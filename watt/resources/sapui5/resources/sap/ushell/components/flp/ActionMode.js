// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.components.flp.ActionMode");var A=function(){this.oEventBus=sap.ui.getCore().getEventBus();this.oEventBus.subscribe('launchpad','actionModeInactive',this.scrollToViewPoint,this);this.oEventBus.subscribe('launchpad','actionModeActive',this.scrollToViewPoint,this);this.viewPoint=undefined;this.init=function(m){this.oModel=m;var n=sap.ui.getCore().byId('navContainerFlp'),c=n.getCurrentPage().getViewName(),i=c=="sap.ushell.components.flp.launchpad.dashboard.DashboardContent";if(i){b(m);}};},_=function(m){var t=new sap.m.Button("ActionModeBtn",{text:sap.ushell.resources.i18n.getText("activateActionMode"),icon:'sap-icon://edit',tooltip:sap.ushell.resources.i18n.getText("activateActionMode"),press:function(){sap.ushell.components.flp.ActionMode.toggleActionMode(m,"Menu Item");}});sap.ushell.renderers.fiori2.RendererExtensions.addOptionsActionSheetButton(t,"home");if(m.getProperty("/enableHelp")){t.addStyleClass('help-id-ActionModeBtn');}},a=function(m){var f=new sap.ushell.ui.shell.ShellFloatingAction({id:"floatingActionBtn",icon:'sap-icon://edit',press:function(e){sap.ushell.components.flp.ActionMode.toggleActionMode(m,"Floating Button");},tooltip:sap.ushell.resources.i18n.getText("activateActionMode")});f.data("sap-ui-fastnavgroup","true",true);f.addEventDelegate({onsapskipback:function(e){e.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;},onsaptabprevious:function(e){e.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;}});if(m.getProperty("/enableHelp")){f.addStyleClass('help-id-floatingActionBtn');}sap.ushell.renderers.fiori2.RendererExtensions.addFloatingActionButton(f,"home");},b=function(m){if(m.getProperty("/actionModeMenuButtonEnabled")){_(m);}if(m.getProperty("/actionModeFloatingButtonEnabled")){a(m);}},s=function(e){var c=e.target;if(!$(c).hasClass("sapUshellTileActionLayerDiv")){setTimeout($.proxy(sap.ushell.components.flp.ActionMode.deactivate(),sap.ushell.components.flp.ActionMode),0);}};A.prototype.activate=function(){var f,t;this.eventDelegateObj={ontap:s,ontouchstart:s,onmousedown:s};jQuery.sap.require("sap.m.MessageToast");sap.m.MessageToast.show(sap.ushell.resources.i18n.getText("actionModeActivated"),{duration:4000});this.calcViewPosition();this.oModel.setProperty('/tileActionModeActive',true);this.aOrigHiddenGroupsIds=sap.ushell.utils.getCurrentHiddenGroupIds(this.oModel);f=sap.ui.getCore().byId("floatingActionBtn");if(f){f.addStyleClass("sapUshellActive");f.setTooltip(sap.ushell.resources.i18n.getText("deactivateActionMode"));}t=sap.ui.getCore().byId("ActionModeBtn");if(t){t.setTooltip(sap.ushell.resources.i18n.getText("exitPersonalizationMode"));t.setText(sap.ushell.resources.i18n.getText("exitPersonalizationMode"));}this.oEventBus.publish('launchpad','actionModeActive');};A.prototype.calcViewPosition=function(){var j=jQuery('#dashboardGroups').find('.sapUshellTileContainer').not('.sapUshellHidden'),i;if(j){for(i=0;i<j.length;i++){var u=j[i],f=jQuery(u).parent().offset().top;if(f>0){var c=jQuery(u).attr("id"),g=sap.ui.getCore().byId(c),d={group:g,fromTop:f};this.viewPoint=d;return;}}}};A.prototype.scrollToViewPoint=function(){window.setTimeout(jQuery.proxy(this.oEventBus.publish,this.oEventBus,"launchpad","scrollToFirstVisibleGroup",this.viewPoint),0);};A.prototype.deactivate=function(){var t=sap.ui.getCore().byId("TileActions"),T,f;this.calcViewPosition();this.oModel.setProperty('/tileActionModeActive',false);this.oEventBus.publish("launchpad",'actionModeInactive',this.aOrigHiddenGroupsIds);if(t!==undefined){t.destroy();}f=sap.ui.getCore().byId("floatingActionBtn");if(f){f.removeStyleClass("sapUshellActive");f.setTooltip(sap.ushell.resources.i18n.getText("activateActionMode"));}T=sap.ui.getCore().byId("ActionModeBtn");if(T){T.setTooltip(sap.ushell.resources.i18n.getText("activateActionMode"));T.setText(sap.ushell.resources.i18n.getText("activateActionMode"));}};A.prototype.toggleActionMode=function(m,S){var t=m.getProperty('/tileActionModeActive');if(t){this.deactivate();}else{this.activate();sap.ui.getCore().getEventBus().publish("launchpad","enterEditMode",{source:S});}};A.prototype.activateGroupEditMode=function(g){var j=jQuery(g.getDomRef()).find('.sapUshellTileContainerContent');j.addClass("sapUshellTileContainerEditMode");};A.prototype._openActionsMenu=function(e,t){var c=this,T=t||e.getSource(),l=sap.ushell.Container.getService("LaunchPage"),d=[],o=sap.ui.getCore().byId("TileActions"),i,n,B,f,g,h;if(T){g=T.getBindingContext().getObject().object;d=l.getTileActions(g);}c.oTileControl=T;jQuery(".sapUshellTileActionLayerDivSelected").removeClass("sapUshellTileActionLayerDivSelected");var j=jQuery(e.getSource().getDomRef()).find(".sapUshellTileActionLayerDiv");j.addClass("sapUshellTileActionLayerDivSelected");if(o===undefined){o=new sap.m.ActionSheet("TileActions",{placement:sap.m.PlacementType.Auto,afterClose:function(){$(".sapUshellTileActionLayerDivSelected").removeClass("sapUshellTileActionLayerDivSelected");var E=sap.ui.getCore().getEventBus();E.publish("dashboard","actionSheetClose",c.oTileControl);}});}else{o.destroyButtons();}if(d.length===0||T.oParent.getProperty("isGroupLocked")){n=new sap.m.Button({text:sap.ushell.resources.i18n.getText("tileHasNoActions"),enabled:false});o.addButton(n);}else{for(i=0;i<d.length;i++){f=d[i];h=function(f){return function(){c._handleActionPress(f);};}(f);B=new sap.m.Button({text:f.text,icon:f.icon,press:h});o.addButton(B);}}o.openBy(e.getSource());};A.prototype._handleActionPress=function(o){if(o.press){o.press.call();}else if(o.targetURL){if(o.targetURL.indexOf("#")==0){hasher.setHash(o.targetURL);}else{window.open(o.targetURL,'_blank');}}else{sap.m.MessageToast.show("No Action");}};sap.ushell.components.flp.ActionMode=new A();}());
