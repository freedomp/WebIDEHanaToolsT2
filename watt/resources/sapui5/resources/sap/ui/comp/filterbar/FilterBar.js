/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/m/MultiInput','sap/m/ActionSheet','sap/m/Bar','sap/m/Button','sap/m/ButtonType','sap/m/CheckBox','sap/m/CustomListItem','sap/m/Dialog','sap/m/Label','sap/m/LabelDesign','sap/m/Link','sap/m/List','sap/m/ListSeparators','sap/m/ListType','sap/m/Panel','sap/m/PlacementType','sap/m/SearchField','sap/m/Text','sap/m/Toolbar','sap/m/ToolbarSpacer','sap/ui/Device','./VariantConverterFrom','./VariantConverterTo','sap/ui/comp/library','sap/ui/comp/smartvariants/PersonalizableInfo','sap/ui/comp/smartvariants/SmartVariantManagement','sap/ui/comp/smartvariants/SmartVariantManagementUi2','sap/ui/comp/variants/VariantManagement','sap/ui/core/Icon','sap/ui/core/TextAlign','sap/ui/core/Title','sap/ui/core/ValueState','sap/ui/layout/Grid','sap/ui/layout/GridData','sap/ui/layout/HorizontalLayout','sap/ui/layout/ResponsiveFlowLayout','sap/ui/layout/ResponsiveFlowLayoutData','sap/ui/layout/VerticalLayout','sap/ui/layout/form/Form','sap/ui/layout/form/FormContainer','sap/ui/layout/form/FormElement','sap/ui/layout/form/ResponsiveGridLayout','sap/ui/layout/form/FormRenderer'],function(q,M,A,B,a,b,C,c,D,L,d,e,f,g,h,P,k,S,T,l,m,o,V,p,r,s,t,u,v,I,w,x,y,G,z,H,R,E,F,J,K,N,O,Q){"use strict";var U=G.extend("sap.ui.comp.filterbar.FilterBar",{metadata:{library:"sap.ui.comp",properties:{persistencyKey:{type:"string",group:"Misc",defaultValue:null},advancedMode:{type:"boolean",group:"Misc",defaultValue:false},expandAdvancedArea:{type:"boolean",group:"Misc",defaultValue:false,deprecated:true},searchEnabled:{type:"boolean",group:"Misc",defaultValue:true},filterBarExpanded:{type:"boolean",group:"Misc",defaultValue:true},considerGroupTitle:{type:"boolean",group:"Misc",defaultValue:false},showClearButton:{type:"boolean",group:"Misc",defaultValue:false},showRestoreButton:{type:"boolean",group:"Misc",defaultValue:true},showGoOnFB:{type:"boolean",group:"Misc",defaultValue:true},showRestoreOnFB:{type:"boolean",group:"Misc",defaultValue:false},showClearOnFB:{type:"boolean",group:"Misc",defaultValue:false},showGoButton:{type:"boolean",group:"Misc",defaultValue:null,deprecated:true}},aggregations:{filterItems:{type:"sap.ui.comp.filterbar.FilterItem",multiple:true,singularName:"filterItem"},filterGroupItems:{type:"sap.ui.comp.filterbar.FilterGroupItem",multiple:true,singularName:"filterGroupItem"}},associations:{basicSearch:{type:"sap.m.SearchField",multiple:false}},events:{cancel:{},reset:{parameters:{selectionSet:{type:"sap.ui.core.Control[]"}}},search:{parameters:{selectionSet:{type:"sap.ui.core.Control[]"}}},beforeVariantSave:{parameters:{context:{type:"string"}}},beforeVariantFetch:{},afterVariantLoad:{parameters:{context:{type:"string"}}},filterChange:{},clear:{parameters:{selectionSet:{type:"sap.ui.core.Control[]"}}},initialise:{},afterVariantSave:{}}}});U.INTERNAL_GROUP="__$INTERNAL$";U.prototype.init=function(){this._oBasicAreaLayout=null;this._oVariantManagement=null;this._oCollectiveSearch=null;this._aBasicAreaSelection=null;this._mAdvancedAreaFilter=null;this._fRegisteredFetchData=null;this._fRegisteredApplyData=null;this._fRegisterGetFiltersWithValues=null;this._oHideShowButton=null;this._oSearchButton=null;this._oFiltersButton=null;this._oClearButtonOnFB=null;this._oRestoreButtonOnFB=null;this._oDialog=null;this._oFilterDialog=null;this._oActionSheet=null;this._oBasicSearchField=null;this._oVariant={};this._filterChangeSemaphore=true;this._fRegisteredFilterChangeHandlers=null;this._fInitialiseVariants=null;this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.addStyleClass("sapUiCompFilterBar");if(this._isPhone()){this.addStyleClass("sapUiCompFilterBarPhone");}else{this.addStyleClass("sapUiCompFilterBarNonPhone");}this.addStyleClass("sapUiCompFilterBarMarginBottom");this.addStyleClass("sapUiCompFilterBarPaddingPanel");this._oToolbar=this._createToolbar();this._oToolbar.setLayoutData(new z({span:"L12 M12 S12"}));this.addContent(this._oToolbar);this._oBasicAreaLayout=this._createBasicAreaLayout();this._oBasicAreaLayout.setLayoutData(new z({span:"L12 M12 S12"}));this.addContent(this._oBasicAreaLayout);this._oAdvancedPanel=new P();this._oAdvancedPanel.setLayoutData(new z({span:"L12 M12 S12"}));this._oAdvancedPanel.setVisible(false);this._oAdvancedAreaForm=this._createAdvancedAreaForm();this._oAdvancedPanel.addContent(this._oAdvancedAreaForm);this.addContent(this._oAdvancedPanel);q(window).on("resize.basicsearch",q.proxy(this._fHandleResize,this));this.oModel=new sap.ui.model.json.JSONModel({});this.setModel(this.oModel,"FilterBar");this.setFilterBarExpanded((this._isTablet()||this._isPhone())?false:this.getFilterBarExpanded());};U.prototype.setShowClearOnFB=function(i){if(!this._isPhone()){this.setProperty("showClearOnFB",i);this._oClearButtonOnFB.setVisible(i);}};U.prototype.setShowRestoreOnFB=function(i){if(!this._isPhone()){this.setProperty("showRestoreOnFB",i);this._oRestoreButtonOnFB.setVisible(i);}};U.prototype.setShowGoOnFB=function(i){this.setProperty("showGoOnFB",i);this._oSearchButton.setVisible(i);};U.prototype.setShowGoButton=function(i){this.setShowGoOnFB(i);};U.prototype.getShowGoButton=function(){return this.getShowGoOnFB();};U.prototype.setCurrentVariantId=function(i,j){if(this._oVariantManagement){this._oVariantManagement.setCurrentVariantId(i,j);}};U.prototype.getCurrentVariantId=function(){var i="";if(this._oVariantManagement){i=this._oVariantManagement.getCurrentVariantId();}return i;};U.prototype.getDataSuiteFormat=function(i){var j=null;var n,W,X;if(this._oVariantManagement){n=this.getCurrentVariantId();if(this.getFilterDataAsString){X=this._determineVariantFiltersInfo(i);W=this.getFilterDataAsString(i);if(W){var Y=new p();j=Y.convert(n,X,W,this);}}}return j;};U.prototype.setDataSuiteFormat=function(i,j){var n,W;var X;if(i){n=new V();W=n.convert(i,this);if(W){X=this._getConsiderFilterChanges();if(W.payload&&this.setFilterDataAsString){this._setConsiderFilterChanges(false);this.setFilterDataAsString(W.payload,j);}if(W.variantId&&this._oVariantManagement){this._oVariantManagement.setInitialSelectionKey(W.variantId);}this._setConsiderFilterChanges(X);}}};U.prototype.setPersistencyKey=function(i){this.setProperty("persistencyKey",i);if(this._oVariantManagement){this._oVariantManagement.setVisible(true);}};U.prototype.clearVariantSelection=function(){if(this._oVariantManagement){this._oVariantManagement.clearVariantSelection();}};U.prototype.setSearchEnabled=function(i){this.setProperty("searchEnabled",i);if(this._oSearchButton){this._oSearchButton.setEnabled(i);}};U.prototype.getSearchEnabled=function(){return this.getProperty("searchEnabled");};U.prototype.setSearchButtonEmphType=function(i){};U.prototype.setSimplifiedMode=function(i){};U.prototype.getSimplifiedMode=function(){if(this.getAdvancedMode()){return false;}return true;};U.prototype.setExpandAdvancedArea=function(i){this.setFilterBarExpanded(i);};U.prototype.getExpandAdvancedArea=function(){return this.getFilterBarExpanded();};U.prototype.setAdvancedMode=function(i){this.setProperty("advancedMode",i);if(i){if(this._oVariantManagement){this._oVariantManagement.setVisible(false);}if(this._oToolbar){this._oToolbar.addStyleClass("sapUiCompFilterBarToolbarBasicSearchNoVariant");}if(this._oBasicSearchField){if(this._oToolbar.indexOfContent(this._oBasicSearchField)<0){this._oToolbar.insertContent(this._oBasicSearchField,1);}}}else{if(this.getPersistencyKey()){if(this._oVariantManagement){this._oVariantManagement.setVisible(true);}if(this._oToolbar){this._oToolbar.removeStyleClass("sapUiCompFilterBarToolbarBasicSearchNoVariant");}}}this._oFiltersButton.setVisible(!i);this._oHideShowButton.setVisible((i&&this._isPhone())?false:true);this._oBasicAreaLayout.setVisible(!i);this._oAdvancedPanel.setVisible(i);};U.prototype._setCollectiveSearch=function(i){if(this.getAdvancedMode()&&i){if(this._oToolbar){if(this._oVariantManagement){this._oToolbar.removeContent(this._oVariantManagement);this._oVariantManagement=null;}if(this._oCollectiveSearch){this._oToolbar.removeContent(this._oCollectiveSearch);}this._oCollectiveSearch=i;this._oToolbar.insertContent(this._oCollectiveSearch,0);this._oToolbar.removeStyleClass("sapUiCompFilterBarToolbarBasicSearchNoVariant");}}};U.prototype.setBasicSearch=function(i){this.setAssociation("basicSearch",i,true);if(this._oBasicSearchField){this._oToolbar.removeContent(this._oBasicSearchField);}if(i&&(!this._isPhone()||this.getAdvancedMode())){this._oToolbar.insertContent(i,1);}this._oBasicSearchField=i;};U.prototype.addFilterItem=function(i){var n,j,W;if(!i){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterItem()"+" Expected argument 'oFilterItem' may not be null nor empty");}n=i.getName();if(!n){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterItem()"+" Expected argument 'oFilterItem.name' may not be null nor empty");}j=i.getControl();if(!j){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterItem()"+" Expected argument 'oFilterItem.control' may not be null nor empty");}this.addAggregation("filterItems",i,true);if(!this._aBasicAreaSelection){this._aBasicAreaSelection=[];}var X={control:i.getControl(),filterItem:i};this._aBasicAreaSelection.push(X);W=new sap.ui.comp.filterbar.FilterGroupItem({label:i.getLabel(),labelTooltip:i.getLabelTooltip(),name:i.getName(),mandatory:i.getMandatory(),visible:i.getVisible(),visibleInFilterBar:i.getVisibleInFilterBar(),partOfCurrentVariant:true,control:i.getControl(),groupName:U.INTERNAL_GROUP,groupTitle:""});if(i.data('isCustomField')){W.data('isCustomField',true);}i.attachChange(this._filterItemChange.bind(this,null));this.addFilterGroupItem(W);};U.prototype.addFilterGroupItem=function(i){var n,j,W,X;if(!i){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterGroupItem()"+" Expected argument 'oFilterGroupItem' may not be null nor empty");}this.addAggregation("filterGroupItems",i,true);j=i.getGroupName();if(!j){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterGroupItems()"+" GroupName may not be null nor empty");}n=i.getName();if(!n){throw new Error("sap.ui.comp.filterbar.FilterBar.prototype.addFilterGroupItems()"+" Name may not be null nor empty");}if(!this._mAdvancedAreaFilter){this._mAdvancedAreaFilter={};}if(!this._mAdvancedAreaFilter[j]){this._mAdvancedAreaFilter[j]={};this._mAdvancedAreaFilter[j].filterItem=i;this._mAdvancedAreaFilter[j].items=[];}W={control:i.getControl(),filterItem:i};if(this.getAdvancedMode()||i.getVisibleInFilterBar()){i.setVisibleInFilterBar(true);}else{i.setVisibleInFilterBar(false);}this._mAdvancedAreaFilter[j].items.push(W);X=this._addControlToBasicAreaFormContainer(i);if(X){W.container=X;X.setVisible(i.getVisible()&&i.getVisibleInFilterBar());if(i.getVisibleInFilterBar()){i.setPartOfCurrentVariant(i.getVisibleInFilterBar());}i.attachChange(this._filterGroupItemChange.bind(this));}if(this.getAdvancedMode()){this._rerenderAA();}};U.prototype._filterItemChange=function(i,j){var n;var W;var X;if(j&&j.oSource&&(j.oSource instanceof sap.ui.comp.filterbar.FilterItem)){X=j.getParameter("propertyName");if(X==="visibleInFilterBar"||X==="visible"||X==="label"||X==="mandatory"){n=this._determineItemByName(j.oSource.getName(),U.INTERNAL_GROUP);if(n&&n.filterItem){if((X==="visible")){W=j.oSource.getVisible();n.filterItem.setVisible(W);}else if(X==="visibleInFilterBar"){W=j.oSource.getVisibleInFilterBar();var Y=this._checkChangePossibleVisibleInFilterBar(n.filterItem,W);if(Y){n.filterItem.setVisibleInFilterBar(W);}else{j.oSource.setVisibleInFilterBar(true);}}else if(X==="label"){n.filterItem.setLabel(j.oSource.getLabel());}else if(X==="mandatory"){W=j.oSource.getMandatory();n.filterItem.setMandatory(W);}}}}};U.prototype._filterGroupItemChange=function(i){var j;var n;if(i&&i.oSource){n=i.getParameter("propertyName");if(n==="visibleInFilterBar"||n==="visible"){j=this._determineItemByName(i.oSource.getName(),i.oSource.getGroupName());if(j){if(n==="visibleInFilterBar"){var W=i.oSource.getVisibleInFilterBar();var X=this._checkChangePossibleVisibleInFilterBar(i.oSource,W);if(!X){i.oSource.setVisibleInFilterBar(true);W=true;}if(W){i.oSource.setPartOfCurrentVariant(true);}if(!this.getAdvancedMode()){this._rerenderItem(j);this._adaptLinkText(i.oSource.getGroupName());}}else if(n==="visible"){if(this.getAdvancedMode()&&j.container){j.container.setVisible(true);}else{this._updateToolbarText();this._rerenderGroup(j,i.oSource.getGroupName());}}}}else if(n==="groupTitle"){if(this._mAdvancedAreaFilter&&this._mAdvancedAreaFilter[i.oSource.getGroupName()]){if(this._mAdvancedAreaFilter[i.oSource.getGroupName()].formcontainer){this._mAdvancedAreaFilter[i.oSource.getGroupName()].formcontainer.setTitle(i.oSource.getGroupTitle());}else{this._adaptGroupTitle(i.oSource.getGroupName());}}}else if(n==="label"){if(!this._mAdvancedAreaFilter[i.oSource.getGroupName()].formcontainer){this._adaptGroupTitleForFilter(i.oSource);}}else if(n==="mandatory"){if(this._oFilterDialog){this._adaptMandatoryForFilter(i.oSource);}}if(this.getAdvancedMode()){this._rerenderAA();}}};U.prototype._checkChangePossibleVisibleInFilterBar=function(i,j){if(i&&i.getMandatory()&&!j){var n=this._hasFilterValue(i);if(!n){i.setVisibleInFilterBar(true);return false;}}return true;};U.prototype._adaptLinkText=function(i){if(this._mAdvancedAreaFilter&&this._mAdvancedAreaFilter[i]&&this._mAdvancedAreaFilter[i].link){this._setLinkText(i,this._mAdvancedAreaFilter[i].link);}};U.prototype._hasFilterValue=function(i){var j=this._getFiltersWithValues();return this._checkFilterForValue(j,i);};U.prototype._adaptMandatoryForFilter=function(i){var j;var n=i.getGroupName();if(i){j=this._determineItemByName(i.getName(),n);if(j&&j.checkbox&&j.checkbox.getVisible()){var W=true;if(i.getMandatory()){var X=this._hasFilterValue(i);if(!X){W=false;i.setVisibleInFilterBar(true);}}j.checkbox.setEnabled(W);}}};U.prototype._adaptGroupTitleForFilter=function(i){var j;var n;if(i){j=i.getLabel();n=i.getLabelControl(this.getId());if(this.getConsiderGroupTitle()){if(n&&i.getGroupTitle()){n.setText(j+" ("+i.getGroupTitle()+')');}}else{n.setText(j);}}};U.prototype._adaptGroupTitle=function(j){var i;var n;if(this._mAdvancedAreaFilter&&this._mAdvancedAreaFilter[j]&&this._mAdvancedAreaFilter[j].items){for(i=0;i<this._mAdvancedAreaFilter[j].items.length;i++){n=this._mAdvancedAreaFilter[j].items[i];if(n&&n){this._adaptGroupTitleForFilter(n.filterItem);}}}};U.prototype._adaptGroupsTitle=function(){var n=null;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n&&n!==U.INTERNAL_GROUP){this._adaptGroupTitle(n);}}}};U.prototype.registerGetFiltersWithValues=function(i){this._fRegisterGetFiltersWithValues=i;};U.prototype.registerFetchData=function(i){this._fRegisteredFetchData=i;};U.prototype.registerApplyData=function(i){this._fRegisteredApplyData=i;};U.prototype._isTINAFScenario=function(){if(this._oVariantManagement){if(this._oVariantManagement instanceof t){return true;}}else{if(this._oCollectiveSearch&&this.getAdvancedMode()){return true;}}return false;};U.prototype.fireInitialise=function(){if(this._isTINAFScenario()){this._fireInitialiseEvent();}else{this._initializeVariantManagement();}};U.prototype._initializeVariantManagement=function(){if(this._oVariantManagement&&this.getPersistencyKey()){this._fInitialiseVariants=q.proxy(this._initialiseVariants,this);this._oVariantManagement.attachInitialise(this._fInitialiseVariants);this._oVariantManagement.initialise();}else{this._fireInitialiseEvent();}};U.prototype._fireInitialiseEvent=function(){this.fireEvent("initialise");this._updateToolbarText();};U.prototype._initialiseVariants=function(){this._fireInitialiseEvent();if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(false);}};U.prototype.fireAfterVariantLoad=function(i){this._rerenderFilters();var j={context:i};this.fireEvent("afterVariantLoad",j);};U.prototype.fireBeforeVariantSave=function(i){var j={context:i};var n=this._getConsiderFilterChanges();if(i){this._setConsiderFilterChanges(false);}this.fireEvent("beforeVariantSave",j);if(i){this._setConsiderFilterChanges(n);}};U.prototype.removeAllFilterItems=function(){var i;var j;this._aBasicAreaSelection=null;var n=this._oBasicAreaLayout.getContent();if(n){for(i=0;i<n.length;i++){this._oBasicAreaLayout.removeContent(n[i]);}}j=this.getFilterItems();if(this._mAdvancedAreaFilter){if((this._mAdvancedAreaFilter[U.INTERNAL_GROUP])&&(this._mAdvancedAreaFilter[U.INTERNAL_GROUP].items)){for(i=0;i<this._mAdvancedAreaFilter[U.INTERNAL_GROUP].items.length;i++){if(this._mAdvancedAreaFilter[U.INTERNAL_GROUP].items[i].filterItem){j.push(this._mAdvancedAreaFilter[U.INTERNAL_GROUP].items[i].filterItem);}}delete this._mAdvancedAreaFilter[U.INTERNAL_GROUP];}if(Object.keys(this._mAdvancedAreaFilter).length===0){this._mAdvancedAreaFilter=null;}}this._destroyItems(j);};U.prototype.removeAllFilterGroupItems=function(){var n=null,i;var j=[];for(n in this._mAdvancedAreaFilter){if(n){if(this._mAdvancedAreaFilter[n]&&this._mAdvancedAreaFilter[n].items){for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){if(this._mAdvancedAreaFilter[n].items[i].filterItem){j.push(this._mAdvancedAreaFilter[n].items[i].filterItem);}}delete this._mAdvancedAreaFilter[n];}}if(Object.keys(this._mAdvancedAreaFilter).length===0){this._mAdvancedAreaFilter=null;}}this._destroyItems(j);};U.prototype.removeBasicSearch=function(){this.setBasicSearch(null);};U.prototype.getAllFilterItems=function(j){var i,n=null;var W=[];var X,Y;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){X=this._mAdvancedAreaFilter[n];if(X.items){for(i=0;i<X.items.length;i++){Y=X.items[i];if(Y&&Y.filterItem&&Y.filterItem.getVisible()){if(j){if(Y.filterItem.getVisibleInFilterBar()||Y.filterItem.getPartOfCurrentVariant()){W.push(Y.filterItem);}}else{W.push(Y.filterItem);}}}}}}}return W;};U.prototype._clearErrorState=function(){var i;var j;var n=this.determineMandatoryFilterItems();if(n){for(i=0;i<n.length;i++){j=this.determineControlByFilterItem(n[i]);if(j&&j.setValueState){j.setValueState(y.None);}}}};U.prototype._destroyItems=function(j){if(j&&j.length){for(var i=0;i<j.length;i++){j[i].destroy();}}};U.prototype._reapplyVisibility=function(j){var i,n=null;var W;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){var X=this._mAdvancedAreaFilter[n];if(X&&X.items){for(i=0;i<X.items.length;i++){W=X.items[i];if(W&&W.filterItem){this._setPersVisibility(j,W.filterItem);}}if(n!==U.INTERNAL_GROUP){this._adaptLinkText(n);}}}}}};U.prototype._setPersVisibility=function(i,j){var n,W;var X;if(j){W=j.getName();n=j.getGroupName();X=this._checkForFilterInfo(i,W,n);if(this._isTINAFScenario()){if(X){j.setVisibleInFilterBar((X.visibleInFilterBar));j.setPartOfCurrentVariant((X.partOfCurrentVariant));}}else{if(X&&(X.visibleInFilterBar!==undefined)){j.setVisibleInFilterBar((X.visibleInFilterBar));j.setPartOfCurrentVariant((X.partOfCurrentVariant));}else{if((n!==U.INTERNAL_GROUP)&&X&&(X.group===n)){j.setVisibleInFilterBar((X!==null));}}}if(n===U.INTERNAL_GROUP){j.setPartOfCurrentVariant(true);}}};U.prototype._checkForFilterInfo=function(j,n,W){var i;var X=null;if(j&&j.length){for(i=0;i<j.length;i++){if((j[i].name===n)&&(j[i].group===W)){X=j[i];break;}}}return X;};U.prototype._createVariantManagement=function(){var i=new u({});var j=new s({type:"filterBar",keyName:"persistencyKey"});j.setControl(this);i.addPersonalizableControl(j);i.addStyleClass("sapUiCompFilterBarMarginLeft");return i;};U.prototype._getFiltersWithValues=function(){if(this._fRegisterGetFiltersWithValues){try{return this._fRegisterGetFiltersWithValues();}catch(i){q.sap.log.error("callback for obtaining the filter count throws an exception");}}return null;};U.prototype._getFiltersWithValuesCount=function(){var i,n=0;var j=this._getFiltersWithValues();if(j){for(i=0;i<j.length;i++){if(j[i].getVisible()&&(j[i].getVisibleInFilterBar()||j[i].getPartOfCurrentVariant())){n++;}}}return n;};U.prototype._checkFilterForValue=function(j,n){var i;if(j){for(i=0;i<j.length;i++){if(j[i]===n){return true;}}}return false;};U.prototype._handleVisibilityOfToolbar=function(){if(this.getAdvancedMode()){var j=false;var n=this._oToolbar.getContent();for(var i=0;i<n.length;i++){if(n[i]instanceof m){continue;}if(n[i].getVisible&&n[i].getVisible()){j=true;break;}}this._oToolbar.setVisible(j);}};U.prototype._toggleHideShow=function(){this.setFilterBarExpanded(!this.getFilterBarExpanded());};U.prototype._updateToolbarText=function(){var n=this._getFiltersWithValuesCount();var i=n?(this._oRb.getText("FILTER_BAR_ACTIVE_FILTERS",[n])):(this._oRb.getText("FILTER_BAR_ACTIVE_FILTERS_ZERO"));this._oFiltersButton.setText(i);};U.prototype.setFilterBarExpanded=function(i){if(this.getAdvancedMode()){this.setProperty("filterBarExpanded",i);if(i){this._oHideShowButton.setText(this._oRb.getText("FILTER_BAR_VH_HIDE"));}else{this._oHideShowButton.setText(this._oRb.getText("FILTER_BAR_VH_SHOW"));}this._oSearchButton.setVisible(this.getShowGoOnFB());this._oAdvancedPanel.setVisible(i);}else{var j=this._isPhone()?false:i;this.setProperty("filterBarExpanded",j);if(this._isPhone()){this._oHideShowButton.setVisible(false);this._oSearchButton.setVisible(this.getShowGoOnFB());this._oBasicAreaLayout.setVisible(false);}else{if(j){this._oHideShowButton.setText(this._oRb.getText("FILTER_BAR_HIDE"));}else{this._oHideShowButton.setText(this._oRb.getText("FILTER_BAR_SHOW"));}this._oHideShowButton.setVisible(true);this._oSearchButton.setVisible(this.getShowGoOnFB());this._oBasicAreaLayout.setVisible(j);}}this._updateToolbarText();};U.prototype._selectionChangedInFilterDialog=function(i,j){j.setVisibleInFilterBar(i.getSelected());if(this._getConsiderFilterChanges()&&this._oVariantManagement&&this._oVariantManagement.getEnabled()){this._oVariantManagement.currentVariantSetModified(true);}this._bDirtyViaDialog=true;};U.prototype._mandatoryFilterChange=function(i){if(!i){return;}var j=i.getParameters();if(!j||!j.oSource){return;}var n=this._determineByControl(j.oSource);if(n&&n.checkbox){var W=n.filterItem;if(!W.getMandatory()){return;}var X=this._hasFilterValue(W);if(W.getVisibleInFilterBar()){if(X){n.checkbox.setEnabled(true);}else{n.checkbox.setEnabled(false);}}else{if(!X){W.setVisibleInFilterBar(true);n.checkbox.setSelected(true);n.checkbox.setEnabled(false);}}}};U.prototype._createFiltersAndAdaptBasicArea=function(){var i;this._setConsiderFilterChanges(false);this._recreateBasicAreaContainer(true);i=this._createFilters();this._setConsiderFilterChanges(true);return i;};U.prototype._determineNotAssignedFiltersCount=function(j){var n=0,i;var W;if(this._mAdvancedAreaFilter[j]&&this._mAdvancedAreaFilter[j].items){for(i=0;i<this._mAdvancedAreaFilter[j].items.length;i++){W=this._mAdvancedAreaFilter[j].items[i].filterItem;if(!W.getVisible()){continue;}if(!W.getPartOfCurrentVariant()&&!W.getVisibleInFilterBar()){n++;}}}return n;};U.prototype._rerenderGroup=function(j,n){var i;var W;this._rerenderItem(j);this._adaptLinkText(n);if(j.formelement){if(this._mAdvancedAreaFilter[n]&&this._mAdvancedAreaFilter[n].items&&this._mAdvancedAreaFilter[n].formcontainer){for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){W=this._mAdvancedAreaFilter[n].items[i].filterItem;if(W&&W.getVisible()){this._mAdvancedAreaFilter[n].formcontainer.setVisible(true);return;}}this._mAdvancedAreaFilter[n].formcontainer.setVisible(false);}}};U.prototype._setLinkTextAndCount=function(i,j,n){var W;if(n){W=this._oRb.getText("FILTER_BAR_SHOW_MORE_FILTERS",[n]);}else{W=this._oRb.getText("FILTER_BAR_SHOW_CHANGE_FILTERS");}j.setText(W);};U.prototype._setLinkText=function(i,j){var n=this._determineNotAssignedFiltersCount(i);this._setLinkTextAndCount(i,j,n);};U.prototype._createLink=function(i,j){var n=this;var W=new e();this._setLinkText(i,W);W.attachPress(function(){n._createAddRemoveFiltersDialog(i,W);});if(j){W.addAriaLabelledBy(j);}return W;};U.prototype._isPhone=function(){return(o.system.phone)?true:false;};U.prototype._isTablet=function(){return(o.system.tablet&&!o.system.desktop)?true:false;};U.prototype._createForm=function(i){var j=this;var n=null;n=J.extend('sap.ui.comp.filterbar.Form',{metadata:{},renderer:function(W,X){Q.render.apply(this,arguments);}});(function(){n.prototype.contentOnAfterRendering=function(){J.prototype.contentOnAfterRendering.apply(this,arguments);j._adaptStyleSheet();if(!j._isPhone()){j._repositionAddToFilterBarLabel();}};}());return new n({editable:true,layout:i});};U.prototype._adaptStyleSheet=function(){var i,j;var W,X,n=null;for(n in this._mAdvancedAreaFilter){if(n&&this._mAdvancedAreaFilter[n].items){for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){W=this._mAdvancedAreaFilter[n].items[i];if(W&&W.control&&W.control instanceof M){X=W.control.$();if(X){j=X.parent().css("overflow");if(j!=="visible"){X.parent().css({"overflow":"visible"});}}}}}}};U.prototype._createFilters=function(){var j=this;var n=null,i;var W;var X=null,Y,Z,$;var _,a1,b1;var c1=null;var d1;var e1=null;var f1=true;var g1;var h1=new O();h1.setColumnsL(1);h1.setColumnsM(1);var i1=this._createForm(h1);i1.addStyleClass("sapUiCompFilterBarDialogForm");if(this._oVariantManagement){var j1=this._oToolbar.indexOfContent(this._oVariantManagement);if(j1>=0){var k1=this._oVariantManagement.clone();k1._setSelectionByKey(this._oVariantManagement.getSelectionKey());this._oToolbar.removeContent(this._oVariantManagement);this._oToolbar.insertContent(k1,j1);this._oVariant.key=this._oVariantManagement.getSelectionKey();this._oVariant.modified=this._oVariantManagement.currentVariantGetModified();X=new K();this._oVariantManagement.setLayoutData(new z({span:"L10 M10 S12"}));Y=new N({fields:this._oVariantManagement});X.addFormElement(Y);if(!this._isPhone()){e1=new L({});e1.setLayoutData(new z({span:"L2 M2 S2"}));e1.addStyleClass("sapUiCompFilterBarAddFilterLabel");this._oAddToFilterBarLabel=e1;Y=new N({label:e1});X.addFormElement(Y);}i1.addFormContainer(X);}i1.addStyleClass("sapUiCompFilterBarGroupTitle");}if(this._oBasicSearchField){if(!X){X=new K();}if(!this._isPhone()){this._oToolbar.removeContent(this._oBasicSearchField);this._oBasicSearchFieldClone=this._oBasicSearchField.clone();this._oToolbar.insertContent(this._oBasicSearchFieldClone,1);}else{if(this.getAdvancedMode()){this._oBasicSearchFieldClone=this._oBasicSearchField.clone();}}if(this._isPhone()){this._oBasicSearchField.setLayoutData(new z({span:"L8 M8 S12"}));}else{this._oBasicSearchField.setLayoutData(new z({span:"L8 M8 S11",indent:"L0 M3 S0"}));}if(this._isPhone()&&this.getAdvancedMode()){Y=new N({fields:[this._oBasicSearchFieldClone]});}else{Y=new N({fields:[this._oBasicSearchField]});}X.addFormElement(Y);}var l1=this._getFiltersWithValues();this._fRegisteredFilterChangeHandlers=function(m1){j._mandatoryFilterChange(m1);};this.attachFilterChange(this._fRegisteredFilterChangeHandlers);this._oVariant.content=this.fetchVariant();this._oInitialVariant={};q.extend(true,this._oInitialVariant,this._oVariant);for(n in this._mAdvancedAreaFilter){if(n&&this._mAdvancedAreaFilter[n].items){if(n===U.INTERNAL_GROUP){W=this._oRb.getText("FILTER_BAR_BASIC_GROUP");}else{W=this._mAdvancedAreaFilter[n].filterItem.getGroupTitle();}b1=new x({text:W});X=new K({title:b1});if(f1&&W===""&&e1){e1.removeStyleClass("sapUiCompFilterBarAddFilterLabel");e1.addStyleClass("sapUiCompFilterBarAddFilterLabelNoGroup");}f1=false;g1=0;this._mAdvancedAreaFilter[n].formcontainer=X;for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){$=this._mAdvancedAreaFilter[n].items[i];if($.control.getWidth){$.width=$.control.getWidth();if($.control.setWidth){$.control.setWidth("100%");}}a1=$.filterItem.getLabelControl(this.getId());if(this.getConsiderGroupTitle()){a1.setText($.filterItem.getLabel());}c1=new C({tooltip:this._oRb.getText("FILTER_BAR_SHOW_IN_FILTERBAR")});c1.setSelected($.filterItem.getVisibleInFilterBar());if($.filterItem.getMandatory()){d1=this._checkFilterForValue(l1,$.filterItem);if(!d1&&$.filterItem.getVisibleInFilterBar()){c1.setEnabled(false);}}c1.attachSelect(q.proxy(this._selectionChangedInFilterDialog,this,c1,$.filterItem));if(this._isPhone()){a1.setLayoutData(new z({span:"L3 M3 S12"}));$.control.setLayoutData(new z({span:"L8 M8 S12"}));c1.setVisible(false);}else{a1.setLayoutData(new z({span:"L3 M3 S12"}));$.control.setLayoutData(new z({span:"L8 M8 S11"}));c1.setLayoutData(new z({span:"L1 M1 S1"}));}Y=new N({label:a1,fields:[$.control,c1]});Y.setVisible($.filterItem.getVisible()&&($.filterItem.getVisibleInFilterBar()||$.filterItem.getPartOfCurrentVariant()));if(!$.filterItem.getVisible()){g1++;}$.formelement=Y;$.checkbox=c1;X.addFormElement(Y);}Z=X.getFormElements();if(Z&&Z.length>0){if((n!==U.INTERNAL_GROUP)&&!this.getAdvancedMode()){_=this._createLink(n,b1);if(_){if(this._isPhone()){_.setLayoutData(new z({span:"L8 M8 S12"}));}else{_.setLayoutData(new z({span:"L8 M8 S12",indent:"L3 M3 S0"}));}Y=new N({fields:[_]});this._mAdvancedAreaFilter[n].link=_;X.addFormElement(Y);}if(g1===Z.length){X.setVisible(false);}}i1.addFormContainer(X);}}}return i1;};U.prototype._recreateBasicAreaContainer=function(j){var n=null,i;var W,X;var Y,Z;if(this._oVariantManagement){var $=this._oToolbar.getContent();this._oToolbar.removeContent($[0]);this._oToolbar.insertContent(this._oVariantManagement,0);}if(this._oBasicSearchField){if(!this._isPhone()){if(this._oBasicSearchFieldClone){this._oToolbar.removeContent(this._oBasicSearchFieldClone);this._oBasicSearchFieldClone=null;}if(this._oToolbar.indexOfContent(this._oBasicSearchField)<0){this._oToolbar.insertContent(this._oBasicSearchField,1);}}else{if(this.getAdvancedMode()){this._oBasicSearchFieldClone=null;}}}this._oBasicAreaLayout.removeAllContent();for(n in this._mAdvancedAreaFilter){if(n&&this._mAdvancedAreaFilter[n].items){for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){Y=this._mAdvancedAreaFilter[n].items[i].filterItem;if(j){if(!Y.getVisible()||!Y.getVisibleInFilterBar()){continue;}W=this._mAdvancedAreaFilter[n].items[i].control.clone();X=Y.getLabelControl(this.getId()).clone();if(this.getConsiderGroupTitle()){Y.getLabelControl(this.getId()).setText(Y.getLabel());}}else{W=this._mAdvancedAreaFilter[n].items[i].control;X=Y.getLabelControl(this.getId());if(this._mAdvancedAreaFilter[n].items[i].width){W.setWidth(this._mAdvancedAreaFilter[n].items[i].width);}}Z=this._addControlToBasicAreaContainer(Y,W,X);if(Z){Z.setVisible(Y.getVisible()&&Y.getVisibleInFilterBar());this._mAdvancedAreaFilter[n].items[i].container=Z;}}}}};U.prototype._searchRequested=function(i){if(this.search()){this._oFilterDialog.close();}};U.prototype._closeDialogAndRestoreFilterBar=function(i){this._sSearchCriteriaInFiltersDialog=null;this._oVariant={};i.removeAllFormContainers();if(this._oActionSheet){this._oActionSheet.destroy();this._oActionSheet=null;}this._recreateBasicAreaContainer();this._deleteProperties();this._adaptGroupsTitle();if(this._fRegisteredFilterChangeHandlers){this.detachFilterChange(this._fRegisteredFilterChangeHandlers);this._fRegisteredFilterChangeHandlers=null;}this._updateToolbarText();};U.prototype._variantSave=function(i){var j;this._oVariant={};this.fireBeforeVariantSave();if(this._oVariantManagement&&this._oFilterDialog){j=this._oVariantManagement.getSelectionKey();this._oVariant.key=j;this._oVariant.modified=false;this._oVariant.content=this._oVariantManagement.getVariantContent(this,j);}};U.prototype._afterVariantSave=function(i){this.fireAfterVariantSave();};U.prototype._variantSavePressed=function(i){if(this._oVariantManagement){var j=this._oVariantManagement.getSelectionKey();var n=this._oVariantManagement.getItemByKey(this._oVariantManagement.getSelectionKey());if(!this._oVariantManagement._isIndustrySolutionModeAndVendorLayer()&&((j===this._oVariantManagement.getStandardVariantKey())||(n&&n.getReadOnly&&n.getReadOnly()))){this._oVariantManagement._openSaveAsDialog();}else{this._oVariantManagement._variantSavePressed();}}};U.prototype._findFirstVisibleGroup=function(){var n=null;for(n in this._mAdvancedAreaFilter){if(n&&this._mAdvancedAreaFilter[n].formcontainer&&this._mAdvancedAreaFilter[n].formcontainer.getVisible()){return this._mAdvancedAreaFilter[n].formcontainer.getTitle();}}return null;};U.prototype._repositionAddToFilterBarLabel=function(){if(!this._isPhone()){var i=this._findFirstVisibleGroup();if(i&&this._oAddToFilterBarLabel){var j=i.$();if(j){var n=j.offset();var W=this._oAddToFilterBarLabel.$();if(W){var X=W.offset();if(X&&n){X.top=n.top+5;X.right=32;W.offset(X);}}}}if(this._oAddToFilterBarLabel&&!this._oAddToFilterBarLabel.getText()){this._oAddToFilterBarLabel.setText(this._oRb.getText("FILTER_BAR_SHOW_IN_FILTERBAR"));}}};U.prototype._cancelFilterDialog=function(){if(this._oInitialVariant&&this._oInitialVariant.content&&this._bDirtyViaDialog){this._applyVariant(this._oInitialVariant.content,"CANCEL");if(this._oVariantManagement){this._oVariantManagement._setSelectionByKey(this._oInitialVariant.key);this._oVariantManagement.currentVariantSetModified(this._oInitialVariant.modified);}this.fireCancel();}};U.prototype._showFilterDialog=function(){var i=this;this._oFilterDialog=new D({stretch:o.system.phone});this._oFilterDialog.setParent(this);this._oFilterDialog.addStyleClass("sapUiPopupWithPadding");if(this.$().closest(".sapUiSizeCompact").length>0){this._oFilterDialog.addStyleClass("sapUiSizeCompact");}this._oFilterDialog.addStyleClass("sapUiCompFilterBarDialog");if(!this._isPhone()){this._oFilterDialog.addStyleClass("sapUiCompFilterBarDialogNonPhone");}this._oFilterDialog.setTitle(this._oRb.getText("FILTER_BAR_ADV_FILTERS_DIALOG"));this._oFilterDialog.addStyleClass("sapMH4FontSize");this._oFilterDialog.addStyleClass("sapMH4Style");this._oFilterDialog.setVerticalScrolling(true);var j=new B();var n=new S({placeholder:this._oRb.getText("FILTER_BAR_SEARCH")});n.attachLiveChange(function(Y){if(i._oFilterDialog){i._triggerSearchInFilterDialog(Y);}});j.addContentRight(n);this._oFilterDialog.setSubHeader(j);var W=this._createFiltersAndAdaptBasicArea();if(!W){q.sap.log.error("Content for Advanced Filters Dialog could not be created");return;}this._oFilterDialog.addContent(W);this._bOKFiltersDialogTriggered=false;this._oFilterDialog.attachBeforeClose(function(){if(!i._bOKFiltersDialogTriggered){i._cancelFilterDialog();}i._closeDialogAndRestoreFilterBar(W);});this._oFilterDialog.attachAfterClose(function(){i._oBasicAreaLayout.rerender();i._oInitialVariant=null;i._oFilterDialog.destroy();i._oFilterDialog=null;});this._oFilterDialog.setInitialFocus(n);this._addFilterDialogButtons(W);if(!this._isPhone()){this._oFilterDialog.setContentWidth("42rem");}var X=q(document).height()/16;this._oFilterDialog.setContentHeight((X-17)+"rem");this._bDirtyViaDialog=false;this._oFilterDialog.open();};U.prototype._addFilterDialogButtons=function(i){var j=this;var n,W=[];var X=null,Y,Z,$,_;var a1;var b1=0,c1=50;$=new a({text:this._oRb.getText("FILTER_BAR_GO"),press:function(){j._bOKFiltersDialogTriggered=true;$.focus();j._searchRequested(i);},type:b.Emphasized});this._oFilterDialog.addButton($);b1+=$.getText().length;if(!this.getAdvancedMode()){if(this._oVariantManagement&&this._oVariantManagement.getVisible()&&this._oVariantManagement.oVariantSave){X=new a({text:this._oRb.getText("VARIANT_MANAGEMENT_SAVE"),enabled:this._oVariantManagement.oVariantSave.getEnabled(),press:function(){j._variantSavePressed();}});n=this._oVariantManagement.getModel("save_enablement");X.setModel(n);X.bindProperty("enabled","/enabled");W.push(X.clone());X.addStyleClass("sapUiHideOnPhone");this._oFilterDialog.addButton(X);b1+=X.getText().length;}Y=new a({text:this._oRb.getText("FILTER_BAR_CLEAR"),visible:this.getShowClearButton(),press:function(){j.clear();}});if(Y.getVisible()){W.push(Y.clone());b1+=Y.getText().length;}Y.addStyleClass("sapUiHideOnPhone");this._oFilterDialog.addButton(Y);Z=new a({text:this._oRb.getText("FILTER_BAR_RESTORE"),visible:this.getShowRestoreButton(),press:function(){j.reset();if(j._oVariantManagement){j._oVariantManagement.currentVariantSetModified(false);}}});if(n){Z.setEnabled(this._oVariantManagement.oVariantSave.getEnabled());Z.setModel(n);Z.bindProperty("enabled","/enabled");}if(Z.getVisible()){W.push(Z.clone());b1+=Z.getText().length;}Z.addStyleClass("sapUiHideOnPhone");this._oFilterDialog.addButton(Z);_=new a({text:this._oRb.getText("FILTER_BAR_CANCEL"),press:function(){j._oFilterDialog.close();}});this._oFilterDialog.addButton(_);b1+=_.getText().length;if(!this._isPhone()&&b1>c1){if(X){X.addStyleClass("sapUiCompFilterBarButtonHide");}Y.addStyleClass("sapUiCompFilterBarButtonHide");Z.addStyleClass("sapUiCompFilterBarButtonHide");}if(W.length>0){this._oActionSheet=new A({showCancelButton:true,buttons:W,placement:k.Top});a1=new a({icon:"sap-icon://overflow",press:function(){j._oActionSheet.openBy(this);},tooltip:this._oRb.getText("FILTER_BAR_ACTIONS")});if(b1<=c1){a1.addStyleClass("sapUiVisibleOnlyOnPhone");}this._oFilterDialog.addButton(a1);}}};U.prototype._createButtons=function(i){var j=this;this._oHideShowButton=new a({text:this._oRb.getText("FILTER_BAR_HIDE"),type:b.Transparent});this._oHideShowButton.attachPress(function(){j._toggleHideShow();});i.addContent(this._oHideShowButton);this._oClearButtonOnFB=new a({visible:this.getShowClearOnFB(),text:this._oRb.getText("FILTER_BAR_CLEAR"),type:b.Transparent});this._oClearButtonOnFB.attachPress(function(){j.clear();});i.addContent(this._oClearButtonOnFB);this._oRestoreButtonOnFB=new a({visible:this.getShowRestoreOnFB(),text:this._oRb.getText("FILTER_BAR_RESTORE"),type:b.Transparent});this._oRestoreButtonOnFB.attachPress(function(){j.reset();if(j._oVariantManagement){j._oVariantManagement.currentVariantSetModified(false);}});i.addContent(this._oRestoreButtonOnFB);this._oFiltersButton=new a({text:this._oRb.getText("FILTER_BAR_ACTIVE_FILTERS_ZERO"),type:b.Transparent});this._oFiltersButton.attachPress(function(){j._showFilterDialog();});i.addContent(this._oFiltersButton);this._oSearchButton=new a({visible:this.getShowGoOnFB(),text:this._oRb.getText("FILTER_BAR_GO"),type:b.Emphasized});this._oSearchButton.attachPress(function(){j._oSearchButton.focus();j.search();});i.addContent(this._oSearchButton);};U.prototype._createVariantLayout=function(){this._oVariantManagement=this._createVariantManagement();this._oVariantManagement.setVisible(false);this._fSaveVariant=q.proxy(this._variantSave,this);this._oVariantManagement.attachSave(this._fSaveVariant);this._fAfterSaveVariant=q.proxy(this._afterVariantSave,this);this._oVariantManagement.attachAfterSave(this._fAfterSaveVariant);return this._oVariantManagement;};U.prototype._createToolbar=function(){var i=new l();var j=this._createVariantLayout();i.addContent(j);i.addContent(new m());this._createButtons(i);i.addStyleClass("sapUiCompFilterBarToolbar");i.addStyleClass("sapUiCompFilterBarToolbarMarker");return i;};U.prototype._createBasicAreaLayout=function(){var i=new H();i.setAllowWrapping(true);i.addStyleClass("sapUiCompFilterBarWidth100");i.addStyleClass("sapUiCompFilterBarBasicArea");return i;};U.prototype._createAdvancedAreaForm=function(){var i=new O();i.addStyleClass("sapUiCompFilterBarPaddingForm");i.setColumnsL(3);i.setColumnsM(2);var j=new J({editable:true});j.setLayout(i);return j;};U.prototype._addControlToBasicAreaFormContainer=function(i){var j=i.getControl();if(!j){q.sap.log.error("no Control obtained");return null;}var n=i.getLabelControl(this.getId());if(!n){q.sap.log.error("no Label obtained");return null;}this._adaptGroupTitleForFilter(i);return this._addControlToBasicAreaContainer(i,j,n);};U.prototype._addControlToBasicAreaContainer=function(i,j,n){var W=new F();W.setLayoutData(new E({margin:true}));if(j.getWidth){W.setWidth("12rem");}if(n){W.addContent(n);n.setLabelFor(j);}W.addContent(j);W.addStyleClass("sapUiCompFilterBarPaddingRight");W.addStyleClass("sapUiCompFilterBarPaddingTop");if(!this.getAdvancedMode()){this._oBasicAreaLayout.addContent(W);}return W;};U.prototype._rerenderAA=function(){this._oAdvancedAreaForm.removeAllFormContainers();var i=this._flattenMap();this._layOutAA(i);};U.prototype._layOutAA=function(i){if(this._mAdvancedAreaFilter&&Object.keys(this._mAdvancedAreaFilter).length>1){this._layOutAAMultipleGroup(i);}else{this._layOutAASingleGroup(i);}};U.prototype._layOutAAMultipleGroup=function(n){var i,j,W=0;var X=null;for(i=0;i<n.length;i++){if(n[i].control===null){W++;}}var Y=this._oAdvancedAreaForm.getLayout();if(Y){if(W>=3){Y.setLabelSpanL(5);Y.setLabelSpanM(5);Y.setColumnsL(3);Y.setColumnsM(2);}else if(W===2){Y.setLabelSpanL(4);Y.setLabelSpanM(5);Y.setColumnsL(2);Y.setColumnsM(2);}else if(W===1){Y.setLabelSpanL(4);Y.setLabelSpanM(5);Y.setColumnsL(2);Y.setColumnsM(2);}}for(i=0;i<n.length;i++){if(n[i].control===null){X=new K();if(Object.keys(this._mAdvancedAreaFilter).length>1){X.setTitle(n[i].filterItem.getGroupTitle());}this._oAdvancedAreaForm.addFormContainer(X);j=i+1;while(j<n.length&&(n[j].control)){this._addControlToAdvancedArea(n[j].filterItem,n[j].control,X);j++;}i=j-1;}}if(W===1){this._oAdvancedAreaForm.addFormContainer(new K());}};U.prototype._layOutAASingleGroup=function(j){var i,n,W,X;var Y=j.length-1;var Z=Y>2?2:1;if(Z>1){W=Math.floor(Y/Z);X=((W*Z)<Y);for(i=1;i<Z;i++){n=i*W;if(X){++n;}if((n+i)<j.length){j.splice(n+i,0,j[0]);}}}this._layOutAAMultipleGroup(j);};U.prototype._flattenMap=function(){var n=null,i;var j=[];var W;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n&&this._mAdvancedAreaFilter[n].items){W=false;for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){var X=this._mAdvancedAreaFilter[n].items[i];if(X.filterItem&&X.filterItem.getVisibleInFilterBar()&&X.filterItem.getVisible()){if(!W){W=true;j.push({control:null,filterItem:this._mAdvancedAreaFilter[n].filterItem});}j.push({control:X.control,filterItem:X.filterItem});}}}}}return j;};U.prototype._triggerSearchByValue=function(j){var i,n,W;var X;var Y;j=j.replace(/^\s+|\s+$/g,"").toLowerCase();if(this._aListItems){var Z=0;for(i=this._aListItems.length-1;i>=0;i--){X=this._aListItems[i].getContent();if(X.length===2){n=X[1].getText();W=this._aListItems[i].data("quickinfo");if((n.toLowerCase().indexOf(j)>=0||(W&&W.toLowerCase().indexOf(j)>=0))||(this._aListItems[i].hasStyleClass("sapUiCompFilterBarGroupListItem")&&Z>0)){Y=true;if(this._aListItems[i].hasStyleClass("sapUiCompFilterBarGroupListItem")){if(!Z){Y=false;}}else{Z++;}this._aListItems[i].setVisible(Y);}else{this._aListItems[i].setVisible(false);}}}}};U.prototype._triggerSearch=function(i){if(!i){return;}var j=i.getParameters();if(!j){return;}var n=j.newValue?j.newValue:"";this._triggerSearchByValue(n);};U.prototype._triggerSearchByValueInFilterDialog=function(j){var n=null,i;var W,X;var Y,Z;var $;var _;j=j.replace(/^\s+|\s+$/g,"").toLowerCase();if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){Y=this._mAdvancedAreaFilter[n];if(Y&&Y.items){$=0;_=0;for(i=0;i<Y.items.length;i++){if(Y.items[i]&&Y.items[i].filterItem&&Y.items[i].formelement){Z=Y.items[i].filterItem;if(Z.getVisible()){if(j){W=Z.getLabel();X=Z.getLabelTooltip();if((W.toLowerCase().indexOf(j)>=0||(X&&X.toLowerCase().indexOf(j)>=0))){if(Z.getPartOfCurrentVariant()){Y.items[i].formelement.setVisible(true);}else{++_;}}else{++$;Y.items[i].formelement.setVisible(false);}}else{Y.items[i].formelement.setVisible(Z.getVisibleInFilterBar()||Z.getPartOfCurrentVariant());if(Y.link&&!Y.link.getVisible()){Y.link.setVisible(true);}}}else{++$;}}}if(Y&&Y.formcontainer){if($===Y.items.length){Y.formcontainer.setVisible(false);}else{Y.formcontainer.setVisible(true);if(Y.link){Y.link.setVisible((j&&(_===0))?false:true);if(j&&(_>0)){this._setLinkTextAndCount(n,Y.link,_);}else{this._setLinkText(n,Y.link);}}}}}}}}};U.prototype._triggerSearchInFilterDialog=function(i){if(!i){return;}var j=i.getParameters();if(!j){return;}var n=j.newValue?j.newValue:"";this._sSearchCriteriaInFiltersDialog=n;this._triggerSearchByValueInFilterDialog(n);};U.prototype._generateListItems=function(j){var i;var n,W;var X=[];var Y,Z;var $=false;if(this.$().closest(".sapUiSizeCompact").length>0){$=true;}if(j&&this._mAdvancedAreaFilter){W=this._mAdvancedAreaFilter[j];if(W&&W.items){for(i=0;i<W.items.length;i++){var _=W.items[i];if(_&&_.filterItem){if(!_.filterItem.getVisible()){continue;}n=new c();n.setVisible(true);if(!$){n.addStyleClass("sapUiCompFilterBarListItem");}else{n.addStyleClass("sapUiCompFilterBarListItemCompact");}n.data("quickinfo",_.filterItem.getLabelTooltip());Z=new C();Z.setSelected(_.filterItem.getPartOfCurrentVariant());if(((_.filterItem.getMandatory()&&_.checkbox&&!_.checkbox.getEnabled())||_.filterItem.getVisibleInFilterBar())){Z.setEnabled(false);}_.initialPartOfCurrentVariant=_.filterItem.getPartOfCurrentVariant();Z.attachSelect(q.proxy(this._selectionChangedInAddFiltersDialog,this,Z,_));n.addContent(Z);Y=new L({text:_.filterItem.getLabel(),tooltip:_.filterItem.getLabelTooltip()});n.addContent(Y);X.push(n);}}}}return X;};U.prototype._rerenderItem=function(i){if(i){if(i.container){i.container.setVisible(i.filterItem.getVisible()&&i.filterItem.getVisibleInFilterBar());}if(i.formelement){i.formelement.setVisible(i.filterItem.getVisible()&&(i.filterItem.getVisibleInFilterBar()||i.filterItem.getPartOfCurrentVariant()));if(i.checkbox){i.checkbox.setSelected(i.filterItem.getVisibleInFilterBar());}}}};U.prototype._rerenderFilters=function(){var i;var n=null;var j=null;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n&&this._mAdvancedAreaFilter[n]&&this._mAdvancedAreaFilter[n].items){for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){j=this._mAdvancedAreaFilter[n].items[i];this._rerenderItem(j);}}}}this._updateToolbarText();};U.prototype.rerenderFilters=function(){this._rerenderFilters();};U.prototype._closeAddRemoveFiltersDialog=function(i,j){if(i&&j){if(this._sSearchCriteriaInFiltersDialog&&this._oFilterDialog){this._triggerSearchByValueInFilterDialog(this._sSearchCriteriaInFiltersDialog);}else{this._setLinkText(i,j);}}};U.prototype._cancelAddRemoveFiltersDialog=function(j){var i;var n;if(j&&this._mAdvancedAreaFilter&&this._mAdvancedAreaFilter[j]&&this._mAdvancedAreaFilter[j].items){for(i=0;i<this._mAdvancedAreaFilter[j].items.length;i++){n=this._mAdvancedAreaFilter[j].items[i];if(n.initialPartOfCurrentVariant!==undefined&&n.filterItem){if(n.filterItem.getPartOfCurrentVariant()!==n.initialPartOfCurrentVariant){n.filterItem.setPartOfCurrentVariant(n.initialPartOfCurrentVariant);this._rerenderItem(n);this._notifyAboutChangedFilters(n.initialPartOfCurrentVariant,n.control);}}}}if(this._oVariantManagement&&(this._oVariant.modified2!==undefined)){this._oVariantManagement.currentVariantSetModified(this._oVariant.modified2);}};U.prototype._createAddRemoveFiltersDialog=function(j,n){var i;var W=this;if(!j){return;}this._oDialog=new D({stretch:o.system.phone});this._oDialog.addStyleClass("sapUiPopupWithPadding");this._oDialog.addStyleClass("sapUiCompAddRemoveFilterDialog");if(this.$().closest(".sapUiSizeCompact").length>0){this._oDialog.addStyleClass("sapUiSizeCompact");}this._oDialog.setTitle(this._oRb.getText("SELECT_FILTER_FIELDS"));this._oDialog.addStyleClass("sapMH4FontSize");this._oDialog.addStyleClass("sapMH4Style");this._oDialog.setVerticalScrolling(true);var X=new B();var Y=new S({placeholder:this._oRb.getText("FILTER_BAR_SEARCH")});this._oSearchField=Y;Y.attachLiveChange(function(a1){W._triggerSearch(a1);});X.addContentRight(Y);this._oDialog.setSubHeader(X);var Z=new f();Z.setShowSeparators(g.None);this._oDialog.addContent(Z);this._aListItems=this._generateListItems(j);for(i=0;i<this._aListItems.length;i++){Z.addItem(this._aListItems[i]);}if(this._oVariant&&this._oVariantManagement){this._oVariant.modified2=this._oVariantManagement.currentVariantGetModified();}this._bOKButtonAddRemoveFilterDialogTriggered=false;var $=new a({text:this._oRb.getText("FILTER_BAR_OK")});$.attachPress(function(){W._bOKButtonAddRemoveFilterDialogTriggered=true;W._oDialog.close();});this._oDialog.addAggregation("buttons",$);this._oDialog.setInitialFocus(this._oSearchField);this._oDialog.setContentHeight("23.25rem");if(this._sSearchCriteriaInFiltersDialog){this._triggerSearchByValue(this._sSearchCriteriaInFiltersDialog);}var _=new a({text:this._oRb.getText("FILTER_BAR_CANCEL"),press:function(){W._oDialog.close();}});this._oDialog.addAggregation("buttons",_);this._oDialog.attachBeforeClose(function(){if(!W._bOKButtonAddRemoveFilterDialogTriggered){W._cancelAddRemoveFiltersDialog(j);}W._closeAddRemoveFiltersDialog(j,n);});this._oDialog.attachAfterClose(function(){W._oDialog.destroy();W._oDialog=null;});this._oDialog.open();};U.prototype._selectionChangedInAddFiltersDialog=function(i,j){var n=i.getSelected();if(!n&&((j.filterItem.getMandatory()&&!j.checkbox.getEnabled())||j.filterItem.getVisibleInFilterBar())){i.setSelected(true);return;}j.filterItem.setPartOfCurrentVariant(n);this._rerenderItem(j);this._notifyAboutChangedFilters(n,j.control);};U.prototype._setConsiderFilterChanges=function(i){this._filterChangeSemaphore=i;};U.prototype._getConsiderFilterChanges=function(){return this._filterChangeSemaphore;};U.prototype.fireFilterChange=function(i){this._updateToolbarText();if(this._getConsiderFilterChanges()&&this._oVariantManagement&&this._oVariantManagement.getEnabled()){this._oVariantManagement.currentVariantSetModified(true);}if(this._oFilterDialog&&!(this._oFilterDialog.isOpen())){return;}this._bDirtyViaDialog=true;this.fireEvent("filterChange",i);};U.prototype._notifyAboutChangedFilters=function(i,j){var n;if(i){n={"added":j};}else{n={"deleted":j};}this.fireFilterChange(n);};U.prototype._determineVariantFiltersInfo=function(j){var i;var n=null,W;var X=null;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){if(this._mAdvancedAreaFilter[n].items){for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){W=this._mAdvancedAreaFilter[n].items[i];if(j||W.filterItem.getVisible()){if(!X){X=[];}X.push({group:W.filterItem.getGroupName(),name:W.filterItem.getName(),partOfCurrentVariant:W.filterItem.getPartOfCurrentVariant(),visibleInFilterBar:W.filterItem.getVisibleInFilterBar()});}}}}}}return X;};U.prototype._addControlToAdvancedArea=function(i,j,n){var W=new N({label:i.getLabelControl(this.getId()),fields:[(j!==null)?j:new T()]});n.addFormElement(W);};U.prototype._determineVisibility=function(i){var j=false;if(i){j=i.getVisible()&&(i.getVisibleInFilterBar()||i.getPartOfCurrentVariant());}return j;};U.prototype._retrieveVisibleAdvancedItems=function(){var i,n=null,j;var W=[];if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){if(this._mAdvancedAreaFilter[n]&&this._mAdvancedAreaFilter[n].items){for(i=0;i<this._mAdvancedAreaFilter[n].items.length;i++){j=this._mAdvancedAreaFilter[n].items[i];if(j){if(this._determineVisibility(j.filterItem)){W.push(j);}}}}}}}return W;};U.prototype._retrieveCurrentSelectionSet=function(){var i;var j=[];var n=this._retrieveVisibleAdvancedItems();for(i=0;i<n.length;i++){if(n[i].control){j.push(n[i].control);}}return j;};U.prototype.search=function(){var i={};i.selectionSet=this._retrieveCurrentSelectionSet();this.fireSearch(i);return true;};U.prototype.clear=function(){var i={};i.selectionSet=this._retrieveCurrentSelectionSet();this._clearErrorState();this.fireClear(i);this._updateToolbarText();};U.prototype.reset=function(){var i={};i.selectionSet=this._retrieveCurrentSelectionSet();this.fireReset(i);this._resetVariant();};U.prototype._resetVariant=function(){var i=null;if(this._oVariantManagement){var j=this._oVariantManagement.getSelectionKey();if(j){i=this._oVariantManagement.getVariantContent(this,j);if(this._oVariant){this._oVariant.content=i;this._oVariant.modified=false;}if(i){this._applyVariant(i,"RESET");}}}};U.prototype._applyVariant=function(i,j){var n=null;var W;var X=false;if(i){this._setConsiderFilterChanges(false);W=i.filterBarVariant;n=i.filterbar;this._applyVariantFields(W);this._reapplyVisibility(n);this.fireAfterVariantLoad(j);this._setConsiderFilterChanges(true);this._updateToolbarText();if(i.executeOnSelection){X=i.executeOnSelection;}if(X){this.search();}else{this._clearErrorState();}}};U.prototype._fetchVariantFiltersData=function(){if(this._fRegisteredFetchData){try{return this._fRegisteredFetchData();}catch(i){q.sap.log.error("callback for fetching data throws an exception");}}else{q.sap.log.warning("no callback for fetch data supplied");}return null;};U.prototype._applyVariantFields=function(j){if(this._fRegisteredApplyData){try{return this._fRegisteredApplyData(j);}catch(i){q.sap.log.error("callback for applying data throws an exception");}}else{q.sap.log.warning("no callback for appy data supplied");}};U.prototype.fetchVariant=function(i){var j;var n={};this.fireBeforeVariantFetch();j=this._determineVariantFiltersInfo(i);n.filterbar=(!j)?[]:j;n.filterBarVariant=this._fetchVariantFiltersData();return n;};U.prototype.applyVariant=function(i,j){this._applyVariant(i,j);};U.prototype.determineMandatoryFilterItems=function(){var i;var j=[];var n=this._retrieveVisibleAdvancedItems();for(i=0;i<n.length;i++){if(n[i].filterItem.getMandatory()===true){if(n[i].control){j.push(n[i].filterItem);}}}return j;};U.prototype.determineControlByFilterItem=function(j){var i,n=null;var W,X;if(this._aBasicAreaSelection){for(i=0;i<this._aBasicAreaSelection.length;i++){W=this._aBasicAreaSelection[i];if(j===W.filterItem){return W.control;}}}if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){X=this._mAdvancedAreaFilter[n];if(X&&X.items){for(i=0;i<X.items.length;i++){W=X.items[i];if(j===W.filterItem){return W.control;}}}}}}return null;};U.prototype.determineControlByName=function(n,i){var j=this._determineItemByName(n,i);if(j){return j.control;}return null;};U.prototype._determineItemByName=function(n,j){var i;var W,X;var Y=j;if(!n){return null;}if(!Y){Y=U.INTERNAL_GROUP;}if(this._mAdvancedAreaFilter){X=this._mAdvancedAreaFilter[Y];if(X&&X.items){for(i=0;i<X.items.length;i++){W=X.items[i];if(W&&W.filterItem&&(W.filterItem.getName()===n)){return W;}}}}return null;};U.prototype.determineFilterItemByName=function(i){var n,j;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){j=this._determineItemByName(i,n);if(j){return j.filterItem;}}}return null;};U.prototype._determineByFilterGroupItem=function(j){var n=null,i;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){var W=this._mAdvancedAreaFilter[n];if(W&&W.items){for(i=0;i<W.items.length;i++){if(W.items[i]&&W.items[i].filterItem===j){return W.items[i];}}}}}}return null;};U.prototype._determineByControl=function(j){var n=null,i;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){var W=this._mAdvancedAreaFilter[n];if(W&&W.items){for(i=0;i<W.items.length;i++){if(W.items[i]&&W.items[i].control===j){return W.items[i];}}}}}}return null;};U.prototype._deleteProperties=function(){var n=null,i;if(this._mAdvancedAreaFilter){for(n in this._mAdvancedAreaFilter){if(n){var j=this._mAdvancedAreaFilter[n];if(j&&j.items){if(j.formcontainer){delete j.formcontainer;}if(j.link){delete j.link;}for(i=0;i<j.items.length;i++){if(j.items[i]&&j.items[i].checkbox){delete j.items[i].checkbox;}if(j.items[i]&&j.items[i].formelement){delete j.items[i].formelement;}}}}}}};U.prototype._fHandleResize=function(){if(!this._isPhone()&&this._oFilterDialog&&this._mAdvancedAreaFilter){this._repositionAddToFilterBarLabel();}};U.prototype.onAfterRendering=function(){this._fHandleResize();};U.prototype.destroy=function(){q(window).off("resize.basicsearch");if(this._oVariantManagement){if(this._fInitialiseVariants){this._oVariantManagement.detachInitialise(this._fInitialiseVariants);this._fInitialiseVariants=null;}if(this._fSaveVariant){this._oVariantManagement.detachSave(this._fSaveVariant);this._fSaveVariant=null;}if(this._fAfterSaveVariant){this._oVariantManagement.detachSave(this._fAfterSaveVariant);this._fAfterSaveVariant=null;}}G.prototype.destroy.apply(this,arguments);if(this._oDialog){this._oDialog.destroy();this._oDialog=null;}if(this._oActionSheet){this._oActionSheet.destroy();this._oActionSheet=null;}if(this._oFilterDialog){this._oFilterDialog.destroy();this._oFilterDialog=null;}this._aBasicAreaSelection=null;this._mAdvancedAreaFilter=null;this._oBasicAreaLayout=null;this._oVariantManagement=null;this._oCollectiveSearch=null;this._oVariant=null;this._fRegisteredFetchData=null;this._fRegisteredApplyData=null;this._fRegisterGetFiltersWithValues=null;this._fRegisteredFilterChangeHandlers=null;this._oSearchButton=null;this._oFiltersButton=null;this._oHideShowButton=null;this._oClearButtonOnFB=null;this._oRestoreButtonOnFB=null;this._oAddToFilterBarLabel=null;this._oBasicSearchField=null;};return U;},true);
