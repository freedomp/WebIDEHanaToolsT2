/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/comp/odata/FieldSelectorModelConverter','sap/ui/dt/ElementUtil','./Utils'],function(q,F,E,U){"use strict";var M={};M.getConvertedModelWithBoundAndRenamedLabels=function(c,e){var t=this;var m=c.getModel();return this._getModelConverter(m).then(function(f){return t._getFieldModel(c,f,e);});};M._getModelConverter=function(m){var o=m.getMetaModel();return o.loaded().then(function(){return new F(m);},function(r){q.sap.log.error("MetadataModel could not be loaded",r);});};M._getIgnoredFields=function(c){if(c&&c.getIgnoredFields){var C=c.getIgnoredFields();if(C){var i=C.split(",");return i;}}return[];};M._getFieldModel=function(c,f,e){var I=this._getIgnoredFields(c);var C=f.getConvertedModel(e,I);var v=this._findVisibleAndBoundFieldsAndLabelNames(c);var V=v.visibleAndBoundFields;var m=v.fieldsAndLabelNames;var a=v.fieldsAndBoundPropertyName;var b=v.boundFieldsId;var s;for(var z=0;z<e.length;z++){s=e[z];for(var i=0;i<C[s].length;i++){var A=C[s][i];var d=f.getMetaDataAnalyzer()._getNameOfPropertyUsingComplexType(s,A.entityName);if(V[A.name]){A.checked=true;}A.controlId=b[A.name];if(d){A.isComplexType=true;A.complexTypeName=d;if(V[d+"/"+A.name]){A.checked=true;A.controlId=V[d+"/"+A.name];}}var g;if(A.isComplexType){g=m[A.complexTypeName+"/"+A.name];}else{g=m[A.name];}if(g&&g!==A["sap:label"]){A.fieldLabel=g;}A.boundProperty=a[A.name];}}return C[s];};M._findVisibleAndBoundFieldsAndLabelNames=function(c){var v=[];var b=[];var f={};var m={};var e=E.findAllPublicElements(c);var i=0;if(c instanceof sap.m.ObjectHeader){for(i=0;i<e.length;i++){var o=e[i];if(o instanceof sap.m.ObjectAttribute){v.push(o.getBindingPath("text"));}}}else if(c instanceof sap.ui.comp.smartform.SmartForm){for(i=0;i<e.length;i++){var a=e[i];if(a.mBindingInfos){for(var I in a.mBindingInfos){var p=a.mBindingInfos[I].parts[0].path?a.mBindingInfos[I].parts[0].path:"";var P=a.getParent();if(P&&p){m[p]=I;var s=U.getLabelForElement(P);if(s){f[p]=s;}if(a.getDomRef()){v[p]=P.getId();}b[p]=P.getId();}}}}}return{visibleAndBoundFields:v,boundFieldsId:b,fieldsAndLabelNames:f,fieldsAndBoundPropertyName:m};};return M;},true);
