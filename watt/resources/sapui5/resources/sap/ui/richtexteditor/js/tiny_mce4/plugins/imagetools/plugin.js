(function(c,u){"use strict";var f={};function l(a,b){var m,d=[];for(var i=0;i<a.length;++i){m=f[a[i]]||p(a[i]);if(!m){throw'module definition dependecy not found: '+a[i];}d.push(m);}b.apply(null,d);}function n(i,d,a){if(typeof i!=='string'){throw'invalid module definition, module id must be defined and be a string';}if(d===u){throw'invalid module definition, dependencies must be specified';}if(a===u){throw'invalid module definition, definition function must be specified';}l(d,function(){f[i]=a.apply(null,arguments);});}function o(i){return!!f[i];}function p(i){var t=c;var a=i.split(/[.\/]/);for(var b=0;b<a.length;++b){if(!t[a[b]]){return;}t=t[a[b]];}return t;}function q(a){var i,t,b,d,e;for(i=0;i<a.length;i++){t=c;b=a[i];d=b.split(/[.\/]/);for(var g=0;g<d.length-1;++g){if(t[d[g]]===u){t[d[g]]={};}t=t[d[g]];}t[d[d.length-1]]=f[b];}if(c.AMDLC_TESTS){e=c.privateModules||{};for(b in f){e[b]=f[b];}for(i=0;i<a.length;i++){delete e[a[i]];}c.privateModules=e;}}n("tinymce/imagetoolsplugin/Canvas",[],function(){function a(w,h){return r(document.createElement('canvas'),w,h);}function g(b){return b.getContext("2d");}function r(b,w,h){b.width=w;b.height=h;return b;}return{create:a,resize:r,get2dContext:g};});n("tinymce/imagetoolsplugin/Mime",[],function(){function g(d){var a=document.createElement('a');a.href=d;return a.pathname;}function b(a){var d=g(a).split('.'),e=d[d.length-1],m={'jpg':'image/jpeg','jpeg':'image/jpeg','png':'image/png'};if(e){e=e.toLowerCase();}return m[e];}return{guessMimeType:b};});n("tinymce/imagetoolsplugin/ImageSize",[],function(){function g(i){return i.naturalWidth||i.width;}function a(i){return i.naturalHeight||i.height;}return{getWidth:g,getHeight:a};});n("tinymce/imagetoolsplugin/Conversions",["tinymce/util/Promise","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/Mime","tinymce/imagetoolsplugin/ImageSize"],function(P,C,M,I){function a(i){return new P(function(p){function t(){i.removeEventListener('load',t);p(i);}if(i.complete){p(i);}else{i.addEventListener('load',t);}});}function b(i){return a(i).then(function(i){var t,v;v=C.create(I.getWidth(i),I.getHeight(i));t=C.get2dContext(v);t.drawImage(i,0,0);return v;});}function d(i){return a(i).then(function(i){var t=i.src;if(t.indexOf('blob:')===0){return g(t);}if(t.indexOf('data:')===0){return h(t);}return b(i).then(function(v){return h(v.toDataURL(M.guessMimeType(t)));});});}function e(i){return new P(function(p){var t=new Image();function v(){t.removeEventListener('load',v);p(t);}t.addEventListener('load',v);t.src=URL.createObjectURL(i);if(t.complete){v();}});}function g(i){return new P(function(p){var x=new XMLHttpRequest();x.open('GET',i,true);x.responseType='blob';x.onload=function(){if(this.status==200){p(this.response);}};x.send();});}function h(t){return new P(function(p){var v,w,i,x,y,z;t=t.split(',');x=/data:([^;]+)/.exec(t[0]);if(x){y=x[1];}v=atob(t[1]);if(window.WebKitBlobBuilder){z=new WebKitBlobBuilder();w=new ArrayBuffer(v.length);for(i=0;i<w.length;i++){w[i]=v.charCodeAt(i);}z.append(w);p(z.getBlob(y));return;}w=new Uint8Array(v.length);for(i=0;i<w.length;i++){w[i]=v.charCodeAt(i);}p(new Blob([w],{type:y}));});}function j(i){if(i.indexOf('blob:')===0){return g(i);}if(i.indexOf('data:')===0){return h(i);}return null;}function k(i,t){return h(i.toDataURL(t));}function m(i){return new P(function(p){var t=new FileReader();t.onloadend=function(){p(t.result);};t.readAsDataURL(i);});}function r(i){return m(i).then(function(t){return t.split(',')[1];});}function s(i){URL.revokeObjectURL(i.src);}return{blobToImage:e,imageToBlob:d,uriToBlob:j,blobToDataUri:m,blobToBase64:r,imageToCanvas:b,canvasToBlob:k,revokeImageUrl:s};});n("tinymce/imagetoolsplugin/ImageTools",["tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/ImageSize"],function(C,a,I){var r=C.revokeImageUrl;function b(h,i){return C.blobToImage(h).then(function(j){var k=a.create(I.getWidth(j),I.getHeight(j)),m=a.get2dContext(k),t=0,s=0;i=i<0?360+i:i;if(i==90||i==270){a.resize(k,k.height,k.width);}if(i==90||i==180){t=k.width;}if(i==270||i==180){s=k.height;}m.translate(t,s);m.rotate(i*Math.PI/180);m.drawImage(j,0,0);r(j);return C.canvasToBlob(k,h.type);});}function d(h,i){return C.blobToImage(h).then(function(j){var k=a.create(I.getWidth(j),I.getHeight(j)),m=a.get2dContext(k);if(i=='v'){m.scale(1,-1);m.drawImage(j,0,-k.height);}else{m.scale(-1,1);m.drawImage(j,-k.width,0);}r(j);return C.canvasToBlob(k);});}function e(i,x,y,w,h){return C.blobToImage(i).then(function(j){var k=a.create(w,h),m=a.get2dContext(k);m.drawImage(j,-x,-y);r(j);return C.canvasToBlob(k);});}function g(i,w,h){return C.blobToImage(i).then(function(j){var k=a.create(w,h),m=a.get2dContext(k);m.drawImage(j,0,0,w,h);r(j);return C.canvasToBlob(k,i.type);});}return{rotate:b,flip:d,crop:e,resize:g};});n("tinymce/imagetoolsplugin/CropRect",["tinymce/dom/DomQuery","tinymce/ui/DragHelper","tinymce/ui/Rect","tinymce/util/Tools","tinymce/util/Observable"],function($,D,R,T,O){var a=0;return function(b,v,d,g){var i,j,k,m,r='mce-',s=r+'crid-'+(a++);j=[{name:'move',xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0},{name:'nw',xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1},{name:'ne',xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1},{name:'sw',xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1},{name:'se',xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1}];m=["top","right","bottom","left"];function t(e,h){return{x:h.x+e.x,y:h.y+e.y,w:h.w,h:h.h};}function z(e,h){return{x:h.x-e.x,y:h.y-e.y,w:h.w,h:h.h};}function A(){return z(d,b);}function B(){function K(L){var M;return new D(s,{document:g.ownerDocument,handle:s+'-'+L.name,start:function(){M=b;},drag:function(e){var x,y,w,h,N;x=M.x;y=M.y;w=M.w;h=M.h;x+=e.deltaX*L.deltaX;y+=e.deltaY*L.deltaY;w+=e.deltaX*L.deltaW;h+=e.deltaY*L.deltaH;if(w<20){w=20;}if(h<20){h=20;}N=b=R.clamp({x:x,y:y,w:w,h:h},d,L.name=='move');N=z(d,N);i.fire('updateRect',{rect:N});H(N);}});}$('<div id="'+s+'" class="'+r+'croprect-container" data-mce-bogus="all">').appendTo(g);T.each(m,function(e){$('#'+s,g).append('<div id="'+s+'-'+e+'"class="'+r+'croprect-block" style="display: none" data-mce-bogus="all">');});T.each(j,function(h){$('#'+s,g).append('<div id="'+s+'-'+h.name+'" class="'+r+'croprect-handle '+r+'croprect-handle-'+h.name+'" style="display: none" data-mce-bogus="all">');});k=T.map(j,K);E(b);}function C(e){var h;h=T.map(j,function(w){return'#'+s+'-'+w.name;}).concat(T.map(m,function(w){return'#'+s+'-'+w;})).join(',');if(e){$(h,g).show();}else{$(h,g).hide();}}function E(e){function h(w,e){if(e.h<0){e.h=0;}if(e.w<0){e.w=0;}$('#'+s+'-'+w,g).css({left:e.x,top:e.y,width:e.w,height:e.h});}T.each(j,function(w){$('#'+s+'-'+w.name,g).css({left:e.w*w.xMul+e.x,top:e.h*w.yMul+e.y});});h('top',{x:v.x,y:v.y,w:v.w,h:e.y-v.y});h('right',{x:e.x+e.w,y:e.y,w:v.w-e.x-e.w+v.x,h:e.h});h('bottom',{x:v.x,y:e.y+e.h,w:v.w,h:v.h-e.y-e.h+v.y});h('left',{x:v.x,y:e.y,w:e.x-v.x,h:e.h});h('move',e);}function F(e){b=e;E(b);}function G(e){v=e;E(b);}function H(e){F(t(d,e));}function I(e){d=e;E(b);}function J(){T.each(k,function(h){h.destroy();});k=[];}B(g);i=T.extend({toggleVisibility:C,setClampRect:I,setRect:F,getInnerRect:A,setInnerRect:H,setViewPortRect:G,destroy:J},O);return i;};});n("tinymce/imagetoolsplugin/ImagePanel",["tinymce/ui/Control","tinymce/ui/DragHelper","tinymce/ui/Rect","tinymce/util/Tools","tinymce/util/Promise","tinymce/imagetoolsplugin/CropRect"],function(C,D,R,T,P,a){function b(i){return new P(function(p){function d(){i.removeEventListener('load',d);p(i);}if(i.complete){p(i);}else{i.addEventListener('load',d);}});}return C.extend({Defaults:{classes:"imagepanel"},selection:function(r){if(arguments.length){this.state.set('rect',r);return this;}return this.state.get('rect');},imageSize:function(){var v=this.state.get('viewRect');return{w:v.w,h:v.h};},toggleCropRect:function(s){this.state.set('cropEnabled',s);},imageSrc:function(d){var s=this,i=new Image();i.src=d;b(i).then(function(){var r,$,e=s.state.get('viewRect');$=s.$el.find('img');if($[0]){$.replaceWith(i);}else{s.getEl().appendChild(i);}r={x:0,y:0,w:i.naturalWidth,h:i.naturalHeight};s.state.set('viewRect',r);s.state.set('rect',R.inflate(r,-20,-20));if(!e||e.w!=r.w||e.h!=r.h){s.zoomFit();}s.repaintImage();s.fire('load');});},zoom:function(v){if(arguments.length){this.state.set('zoom',v);return this;}return this.state.get('zoom');},postRender:function(){this.imageSrc(this.settings.imageSrc);return this._super();},zoomFit:function(){var s=this,$,d,e,w,h,z,g;g=10;$=s.$el.find('img');d=s.getEl().clientWidth;e=s.getEl().clientHeight;w=$[0].naturalWidth;h=$[0].naturalHeight;z=Math.min((d-g)/w,(e-g)/h);if(z>=1){z=1;}s.zoom(z);},repaintImage:function(){var x,y,w,h,d,e,$,z,r,g;g=this.getEl();z=this.zoom();r=this.state.get('rect');$=this.$el.find('img');d=g.offsetWidth;e=g.offsetHeight;w=$[0].naturalWidth*z;h=$[0].naturalHeight*z;x=Math.max(0,d/2-w/2);y=Math.max(0,e/2-h/2);$.css({left:x,top:y,width:w,height:h});if(this.cropRect){this.cropRect.setRect({x:r.x*z+x,y:r.y*z+y,w:r.w*z,h:r.h*z});this.cropRect.setClampRect({x:x,y:y,w:w,h:h});this.cropRect.setViewPortRect({x:0,y:0,w:d,h:e});}},bindStates:function(){var s=this;function d(r){s.cropRect=new a(r,s.state.get('viewRect'),s.state.get('viewRect'),s.getEl());s.cropRect.on('updateRect',function(e){var r=e.rect,z=s.zoom();r={x:Math.round(r.x/z),y:Math.round(r.y/z),w:Math.round(r.w/z),h:Math.round(r.h/z)};s.state.set('rect',r);});s.on('remove',s.cropRect.destroy);}s.state.on('change:cropEnabled',function(e){s.cropRect.toggleVisibility(e.value);s.repaintImage();});s.state.on('change:zoom',function(){s.repaintImage();});s.state.on('change:rect',function(e){var r=e.value;if(!s.cropRect){d(r);}s.cropRect.setRect(r);});}});});n("tinymce/imagetoolsplugin/ColorMatrix",[],function(){function a(i,j,k){i=parseFloat(i);if(i>k){i=k;}else if(i<j){i=j;}return i;}function b(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1];}var D=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.20,0.21,0.22,0.24,0.25,0.27,0.28,0.30,0.32,0.34,0.36,0.38,0.40,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.80,0.83,0.86,0.89,0.92,0.95,0.98,1.0,1.06,1.12,1.18,1.24,1.30,1.36,1.42,1.48,1.54,1.60,1.66,1.72,1.78,1.84,1.90,1.96,2.0,2.12,2.25,2.37,2.50,2.62,2.75,2.87,3.0,3.2,3.4,3.6,3.8,4.0,4.3,4.7,4.9,5.0,5.5,6.0,6.5,6.8,7.0,7.3,7.5,7.8,8.0,8.4,8.7,9.0,9.4,9.6,9.8,10.0];function m(w,x){var i,j,k,y,z=[],A=new Array(10);for(i=0;i<5;i++){for(j=0;j<5;j++){z[j]=x[j+i*5];}for(j=0;j<5;j++){y=0;for(k=0;k<5;k++){y+=w[j+k*5]*z[k];}A[j+i*5]=y;}}return A;}function d(i,j){j=a(j,0,1);return i.map(function(k,w){if(w%6===0){k=1.0-((1-k)*j);}else{k*=j;}return a(k,0,1);});}function e(i,j){var x;j=a(j,-1,1);j*=100;if(j<0){x=127+j/100*127;}else{x=j%1;if(x===0){x=D[j];}else{x=D[(Math.floor(j))]*(1-x)+D[(Math.floor(j))+1]*x;}x=x*127+127;}return m(i,[x/127,0,0,0,0.5*(127-x),0,x/127,0,0,0.5*(127-x),0,0,x/127,0,0.5*(127-x),0,0,0,1,0,0,0,0,0,1]);}function g(i,j){var x,k,w,y;j=a(j,-1,1);x=1+((j>0)?3*j:j);k=0.3086;w=0.6094;y=0.0820;return m(i,[k*(1-x)+x,w*(1-x),y*(1-x),0,0,k*(1-x),w*(1-x)+x,y*(1-x),0,0,k*(1-x),w*(1-x),y*(1-x)+x,0,0,0,0,0,1,0,0,0,0,0,1]);}function h(i,j){var k,w,x,y,z;j=a(j,-180,180)/180*Math.PI;k=Math.cos(j);w=Math.sin(j);x=0.213;y=0.715;z=0.072;return m(i,[x+k*(1-x)+w*(-x),y+k*(-y)+w*(-y),z+k*(-z)+w*(1-z),0,0,x+k*(-x)+w*(0.143),y+k*(1-y)+w*(0.140),z+k*(-z)+w*(-0.283),0,0,x+k*(-x)+w*(-(1-x)),y+k*(-y)+w*(y),z+k*(1-z)+w*(z),0,0,0,0,0,1,0,0,0,0,0,1]);}function r(i,j){j=a(255*j,-255,255);return m(i,[1,0,0,0,j,0,1,0,0,j,0,0,1,0,j,0,0,0,1,0,0,0,0,0,1]);}function s(i,j,k,w){j=a(j,0,2);k=a(k,0,2);w=a(w,0,2);return m(i,[j,0,0,0,0,0,k,0,0,0,0,0,w,0,0,0,0,0,1,0,0,0,0,0,1]);}function t(i,j){j=a(j,0,1);return m(i,d([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],j));}function v(i,j){j=a(j,0,1);return m(i,d([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],j));}return{identity:b,adjust:d,multiply:m,adjustContrast:e,adjustBrightness:r,adjustSaturation:g,adjustHue:h,adjustColors:s,adjustSepia:t,adjustGrayscale:v};});n("tinymce/imagetoolsplugin/Filters",["tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/ColorMatrix"],function(C,I,e,j){var k=e.revokeImageUrl;function s(h,w){return e.blobToImage(h).then(function(x){var y=C.create(I.getWidth(x),I.getHeight(x)),D=C.get2dContext(y),E;function F(E,m){var d=E.data,r,g,b,a,i,G=m[0],H=m[1],J=m[2],K=m[3],L=m[4],M=m[5],N=m[6],O=m[7],P=m[8],Q=m[9],R=m[10],S=m[11],T=m[12],U=m[13],V=m[14],W=m[15],X=m[16],Y=m[17],Z=m[18],$=m[19];for(i=0;i<d.length;i+=4){r=d[i];g=d[i+1];b=d[i+2];a=d[i+3];d[i]=r*G+g*H+b*J+a*K+L;d[i+1]=r*M+g*N+b*O+a*P+Q;d[i+2]=r*R+g*S+b*T+a*U+V;d[i+3]=r*W+g*X+b*Y+a*Z+$;}return E;}D.drawImage(x,0,0);k(x);E=F(D.getImageData(0,0,y.width,y.height),w);D.putImageData(E,0,0);return e.canvasToBlob(y);});}function t(a,m){return e.blobToImage(a).then(function(i){var d=C.create(I.getWidth(i),I.getHeight(i)),D=C.get2dContext(d),E,F;function G(E,F,m){var H,J,K,L,x,y,r,g,b,M,N,O,P,Q,R,w,h;function S(T,U,V){if(T>V){T=V;}else if(T<U){T=U;}return T;}K=Math.round(Math.sqrt(m.length));L=Math.floor(K/2);H=E.data;J=F.data;w=E.width;h=E.height;for(y=0;y<h;y++){for(x=0;x<w;x++){r=g=b=0;for(N=0;N<K;N++){for(M=0;M<K;M++){O=S(x+M-L,0,w-1);P=S(y+N-L,0,h-1);Q=(P*w+O)*4;R=m[N*K+M];r+=H[Q]*R;g+=H[Q+1]*R;b+=H[Q+2]*R;}}Q=(y*w+x)*4;J[Q]=S(r,0,255);J[Q+1]=S(g,0,255);J[Q+2]=S(b,0,255);}}return F;}D.drawImage(i,0,0);k(i);E=D.getImageData(0,0,d.width,d.height);F=D.getImageData(0,0,d.width,d.height);F=G(E,F,m);D.putImageData(F,0,0);return e.canvasToBlob(d);});}function v(a){return function(b,g){return e.blobToImage(b).then(function(h){var m=C.create(I.getWidth(h),I.getHeight(h)),r=C.get2dContext(m),w,i,x=new Array(256);function y(w,x){var d=w.data,i;for(i=0;i<d.length;i+=4){d[i]=x[d[i]];d[i+1]=x[d[i+1]];d[i+2]=x[d[i+2]];}return w;}for(i=0;i<x.length;i++){x[i]=a(i,g);}r.drawImage(h,0,0);k(h);w=y(r.getImageData(0,0,m.width,m.height),x);r.putImageData(w,0,0);return e.canvasToBlob(m);});};}function z(m){return function(b,a){return s(b,m(j.identity(),a));};}function A(m){return function(b){return s(b,m);};}function B(a){return function(b){return t(b,a);};}return{invert:A([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:z(j.adjustBrightness),hue:z(j.adjustHue),saturate:z(j.adjustSaturation),contrast:z(j.adjustContrast),grayscale:z(j.adjustGrayscale),sepia:z(j.adjustSepia),colorize:function(b,a,d,g){return s(b,j.adjustColors(j.identity(),a,d,g));},sharpen:B([0,-1,0,-1,5,-1,0,-1,0]),emboss:B([-2,-1,0,-1,1,1,0,1,2]),gamma:v(function(a,b){return Math.pow(a/255,1-b)*255;}),exposure:v(function(a,b){return 255*(1-Math.exp(-(a/255)*b));}),colorFilter:s,convoluteFilter:t};});n("tinymce/imagetoolsplugin/UndoStack",[],function(){return function(){var d=[],i=-1;function a(s){var h;h=d.splice(++i);d.push(s);return{state:s,removed:h};}function b(){if(e()){return d[--i];}}function r(){if(g()){return d[++i];}}function e(){return i>0;}function g(){return i!=-1&&i<d.length-1;}return{data:d,add:a,undo:b,redo:r,canUndo:e,canRedo:g};};});n("tinymce/imagetoolsplugin/Dialog",["tinymce/dom/DOMUtils","tinymce/util/Tools","tinymce/util/Promise","tinymce/ui/Factory","tinymce/ui/Form","tinymce/ui/Container","tinymce/imagetoolsplugin/ImagePanel","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/Filters","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/UndoStack"],function(D,T,P,F,a,C,I,d,h,i,U){function j(b){return{blob:b,url:URL.createObjectURL(b)};}function k(b){if(b){URL.revokeObjectURL(b.url);}}function m(b){T.each(b,k);}function s(v,p,w){var x,y=new U(),z,A,B,E,G,H,J,K,L,M,N,O,Q,R,S,V,W,X,Y,Z,$,_,a1,b1,c1,d1;function e1(e){var b,g,r,B1;b=x.find('#w')[0];g=x.find('#h')[0];r=parseInt(b.value(),10);B1=parseInt(g.value(),10);if(x.find('#constrain')[0].checked()&&a1&&b1&&r&&B1){if(e.control.settings.name=='w'){B1=Math.round(r*c1);g.value(B1);}else{r=Math.round(B1*d1);b.value(r);}}a1=r;b1=B1;}function f1(b){return Math.round(b*100)+'%';}function g1(){x.find('#undo').disabled(!y.canUndo());x.find('#redo').disabled(!y.canRedo());x.statusbar.find('#save').disabled(!y.canUndo());}function h1(){x.find('#undo').disabled(true);x.find('#redo').disabled(true);}function i1(b){if(b){J.imageSrc(b.url);}}function j1(b){return function(){var e=T.grep(_,function(g){return g.settings.name!=b;});T.each(e,function(g){g.hide();});b.show();};}function k1(b){B=j(b);i1(B);}function l1(b){v=j(b);i1(v);m(y.add(v).removed);g1();}function m1(){var r=J.selection();d.crop(v.blob,r.x,r.y,r.w,r.h).then(function(b){l1(b);p1();});}function n1(b){var e=[].slice.call(arguments,1);return function(){var g=B||v;b.apply(this,[g.blob].concat(e)).then(k1);};}function o1(b){var e=[].slice.call(arguments,1);return function(){b.apply(this,[v.blob].concat(e)).then(l1);};}function p1(){i1(v);k(B);j1(z)();g1();}function q1(){if(B){l1(B.blob);p1();}}function r1(){var b=J.zoom();if(b<2){b+=0.1;}J.zoom(b);}function s1(){var b=J.zoom();if(b>0.1){b-=0.1;}J.zoom(b);}function t1(){v=y.undo();i1(v);g1();}function u1(){v=y.redo();i1(v);g1();}function v1(){p(v.blob);x.close();}function w1(b){return new a({layout:'flex',direction:'row',labelGap:5,border:'0 0 1 0',align:'center',pack:'center',padding:'0 10 0 10',spacing:5,flex:0,minHeight:60,defaults:{classes:'imagetool',type:'button'},items:b});}function x1(b,e){return w1([{text:'Back',onclick:p1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:q1}]).hide().on('show',function(){h1();e(v.blob).then(function(g){var r=j(g);i1(r);k(B);B=r;});});}function y1(b,g,r,B1,C1){function D1(r){g(v.blob,r).then(function(e){var E1=j(e);i1(E1);k(B);B=E1;});}return w1([{text:'Back',onclick:p1},{type:'spacer',flex:1},{type:'slider',flex:1,ondragend:function(e){D1(e.value);},minValue:B1,maxValue:C1,value:r,previewFilter:f1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:q1}]).hide().on('show',function(){this.find('slider').value(r);h1();});}function z1(e,B1){function C1(){var r,g,b;r=x.find('#r')[0].value();g=x.find('#g')[0].value();b=x.find('#b')[0].value();B1(v.blob,r,g,b).then(function(D1){var E1=j(D1);i1(E1);k(B);B=E1;});}return w1([{text:'Back',onclick:p1},{type:'spacer',flex:1},{type:'slider',label:'R',name:'r',minValue:0,value:1,maxValue:2,ondragend:C1,previewFilter:f1},{type:'slider',label:'G',name:'g',minValue:0,value:1,maxValue:2,ondragend:C1,previewFilter:f1},{type:'slider',label:'B',name:'b',minValue:0,value:1,maxValue:2,ondragend:C1,previewFilter:f1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:q1}]).hide().on('show',function(){x.find('#r,#g,#b').value(1);h1();});}E=w1([{text:'Back',onclick:p1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:m1}]).hide().on('show hide',function(e){J.toggleCropRect(e.type=='show');}).on('show',h1);function A1(e){if(e.control.value()===true){c1=b1/a1;d1=a1/b1;}}G=w1([{text:'Back',onclick:p1},{type:'spacer',flex:1},{type:'textbox',name:'w',label:'Width',size:4,onkeyup:e1},{type:'textbox',name:'h',label:'Height',size:4,onkeyup:e1},{type:'checkbox',name:'constrain',text:'Constrain proportions',checked:true,onchange:A1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:'submit'}]).hide().on('submit',function(e){var a1=parseInt(x.find('#w').value(),10),b1=parseInt(x.find('#h').value(),10);e.preventDefault();o1(d.resize,a1,b1)();p1();}).on('show',h1);H=w1([{text:'Back',onclick:p1},{type:'spacer',flex:1},{icon:'fliph',tooltip:'Flip horizontally',onclick:n1(d.flip,'h')},{icon:'flipv',tooltip:'Flip vertically',onclick:n1(d.flip,'v')},{icon:'rotateleft',tooltip:'Rotate counterclockwise',onclick:n1(d.rotate,-90)},{icon:'rotateright',tooltip:'Rotate clockwise',onclick:n1(d.rotate,90)},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:q1}]).hide().on('show',h1);M=x1("Invert",h.invert);X=x1("Sharpen",h.sharpen);Y=x1("Emboss",h.emboss);N=y1("Brightness",h.brightness,0,-1,1);O=y1("Hue",h.hue,180,0,360);Q=y1("Saturate",h.saturate,0,-1,1);R=y1("Contrast",h.contrast,0,-1,1);S=y1("Grayscale",h.grayscale,0,0,1);V=y1("Sepia",h.sepia,0,0,1);W=z1("Colorize",h.colorize);Z=y1("Gamma",h.gamma,0,-1,1);$=y1("Exposure",h.exposure,1,0,2);A=w1([{text:'Back',onclick:p1},{type:'spacer',flex:1},{text:'hue',icon:'hue',onclick:j1(O)},{text:'saturate',icon:'saturate',onclick:j1(Q)},{text:'sepia',icon:'sepia',onclick:j1(V)},{text:'emboss',icon:'emboss',onclick:j1(Y)},{text:'exposure',icon:'exposure',onclick:j1($)},{type:'spacer',flex:1}]).hide();z=w1([{tooltip:'Crop',icon:'crop',onclick:j1(E)},{tooltip:'Resize',icon:'resize2',onclick:j1(G)},{tooltip:'Orientation',icon:'orientation',onclick:j1(H)},{tooltip:'Brightness',icon:'sun',onclick:j1(N)},{tooltip:'Sharpen',icon:'sharpen',onclick:j1(X)},{tooltip:'Contrast',icon:'contrast',onclick:j1(R)},{tooltip:'Color levels',icon:'drop',onclick:j1(W)},{tooltip:'Gamma',icon:'gamma',onclick:j1(Z)},{tooltip:'Invert',icon:'invert',onclick:j1(M)}]);J=new I({flex:1,imageSrc:v.url});K=new C({layout:'flex',direction:'column',border:'0 1 0 0',padding:5,spacing:5,items:[{type:'button',icon:'undo',tooltip:'Undo',name:'undo',onclick:t1},{type:'button',icon:'redo',tooltip:'Redo',name:'redo',onclick:u1},{type:'button',icon:'zoomin',tooltip:'Zoom in',onclick:r1},{type:'button',icon:'zoomout',tooltip:'Zoom out',onclick:s1}]});L=new C({type:'container',layout:'flex',direction:'row',align:'stretch',flex:1,items:[K,J]});_=[z,E,G,H,A,M,N,O,Q,R,S,V,W,X,Y,Z,$];x=F.create('window',{layout:'flex',direction:'column',align:'stretch',minWidth:Math.min(D.DOM.getViewPort().w,800),minHeight:Math.min(D.DOM.getViewPort().h,650),title:'Edit image',items:_.concat([L]),buttons:[{text:'Save',name:'save',subtype:'primary',onclick:v1},{text:'Cancel',onclick:'close'}]});x.renderTo(document.body).reflow();x.on('close',function(){w();m(y.data);y=null;B=null;});y.add(v);g1();J.on('load',function(){a1=J.imageSize().w;b1=J.imageSize().h;c1=b1/a1;d1=a1/b1;x.find('#w').value(a1);x.find('#h').value(b1);});}function t(b){return new P(function(p,r){s(j(b),p,r);});}return{edit:t};});n("tinymce/imagetoolsplugin/Plugin",["tinymce/PluginManager","tinymce/Env","tinymce/util/Promise","tinymce/util/URI","tinymce/util/Tools","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/Dialog"],function(P,E,a,U,T,I,C,D){P.add('imagetools',function(b){var d=0,i,g;if(!E.fileApi){return;}function h(e){var N,O;function Q(R){return R.indexOf('px')==R.length-2;}N=e.style.width;O=e.style.height;if(N||O){if(Q(N)&&Q(O)){return{w:parseInt(N,10),h:parseInt(O,10)};}return null;}N=b.$(e).attr('width');O=b.$(e).attr('height');if(N&&O){return{w:parseInt(N,10),h:parseInt(O,10)};}return null;}function s(e,N){var O,Q;if(N){O=e.style.width;Q=e.style.height;if(O||Q){b.$(e).css({width:N.w,height:N.h}).removeAttr('data-mce-style');}O=e.width;Q=e.height;if(O||Q){b.$(e).attr({width:N.w,height:N.h});}}}function j(e){return{w:e.naturalWidth,h:e.naturalHeight};}function k(){return b.selection.getNode();}function m(){return'imagetools'+d++;}function r(e){var N=e.src;return N.indexOf('data:')===0||N.indexOf('blob:')===0||new U(N).host===b.documentBaseURI.host;}function t(e){return T.inArray(b.settings.imagetools_cors_hosts,new U(e.src).host)!==-1;}function v(e){return new a(function(p){var N=new XMLHttpRequest();N.onload=function(){p(this.response);};N.open('GET',e,true);N.responseType='blob';N.send();});}function w(e){var N=e.src;if(t(e)){return v(e.src);}if(!r(e)){N=b.settings.imagetools_proxy;N+=(N.indexOf('?')===-1?'?':'&')+'url='+encodeURIComponent(e.src);e=new Image();e.src=N;}return C.imageToBlob(e);}function x(){var e;e=b.editorUpload.blobCache.getByUri(k().src);if(e){return e;}return w(k()).then(function(N){return C.blobToBase64(N).then(function(O){var Q=b.editorUpload.blobCache;var e=Q.create(m(),N,O);Q.add(e);return e;});});}function y(){i=setTimeout(function(){b.editorUpload.uploadImagesAuto();},30000);}function z(){clearTimeout(i);}function A(e,N){return C.blobToDataUri(e).then(function(O){var Q,R,S,V,W;W=k();Q=m();S=b.editorUpload.blobCache;R=U.parseDataUri(O).data;V=S.create(Q,e,R);S.add(V);b.undoManager.transact(function(){function X(){b.$(W).off('load',X);b.nodeChanged();if(N){b.editorUpload.uploadImagesAuto();}else{z();y();}}b.$(W).on('load',X);b.$(W).attr({src:V.blobUri()}).removeAttr('data-mce-src');});return V;});}function B(e){return function(){return b._scanForImages().then(x).then(e).then(A);};}function F(e){return function(){return B(function(N){var O=h(k());if(O){s(k(),{w:O.h,h:O.w});}return I.rotate(N.blob(),e);})();};}function G(e){return function(){return B(function(N){return I.flip(N.blob(),e);})();};}function H(){var e=k(),N=j(e);if(e){w(e).then(D.edit).then(function(O){return new a(function(p){C.blobToImage(O).then(function(Q){var R=j(Q);if(N.w!=R.w||N.h!=R.h){if(h(e)){s(e,R);}}URL.revokeObjectURL(Q.src);p(O);});});}).then(function(O){A(O,true);},function(){});}}function J(){b.addButton('rotateleft',{title:'Rotate counterclockwise',onclick:F(-90)});b.addButton('rotateright',{title:'Rotate clockwise',onclick:F(90)});b.addButton('flipv',{title:'Flip vertically',onclick:G('v')});b.addButton('fliph',{title:'Flip horizontally',onclick:G('h')});b.addButton('editimage',{title:'Edit image',onclick:H});b.addButton('imageoptions',{title:'Image options',icon:'options',cmd:'mceImage'});}function K(){b.on('NodeChange',function(e){if(g&&g.src!=e.element.src){z();b.editorUpload.uploadImagesAuto();g=u;}if(L(e.element)){g=e.element;}});}function L(e){var N=b.dom.is(e,'img:not([data-mce-object],[data-mce-placeholder])');return N&&(r(e)||t(e)||b.settings.imagetools_proxy);}function M(){var e=b.settings.imagetools_toolbar;if(!e){e='rotateleft rotateright | flipv fliph | crop editimage imageoptions';}b.addContextToolbar(L,e);}J();M();K();b.addCommand('mceEditImage',H);});});q(["tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/Mime","tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/CropRect","tinymce/imagetoolsplugin/ImagePanel","tinymce/imagetoolsplugin/ColorMatrix","tinymce/imagetoolsplugin/Filters","tinymce/imagetoolsplugin/UndoStack","tinymce/imagetoolsplugin/Dialog","tinymce/imagetoolsplugin/Plugin"]);})(this);
