(function(){"use strict";jQuery.sap.require("sap.ui.core.format.NumberFormat");jQuery.sap.declare('sap.ushell.renderers.fiori2.search.INAV2SearchFacetsFormatter');var a=sap.ushell.renderers.fiori2.search.INAV2SearchFacetsFormatter=function(){this.init.apply(this,arguments);};jQuery.sap.declare('sap.ushell.renderers.fiori2.search.Facet');var F=sap.ushell.renderers.fiori2.search.Facet=function(){this.init.apply(this,arguments);};jQuery.sap.declare('sap.ushell.renderers.fiori2.search.FacetItem');var b=sap.ushell.renderers.fiori2.search.FacetItem=function(){this.init.apply(this,arguments);};F.prototype={init:function(p){this.title=p.title;this.facetType=p.facetType;this.dimension=p.dimension;this.items=p.items||[];},hasFilterCondition:function(f){for(var i=0,l=this.items.length;i<l;i++){var c=this.items[i].filterCondition||this.items[i];if(c.equals&&c.equals(f)){return true;}}return false;},hasFilterConditions:function(){for(var i=0,l=this.items.length;i<l;i++){if(this.items[i].filterCondition){return true;}}return false;},removeItem:function(f){for(var i=0,l=this.items.length;i<l;i++){var c=this.items[i].filterCondition||this.items[i];if(c.equals&&f.filterCondition&&c.equals(f.filterCondition)){return this.items.splice(i,1);}}}};b.prototype={init:function(p){var s=sap.ushell.Container.getService("Search").getSina();this.id=p.id;this.label=p.label;this.value=p.value;this.valueLabel=typeof this.value==="number"?sap.ui.core.format.NumberFormat.getIntegerInstance({style:"short"}).format(this.value):"";this.facetTitle=p.facetTitle||"";if(p.filterCondition.attribute){var c=this.createSinaFilterCondition(p.filterCondition);this.filterCondition=c;}else if(p.filterCondition.conditions){var d=s.createFilterConditionGroup(p.filterCondition);for(var i=0,l=d.conditions.length;i<l;i++){d.conditions[i]=this.createSinaFilterCondition(d.conditions[i]);}this.filterCondition=d;}else{this.filterCondition=p.filterCondition;}this.selected=p.selected;this.level=p.level||0;},equals:function(o){return(this.id===o.id&&this.label===o.label&&this.value===o.value&&this.filterCondition.equals(o.filterCondition));},createSinaFilterCondition:function(p){var s=sap.ushell.Container.getService("Search").getSina();if(p.inaV2_extended_properties){var n=jQuery.extend({},p);delete n.inaV2_extended_properties;var i=jQuery.extend({},p.inaV2_extended_properties);delete i.attribute;delete i.operator;delete i.value;n=jQuery.extend(n,i);return s.createFilterCondition(n);}else{return s.createFilterCondition(p);}}};a.prototype={init:function(){this.level=0;},_getAllDataSourceFacetItem:function(s){var c=s.allDataSource;var f=new b({label:c.getLabelPlural(),filterCondition:c,selected:s.getProperty("/dataSource").equals(c),level:0});if(f.selected){f.value=s.getProperty("/boCount")+s.getProperty("/appCount");}return f;},_getAppsDataSourceFacetItem:function(s){var c=s.appDataSource;var f=new b({label:c.getLabelPlural(),filterCondition:c,selected:s.getProperty("/dataSource").equals(c),value:s.getProperty("/appCount"),level:1});return f;},_getCurrentDataSourceFacetItem:function(s){var c=s.getProperty("/dataSource");if(c.equals(s.appDataSource)){return this._getAppsDataSourceFacetItem(s);}if(c.equals(s.allDataSource)){return this._getAllDataSourceFacetItem(s);}var d=new b({label:c.getLabelPlural(),value:s.getProperty("/boCount"),filterCondition:c,selected:true,level:this.level});return d;},_getRecentDataSourcesTree:function(s){var r=[];for(var i=0,l=s.getProperty('/recentDataSources').length;i<l;i++){var d=s.getProperty('/recentDataSources')[i];if(!d){continue;}var c=new b({label:d.getLabelPlural(),filterCondition:d,selected:false,level:0});r.push(c);}return r;},getDataSourceFacetFromPerspective:function(I,s){var t=this;var d=new F({facetType:"datasource",title:"Search In"});var c=s.getProperty("/dataSource");var e;this.level=0;var A=I.getChartFacets().filter(function(j){return j.facetType==="datasource";});if(A.length>0&&A[0].query.resultSet.elements.length>0){A=A[0].query.resultSet.elements;}else{A=[];}function f(m){for(var j=0,n=A.length;j<n;j++){var o=A[j].dataSource;var q=new b({label:o.getLabelPlural(),value:A[j].valueRaw,filterCondition:o,selected:c.equals(o),level:m||t.level});d.items.push(q);}}d.items.push(this._getAllDataSourceFacetItem(s));this.level++;if(c.equals(s.allDataSource)){d.items.push(this._getAppsDataSourceFacetItem(s));f();return d;}d.items.push.apply(d.items,this._getRecentDataSourcesTree(s));var p;if(s.dataSourceTree.findNode(c)){p=s.dataSourceTree.findNode(c).parent;}if(p){for(var i=0,l=p.children.length;i<l;i++){var g=p.children[i];var h=g.dataSource;var k=new b({label:h.getLabelPlural(),value:g.count,filterCondition:h,selected:false,level:t.level});if(h.equals(s.appDataSource)){d.items.splice(1,0,k);}else{d.items.push(k);}if(h.equals(c)){e=k;e.selected=true;if(!h.equals(s.appDataSource)){f(t.level+1);}}}}if(!e){d.items.push(this._getCurrentDataSourceFacetItem(s));f();}return d;},getAttributeFacetsFromPerspective:function(r,s,f){var S=r.getChartFacets().filter(function(E){return E.facetType==="attribute";});var c=[];var C={};var d={};var e=s.getProperty("/filterConditions").reverse();for(var i=0,l=S.length;i<l;i++){var o=S[i];var g=new F({title:o.title,facetType:o.facetType,dimension:o.dimension});if(!o.query.resultSet||!o.query.resultSet.elements||o.query.resultSet.elements.length===0){continue;}for(var j=0;j<o.query.resultSet.elements.length;j++){var h=o.query.resultSet.elements[j];var p=new b({value:h.valueRaw,filterCondition:h.dataSource||h.labelRaw,facetTitle:o.title,label:h.label,selected:false,level:0});if(f){p.advanced=false;}g.items.push(p);}d[o.title]=g;c.push(g);}for(var k=0,q=e.length;k<q;k++){var t=e[k];var u=d[t.facetTitle];t.selected=true;t.value=null;t.valueLabel=null;if(!u){u=new F({dimension:t.filterCondition.attribute?t.filterCondition.attribute:t.filterCondition.conditions[0].attribute,title:t.facetTitle,facetType:"attribute",items:[t]});d[t.facetTitle]=u;c.splice(0,0,u);}else{if(!f){var v=c.indexOf(u);c.splice(v,1);c.splice(0,0,u);}var w=false;for(var m=0,x=u.items.length;m<x;m++){var y=u.items[m];if(t.filterCondition.equals(y.filterCondition)){y.selected=true;w=true;if(!f){y.value=null;y.valueLabel=null;}}}if(!w){u.items.splice(0,0,t);if(f){t.advanced=true;if(t.filterCondition.attribute){var z=s.aAttributesMetaData[t.filterCondition.attribute].$$MetaData$$.dataType;if(z==="Double"){t.advanced=false;}}}}}C[t.facetTitle]=u;}if(!f){for(var A in C){if(C.hasOwnProperty(A)){var B=C[A];for(var n=B.items.length-1;n>=0;n--){var D=B.items[n];if(!D.selected){B.items.splice(n,1);}}}}}return c;},getFacets:function(d,i,s){if(!i){return[];}var f=[this.getDataSourceFacetFromPerspective(i,s)];if(!s.isFacetSearchEnabled()){return f;}if(!d.equals(s.appDataSource)){var A=this.getAttributeFacetsFromPerspective(i,s,false);if(A.length>0){f.push.apply(f,A);}}return f;},getDialogFacets:function(d,i,s){var f=[];if(!d.equals(s.appDataSource)){f=this.getAttributeFacetsFromPerspective(i,s,true);}return f;}};})();
