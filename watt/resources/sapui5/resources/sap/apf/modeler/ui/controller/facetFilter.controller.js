/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
jQuery.sap.require("sap.apf.modeler.ui.utils.textPoolHelper");sap.ui.controller("sap.apf.modeler.ui.controller.facetFilter",{onInit:function(){this.getView().addStyleClass("sapUiSizeCompact");this.oViewData=this.getView().getViewData();this.getText=this.oViewData.getText;this.params=this.oViewData.oParams;this.oConfigurationHandler=this.oViewData.oConfigurationHandler;this.oConfigurationEditor=this.oViewData.oConfigurationEditor;var s=this;if(!this.oConfigurationEditor){this.oConfigurationHandler.loadConfiguration(this.params.arguments.configId,function(c){s.oConfigurationEditor=c;});}this.oTextPool=this.oConfigurationHandler.getTextPool();var m=[];m.push(this.byId("idffProperty"));m.push(this.byId("idLabel"));m.push(this.byId("idVHDefaultValues"));m.push(this.byId("idVHfunction"));m.push(this.byId("idVHEntity"));m.push(this.byId("idVHSelectProperties"));m.push(this.byId("idFREntity"));m.push(this.byId("idFRSelectProperties"));this._setMandatoryFields(m);this._setDisplayText();this.setDetailData();},_addAutoCompleteFeatureOnInputs:function(){if(this.oConfigurationHandler){var t=new sap.apf.modeler.ui.utils.TextPoolHelper(this.oTextPool);var T=sap.apf.modeler.ui.utils.TranslationFormatMap.FACETFILTER_LABEL;var d={oTranslationFormat:T,type:"text"};var f=this.byId("idLabel");t.setAutoCompleteOn(f,d);var D={oConfigurationEditor:this.oConfigurationEditor,type:"service"};var F=this.byId("idVHSource");t.setAutoCompleteOn(F,D);var o=this.byId("idFRSource");t.setAutoCompleteOn(o,D);}},_setDisplayText:function(){this.byId("idFacetFilterBasicData").setTitle(this.getText("basicData"));this.byId("idLabel").setPlaceholder(this.getText("New Filter"));this.byId("idValueHelpTitle").setTitle(this.getText("valueHelp"));this.byId("idFilterResolutionTitle").setTitle(this.getText("filterResolution"));this.byId("idFfPropertyLabel").setText(this.getText("ffProperty"));this.byId("idFfPropertyLabel").setRequired(true);this.byId("idFfLabel").setText(this.getText("ffLabel"));this.byId("idFfLabel").setRequired(true);this.byId("idFfAliasLabel").setText(this.getText("ffAlias"));this.byId("idSelectionModeLabel").setText(this.getText("ffSelectionMode"));this.byId("idVhSourceLabel").setText(this.getText("vhSource"));this.byId("idVhEntityLabel").setText(this.getText("vhEntity"));this.byId("idVhEntityLabel").setRequired(false);this.byId("idVhSelectPropertiesLabel").setText(this.getText("vhSelectProperties"));this.byId("idVhSelectPropertiesLabel").setRequired(false);this.byId("idVhDefaultValueModeLabel").setText(this.getText("vhDefaultValueMode"));this.byId("idVhDefaultValuesLabel").setText(this.getText("vhDefaultValues"));this.byId("idVhDefaultValuesLabel").setRequired(false);this.byId("idVhFunctionLabel").setText(this.getText("function"));this.byId("idVhFunctionLabel").setRequired(false);this.byId("idVhCheckBoxLabel").setText(this.getText("vhCheckBoxLabel"));this.byId("idVhSourceLabel1").setText(this.getText("vhSource"));this.byId("idVhSourceLabel1").setRequired(false);this.byId("idVhEntityLabel1").setText(this.getText("vhEntity"));this.byId("idVhEntityLabel1").setRequired(false);this.byId("idVhSelectPropertiesLabel1").setText(this.getText("vhSelectProperties"));this.byId("idVhSelectPropertiesLabel1").setRequired(false);this.byId("single").setText(this.getText("singleSelection"));this.byId("multi").setText(this.getText("multipleSelection"));},setDetailData:function(){var p=[];this._addAutoCompleteFeatureOnInputs();var a=this.oConfigurationEditor.getAllKnownProperties();a.forEach(function(t){var u={};u.propertyKey=t;u.propertyName=t;p.push(u);});var d={Properties:p};var m=new sap.ui.model.json.JSONModel();m.setSizeLimit(500);m.setData(d);this.byId("idffProperty").setModel(m);var M=new sap.ui.model.json.JSONModel();M.setSizeLimit(500);M.setData(d);this.byId("idAlias").setModel(M);var D=[{dvKey:this.getText("fixedValues"),dvName:this.getText("fixedValues")},{dvKey:this.getText("function"),dvName:this.getText("function")}];var o={DVModes:D};var b=new sap.ui.model.json.JSONModel();b.setSizeLimit(500);b.setData(o);this.byId("idVHDefaultValueMode").setModel(b);if(this.params&&this.params.arguments&&this.params.arguments.facetFilterId){this.facetFilter=this.oConfigurationEditor.getFacetFilter(this.params.arguments.facetFilterId);}if(this.facetFilter){if(this.params&&this.params.arguments&&this.params.arguments.facetFilterId){this.facetFilter=this.oConfigurationEditor.getFacetFilter(this.params.arguments.facetFilterId);}if(this.facetFilter.getProperty()!==undefined&&this.facetFilter.getProperty()!==null){this.byId("idffProperty").setValue(this.facetFilter.getProperty());}if(this.facetFilter.getLabelKey()!==undefined&&this.facetFilter.getLabelKey()!==null&&this.oTextPool.get(this.facetFilter.getLabelKey())){this.byId("idLabel").setValue(this.oTextPool.get(this.facetFilter.getLabelKey()).TextElementDescription);}else{this.byId("idLabel").setValue(this.params.arguments.facetFilterId);}if(this.facetFilter.getAlias()!==undefined){this.byId("idAlias").setValue(this.facetFilter.getAlias());}if(this.facetFilter.isMultiSelection()!==undefined){this.byId("multi").setSelected(this.facetFilter.isMultiSelection());this.byId("single").setSelected(!this.facetFilter.isMultiSelection());}if(this.facetFilter.getServiceOfValueHelp()!==undefined){this.byId("idVHSource").setValue(this.facetFilter.getServiceOfValueHelp());var s=this.facetFilter.getServiceOfValueHelp();var A=[];var c=[];A=this.oConfigurationEditor.getAllEntitySetsOfService(s);A.forEach(function(t){var u={};u.entityKey=t;u.entityName=t;c.push(u);});var e={Entities:c};var f=new sap.ui.model.json.JSONModel();f.setSizeLimit(500);f.setData(e);this.byId("idVHEntity").setModel(f);this.byId("idVhEntityLabel").setText(this.getText("vhEntity"));this.byId("idVhEntityLabel").setRequired(true);this.byId("idVhSelectPropertiesLabel").setText(this.getText("vhSelectProperties"));this.byId("idVhSelectPropertiesLabel").setRequired(true);}if(this.facetFilter.getEntitySetOfValueHelp()!==undefined){this.byId("idVHEntity").setSelectedKey(this.facetFilter.getEntitySetOfValueHelp());var E=this.facetFilter.getEntitySetOfValueHelp();var S=this.facetFilter.getServiceOfValueHelp();var P=[];p=[];P=this.oConfigurationEditor.getAllPropertiesOfEntitySet(S,E);var g=P[0];P.forEach(function(t){var u={};u.propertyKey=t;u.propertyName=t;p.push(u);});var h={Properties:p};var i=new sap.ui.model.json.JSONModel();i.setSizeLimit(500);i.setData(h);this.byId("idVHSelectProperties").setModel(i);}if(this.facetFilter.getSelectPropertiesOfValueHelp()&&this.facetFilter.getSelectPropertiesOfValueHelp().length>0){this.byId("idVHSelectProperties").setSelectedKeys(this.facetFilter.getSelectPropertiesOfValueHelp());}if(this.facetFilter.getPreselectionFunction()!==undefined){this._hideAndResetPreselectionDefault();this._showPreselectionFunction();this.byId("idVHDefaultValueMode").setSelectedKey(this.getText("function"));this.byId("idVHfunction").setValue(this.facetFilter.getPreselectionFunction());}else{this._hideAndResetPreselectionFunction();this._showPreselectionDefault();this.byId("idVHDefaultValueMode").setSelectedKey(this.getText("fixedValues"));var j;if(this.facetFilter.isMultiSelection()){j=this.facetFilter.getPreselectionDefaults()?this.facetFilter.getPreselectionDefaults().join(','):"";}else{j=this.facetFilter.getPreselectionDefaults()[0];}this.byId("idVHDefaultValues").setValue(j);}if(this.facetFilter.getUseSameRequestForValueHelpAndFilterResolution()){this.byId("idVhCheckBox").setSelected(true);this._disableFilterResolutionSourceFields();this._setValueHelpSourceAsFilterResolution();}else{this.byId("idVhCheckBox").setSelected(false);this._enableFilterResolutionSourceFields();if(this.facetFilter.getServiceOfFilterResolution()!==undefined&&this.facetFilter.getServiceOfFilterResolution()!==""&&this.facetFilter.getServiceOfFilterResolution()!==null){s=this.facetFilter.getServiceOfFilterResolution();this.byId("idFRSource").setValue(s);A=[];c=[];A=this.oConfigurationEditor.getAllEntitySetsOfService(s);A.forEach(function(t){var u={};u.entityKey=t;u.entityName=t;c.push(u);});var k={Entities:c};var l=new sap.ui.model.json.JSONModel();l.setSizeLimit(500);l.setData(k);this.byId("idFREntity").setModel(l);this.byId("idVhEntityLabel1").setText(this.getText("vhEntity"));this.byId("idVhEntityLabel1").setRequired(true);this.byId("idVhSelectPropertiesLabel1").setText(this.getText("vhSelectProperties"));this.byId("idVhSelectPropertiesLabel1").setRequired(true);}if(this.facetFilter.getEntitySetOfFilterResolution()!==undefined&&this.facetFilter.getEntitySetOfFilterResolution()!==null&&this.facetFilter.getEntitySetOfFilterResolution()!==""){E=this.facetFilter.getEntitySetOfFilterResolution();S=this.facetFilter.getServiceOfFilterResolution();this.byId("idFREntity").setSelectedKey(this.facetFilter.getEntitySetOfFilterResolution());P=[];p=[];P=this.oConfigurationEditor.getAllPropertiesOfEntitySet(S,E);g=P[0];P.forEach(function(t){var u={};u.propertyKey=t;u.propertyName=t;p.push(u);});var n={Properties:p};var q=new sap.ui.model.json.JSONModel();q.setSizeLimit(500);q.setData(n);this.byId("idFRSelectProperties").setModel(q);}if(this.facetFilter.getSelectPropertiesOfFilterResolution()!==undefined&&this.facetFilter.getSelectPropertiesOfFilterResolution().length>0){this.byId("idFRSelectProperties").setSelectedKeys(this.facetFilter.getSelectPropertiesOfFilterResolution());}}}else{var F=this.oConfigurationEditor.createFacetFilter();this.facetFilter=this.oConfigurationEditor.getFacetFilter(F);this.facetFilter.setMultiSelection(true);this.byId("idVHDefaultValueMode").setSelectedKey(this.getText("fixedValues"));this.byId("idVHDefaultValues").isMandatory=false;this.byId("idVhDefaultValuesLabel").setRequired(false);this._showPreselectionDefault();this._hideAndResetPreselectionFunction();this.byId("multi").setSelected(true);var r={id:F,icon:"sap-icon://filter"};this.oViewData.updateSelectedNode(r);}},handleChangeForProperty:function(e){this.oConfigurationEditor.setIsUnsaved();var p=this.byId("idffProperty").getValue().trim();if(p!==""&&p!==null){this.facetFilter.setProperty(p);}},handleChangeForLabel:function(e){this.oConfigurationEditor.setIsUnsaved();var s=this;var t=sap.apf.modeler.ui.utils.TranslationFormatMap.FACETFILTER_LABEL;var f=this.byId("idLabel").getValue().trim();var F=s.oTextPool.setText(f,t);if(f!==""&&f!==null){this.facetFilter.setLabelKey(F);}var a={};a.name=f;a.id=this.facetFilter.getId();if(f!==""&&f!==null){this.oViewData.updateSelectedNode(a,this.bIsNew);var T=this.getText("facetFilter")+": "+f;this.oViewData.updateTitleAndBreadCrumb(T);}},handleChangeForAlias:function(){this.oConfigurationEditor.setIsUnsaved();var a=this.byId("idAlias").getValue().trim();this.facetFilter.setAlias(a);},_setPreselectionDefaultValue:function(){if(!this.facetFilter.isMultiSelection()){var p=this.facetFilter.getPreselectionDefaults();if(p&&p.length>0){this.facetFilter.setPreselectionDefaults([p[0]]);if(this.byId("idVHDefaultValues")){this.byId("idVHDefaultValues").setValue(p[0]);}}}},handleChangeForSelectionModeSingle:function(){this.facetFilter.setMultiSelection(false);this.oConfigurationEditor.setIsUnsaved();this._changeMandatoryTagForSelectionMode();this._setPreselectionDefaultValue();},handleChangeForSelectionModeMulti:function(){this.facetFilter.setMultiSelection(true);this.oConfigurationEditor.setIsUnsaved();this._changeMandatoryTagForSelectionMode();},_changeMandatoryTagForSelectionMode:function(){if(jQuery(this.byId("idVHfunction").getDomRef()).length>=1){this.byId("idVhFunctionLabel").setRequired(true);this.byId("idVHfunction").isMandatory=true;this.byId("idVHDefaultValues").isMandatory=false;}else if(jQuery(this.byId("idVHDefaultValues").getDomRef()).length>=1){this.byId("idVhFunctionLabel").setRequired(true);this.byId("idVHfunction").isMandatory=false;if(this.facetFilter.isMultiSelection()){this.byId("idVHDefaultValues").isMandatory=false;this.byId("idVhDefaultValuesLabel").setRequired(false);}else{this.byId("idVHDefaultValues").isMandatory=true;this.byId("idVhDefaultValuesLabel").setRequired(true);}}},_checkValidationStateForService:function(v,p){var s=this;var S,o,V={source:undefined,entitySet:undefined,selectProperty:undefined};if(v){S=this.byId("idVHSource").getValue().trim();}else{S=this.byId("idFRSource").getValue().trim();}var b=this.oConfigurationEditor.registerService(S);var a=[];var A=[];if(b){V.source=S;a=this.oConfigurationEditor.getAllEntitySetsOfService(S);var c;if(p==="entitySet"||p==="selectProperties"){if(v){c=this.byId("idVHEntity").getSelectedKey();}else{c=this.byId("idFREntity").getSelectedKey();}}else{if(v){c=this.facetFilter.getEntitySetOfValueHelp();}else{c=this.facetFilter.getEntitySetOfFilterResolution();}}if(c){a.forEach(function(e){if(c===e){V.entitySet=c;if(p==="source"){if(v){s.byId("idVHEntity").setSelectedKey(c);}else{s.byId("idFREntity").setSelectedKey(c);}}}});var d,C=[];if(p==="selectProperties"){if(v){d=this.byId("idVHSelectProperties").getSelectedKeys();}else{d=this.byId("idFRSelectProperties").getSelectedKeys();}}else{if(v){d=this.facetFilter.getSelectPropertiesOfValueHelp();}else{d=this.facetFilter.getSelectPropertiesOfFilterResolution();}}var P=this.oConfigurationEditor.getAllPropertiesOfEntitySet(S,c);P.forEach(function(e){d.forEach(function(f){if(f===e){C.push(f);}});});if(C.length>0){V.selectProperty=C;if(p!=="selectProperties"){if(v){this.byId("idVHSelectProperties").setSelectedKeys(C);}else{this.byId("idFRSelectProperties").setSelectedKeys(C);}}}else{if(this.byId("idVhCheckBox").getSelected()===true){this._resetFilterResolutionSelectProperty();}}}}if(V.selectProperty&&V.entitySet&&V.source){if(v){this.facetFilter.setServiceOfValueHelp(V.source);this.facetFilter.setEntitySetOfValueHelp(V.entitySet);o=this.facetFilter.getSelectPropertiesOfValueHelp();o.forEach(function(e){s.facetFilter.removeSelectPropertyOfValueHelp(e);});V.selectProperty.forEach(function(e){s.facetFilter.addSelectPropertyOfValueHelp(e);});if(this.byId("idVhCheckBox").getSelected()===true){this._setValueHelpSourceAsFilterResolution();}}else{this.facetFilter.setServiceOfFilterResolution(V.source);this.facetFilter.setEntitySetOfFilterResolution(V.entitySet);o=this.facetFilter.getSelectPropertiesOfFilterResolution();o.forEach(function(e){s.facetFilter.removeSelectPropertyOfFilterResolution(e);});V.selectProperty.forEach(function(e){s.facetFilter.addSelectPropertyOfFilterResolution(e);});}}},handleChangeForVHSource:function(){var s=this;this.oConfigurationEditor.setIsUnsaved();var S=this.byId("idVHSource").getValue().trim();var b;if(S){b=this.oConfigurationEditor.registerService(S);if(b){this.byId("idVhEntityLabel").setText(this.getText("vhEntity"));this.byId("idVhEntityLabel").setRequired(true);this.byId("idVhSelectPropertiesLabel").setText(this.getText("vhSelectProperties"));this.byId("idVhSelectPropertiesLabel").setRequired(true);}}else{this.facetFilter.setServiceOfValueHelp(S);this.facetFilter.setEntitySetOfValueHelp(undefined);var o=this.facetFilter.getSelectPropertiesOfValueHelp();o.forEach(function(e){s.facetFilter.removeSelectPropertyOfValueHelp(e);});this.byId("idVhEntityLabel").setText(this.getText("vhEntity"));this.byId("idVhEntityLabel").setRequired(false);this.byId("idVhSelectPropertiesLabel").setText(this.getText("vhSelectProperties"));this.byId("idVhSelectPropertiesLabel").setRequired(false);if(this.byId("idVhCheckBox").getSelected()===true){this._resetFilterResolutionFields();}}var d,a=[],A=[];a=this.oConfigurationEditor.getAllEntitySetsOfService(S);a.forEach(function(e){var E={};E.entityKey=e;E.entityName=e;A.push(E);});var D={Entities:A};var m=new sap.ui.model.json.JSONModel();m.setSizeLimit(500);m.setData(D);this.byId("idVHEntity").setModel(m);var p=[],P=[];if(a.length>=1){this.byId("idVHEntity").setSelectedKey(a[0]);this.facetFilter.setEntitySetOfValueHelp(a[0]);p=this.oConfigurationEditor.getAllPropertiesOfEntitySet(S,a[0]);p.forEach(function(e){var f={};f.propertyKey=e;f.propertyName=e;P.push(f);});}var c={Properties:P};var M=new sap.ui.model.json.JSONModel();M.setSizeLimit(500);M.setData(c);this.byId("idVHSelectProperties").setModel(M);this._checkValidationStateForService(true,"source");if(this.byId("idVhCheckBox").getSelected()===true){this._populateServiceForFilterResolution();}},handleChangeForVHEntity:function(){var s=this;this.oConfigurationEditor.setIsUnsaved();var e=this.byId("idVHEntity").getSelectedKey();var S=this.byId("idVHSource").getValue().trim();var p=[],P=[];if(S&&S!==null&&S!==""){p=this.oConfigurationEditor.getAllPropertiesOfEntitySet(S,e);p.forEach(function(a){var o={};o.propertyKey=a;o.propertyName=a;P.push(o);});var d={Properties:P};var m=new sap.ui.model.json.JSONModel();m.setSizeLimit(500);m.setData(d);this.byId("idVHSelectProperties").setModel(m);this._checkValidationStateForService(true,"entitySet");if(this.byId("idVhCheckBox").getSelected()===true){this._populateEntityForFilterResolution();}}},handleChangeForVHSelectProperties:function(){this.oConfigurationEditor.setIsUnsaved();this._checkValidationStateForService(true,"selectProperties");if(this.byId("idVhCheckBox").getSelected()===true){this._populateSelectPropertyForFilterResolution();}},handleChangeForDVMode:function(){var d=this.byId("idVHDefaultValueMode").getSelectedKey();if(d===this.getText("fixedValues")){this._hideAndResetPreselectionFunction();this._showPreselectionDefault();}else if(d===this.getText("Function")){this._showPreselectionFunction();this._hideAndResetPreselectionDefault();}},handleChangeForVHFixedValues:function(){this.oConfigurationEditor.setIsUnsaved();var p=this.byId("idVHDefaultValues").getValue().trim();var P=p.split(',');var v=[];if(this.facetFilter.getPreselectionFunction()){this.facetFilter.removePreselectionFunction();}P.forEach(function(d){var V=d.trim();if(V){v.push(V);}});if(v.length>0){if(this.facetFilter.isMultiSelection()){this.facetFilter.setPreselectionDefaults(v);this.byId("idVHDefaultValues").isMandatory=false;}else{this.facetFilter.setPreselectionDefaults([v[0]]);this.facetFilter.setMultiSelection(false);this.byId("idVHDefaultValues").isMandatory=true;}}},handleChangeForPreselectionFunction:function(){this.oConfigurationEditor.setIsUnsaved();var p=this.byId("idVHfunction").getValue().trim();if(this.facetFilter.getPreselectionDefaults().length){this.facetFilter.removePreselectionDefaults();}this.byId("idVHfunction").isMandatory=true;if(p){this.facetFilter.setPreselectionFunction(p);}},handleChangeForFRSource:function(){var s=this;this.oConfigurationEditor.setIsUnsaved();var S=this.byId("idFRSource").getValue().trim();var b;var a=[];var A=[];if(S){b=this.oConfigurationEditor.registerService(S);if(b){this.byId("idVhEntityLabel1").setText(this.getText("vhEntity"));this.byId("idVhEntityLabel1").setRequired(true);this.byId("idVhSelectPropertiesLabel1").setText(this.getText("vhSelectProperties"));this.byId("idVhSelectPropertiesLabel1").setRequired(true);}}else{this.facetFilter.setServiceOfFilterResolution(S);this.facetFilter.setEntitySetOfFilterResolution(undefined);var o=this.facetFilter.getSelectPropertiesOfFilterResolution();o.forEach(function(c){s.facetFilter.removeSelectPropertyOfFilterResolution(c);});this.byId("idVhEntityLabel1").setText(this.getText("vhEntity"));this.byId("idVhEntityLabel1").setRequired(false);this.byId("idVhSelectPropertiesLabel1").setText(this.getText("vhSelectProperties"));this.byId("idVhSelectPropertiesLabel1").setRequired(false);}a=this.oConfigurationEditor.getAllEntitySetsOfService(S);a.forEach(function(e){var E={};E.entityKey=e;E.entityName=e;A.push(E);});var d={Entities:A};var m=new sap.ui.model.json.JSONModel();m.setSizeLimit(500);m.setData(d);this.byId("idFREntity").setModel(m);var p=[],P=[];if(a.length>=1){this.byId("idFREntity").setSelectedKey(a[0]);this.facetFilter.setEntitySetOfFilterResolution(a[0]);p=this.oConfigurationEditor.getAllPropertiesOfEntitySet(S,a[0]);p.forEach(function(c){var e={};e.propertyKey=c;e.propertyName=c;P.push(e);});}var D={Properties:P};var M=new sap.ui.model.json.JSONModel();M.setSizeLimit(500);M.setData(D);this.byId("idFRSelectProperties").setModel(M);this._checkValidationStateForService(false,"source");},handleChangeForFREntity:function(){var s=this;this.oConfigurationEditor.setIsUnsaved();var e=this.byId("idFREntity").getSelectedKey();var S=this.byId("idFRSource").getValue().trim();var p=[],P=[];if(S&&S!==null&&S!==""){p=this.oConfigurationEditor.getAllPropertiesOfEntitySet(S,e);var d=p[0];p.forEach(function(a){var o={};o.propertyKey=a;o.propertyName=a;P.push(o);});var D={Properties:P};var m=new sap.ui.model.json.JSONModel();m.setSizeLimit(500);m.setData(D);this.byId("idFRSelectProperties").setModel(m);this._checkValidationStateForService(false,"entitySet");}},handleChangeForFRSelectProperties:function(){this.oConfigurationEditor.setIsUnsaved();this._checkValidationStateForService(false,"selectProperties");},handleChangeForVHCheckBox:function(e){this.oConfigurationEditor.setIsUnsaved();if(e.getParameter("selected")){this.facetFilter.setUseSameRequestForValueHelpAndFilterResolution(true);this._disableFilterResolutionSourceFields();}else{this.facetFilter.setUseSameRequestForValueHelpAndFilterResolution(false);this._enableFilterResolutionSourceFields();}},_enableFilterResolutionSourceFields:function(){this.byId("idFRSource").setEnabled(true);this.byId("idFREntity").setEnabled(true);this.byId("idFRSelectProperties").setEnabled(true);},_disableFilterResolutionSourceFields:function(){this.byId("idFRSource").setEnabled(false);this.byId("idFREntity").setEnabled(false);this.byId("idFRSelectProperties").setEnabled(false);this._setValueHelpSourceAsFilterResolution();},_setValueHelpSourceAsFilterResolution:function(){this._populateServiceForFilterResolution();this._populateEntityForFilterResolution();this._populateSelectPropertyForFilterResolution();},_populateServiceForFilterResolution:function(){this.byId("idFRSource").setModel(this.byId("idVHSource").getModel());this.byId("idFRSource").setValue(this.byId("idVHSource").getValue());this.facetFilter.setServiceOfFilterResolution(this.facetFilter.getServiceOfValueHelp());},_populateEntityForFilterResolution:function(){this.byId("idFREntity").setModel(this.byId("idVHEntity").getModel());this.byId("idFREntity").setSelectedKey(this.byId("idVHEntity").getSelectedKey());this.facetFilter.setEntitySetOfFilterResolution(this.facetFilter.getEntitySetOfValueHelp());},_populateSelectPropertyForFilterResolution:function(){var s=this;this.byId("idFRSelectProperties").setModel(this.byId("idVHSelectProperties").getModel());this.byId("idFRSelectProperties").setSelectedKeys(this.byId("idVHSelectProperties").getSelectedKeys());var o=this.facetFilter.getSelectPropertiesOfFilterResolution();o.forEach(function(p){s.facetFilter.removeSelectPropertyOfFilterResolution(p);});this.facetFilter.getSelectPropertiesOfValueHelp().forEach(function(p){s.facetFilter.addSelectPropertyOfFilterResolution(p);});},_resetFilterResolutionFields:function(){this._resetFilterResolutionService();this._resetFilterResolutionEntity();this._resetFilterResolutionSelectProperty();},_resetFilterResolutionService:function(){this.byId("idFRSource").setValue("");this.facetFilter.setServiceOfFilterResolution("");},_resetFilterResolutionEntity:function(){this.byId("idFREntity").setSelectedKey();var e=new sap.ui.model.json.JSONModel().setData({NoData:[]});this.byId("idFREntity").setModel(e);this.facetFilter.setEntitySetOfFilterResolution(undefined);},_resetFilterResolutionSelectProperty:function(){var s=this;this.byId("idFRSelectProperties").setSelectedKeys([]);var e=new sap.ui.model.json.JSONModel().setData({NoData:[]});this.byId("idFRSelectProperties").setModel(e);var S=this.byId("idFRSelectProperties").getSelectedKeys();this.byId("idFRSelectProperties").removeSelectedKeys(S);var o=this.facetFilter.getSelectPropertiesOfFilterResolution();o.forEach(function(p){s.facetFilter.removeSelectPropertyOfFilterResolution(p);});},_hideAndResetPreselectionFunction:function(){this.byId("idVHfunction").setValue("");if(this.facetFilter.getPreselectionFunction()){this.facetFilter.removePreselectionFunction();}this.byId("idVhFunctionLabel").setRequired(false);this.byId("idVhFunctionLabel").setVisible(false);this.byId("idVHfunction").setVisible(false);this.byId("idVHfunction").isMandatory=false;},_hideAndResetPreselectionDefault:function(){this.byId("idVHDefaultValues").setValue("");if(this.facetFilter.getPreselectionDefaults()){this.facetFilter.removePreselectionDefaults();}this.byId("idVhDefaultValuesLabel").setRequired(false);this.byId("idVhDefaultValuesLabel").setVisible(false);this.byId("idVHDefaultValues").setVisible(false);this.byId("idVHDefaultValues").isMandatory=false;},_showPreselectionFunction:function(){this.byId("idVhFunctionLabel").setRequired(true);this.byId("idVhFunctionLabel").setVisible(true);this.byId("idVHfunction").setVisible(true);this.byId("idVHfunction").isMandatory=true;},_showPreselectionDefault:function(){this.byId("idVhDefaultValuesLabel").setVisible(true);this.byId("idVHDefaultValues").setVisible(true);if(this.facetFilter.isMultiSelection()){this.byId("idVHDefaultValues").isMandatory=false;this.byId("idVhDefaultValuesLabel").setRequired(false);}else{this.byId("idVHDefaultValues").isMandatory=true;this.byId("idVhDefaultValuesLabel").setRequired(true);}},_setSourceValidationState:function(){var s=this.byId("idVHSource").getValue().trim();var f=this.byId("idFRSource").getValue().trim();var S;var F;if(s!==""){S=this.oConfigurationEditor.registerService(s);if(S){this.byId("idVHEntity").isMandatory=true;this.byId("idVHSelectProperties").isMandatory=true;}else{this.byId("idVHEntity").isMandatory=false;this.byId("idVHSelectProperties").isMandatory=false;}}else{this.byId("idVHEntity").isMandatory=false;this.byId("idVHSelectProperties").isMandatory=false;}if(f){F=this.oConfigurationEditor.registerService(s);if(F){this.byId("idFREntity").isMandatory=true;this.byId("idFRSelectProperties").isMandatory=true;}else{this.byId("idFREntity").isMandatory=false;this.byId("idFRSelectProperties").isMandatory=false;}}else{this.byId("idFREntity").isMandatory=false;this.byId("idFRSelectProperties").isMandatory=false;}},_setMandatoryFields:function(f){this.mandatoryFields=this.mandatoryFields||[];for(var i=0;i<f.length;i++){f[i].isMandatory=true;this.mandatoryFields.push(f[i]);}},_getMandatoryFields:function(){return this.mandatoryFields;},_setValidationState:function(){var m=this._getMandatoryFields();for(var i=0;i<m.length;i++){if(m[i].isMandatory===true){if(typeof m[i].getSelectedKeys==="function"){this.isValidState=(m[i].getSelectedKeys().length>=1)?true:false;}else if(typeof m[i].getValue==="function"){this.isValidState=(m[i].getValue().trim()!=="")?true:false;}else{this.isValidState=(m[i].getSelectedKey().length>=1)?true:false;}if(this.isValidState===false){break;}}}},getValidationState:function(){this._setSourceValidationState();this._setValidationState();var i=(this.isValidState!==undefined)?this.isValidState:true;return i;}});
