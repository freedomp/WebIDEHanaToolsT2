(function(c,u){"use strict";var d={};function r(a,b){var m,e=[];for(var i=0;i<a.length;++i){m=d[a[i]]||h(a[i]);if(!m){throw'module definition dependecy not found: '+a[i];}e.push(m);}b.apply(null,e);}function f(i,a,b){if(typeof i!=='string'){throw'invalid module definition, module id must be defined and be a string';}if(a===u){throw'invalid module definition, dependencies must be specified';}if(b===u){throw'invalid module definition, definition function must be specified';}r(a,function(){d[i]=b.apply(null,arguments);});}function g(i){return!!d[i];}function h(i){var t=c;var a=i.split(/[.\/]/);for(var b=0;b<a.length;++b){if(!t[a[b]]){return;}t=t[a[b]];}return t;}function j(a){var i,t,b,e,p;for(i=0;i<a.length;i++){t=c;b=a[i];e=b.split(/[.\/]/);for(var k=0;k<e.length-1;++k){if(t[e[k]]===u){t[e[k]]={};}t=t[e[k]];}t[e[e.length-1]]=d[b];}if(c.AMDLC_TESTS){p=c.privateModules||{};for(b in d){p[b]=d[b];}for(i=0;i<a.length;i++){delete p[a[i]];}c.privateModules=p;}}f("tinymce/spellcheckerplugin/DomTextMatcher",[],function(){
// released under UNLICENSE that is compatible with LGPL
return function(n,e){var m,k=[],t,o=e.dom;var p,q,s;p=e.schema.getBlockElements();q=e.schema.getWhiteSpaceElements();s=e.schema.getShortEndedElements();function v(m,a){if(!m[0]){throw'findAndReplaceDOMText cannot handle zero-length matches';}return{start:m.index,end:m.index+m[0].length,text:m[0],data:a};}function w(n){var a;if(n.nodeType===3){return n.data;}if(q[n.nodeName]&&!p[n.nodeName]){return'';}a='';if(p[n.nodeName]||s[n.nodeName]){a+='\n';}if((n=n.firstChild)){do{a+=w(n);}while((n=n.nextSibling));}return a;}function x(n,k,i){var l,N,O,P,Q=[],R=0,S=n,T,U=0;k=k.slice(0);k.sort(function(a,b){return a.start-b.start;});T=k.shift();out:while(true){if(p[S.nodeName]||s[S.nodeName]){R++;}if(S.nodeType===3){if(!N&&S.length+R>=T.end){N=S;P=T.end-R;}else if(l){Q.push(S);}if(!l&&S.length+R>T.start){l=S;O=T.start-R;}R+=S.length;}if(l&&N){S=i({startNode:l,startNodeIndex:O,endNode:N,endNodeIndex:P,innerNodes:Q,match:T.text,matchIndex:U});R-=(N.length-P);l=null;N=null;Q=[];T=k.shift();U++;if(!T){break;}}else if((!q[S.nodeName]||p[S.nodeName])&&S.firstChild){S=S.firstChild;continue;}else if(S.nextSibling){S=S.nextSibling;continue;}while(true){if(S.nextSibling){S=S.nextSibling;break;}else if(S.parentNode!==n){S=S.parentNode;}else{break out;}}}}function y(a){function b(i,l){var N=k[l];if(!N.stencil){N.stencil=a(N);}var O=N.stencil.cloneNode(false);O.setAttribute('data-mce-index',l);if(i){O.appendChild(o.doc.createTextNode(i));}return O;}return function(N){var O,P,Q,R=N.startNode,S=N.endNode,T=N.matchIndex,U=o.doc;if(R===S){var n=R;Q=n.parentNode;if(N.startNodeIndex>0){O=U.createTextNode(n.data.substring(0,N.startNodeIndex));Q.insertBefore(O,n);}var V=b(N.match,T);Q.insertBefore(V,n);if(N.endNodeIndex<n.length){P=U.createTextNode(n.data.substring(N.endNodeIndex));Q.insertBefore(P,n);}n.parentNode.removeChild(n);return V;}O=U.createTextNode(R.data.substring(0,N.startNodeIndex));P=U.createTextNode(S.data.substring(N.endNodeIndex));var W=b(R.data.substring(N.startNodeIndex),T);var X=[];for(var i=0,l=N.innerNodes.length;i<l;++i){var Y=N.innerNodes[i];var Z=b(Y.data,T);Y.parentNode.replaceChild(Z,Y);X.push(Z);}var $=b(S.data.substring(0,N.endNodeIndex),T);Q=R.parentNode;Q.insertBefore(O,R);Q.insertBefore(W,R);Q.removeChild(R);Q=S.parentNode;Q.insertBefore($,S);Q.insertBefore(P,S);Q.removeChild(S);return $;};}function z(a){var b=a.parentNode;b.insertBefore(a.firstChild,a);a.parentNode.removeChild(a);}function A(a){var b=n.getElementsByTagName('*'),l=[];a=typeof a=="number"?""+a:null;for(var i=0;i<b.length;i++){var N=b[i],O=N.getAttribute('data-mce-index');if(O!==null&&O.length){if(O===a||a===null){l.push(N);}}}return l;}function B(a){var i=k.length;while(i--){if(k[i]===a){return i;}}return-1;}function C(a){var b=[];D(function(l,i){if(a(l,i)){b.push(l);}});k=b;return this;}function D(a){for(var i=0,l=k.length;i<l;i++){if(a(k[i],i)===false){break;}}return this;}function E(a){if(k.length){x(n,k,y(a));}return this;}function F(a,b){if(t&&a.global){while((m=a.exec(t))){k.push(v(m,b));}}return this;}function G(a){var i,b=A(a?B(a):null);i=b.length;while(i--){z(b[i]);}return this;}function H(a){return k[a.getAttribute('data-mce-index')];}function I(a){return A(B(a))[0];}function J(a,l,b){k.push({start:a,end:a+l,text:t.substr(a,l),data:b});return this;}function K(a){var b=A(B(a));var i=e.dom.createRng();i.setStartBefore(b[0]);i.setEndAfter(b[b.length-1]);return i;}function L(a,t){var b=K(a);b.deleteContents();if(t.length>0){b.insertNode(e.dom.doc.createTextNode(t));}return b;}function M(){k.splice(0,k.length);G();return this;}t=w(n);return{text:t,matches:k,each:D,filter:C,reset:M,matchFromElement:H,elementFromMatch:I,find:F,add:J,wrap:E,unwrap:G,replace:L,rangeFromMatch:K,indexOf:B};};});f("tinymce/spellcheckerplugin/Plugin",["tinymce/spellcheckerplugin/DomTextMatcher","tinymce/PluginManager","tinymce/util/Tools","tinymce/ui/Menu","tinymce/dom/DOMUtils","tinymce/util/XHR","tinymce/util/URI","tinymce/util/JSON"],function(D,P,T,M,a,X,U,J){P.add('spellchecker',function(b,k){var l,s=this,m,n,o,p=b.settings;var q;function t(){if(!s.textMatcher){s.textMatcher=new D(b.getBody(),b);}return s.textMatcher;}function v(e,i){var Q=[];T.each(i,function(R){Q.push({selectable:true,text:R.name,data:R.value});});return Q;}var w=p.spellchecker_languages||'English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,'+'German=de,Italian=it,Polish=pl,Portuguese=pt_BR,'+'Spanish=es,Swedish=sv';l=v('Language',T.map(w.split(','),function(e){e=e.split('=');return{name:e[0],value:e[1]};}));function x(e){for(var i in e){return false;}return true;}function y(i,Q){var R=[],S=m[i];T.each(S,function(e){R.push({text:e,onclick:function(){b.insertContent(b.dom.encode(e));b.dom.remove(Q);E();}});});R.push({text:'-'});if(q){R.push({text:'Add to Dictionary',onclick:function(){F(i,Q);}});}R.push.apply(R,[{text:'Ignore',onclick:function(){G(i,Q);}},{text:'Ignore all',onclick:function(){G(i,Q,true);}}]);o=new M({items:R,context:'contextmenu',onautohide:function(e){if(e.target.className.indexOf('spellchecker')!=-1){e.preventDefault();}},onhide:function(){o.remove();o=null;}});o.renderTo(document.body);var V=a.DOM.getPos(b.getContentAreaContainer());var W=b.dom.getPos(Q[0]);var Y=b.dom.getRoot();if(Y.nodeName=='BODY'){W.x-=Y.ownerDocument.documentElement.scrollLeft||Y.scrollLeft;W.y-=Y.ownerDocument.documentElement.scrollTop||Y.scrollTop;}else{W.x-=Y.scrollLeft;W.y-=Y.scrollTop;}V.x+=W.x;V.y+=W.y;o.moveTo(V.x,V.y+Q[0].offsetHeight);}function z(){return b.getParam('spellchecker_wordchar_pattern')||new RegExp("[^"+"\\s!\"#$%&()*+,-./:;<=>?@[\\]^_{|}`"+"\u00a7\u00a9\u00ab\u00ae\u00b1\u00b6\u00b7\u00b8\u00bb"+"\u00bc\u00bd\u00be\u00bf\u00d7\u00f7\u00a4\u201d\u201c\u201e\u00a0\u2002\u2003\u2009"+"]+","g");}function A(e,i,Q,R){var S={method:e},V='';if(e=="spellcheck"){S.text=i;S.lang=p.spellchecker_language;}if(e=="addToDictionary"){S.word=i;}T.each(S,function(W,Y){if(V){V+='&';}V+=Y+'='+encodeURIComponent(W);});X.send({url:new U(k).toAbsolute(p.spellchecker_rpc_url),type:"post",content_type:'application/x-www-form-urlencoded',data:V,success:function(W){W=J.parse(W);if(!W){R("Sever response wasn't proper JSON.");}else if(W.error){R(W.error);}else{Q(W);}},error:function(W,Y){R("Spellchecker request error: "+Y.status);}});}function B(e,i,Q,R){var S=p.spellchecker_callback||A;S.call(s,e,i,Q,R);}function C(){H();if(n){return;}function e(i){b.windowManager.alert(i);b.setProgressState(false);H();}b.setProgressState(true);B("spellcheck",t().text,N,e);b.focus();}function E(){if(!b.dom.select('span.mce-spellchecker-word').length){H();}}function F(e,i){b.setProgressState(true);B("addToDictionary",e,function(){b.setProgressState(false);b.dom.remove(i,true);E();},function(Q){b.windowManager.alert(Q);b.setProgressState(false);});}function G(e,i,Q){b.selection.collapse();if(Q){T.each(b.dom.select('span.mce-spellchecker-word'),function(R){if(R.getAttribute('data-mce-word')==e){b.dom.remove(R,true);}});}else{b.dom.remove(i,true);}E();}function H(){t().reset();s.textMatcher=null;if(n){n=false;b.fire('SpellcheckEnd');}}function I(e){var i=e.getAttribute('data-mce-index');if(typeof i=="number"){return""+i;}return i;}function K(e){var Q,R=[];Q=T.toArray(b.getBody().getElementsByTagName('span'));if(Q.length){for(var i=0;i<Q.length;i++){var S=I(Q[i]);if(S===null||!S.length){continue;}if(S===e.toString()){R.push(Q[i]);}}}return R;}b.on('click',function(e){var i=e.target;if(i.className=="mce-spellchecker-word"){e.preventDefault();var Q=K(I(i));if(Q.length>0){var R=b.dom.createRng();R.setStartBefore(Q[0]);R.setEndAfter(Q[Q.length-1]);b.selection.setRng(R);y(i.getAttribute('data-mce-word'),Q);}}});b.addMenuItem('spellchecker',{text:'Spellcheck',context:'tools',onclick:C,selectable:true,onPostRender:function(){var s=this;s.active(n);b.on('SpellcheckStart SpellcheckEnd',function(){s.active(n);});}});function L(e){var i=p.spellchecker_language;e.control.items().each(function(Q){Q.active(Q.settings.data===i);});}function N(e){var i;if(e.words){q=!!e.dictionary;i=e.words;}else{i=e;}b.setProgressState(false);if(x(i)){b.windowManager.alert('No misspellings found');n=false;return;}m=i;t().find(z()).filter(function(Q){return!!i[Q.text];}).wrap(function(Q){return b.dom.create('span',{"class":'mce-spellchecker-word',"data-mce-bogus":1,"data-mce-word":Q.text});});n=true;b.fire('SpellcheckStart');}var O={tooltip:'Spellcheck',onclick:C,onPostRender:function(){var s=this;b.on('SpellcheckStart SpellcheckEnd',function(){s.active(n);});}};if(l.length>1){O.type='splitbutton';O.menu=l;O.onshow=L;O.onselect=function(e){p.spellchecker_language=e.control.settings.data;};}b.addButton('spellchecker',O);b.addCommand('mceSpellCheck',C);b.on('remove',function(){if(o){o.remove();o=null;}});b.on('change',E);this.getTextMatcher=t;this.getWordCharPattern=z;this.markErrors=N;this.getLanguage=function(){return p.spellchecker_language;};p.spellchecker_language=p.spellchecker_language||p.language||'en';});});j(["tinymce/spellcheckerplugin/DomTextMatcher"]);})(this);
