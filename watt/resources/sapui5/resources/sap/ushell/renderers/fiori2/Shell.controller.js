// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.require("sap.ui.core.IconPool");jQuery.sap.require("sap.ushell.renderers.fiori2.History");jQuery.sap.require("sap.ushell.services.Message");jQuery.sap.require("sap.ushell.services.ShellNavigation");jQuery.sap.require("sap.ushell.services.UsageAnalytics");jQuery.sap.require("sap.ushell.services.AppConfiguration");jQuery.sap.require("sap.ushell.ui.launchpad.LoadingDialog");jQuery.sap.require("sap.ushell.renderers.fiori2.AccessKeysHandler");jQuery.sap.require("sap.ushell.utils");var c=true,a=true,b=sap.ui.Device.system.phone,u,U,m=new sap.ui.model.json.JSONModel({searchAvailable:false,title:"",searchFiltering:true,showEndUserFeedback:false,searchTerm:"",isPhoneWidth:false,states:{"home":{"stateName":"home","showCurtain":false,"headerHiding":false,"headerVisible":true,"showCatalog":false,"showPane":false,"headItems":[],"headEndItems":["sf"],"search":"","paneContent":[],"actions":["ContactSupportBtn","EndUserFeedbackBtn","userPreferencesButton","logoutBtn"],"floatingActions":[],"subHeaders":[],"toolAreaItems":[],"toolAreaVisible":false},"app":{"stateName":"app","showCurtain":false,"headerHiding":b,"headerVisible":true,"headEndItems":["sf"],"showCatalog":false,"showPane":false,"paneContent":[],"search":"","headItems":["homeBtn"],"actions":["ContactSupportBtn","EndUserFeedbackBtn","aboutBtn","userPreferencesButton","logoutBtn"],"floatingActions":[],"subHeaders":[],"toolAreaItems":[],"toolAreaVisible":false},"minimal":{"stateName":"minimal","showCurtain":false,"headerHiding":false,"headerVisible":true,"headEndItems":[],"showCatalog":false,"showPane":false,"paneContent":[],"headItems":[],"actions":["ContactSupportBtn","EndUserFeedbackBtn","aboutBtn","userPreferencesButton","logoutBtn"],"floatingActions":[],"subHeaders":[],"toolAreaItems":[],"toolAreaVisible":false},"standalone":{"stateName":"standalone","showCurtain":false,"headerHiding":b,"headerVisible":true,"headEndItems":[],"showCatalog":false,"showPane":false,"paneContent":[],"headItems":[],"actions":["ContactSupportBtn","EndUserFeedbackBtn","aboutBtn"],"floatingActions":[],"subHeaders":[],"toolAreaItems":[],"toolAreaVisible":false},"embedded":{"stateName":"embedded","showCurtain":false,"headerHiding":b,"headerVisible":true,"headEndItems":["standardActionsBtn"],"showCatalog":false,"showPane":false,"paneContent":[],"headItems":[],"actions":["ContactSupportBtn","EndUserFeedbackBtn","aboutBtn"],"floatingActions":[],"subHeaders":[],"toolAreaItems":[],"toolAreaVisible":false},"headerless":{"stateName":"headerless","showCurtain":false,"headerHiding":b,"headerVisible":false,"headEndItems":[],"showCatalog":false,"showPane":false,"paneContent":[],"headItems":[],"actions":[],"floatingActions":[],"subHeaders":[],"toolAreaItems":[],"toolAreaVisible":false}},userPreferences:{entries:[]}}),n={embedded:"embedded",newWindowThenEmbedded:"newWindowThenEmbedded",newWindow:"newWindow",replace:"replace"},C={},d=['minimal','app','standalone','embedded','headerless','home'];sap.ui.controller("sap.ushell.renderers.fiori2.Shell",{oCoreExtLoadingDeferred:undefined,onInit:function(){this.oEndUserFeedbackConfiguration={showAnonymous:true,showLegalAgreement:true,showCustomUIContent:true,feedbackDialogTitle:true,textAreaPlaceholder:true,customUIContent:undefined};this.getView().setModel(m);this.getView().setModel(sap.ushell.resources.i18nModel,"i18n");this.managedElementsQueue=[];sap.ui.getCore().getEventBus().subscribe("externalSearch",this.externalSearchTriggered,this);this._setConfigurationToModel();sap.ui.getCore().getEventBus().subscribe("openApp",this.openApp,this);sap.ui.getCore().getEventBus().subscribe("launchpad","contentRendered",this._loadCoreExt,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.loadUserImage,this);sap.ui.getCore().getEventBus().subscribe("launchpad","contentRendered",this.checkEUFeedback,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.checkEUFeedback,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.renderers.fiori2.Renderer","appOpened",this.closeLoadingScreen,this);sap.ui.getCore().getEventBus().subscribe("launchpad","toggleContentDensity",this.toggleContentDensity,this);var C=this.getView().getViewData()?this.getView().getViewData().config:null,r=C?C.rootIntent:"",s=hasher.getHash(),S=sap.ushell.Container.getService("URLParsing").parseShellHash(s);if(!s.length||r===S.semanticObject+"-"+S.action){this.switchViewState('home');}if(sap.ushell.Container.getService("UsageAnalytics").isEnabled()===true){sap.ushell.Container.getService("UsageAnalytics").init();jQuery.sap.require("sap.ushell.components.flp.FLPAnalytics");}u=sap.ushell.Container.getService("UserRecents");this.history=new sap.ushell.renderers.fiori2.History();this.oNavContainer=sap.ui.getCore().byId("navContainer");this.oLoadingDialog=sap.ui.getCore().byId("loadingDialog");this.oShellNavigation=sap.ushell.Container.getService("ShellNavigation");this.oShellNavigation.registerNavigationFilter(jQuery.proxy(this._handleEmptyHash,this));this.oShellNavigation.init(jQuery.proxy(this.doHashChange,this));this.oShellNavigation.registerNavigationFilter(jQuery.proxy(this.handleDataLoss,this));sap.ushell.Container.getService("Message").init(jQuery.proxy(this.doShowMessage,this));sap.ushell.Container.setLogonFrameProvider(this._getLogonFrameProvider());this.bContactSupportEnabled=sap.ushell.Container.getService("SupportTicket").isEnabled();sap.ushell.renderers.fiori2.AccessKeysHandler.init(m);window.onbeforeunload=function(){if(sap.ushell.Container&&sap.ushell.Container.getDirtyFlag()){if(!sap.ushell.resources.browserI18n){sap.ushell.resources.browserI18n=sap.ushell.resources.getTranslationModel(window.navigator.language).getResourceBundle();}return sap.ushell.resources.browserI18n.getText("dataLossExternalMessage");}};if(this.bContactSupportEnabled){sap.ushell.UserActivityLog.activate();}if(m.getProperty("/contentDensity")){this._applyContentDensity();}},_isCompactContentDensity:function(){var i;if(!sap.ui.Device.support.touch){i=true;}else if(!sap.ui.Device.system.combi){i=false;}else{var o;try{var f=sap.ushell.Container.getService("UserInfo");o=f.getUser();}catch(e){jQuery.sap.log.error("Getting UserInfo service failed.");o=sap.ushell.Container.getUser();}i=(o.getContentDensity()==='compact')?true:false;}return i;},_applyContentDensity:function(i){if(!this.getModel().getProperty("/contentDensity")){return;}if(i===undefined){i=this._isCompactContentDensity();}var e=sap.ushell.services.AppConfiguration.getMetadata();if(i&&!e.compactContentDensity){i=false;}else if(e.compactContentDensity&&!e.cozyContentDensity){i=true;}if(i){jQuery('body').removeClass('sapUiSizeCozy');jQuery('body').addClass('sapUiSizeCompact');}else{jQuery('body').removeClass('sapUiSizeCompact');jQuery('body').addClass('sapUiSizeCozy');}},toggleContentDensity:function(s,e,D){var i=D.contentDensity==="compact";this._applyContentDensity(i);},checkEUFeedback:function(){if(!this.bFeedbackServiceChecked){this.bFeedbackServiceChecked=true;try{sap.ushell.Container.getService("EndUserFeedback").isEnabled().done(function(){m.setProperty('/showEndUserFeedback',true);}).fail(function(){m.setProperty('/showEndUserFeedback',false);});}catch(e){jQuery.sap.log.error("EndUserFeedback adapter is not found",e.message||e);m.setProperty('/showEndUserFeedback',false);}}},_handleEmptyHash:function(h){if(h.length===0){var v=this.getView()?this.getView().getViewData():{};C=v.config||{};if(C.migrationConfig){return this.oShellNavigation.NavigationFilterStatus.Continue;}if(C.rootIntent){setTimeout(function(){hasher.setHash(C.rootIntent);},0);return this.oShellNavigation.NavigationFilterStatus.Abandon;}}return this.oShellNavigation.NavigationFilterStatus.Continue;},_setConfigurationToModel:function(){var v=this.getView().getViewData(),s,e;if(v){C=v.config||{};}if(C){if(C.states){e=m.getProperty('/states');for(s in C.states){if(C.states.hasOwnProperty(s)){e[s]=C.states[s];}}m.setProperty('/states',e);}if(C.appState==="headerless"){m.setProperty("/personalization",false);m.setProperty("/states/home/headerVisible",false);C.enablePersonalization=false;}else if(C.enablePersonalization!==undefined){m.setProperty("/personalization",C.enablePersonalization);}if(C.changeEndUserFeedbackTitle!==undefined){this.oEndUserFeedbackConfiguration.feedbackDialogTitle=C.changeEndUserFeedbackTitle;}if(C.changeEndUserFeedbackPlaceholder!==undefined){this.oEndUserFeedbackConfiguration.textAreaPlaceholder=C.changeEndUserFeedbackPlaceholder;}if(C.showEndUserFeedbackAnonymousCheckbox!==undefined){this.oEndUserFeedbackConfiguration.showAnonymous=C.showEndUserFeedbackAnonymousCheckbox;}if(C.showEndUserFeedbackLegalAgreement!==undefined){this.oEndUserFeedbackConfiguration.showLegalAgreement=C.showEndUserFeedbackLegalAgreement;}if(C.enableSetTheme!==undefined){m.setProperty("/setTheme",C.enableSetTheme);}if(C.enableContentDensity!==undefined){m.setProperty("/contentDensity",C.enableContentDensity);}if(C.title){m.setProperty("/title",C.title);}if(C.migrationConfig!==undefined){m.setProperty("/migrationConfig",C.migrationConfig);}if(C.enableUserDefaultParameters!==undefined){m.setProperty("/userDefaultParameters",C.enableUserDefaultParameters);}if(C.disableHomeAppCache!==undefined){m.setProperty("/disableHomeAppCache",C.disableHomeAppCache);}m.setProperty("/enableHelp",!!C.enableHelp);m.setProperty("/searchAvailable",(C.enableSearch!==false));}},getModelConfiguration:function(){var v=this.getView().getViewData(),o,s;if(v){o=v.config||{};s=jQuery.extend({},o);}delete s.applications;return s;},_getLogonFrameProvider:function(){var v=this.getView();return{create:function(){return v.createIFrameDialog();},show:function(){v.showIFrameDialog();},destroy:function(){v.destroyIFrameDialog();}};},onExit:function(){sap.ui.getCore().getEventBus().unsubscribe("externalSearch",this.externalSearchTriggered,this);sap.ui.getCore().getEventBus().unsubscribe("openApp",this.openApp,this);sap.ui.getCore().getEventBus().unsubscribe("toggleContentDensity",this.toggleContentDensity,this);this.oShellNavigation.hashChanger.destroy();this.getView().aDanglingControls.forEach(function(o){if(o.destroyContent){o.destroyContent();}o.destroy();});sap.ushell.UserActivityLog.deactivate();},getAnimationType:function(){return sap.ui.Device.os.android?"show":"slide";},onCurtainClose:function(e){jQuery.sap.log.warning("Closing Curtain",e);},handleDataLoss:function(e,o){if(sap.ushell.Container.getDirtyFlag()){if(!sap.ushell.resources.browserI18n){sap.ushell.resources.browserI18n=sap.ushell.resources.getTranslationModel(window.navigator.language).getResourceBundle();}if(confirm(sap.ushell.resources.browserI18n.getText("dataLossInternalMessage"))){sap.ushell.Container.setDirtyFlag(false);return this.oShellNavigation.NavigationFilterStatus.Continue;}else{return this.oShellNavigation.NavigationFilterStatus.Abandon;}}return this.oShellNavigation.NavigationFilterStatus.Continue;},doShowMessage:function(t,M,p){jQuery.sap.require("sap.m.MessageToast");jQuery.sap.require("sap.m.MessageBox");if(t===sap.ushell.services.Message.Type.ERROR){if(sap.ushell.Container.getService("SupportTicket").isEnabled()&&M!==sap.ushell.resources.i18n.getText("supportTicketCreationFailed")){try{jQuery.sap.require("sap.ushell.ui.launchpad.EmbeddedSupportErrorMessage");var f=new sap.ushell.ui.launchpad.EmbeddedSupportErrorMessage("EmbeddedSupportErrorMessage",{title:p.title||sap.ushell.resources.i18n.getText("error"),content:new sap.m.Text({text:M})});f.open();}catch(e){sap.m.MessageBox.show(M,sap.m.MessageBox.Icon.ERROR,p.title||sap.ushell.resources.i18n.getText("error"));}}else{sap.m.MessageBox.show(M,sap.m.MessageBox.Icon.ERROR,p.title||sap.ushell.resources.i18n.getText("error"));}}else if(t===sap.ushell.services.Message.Type.CONFIRM){if(p.actions){sap.m.MessageBox.show(M,sap.m.MessageBox.Icon.QUESTION,p.title,p.actions,p.callback);}else{sap.m.MessageBox.confirm(M,p.callback,p.title);}}else{sap.m.MessageToast.show(M,{duration:p.duration||3000});}},_isColdStart:function(){if(this.history.getHistoryLength()<=1){return true;}this._isColdStart=function(){return false;};return false;},_generateExpandedUrl:function(r,s,D,e){return this.oShellNavigation.hrefForExternal({target:{semanticObject:s.semanticObject,action:s.action,contextRaw:"navResCtx"},params:jQuery.extend({url:r.url,additionalInformation:r.additionalInformation,applicationType:r.applicationType,navigationMode:r.navigationMode,"original_intent":D,title:e},s.params)},true,undefined,true);},_logOpenAppAction:function(f){if(C&&C.enableTilesOpacity){setTimeout(function(){if(sap.ushell.Container){u.addAppUsage(f);}},700);}},_performTransition:function(i){if(this.history.backwards&&this.oNavContainer.getInitialPage()!==this.oNavContainer.getCurrentPage().getId()){this.oNavContainer.to(i,"slideBack");return;}this.oNavContainer.to(i,"slide");},doHashChange:function(s,A,o,O,p){var t=this,i,f;if(!a){a=true;this.closeLoadingScreen();return;}if(p){this.hashChangeFailure(this.history.getHistoryLength(),p.message,null,"sap.ushell.renderers.fiori2.Shell.controller");return;}if(sap.m.InstanceManager&&c){sap.m.InstanceManager.closeAllDialogs();sap.m.InstanceManager.closeAllPopovers();}c=true;this.oLoadingDialog.setText("");this.oLoadingDialog.openLoadingScreen();i=this.history.getHistoryLength();f=this.fixShellHash(s);this.history.hashChange(f,o);this._resolveHashFragment(f).done(function(r,P){if(t.getModel().getProperty("/migrationConfig")){var C=t.getView().oViewData.config;C.migrationConfig=false;t.getModel().setProperty("/migrationConfig",false);if(r&&f==='#'){C.rootIntent="";}else if(f==='#'){setTimeout(function(){hasher.setHash(C.rootIntent);},0);return;}}t._loadAppComponentDependencies(r).done(function(){if(t.oCoreExtLoadingDeferred!==undefined){t.oCoreExtLoadingDeferred.promise().fail(function(){jQuery.sap.log.warning("failed to load core-ext by web worker, performing require");t._requireCoreExt(f);}).always(function(){t._initiateApplication(r,f,P,i);});}else{t._requireCoreExt(f);t._initiateApplication(r,f,P,i);}}).fail(function(M){t.hashChangeFailure(i,"Failed to load U5 component from "+f,M,"sap.ushell.renderers.fiori2.Shell.controller");});}).fail(function(M){t.hashChangeFailure(i,"Failed to resolve navigation target: "+f,M,"sap.ushell.renderers.fiori2.Shell.controller");});},_loadAppComponentDependencies:function(r){var o=new jQuery.Deferred(),s,M=r&&r.ui5ComponentName,A;if(!M){o.resolve();}else{A=(r.applicationDependencies&&r.applicationDependencies.asyncHints)||{"libs":["sap.ca.scfld.md","sap.ca.ui","sap.me","sap.ui.unified"]};A.preloadOnly=true;s=(typeof r.url==="string")?r.url.replace(/[?].*$/,""):r.url;sap.ui.component.load({name:r.ui5ComponentName,url:s,async:true,asyncHints:A}).then(function(){o.resolve();},function(e){jQuery.sap.log.warning("Failed to preload component dependency before navigation",e,"sap.ushell.renderers.fiori2.Shell");o.resolve();});}return o.promise();},_initiateApplication:function(r,f,p,o){var M=sap.ushell.services.AppConfiguration.getMetadata(r);this._logOpenAppAction(f);try{this.navigate(p,f,M,r);}catch(e){if(e.stack){jQuery.sap.log.error("Application initialization failed due to an Exception:\n"+e.stack);}this.restoreNavContainerAfterFailure();this.hashChangeFailure(o,e.name,e.message,M?M.title:"");}},_resolveHashFragment:function(s){var r,p,P=sap.ushell.Container.getService("URLParsing").parseShellHash(s),D=new jQuery.Deferred();if(P&&P.contextRaw&&P.contextRaw==="navResCtx"){p=P.params||{};r={additionalInformation:p.additionalInformation[0],applicationType:p.applicationType[0],url:p.url[0],navigationMode:p.navigationMode[0]};if(p.title){r.text=p.title[0];}D.resolve(r,P);}else{sap.ushell.Container.getService("NavTargetResolution").resolveHashFragment(s).done(function(r){D.resolve(r,P);}).fail(function(M){D.reject(M);});}return D.promise();},_handleConditionalNavigation:function(p,f,M,r){var t=this,N=r.navigationMode;if(N===n.newWindowThenEmbedded){if(this._isColdStart()||(p.contextRaw&&p.contextRaw==="navResCtx")||this.history.backwards){r.navigationMode=n.embedded;this.navigate(p,f,M,r);}else{t._generateExpandedUrl(r,p,f,M.title).done(function(s){r.navigationMode=n.newWindow;if(s.skippedParams||s.hash.length>=1023){r.url=encodeURI(f);}else{r.url=s.hash;}t.navigate(p,f,M,r);}).fail(function(s){throw new Error(s);});}return true;}if(N===n.newWindow&&this._isColdStart()){r.navigationMode=n.replace;this.navigate(p,f,M,r);return true;}return false;},navigate:function(p,f,M,r){var N=r.navigationMode,E;if(sap.ushell.utils.isNativeWebGuiNavigation(r)){try{E=window.external.getPrivateEpcm();E.doNavigate(r.url);a=false;this.closeLoadingScreen();this._windowHistoryBack(1);}catch(e){if(e.stack){jQuery.sap.log.error("Application initialization failed due to an Exception:\n"+e.stack);}this.restoreNavContainerAfterFailure();this.hashChangeFailure(this.history.getHistoryLength(),e.name,e.message,M.title);}return;}if(this._handleConditionalNavigation.apply(this,arguments)){return;}if(N===n.embedded){this._handleEmbeddedNavMode(f,p,M,r);if(p&&p.contextRaw==="navResCtx"){a=false;hasher.replaceHash(p.params.original_intent[0]);this.history._history[0]=p.params.original_intent[0];}return;}if(N===n.replace){a=false;this._changeWindowLocation(r.url);return;}if(N===n.newWindow){a=false;this._openAppNewWindow(r.url);this.history.pop();this._windowHistoryBack(1);return;}this.hashChangeFailure(this.history.getHistoryLength(),"Navigation mode is not recognized",null,"sap.ushell.renderers.fiori2.Shell.controller");},_handleEmbeddedNavMode:function(f,p,M,r){var A,i,N,I,s;sap.ushell.services.AppConfiguration.setCurrentApplication(r);this.setAppIcons(M);A='-'+p.semanticObject+'-'+p.action;N=r.applicationType==="NWBC";I=f==="#"||(C.rootIntent&&C.rootIntent===p.semanticObject+"-"+p.action);if(I&&!this.oHomeApp&&!C.disableHomeAppCache){this._saveHomePageComponent();}s=p?p.semanticObject+"-"+p.action:"";this.oLoadingDialog.showAppInfo(M.title,M.icon||null);if(N){this.switchViewState("minimal");}else if(I){this.switchViewState("home");}else{this.switchViewState(d.indexOf(C.appState)>=0?C.appState:"app");}i=this.getWrappedApplication(s,M,r,A,r.fullWidth||M.fullWidth||N);if(I&&!C.disableHomeAppCache){if(!this.oNavContainer.getInitialPage()){this.oNavContainer.setInitialPage(i);}}this._performTransition(i);},getWrappedApplication:function(i,M,r,A,f){var I,e,o;e=this.oNavContainer.getPage("application"+A)||this.oNavContainer.getPage("applicationShellPage"+A);if(e&&i!==C.rootIntent){e.destroy();}else if(e){return e;}jQuery.sap.require('sap.ushell.components.container.ApplicationContainer');setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","appOpening",r);jQuery.sap.log.info('app is being opened');},0);if(C.applications){r.applicationConfiguration=C.applications[i];}o=new sap.ushell.components.container.ApplicationContainer("application"+A,r);this.publishNavigationStateEvents(o,r);if(f){if(!M.hideLightBackground){o.addStyleClass('sapMShellGlobalInnerBackground');}I=o;}else{jQuery.sap.require("sap.m.Shell");I=new sap.m.Shell("applicationShellPage"+A,{logo:sap.ui.resource('sap.ui.core','themes/base/img/1x1.gif'),title:M.title,showLogout:false,app:o}).addStyleClass("sapUshellApplicationPage");if(!M.title){I.addStyleClass("sapUshellApplicationPageNoHdr");}}this._applyContentDensity();o.onfocusin=function(){sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=false;sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusPassedToExternalHandlerFirstTime=false;};o.onfocusout=function(){sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusOnShell=true;sap.ushell.renderers.fiori2.AccessKeysHandler.bFocusPassedToExternalHandlerFirstTime=true;};this.oNavContainer.addPage(I);return I;},_saveHomePageComponent:function(){if(this.oHomeApp){return;}var t=this,s="sap.ushell.components.container.ApplicationContainer",l=function(e,f,D){t.oHomeApp=D.component;sap.ui.getCore().getEventBus().unsubscribe(s,'componentCreated',l);};sap.ui.getCore().getEventBus().subscribe(s,'componentCreated',l);},hashChangeFailure:function(h,M,D,s){this.reportError(M,D,s);this.closeLoadingScreen();this.delayedMessageError(sap.ushell.resources.i18n.getText("fail_to_start_app_try_later"));c=false;if(h===0){hasher.setHash("");}else{this._windowHistoryBack(1);}},reportError:function(M,D,s){jQuery.sap.log.error(M,D,s);},delayedMessageError:function(M){setTimeout(function(){if(sap.ushell.Container!==undefined){sap.ushell.Container.getService("Message").error(M);}},0);},fixShellHash:function(s){if(!s){s='#';}else if(s.charAt(0)!=='#'){s='#'+s;}return s;},restoreNavContainerAfterFailure:function(){var o=this.oNavContainer.getCurrentPage(),e,O;if(o){this.oNavContainer.removePage(o).destroy();}O=this.oNavContainer.removeAllPages();this.oNavContainer.destroy();this.oNavContainer=this.getView().initNavContainer(this);e=this.getView().getOUnifiedShell();e.addContent(this.oNavContainer);jQuery.each(O,jQuery.proxy(function(i,v){if(!this.oNavContainer.getPage(v.getId())){this.oNavContainer.addPage(v);}if(v.getId()===this.oNavContainer.getInitialPage()){v.removeStyleClass("sapMNavItemHidden");}},this));},publishNavigationStateEvents:function(A,o){var e=A.onAfterRendering,f,t=this;A.onAfterRendering=function(){if(e){e.apply(this,arguments);}setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","appOpened",o);jQuery.sap.log.info('app was opened');},0);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appOpened",o);};f=A.exit;A.exit=function(){if(f){f.apply(this,arguments);}t._applyContentDensity();setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","appClosed",o);jQuery.sap.log.info('app was closed');},0);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appClosed",o);};},_openAppNewWindow:function(s){var e=window.open(s);if(!e){var f=sap.ushell.resources.i18n.getText("fail_to_start_app_popup_blocker");this.delayedMessageError(f);}},_windowHistoryBack:function(s){window.history.back(s);},_changeWindowLocation:function(s){window.location.href=s;},setAppIcons:function(M){var s=jQuery.sap.getModulePath("sap.ushell"),l=(M&&M.homeScreenIconPhone)||(s+'/themes/base/img/launchicons/57_iPhone_Desktop_Launch.png'),L=(M&&M["homeScreenIconPhone@2"])||(s+'/themes/base/img/launchicons/114_iPhone-Retina_Web_Clip.png'),o=(M&&M.homeScreenIconTablet)||(s+'/themes/base/img/launchicons/72_iPad_Desktop_Launch.png'),e=(M&&M["homeScreenIconTablet@2"])||(s+'/themes/base/img/launchicons/144_iPad_Retina_Web_Clip.png'),f=(M&&M.favIcon)||(s+'/themes/base/img/launchpad_favicon.ico'),t=(M&&M.title)||"",g=this.getFavIconHref();if(sap.ui.Device.os.ios){jQuery.sap.setIcons({'phone':l,'phone@2':L,'tablet':o,'tablet@2':e,'favicon':f,'precomposed':true});}else if(g!==f){jQuery.sap.setIcons({'phone':'','phone@2':'','tablet':'','tablet@2':'','favicon':f,'precomposed':true});}window.document.title=t;},getFavIconHref:function(){return jQuery('link').filter('[rel="shortcut icon"]').attr('href')||'';},externalSearchTriggered:function(s,e,D){m.setProperty("/searchTerm",D.searchTerm);D.query=D.searchTerm;},onAfterNavigate:function(e){var h=this.oNavContainer.getInitialPage(),f=e.getParameter("fromId");if(f&&f!==h){this.oNavContainer.removePage(sap.ui.getCore().byId(f));sap.ui.getCore().byId(f).destroy();}this.closeLoadingScreen();if(e.mParameters&&e.mParameters.toId===h){sap.ui.getCore().byId("configBtn").focus();if(this.oHomeApp&&this.oHomeApp.setInitialConfiguration){this.oHomeApp.setInitialConfiguration();}}},closeLoadingScreen:function(){this.oLoadingDialog.closeLoadingScreen();},togglePane:function(e){var s=e.getSource(),S=s.getSelected();sap.ui.getCore().getEventBus().publish("launchpad","togglePane",{currentContent:s.getModel().getProperty("/currentState/paneContent")});if(e.getParameter("id")==="categoriesBtn"){s.getModel().setProperty("/currentState/showCurtainPane",!S);}else{s.getModel().setProperty("/currentState/showPane",!S);}},loadUserImage:function(){if(!U){this.getView().loadUserImage();U=true;}},_requireCoreExt:function(f){if((C.preloadLibrariesForRootIntent||C.preloadLibrariesForRootIntent===undefined)||(f!=='#'+C.rootIntent&&f)){try{jQuery.sap.require('sap.fiori.core-ext-light');}catch(e){jQuery.sap.log.warning("failed to load sap.fiori.core-ext-light!");}}},_loadCoreExt:function(){var A=jQuery.sap.isDeclared('sap.fiori.core',true)||jQuery.sap.isDeclared('sap.fiori.core-ext-light',true),M=window['sap-ui-debug']?'sap/fiori/core-ext-light-dbg.js':'sap/fiori/core-ext-light.js',t=this;if(A){return;}this.oCoreExtLoadingDeferred=new jQuery.Deferred();jQuery.sap._loadJSResourceAsync(M).then(function(){t.oCoreExtLoadingDeferred.resolve();setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","coreExtLoaded");},0);}).catch(function(){jQuery.sap.log.warning('failed to load sap.fiori.core-ext-light');t.oCoreExtLoadingDeferred.reject();});},removeHeaderItem:function(i,e,s){this._removeShellItem("headItems",i,e,s);},removeToolAreaItem:function(i,e,s){this._removeShellItem("toolAreaItems",i,e,s);},removeHeaderEndItem:function(i,e,s){this._removeShellItem("headEndItems",i,e,s);},removeSubHeader:function(i,e,s){this._removeShellItem("subHeaders",i,e,s);},removeActionButton:function(i,e,s){this._removeShellItem("actions",i,e,s);},removeLeftPaneContent:function(i,e,s){this._removeShellItem("paneContent",i,e,s);},removeFloatingActionButton:function(i,e,s){this._removeShellItem("floatingActions",i,e,s);},addHeaderItem:function(i,e,s){this._addUpToThreeItem("headItems",i,e,s);},addToolAreaItem:function(i,e,s){this._addToolAreaItem("toolAreaItems",i,e,s);},addHeaderEndItem:function(i,e,s){this._addUpToThreeItem("headEndItems",i,e,s);},addSubHeader:function(i,e,s){this._addShellItem("subHeaders",i,e,s);},addActionButton:function(i,e,s,I){if(I){this._addActionButtonAtStart("actions",i,e,s);}else{this._addActionButton("actions",i,e,s);}},addLeftPaneContent:function(i,e,s){this._addShellItem("paneContent",i,e,s);},addFloatingActionButton:function(i,e,s){this._addShellItem("floatingActions",i,e,s);},_addActionButtonAtStart:function(p,i,e,s){var v=function(A,i,S){return true;},f=function(g,I){var A=m.getProperty(g),h=I.slice(0);m.setProperty(g,h.concat(A));};this._setShellItem(p,i,e,s,v,f);},_addActionButton:function(p,i,e,s){var v=function(A,i,S){return true;},f=function(g,I){var A=m.getProperty(g);var l=A.indexOf("logoutBtn");if(l>-1){A.splice(l,0,I[0]);}else{A.push(I[0]);}m.setProperty(g,A);};this._setShellItem(p,i,e,s,v,f);},_addUpToThreeItem:function(p,i,e,s){var v=function(I,g,S){var h=0,j,k;for(j=0;j<I.length;j++){k=I[j];if(k==='actionsBtn'){h+=2;}else{h++;}if(h+g.length>3){jQuery.sap.log.warning("maximum of three items has reached, cannot add more items.");return false;}}return true;},f=function(g,I){var h=m.getProperty(g),j=h.slice(0);m.setProperty(g,j.concat(I));};this._setShellItem(p,i,e,s,v,f);},_addShellItem:function(p,i,e,s){var v=function(I,i,S){if(I.length>0){jQuery.sap.log.warning("You can only add one item. Replacing existing item: "+I[0]+" in state: "+S+", with the new item: "+i[0]+".");}return true;},f=function(g,I){m.setProperty(g,i.slice(0));};this._setShellItem(p,i,e,s,v,f);},_addToolAreaItem:function(p,i,e,s){var v=function(){return true;},f=function(h,i){var I=m.getProperty(h);I.push(i);m.setProperty(h,I);};var g,P=this._getPassStates(s);for(g=0;g<P.length;g++){this.showShellItem("/toolAreaVisible",P[g],true);}this._setShellItem(p,i,e,s,v,f);},_removeShellItem:function(p,i,e,s){var v=function(I,g){var l,i,h;for(h=0;h<g.length;h++){i=g[h];l=I.indexOf(i);if(l<0){jQuery.sap.log.warning("You cannot remove Item: "+i+", the headItem does not exists.");return false;}}return true;},f=function(g,I){var h=m.getProperty(g),l,i,j;for(j=0;j<I.length;j++){i=I[j];l=h.indexOf(i);if(l>-1){h.splice(l,1);}}m.setProperty(g,h);};this._setShellItem(p,i,e,s,v,f);},_setShellItem:function(p,I,e,s,v,f){var g,h;if(e===true){g="/currentState/"+p;h=m.getProperty(g);if(v(h,I,"currentState")===false){return;}f(g,I);}else{var P=this._getPassStates(s),i,o=m.getProperty("/currentState/stateName");for(i=0;i<P.length;i++){var S=P[i],j;g="/states/"+S+"/"+p;h=m.getProperty(g);if(v(h,I,S)===false){return;}var M=this._getModelStates(S);for(j=0;j<M.length;j++){g="/states/"+M[j]+"/"+p;f(g,I);if(o===M[j]){g="/currentState/"+p;f(g,I);}}}}},_getPassStates:function(s){var p=[],i;s=s||[];for(i=0;i<s.length;i++){if(s[i]!==undefined){if(s[i]!=="home"&&s[i]!=="app"){throw new Error("sLaunchpadState value is invalid");}p.push(s[i]);}}if(!p.length){p=["app","home"];}return p;},_getModelStates:function(s){var M=[];if(s==="app"){var e=["app","minimal","standalone","embedded"];M=M.concat(e);}else{M.push(s);}return M;},showShellItem:function(p,s,v){var M="/states/"+s+p,e="/currentState"+p;m.setProperty(M,v);if(m.getProperty("/currentState/stateName")===s){m.setProperty(e,v);}},_setHeaderTitle:function(t,i){if(typeof t!=="string"){throw new Error("sTitle type is invalid");}this.getView().getOUnifiedShell().setTitle(t,i);},_setHeaderHiding:function(h){if(typeof h!=="boolean"){throw new Error("bHiding type is invalid");}m.setProperty("/currentState/headerHiding",h);},addEndUserFeedbackCustomUI:function(o,s){if(o){this.oEndUserFeedbackConfiguration.customUIContent=o;}if(s===false){this.oEndUserFeedbackConfiguration.showCustomUIContent=s;}},setFooter:function(f){if(typeof f!=="object"||!f.getId){throw new Error("oFooter value is invalid");}if(this.getView().oShellPage.getFooter()!==null){jQuery.sap.log.warning("You can only set one footer. Replacing existing footer: "+this.getView().oShellPage.getFooter().getId()+", with the new footer: "+f.getId()+".");}this.getView().oShellPage.setFooter(f);},removeFooter:function(){if(this.getView().oShellPage.getFooter()===null){jQuery.sap.log.warning("There is no footer to remove.");return;}this.getView().oShellPage.setFooter(null);},addUserPreferencesEntry:function(e){this._validateUserPrefEntryConfiguration(e);this._updateUserPrefModel(e);},_validateUserPrefEntryConfiguration:function(e){if((!e)||(typeof e!=="object")){throw new Error("object oConfig was not provided");}if(!e.title){throw new Error("title was not provided");}if(!e.value){throw new Error("value was not provided");}if(typeof e.entryHelpID!=="undefined"){if(typeof e.entryHelpID!=="string"){throw new Error("entryHelpID type is invalid");}else{if(e.entryHelpID===""){throw new Error("entryHelpID type is invalid");}}}if(e.title&&typeof e.title!=="string"){throw new Error("title type is invalid");}if(typeof e.value!=="function"&&typeof e.value!=="string"&&typeof e.value!=="number"){throw new Error("value type is invalid");}if(e.onSave&&typeof e.onSave!=="function"){throw new Error("onSave type is invalid");}if(e.content&&typeof e.content!=="function"){throw new Error("content type is invalid");}if(e.onCancel&&typeof e.onCancel!=="function"){throw new Error("onCancel type is invalid");}},addElementToManagedQueue:function(i){this.managedElementsQueue.push(i);},destroyManageQueue:function(){var i;if(this.managedElementsQueue){i=this.managedElementsQueue.pop();while(i){i.destroy();i=this.managedElementsQueue.pop();}}},switchViewState:function(s,S){var p=s[0]==="/"?s:"/states/"+s,o=m.getProperty(p),e=m.getProperty("/currentState")||{};if(!!S){m.setProperty("/lastState",e);}m.setProperty("/currentState",jQuery.extend(true,{},{},o));this.destroyManageQueue();if(s==="searchResults"){m.setProperty("/lastSearchScreen",'');if(!hasher.getHash().indexOf("Action-search")===0){var f=sap.ui.getCore().getModel("searchModel");hasher.setHash("Action-search&/searchTerm="+f.getProperty("/searchBoxTerm")+"&dataSource="+JSON.stringify(f.getDataSourceJson()));}}sap.ushell.renderers.fiori2.AccessKeysHandler.resetAppKeysHandler();},_updateUserPrefModel:function(e){var f={"entryHelpID":e.entryHelpID,"title":e.title,"editable":e.content?true:false,"valueArgument":e.value,"valueResult":null,"onSave":e.onSave,"onCancel":e.onCancel,"contentFunc":e.content,"contentResult":null};var g=m.getProperty("/userPreferences/entries");g.push(f);m.setProperty("/userPreferences/entries",g);},pressActionBtn:function(e){if(!sap.ui.Device.system.desktop){var o=m.getProperty("/currentState").headerHiding;m.setProperty("/currentState/headerHiding",false);}var A=sap.ui.getCore().byId('headActions');if(!A){var f=sap.ui.getCore().byId("userPreferencesButton"),l=new sap.ushell.ui.footerbar.LogoutButton("logoutBtn"),g=new sap.ushell.ui.footerbar.AboutButton("aboutBtn");if(!f){f=new sap.ushell.ui.footerbar.UserPreferencesButton("userPreferencesButton");this._setUserPrefModel();}jQuery.sap.require('sap.ushell.ui.footerbar.ContactSupportButton');jQuery.sap.require('sap.ushell.ui.footerbar.EndUserFeedback');var h=new sap.ushell.ui.footerbar.ContactSupportButton("ContactSupportBtn",{visible:this.bContactSupportEnabled}),E,i=m.getProperty('/showEndUserFeedback');if(i){E=new sap.ushell.ui.footerbar.EndUserFeedback("EndUserFeedbackBtn",{showAnonymous:this.oEndUserFeedbackConfiguration.showAnonymous,showLegalAgreement:this.oEndUserFeedbackConfiguration.showLegalAgreement,showCustomUIContent:this.oEndUserFeedbackConfiguration.showCustomUIContent,feedbackDialogTitle:this.oEndUserFeedbackConfiguration.feedbackDialogTitle,textAreaPlaceholder:this.oEndUserFeedbackConfiguration.textAreaPlaceholder,customUIContent:this.oEndUserFeedbackConfiguration.customUIContent});}if(m.getProperty("/enableHelp")){f.addStyleClass('help-id-loginDetails');l.addStyleClass('help-id-logoutBtn');g.addStyleClass('help-id-aboutBtn');if(i){E.addStyleClass('help-id-EndUserFeedbackBtn');}h.addStyleClass('help-id-contactSupportBtn');}var F=new sap.ui.model.Filter('','EQ','a');F.fnTest=function(B){var j=m.getProperty("/currentState/actions"),s,k;for(k=0;k<j.length;k++){s=j[k];if(s.toUpperCase()==B){return!!sap.ui.getCore().byId(s);}}};A=new sap.m.ActionSheet("headActions",{placement:sap.m.PlacementType.Bottom,buttons:{path:"/currentState/actions",filters:[F],factory:function(I,j){return sap.ui.getCore().byId(j.getObject());}}});A.updateAggregation=this.getView().updateShellAggregation;A.setModel(m);this.getView().aDanglingControls.push(A,f,l,g,h);if(i){this.getView().aDanglingControls.push(E);}A.attachAfterClose(A,function(){if(!sap.ui.Device.system.desktop){m.setProperty("/currentState/headerHiding",o);}});}A.openBy(e.getSource());},_setUserPrefModel:function(){var e=m.getProperty("/userPreferences/entries");var D=this._getUserPrefDefaultModel();D.entries=D.entries.concat(e);m.setProperty("/userPreferences",D);},_getUserPrefDefaultModel:function(){var t=this;var o=sap.ushell.Container.getUser();var l=o.getLanguage();var s=window.location.host;var e=sap.ushell.resources.i18n.getText("languageFld");var f=sap.ushell.resources.i18n.getText("serverFld");jQuery.sap.require('sap.ushell.renderers.fiori2.search.userpref.SearchPrefs');var S=sap.ushell.renderers.fiori2.search.userpref.SearchPrefs;var g=S.getEntry();g.isSearchPrefsActive().done(function(k){if(!k){return;}t.addUserPreferencesEntry(g);});function T(){this.view=null;this.getView=function(){if(!this.view||!sap.ui.getCore().byId('userPrefThemeSelector')){this.view=sap.ui.jsview("userPrefThemeSelector","sap.ushell.renderers.fiori2.theme_selector.ThemeSelector");}return this.view;};var k=function(){var w=this.getView().getController().onSave();w.done(function(){if(m.getProperty("/tilesOpacity")===true){sap.ushell.utils.handleTilesOpacity();}});return w;}.bind(this);var p=function(){return this.getView().getController().onCancel();}.bind(this);var q=function(){return this.getView().getController().getContent();}.bind(this);var r=function(){return this.getView().getController().getValue();}.bind(this);var v;if(m.getProperty("/setTheme")!==undefined){v=m.getProperty("/setTheme")&&o.isSetThemePermitted();}else{v=o.isSetThemePermitted();}return{entryHelpID:"themes",title:sap.ushell.resources.i18n.getText("theme"),editable:v,valueArgument:r,valueResult:null,onSave:k,onCancel:p,contentFunc:q,contentResult:null};}var h=new T();function i(){this.view=null;this.getView=function(){if(!this.view||!sap.ui.getCore().byId('userPrefCompactCozySelector')){this.view=sap.ui.jsview("userPrefCompactCozySelector","sap.ushell.renderers.fiori2.compactCozy_selector.CompactCozySelector");}return this.view;};var k=function(){return this.getView().getController().onSave();}.bind(this);var p=function(){return this.getView().getController().onCancel();}.bind(this);var q=function(){return this.getView().getController().getContent();}.bind(this);var r=function(){return this.getView().getController().getValue();}.bind(this);return{entryHelpID:"contentDensity",title:sap.ushell.resources.i18n.getText("displayDensity"),editable:true,valueArgument:r,valueResult:null,onSave:k,onCancel:p,contentFunc:q,contentResult:null};}function D(){this.view=null;this.getView=function(){if(!this.view||!sap.ui.getCore().byId('defaultParametersSelector')){this.view=sap.ui.jsview("defaultParametersSelector","sap.ushell.renderers.fiori2.defaultParameters_selector.DefaultParameters");}return this.view;};var k=function(){return this.getView().getController().onSave();}.bind(this);var p=function(){return this.getView().getController().onCancel();}.bind(this);var q=function(){return this.getView().getController().getContent();}.bind(this);var r=function(){return this.getView().getController().getValue();}.bind(this);return{title:sap.ushell.resources.i18n.getText("userDefaults"),editable:true,visible:false,valueArgument:r,valueResult:null,onSave:k,onCancel:p,contentFunc:q,contentResult:null};}var j=[{entryHelpID:"serverName",title:f,editable:false,valueArgument:s,valueResult:null},{entryHelpID:"language",title:e,editable:false,valueArgument:l,valueResult:null},h];if(sap.ui.Device.system.combi&&m.getProperty("/contentDensity")){j.push(new i());}if(m.getProperty("/userDefaultParameters")){j.push(new D());}return{dialogTitle:sap.ushell.resources.i18n.getText("userPreferences"),isDetailedEntryMode:false,activeEntryPath:null,entries:j};},getModel:function(){return m;}});}());
