define("tinymce/imagetoolsplugin/Dialog",["tinymce/dom/DOMUtils","tinymce/util/Tools","tinymce/util/Promise","tinymce/ui/Factory","tinymce/ui/Form","tinymce/ui/Container","tinymce/imagetoolsplugin/ImagePanel","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/Filters","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/UndoStack"],function(D,T,P,F,a,C,I,c,d,f,U){function h(b){return{blob:b,url:URL.createObjectURL(b)};}function i(s){if(s){URL.revokeObjectURL(s.url);}}function j(s){T.each(s,i);}function o(l,m,n){var w,u=new U(),p,q,t,s,v,x,y,z,A,B,E,G,H,J,K,L,M,N,O,Q,R,S,V,W,X,Y;function Z(e){var b,g,r,u1;b=w.find('#w')[0];g=w.find('#h')[0];r=parseInt(b.value(),10);u1=parseInt(g.value(),10);if(w.find('#constrain')[0].checked()&&V&&W&&r&&u1){if(e.control.settings.name=='w'){u1=Math.round(r*X);g.value(u1);}else{r=Math.round(u1*Y);b.value(r);}}V=r;W=u1;}function $(b){return Math.round(b*100)+'%';}function _(){w.find('#undo').disabled(!u.canUndo());w.find('#redo').disabled(!u.canRedo());w.statusbar.find('#save').disabled(!u.canUndo());}function a1(){w.find('#undo').disabled(true);w.find('#redo').disabled(true);}function b1(b){if(b){y.imageSrc(b.url);}}function c1(b){return function(){var e=T.grep(S,function(g){return g.settings.name!=b;});T.each(e,function(g){g.hide();});b.show();};}function d1(b){t=h(b);b1(t);}function e1(b){l=h(b);b1(l);j(u.add(l).removed);_();}function f1(){var r=y.selection();c.crop(l.blob,r.x,r.y,r.w,r.h).then(function(b){e1(b);i1();});}function g1(b){var e=[].slice.call(arguments,1);return function(){var g=t||l;b.apply(this,[g.blob].concat(e)).then(d1);};}function h1(b){var e=[].slice.call(arguments,1);return function(){b.apply(this,[l.blob].concat(e)).then(e1);};}function i1(){b1(l);i(t);c1(p)();_();}function j1(){if(t){e1(t.blob);i1();}}function k1(){var b=y.zoom();if(b<2){b+=0.1;}y.zoom(b);}function l1(){var b=y.zoom();if(b>0.1){b-=0.1;}y.zoom(b);}function m1(){l=u.undo();b1(l);_();}function n1(){l=u.redo();b1(l);_();}function o1(){m(l.blob);w.close();}function p1(b){return new a({layout:'flex',direction:'row',labelGap:5,border:'0 0 1 0',align:'center',pack:'center',padding:'0 10 0 10',spacing:5,flex:0,minHeight:60,defaults:{classes:'imagetool',type:'button'},items:b});}function q1(b,e){return p1([{text:'Back',onclick:i1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:j1}]).hide().on('show',function(){a1();e(l.blob).then(function(g){var r=h(g);b1(r);i(t);t=r;});});}function r1(b,g,r,u1,v1){function w1(r){g(l.blob,r).then(function(e){var x1=h(e);b1(x1);i(t);t=x1;});}return p1([{text:'Back',onclick:i1},{type:'spacer',flex:1},{type:'slider',flex:1,ondragend:function(e){w1(e.value);},minValue:u1,maxValue:v1,value:r,previewFilter:$},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:j1}]).hide().on('show',function(){this.find('slider').value(r);a1();});}function s1(e,u1){function v1(){var r,g,b;r=w.find('#r')[0].value();g=w.find('#g')[0].value();b=w.find('#b')[0].value();u1(l.blob,r,g,b).then(function(w1){var x1=h(w1);b1(x1);i(t);t=x1;});}return p1([{text:'Back',onclick:i1},{type:'spacer',flex:1},{type:'slider',label:'R',name:'r',minValue:0,value:1,maxValue:2,ondragend:v1,previewFilter:$},{type:'slider',label:'G',name:'g',minValue:0,value:1,maxValue:2,ondragend:v1,previewFilter:$},{type:'slider',label:'B',name:'b',minValue:0,value:1,maxValue:2,ondragend:v1,previewFilter:$},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:j1}]).hide().on('show',function(){w.find('#r,#g,#b').value(1);a1();});}s=p1([{text:'Back',onclick:i1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:f1}]).hide().on('show hide',function(e){y.toggleCropRect(e.type=='show');}).on('show',a1);function t1(e){if(e.control.value()===true){X=W/V;Y=V/W;}}v=p1([{text:'Back',onclick:i1},{type:'spacer',flex:1},{type:'textbox',name:'w',label:'Width',size:4,onkeyup:Z},{type:'textbox',name:'h',label:'Height',size:4,onkeyup:Z},{type:'checkbox',name:'constrain',text:'Constrain proportions',checked:true,onchange:t1},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:'submit'}]).hide().on('submit',function(e){var V=parseInt(w.find('#w').value(),10),W=parseInt(w.find('#h').value(),10);e.preventDefault();h1(c.resize,V,W)();i1();}).on('show',a1);x=p1([{text:'Back',onclick:i1},{type:'spacer',flex:1},{icon:'fliph',tooltip:'Flip horizontally',onclick:g1(c.flip,'h')},{icon:'flipv',tooltip:'Flip vertically',onclick:g1(c.flip,'v')},{icon:'rotateleft',tooltip:'Rotate counterclockwise',onclick:g1(c.rotate,-90)},{icon:'rotateright',tooltip:'Rotate clockwise',onclick:g1(c.rotate,90)},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:j1}]).hide().on('show',a1);B=q1("Invert",d.invert);N=q1("Sharpen",d.sharpen);O=q1("Emboss",d.emboss);E=r1("Brightness",d.brightness,0,-1,1);G=r1("Hue",d.hue,180,0,360);H=r1("Saturate",d.saturate,0,-1,1);J=r1("Contrast",d.contrast,0,-1,1);K=r1("Grayscale",d.grayscale,0,0,1);L=r1("Sepia",d.sepia,0,0,1);M=s1("Colorize",d.colorize);Q=r1("Gamma",d.gamma,0,-1,1);R=r1("Exposure",d.exposure,1,0,2);q=p1([{text:'Back',onclick:i1},{type:'spacer',flex:1},{text:'hue',icon:'hue',onclick:c1(G)},{text:'saturate',icon:'saturate',onclick:c1(H)},{text:'sepia',icon:'sepia',onclick:c1(L)},{text:'emboss',icon:'emboss',onclick:c1(O)},{text:'exposure',icon:'exposure',onclick:c1(R)},{type:'spacer',flex:1}]).hide();p=p1([{tooltip:'Crop',icon:'crop',onclick:c1(s)},{tooltip:'Resize',icon:'resize2',onclick:c1(v)},{tooltip:'Orientation',icon:'orientation',onclick:c1(x)},{tooltip:'Brightness',icon:'sun',onclick:c1(E)},{tooltip:'Sharpen',icon:'sharpen',onclick:c1(N)},{tooltip:'Contrast',icon:'contrast',onclick:c1(J)},{tooltip:'Color levels',icon:'drop',onclick:c1(M)},{tooltip:'Gamma',icon:'gamma',onclick:c1(Q)},{tooltip:'Invert',icon:'invert',onclick:c1(B)}]);y=new I({flex:1,imageSrc:l.url});z=new C({layout:'flex',direction:'column',border:'0 1 0 0',padding:5,spacing:5,items:[{type:'button',icon:'undo',tooltip:'Undo',name:'undo',onclick:m1},{type:'button',icon:'redo',tooltip:'Redo',name:'redo',onclick:n1},{type:'button',icon:'zoomin',tooltip:'Zoom in',onclick:k1},{type:'button',icon:'zoomout',tooltip:'Zoom out',onclick:l1}]});A=new C({type:'container',layout:'flex',direction:'row',align:'stretch',flex:1,items:[z,y]});S=[p,s,v,x,q,B,E,G,H,J,K,L,M,N,O,Q,R];w=F.create('window',{layout:'flex',direction:'column',align:'stretch',minWidth:Math.min(D.DOM.getViewPort().w,800),minHeight:Math.min(D.DOM.getViewPort().h,650),title:'Edit image',items:S.concat([A]),buttons:[{text:'Save',name:'save',subtype:'primary',onclick:o1},{text:'Cancel',onclick:'close'}]});w.renderTo(document.body).reflow();w.on('close',function(){n();j(u.data);u=null;t=null;});u.add(l);_();y.on('load',function(){V=y.imageSize().w;W=y.imageSize().h;X=W/V;Y=V/W;w.find('#w').value(V);w.find('#h').value(W);});}function k(b){return new P(function(r,e){o(h(b),r,e);});}return{edit:k};});
