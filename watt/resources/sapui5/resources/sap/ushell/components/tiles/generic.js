jQuery.sap.require("sap.ushell.components.tiles.indicatorTileUtils.smartBusinessUtil");jQuery.sap.require("sap.ui.model.analytics.odata4analytics");jQuery.sap.require("sap.ui.core.mvc.Controller");sap.ui.core.mvc.Controller.extend("sap.ushell.components.tiles.generic",{onAfterRendering:function(){var t=this;this.firstTimeVisible=false;this.oKpiTileView=this.getView();this.oViewData=this.oKpiTileView.getViewData();if(!sap.ushell.components.tiles.utils){jQuery.sap.require("sap.ushell.components.tiles.utils");}this.oResourceBundle=sap.ushell.components.tiles.utils.getResourceBundleModel().getResourceBundle();this.oTileApi=this.oViewData.chip;if(this.oTileApi.visible){this.oTileApi.visible.attachVisible(this.visibleHandler.bind(this));}this.system=this.oTileApi.url.getApplicationSystem();this.oKpiTileView.oGenericTile.setState(sap.suite.ui.commons.LoadState.Loading);this.getChipConfiguration(function(){if(t.oTileApi.preview.isEnabled()){t.doDummyProcess();}else{t.oKpiTileView.oGenericTile.attachPress(function(){sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(t.queryServiceUriODataReadRef);sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(t.oConfig.TILE_PROPERTIES.id,null);window.location.hash=sap.ushell.components.tiles.indicatorTileUtils.util.getNavigationTarget(t.oConfig,t.system);});t.fetchEvaluation(t.oConfig,function(){t.DEFINITION_DATA=t.oConfig;if(t.KPI_VALUE_REQUIRED){t.fetchKpiValue(function(k,T){this.KPIVALUE=k;t.doProcess(k,T);},t.logError);}else{t.doProcess();}});}});},getChipConfiguration:function(c){var t=this;try{sap.ushell.components.tiles.indicatorTileUtils.util.getParsedChip(t.oTileApi.configuration.getParameterValueAsString("tileConfiguration"),function(a){t.oConfig=a;var b=sap.ushell.components.tiles.indicatorTileUtils.util.getChipTitle(t.oConfig);var s=sap.ushell.components.tiles.indicatorTileUtils.util.getChipSubTitle(t.oConfig);if(t.oTileApi.search){t.oTileApi.search.setKeywords([b,s]);}if(t.oTileApi.preview){t.oTileApi.preview.setTargetUrl(sap.ushell.components.tiles.indicatorTileUtils.util.getNavigationTarget(t.oConfig,t.system));}c.call();});}catch(e){t.logError(e.message);}},fetchEvaluation:function(c,a){var t=this;var p=this.oConfig.TILE_PROPERTIES.sb_metadata||"HANA";if(Number(t.oTileApi.configuration.getParameterValueAsString("isSufficient"))){sap.ushell.components.tiles.indicatorTileUtils.cache.setEvaluationById(t.oConfig.TILE_PROPERTIES.id,t.oConfig);t.DEFINITION_DATA=c;t._updateTileModel(this.DEFINITION_DATA);if(t.oTileApi.visible.isVisible()&&!t.firstTimeVisible){t.firstTimeVisible=true;var b=sap.ushell.components.tiles.indicatorTileUtils.cache.getEvaluationById(t.oConfig.TILE_PROPERTIES.id);if(b){t.oConfig.EVALUATION_FILTERS=b.EVALUATION_FILTERS;a.call(b);}else{try{sap.ushell.components.tiles.indicatorTileUtils.util.getFilterFromRunTimeService(t.oConfig,t.oTileApi,function(f){t.oConfig.EVALUATION_FILTERS=f;if(p.toUpperCase()==="HANA"){t.parse_sapclient();}sap.ushell.components.tiles.indicatorTileUtils.cache.setEvaluationById(t.oConfig.TILE_PROPERTIES.id,t.oConfig);a.call(f);});}catch(e){t.logError("no evaluation data");}}}else{try{var b=sap.ushell.components.tiles.indicatorTileUtils.cache.getEvaluationById(t.oConfig.TILE_PROPERTIES.id);if(b){t.oConfig.EVALUATION_FILTERS=b.EVALUATION_FILTERS;a.call(b);}else{sap.ushell.components.tiles.indicatorTileUtils.util.getFilterFromRunTimeService(t.oConfig,t.oTileApi,function(f){t.oConfig.EVALUATION_FILTERS=f;if(p.toUpperCase()==="HANA"){t.parse_sapclient();}sap.ushell.components.tiles.indicatorTileUtils.cache.setEvaluationById(t.oConfig.TILE_PROPERTIES.id,t.oConfig);a.call(f);});}}catch(e){t.logError("no evaluation data");}}}else{try{var b=sap.ushell.components.tiles.indicatorTileUtils.cache.getEvaluationById(t.oConfig.TILE_PROPERTIES.id);if(b){t.oConfig.EVALUATION_FILTERS=b.EVALUATION_FILTERS;a.call(b);}else{sap.ushell.components.tiles.indicatorTileUtils.util.getFilterFromRunTimeService(t.oConfig,t.oTileApi,function(f){t.oConfig.EVALUATION_FILTERS=f;if(p.toUpperCase()==="HANA"){t.parse_sapclient();}sap.ushell.components.tiles.indicatorTileUtils.cache.setEvaluationById(t.oConfig.TILE_PROPERTIES.id,t.oConfig);a.call(f);});}}catch(e){t.logError("no evaluation data");}}},fetchKpiValue:function(c,E){var t=this;var k=0;try{var u=this.DEFINITION_DATA.EVALUATION.ODATA_URL;var s=this.DEFINITION_DATA.EVALUATION.ODATA_ENTITYSET;var T=this.setThresholdValues();var m=T.fullyFormedMeasure;var a=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(t.oConfig.TILE_PROPERTIES.id);if(!a){var v=sap.ushell.components.tiles.indicatorTileUtils.util.prepareFilterStructure(this.DEFINITION_DATA.EVALUATION_FILTERS,this.DEFINITION_DATA.ADDITIONAL_FILTERS);var q=sap.ushell.components.tiles.indicatorTileUtils.util.prepareQueryServiceUri(t.oTileApi.url.addSystemToServiceUrl(u),s,m,null,v);if(q){this.QUERY_SERVICE_MODEL=q.model;this.queryUriForKpiValue=q.uri;this.queryServiceUriODataReadRef=this.QUERY_SERVICE_MODEL.read(q.uri,null,null,true,function(d){if(d&&d.results&&d.results.length&&d.results[0][t.DEFINITION_DATA.EVALUATION.COLUMN_NAME]!=null){k=d.results[0][t.DEFINITION_DATA.EVALUATION.COLUMN_NAME];var w={};if(q.unit[0]){t._updateTileModel({unit:d.results[0][q.unit[0].name]});w.unit=q.unit[0];w.unit.name=q.unit[0].name;}if(t.oConfig.TILE_PROPERTIES.frameType=="TwoByOne"){if(sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(t.oConfig.TILE_PROPERTIES.id)){w=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(t.oConfig.TILE_PROPERTIES.id);}w.numericData=d;}else{w.data=d;}sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(t.oConfig.TILE_PROPERTIES.id,w);if(t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){T.criticalHighValue=d.results[0][T.sCriticalHigh];T.criticalLowValue=d.results[0][T.sCriticalLow];T.warningHighValue=d.results[0][T.sWarningHigh];T.warningLowValue=d.results[0][T.sWarningLow];T.targetValue=d.results[0][T.sTarget];T.trendValue=d.results[0][T.sTrend];}else if(t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="RELATIVE"){T.targetValue=Number(d.results[0][T.sTarget]);T.criticalHighValue=T.targetValue*T.criticalHighValue/100;T.criticalLowValue=T.targetValue*T.criticalLowValue/100;T.warningHighValue=T.targetValue*T.warningHighValue/100;T.warningLowValue=T.targetValue*T.warningLowValue/100;T.trendValue=Number(d.results[0][T.sTrend]);}c.call(t,k,T);}else{t.setNoData();}},function(b){if(b&&b.response){jQuery.sap.log.error(b.message+" : "+b.request.requestUri);E.call(t,b);}});}else{t.logError("Error Preparing Query Service URI");}}else{if(t.DEFINITION_DATA.TILE_PROPERTIES.frameType==sap.suite.ui.commons.FrameType.OneByOne){if(a.data.results&&a.data.results.length&&a.data.results[0][t.DEFINITION_DATA.EVALUATION.COLUMN_NAME]!=null){k=a.data.results[0][t.DEFINITION_DATA.EVALUATION.COLUMN_NAME];if(a.unit){t._updateTileModel({unit:a.data.results[0][a.unit.name]});}if(t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){T.criticalHighValue=a.data.results[0][T.sCriticalHigh];T.criticalLowValue=a.data.results[0][T.sCriticalLow];T.warningHighValue=a.data.results[0][T.sWarningHigh];T.warningLowValue=a.data.results[0][T.sWarningLow];T.targetValue=a.data.results[0][T.sTarget];T.trendValue=a.data.results[0][T.sTrend];}else if(t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="RELATIVE"){T.targetValue=Number(a.data.results[0][T.sTarget]);T.criticalHighValue=T.targetValue*T.criticalHighValue/100;T.criticalLowValue=T.targetValue*T.criticalLowValue/100;T.warningHighValue=T.targetValue*T.warningHighValue/100;T.warningLowValue=T.targetValue*T.warningLowValue/100;T.trendValue=Number(a.data.results[0][T.sTrend]);}c.call(t,k,T);}else{t.setNoData();}}else{if(a.numericData&&a.numericData.results&&a.numericData.results.length&&a.numericData.results[0][t.DEFINITION_DATA.EVALUATION.COLUMN_NAME]!=null){k=a.numericData.results[0][t.DEFINITION_DATA.EVALUATION.COLUMN_NAME];if(a.unit){t._updateTileModel({unit:a.numericData.results[0][a.unit.name]});}if(t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){T.criticalHighValue=a.numericData.results[0][T.sCriticalHigh];T.criticalLowValue=a.numericData.results[0][T.sCriticalLow];T.warningHighValue=a.numericData.results[0][T.sWarningHigh];T.warningLowValue=a.numericData.results[0][T.sWarningLow];T.targetValue=a.numericData.results[0][T.sTarget];T.trendValue=a.numericData.results[0][T.sTrend];}else if(t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="RELATIVE"){T.targetValue=Number(a.numericData.results[0][T.sTarget]);T.criticalHighValue=T.targetValue*T.criticalHighValue/100;T.criticalLowValue=T.targetValue*T.criticalLowValue/100;T.warningHighValue=T.targetValue*T.warningHighValue/100;T.warningLowValue=T.targetValue*T.warningLowValue/100;T.trendValue=Number(a.numericData.results[0][T.sTrend]);}c.call(t,k,T);}else{t.setNoData();}}}}catch(e){t.logError(e);}},_setLocalModelToTile:function(){if(!this.getTile().getModel()){this.getTile().setModel(new sap.ui.model.json.JSONModel({}));}},getTile:function(){return this.oKpiTileView.oGenericTile;},_updateTileModel:function(n){var m=this.getTile().getModel().getData();jQuery.extend(m,n);this.getTile().getModel().setData(m);},isACurrencyMeasure:function(m){var u=this.DEFINITION_DATA.EVALUATION.ODATA_URL;var e=this.DEFINITION_DATA.EVALUATION.ODATA_ENTITYSET;return sap.ushell.components.tiles.indicatorTileUtils.util.getFormattingMetadata(this.oTileApi.url.addSystemToServiceUrl(u),e,m)._hasCurrency;},autoFormatter:function(n,i){i=i||false;if(!n){return"";}return sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(Number(n),this.oConfig.EVALUATION.SCALING,this.oConfig.EVALUATION.DECIMAL_PRECISION,i);},setToolTip:function(a,c,t){var b=this;var C;var T=this.setThresholdValues();var m=this.oConfig.EVALUATION.COLUMN_NAME;var i=this.isACurrencyMeasure(m);if(t=="CONT"||t=="COMP"){if(this.oKpiTileView.getContent()[0].getTileContent().length){C=b.oKpiTileView.getContent()[0].getTileContent()[0].getContent();var d,e,f,v,g,h,j,k,l;if(c&&c[0]){d=c[0].title;v=this.autoFormatter(c[0].value,i);j=sap.ushell.components.tiles.indicatorTileUtils.util.getSemanticColorName(c[0].color);}if(c&&c[1]){e=c[1].title;g=this.autoFormatter(c[1].value,i);k=sap.ushell.components.tiles.indicatorTileUtils.util.getSemanticColorName(c[1].color);}if(c&&c[2]){f=c[2].title;h=this.autoFormatter(c[2].value,i);l=sap.ushell.components.tiles.indicatorTileUtils.util.getSemanticColorName(c[2].color);}var n={measure:this.oConfig.EVALUATION.COLUMN_NAME,m1:d,v1:v,c1:j,m2:e,v2:g,c2:k,m3:f,v3:h,c3:l};sap.ushell.components.tiles.indicatorTileUtils.util.setTooltipInTile(C,t,n);}}else{var s="";if(a=="Error"){s="sb.error";}if(a=="Neutral"){s="sb.neutral";}if(a=="Critical"){s="sb.critical";}if(a=="Good"){s="sb.good";}var n={status:s,actual:this.autoFormatter(c,i),target:this.autoFormatter(T.targetValue,i),cH:this.autoFormatter(T.criticalHighValue,i),wH:this.autoFormatter(T.warningHighValue,i),wL:this.autoFormatter(T.warningLowValue,i),cL:this.autoFormatter(T.criticalLowValue,i)};var C=b.oKpiTileView.getContent()[0].getTileContent()[0].getContent();sap.ushell.components.tiles.indicatorTileUtils.util.setTooltipInTile(C,t,n);}},getTrendColor:function(t){var a=this,w,c,b,d;try{var i=this.DEFINITION_DATA.EVALUATION.GOAL_TYPE;this.DEFINITION_DATA.EVALUATION_VALUES;var r=sap.suite.ui.commons.InfoTileValueColor.Neutral;if(i==="MI"){if(t.criticalHighValue&&t.warningHighValue){d=Number(t.criticalHighValue);b=Number(t.warningHighValue);if(this.CALCULATED_KPI_VALUE<b){r=sap.suite.ui.commons.InfoTileValueColor.Good;}else if(this.CALCULATED_KPI_VALUE<=d){r=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{r=sap.suite.ui.commons.InfoTileValueColor.Error;}}}else if(i==="MA"){if(t.criticalLowValue&&t.warningLowValue){c=Number(t.criticalLowValue);w=Number(t.warningLowValue);if(this.CALCULATED_KPI_VALUE<c){r=sap.suite.ui.commons.InfoTileValueColor.Error;}else if(this.CALCULATED_KPI_VALUE<=w){r=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{r=sap.suite.ui.commons.InfoTileValueColor.Good;}}}else{if(t.warningLowValue&&t.warningHighValue&&t.criticalLowValue&&t.criticalHighValue){d=Number(t.criticalHighValue);b=Number(t.warningHighValue);w=Number(t.warningLowValue);c=Number(t.criticalLowValue);if(this.CALCULATED_KPI_VALUE<c||this.CALCULATED_KPI_VALUE>d){r=sap.suite.ui.commons.InfoTileValueColor.Error;}else if((this.CALCULATED_KPI_VALUE>=c&&this.CALCULATED_KPI_VALUE<=w)||(this.CALCULATED_KPI_VALUE>=b&&this.CALCULATED_KPI_VALUE<=d)){r=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{r=sap.suite.ui.commons.InfoTileValueColor.Good;}}}return r;}catch(e){a.logError(e);}},getTrendIndicator:function(t){var a=this;t=Number(t);try{var b=sap.suite.ui.commons.DeviationIndicator.None;if(t>this.CALCULATED_KPI_VALUE){b=sap.suite.ui.commons.DeviationIndicator.Down;}else if(t<this.CALCULATED_KPI_VALUE){b=sap.suite.ui.commons.DeviationIndicator.Up;}return b;}catch(e){a.logError(e);}},setThresholdValues:function(){var t=this;try{var T={};T.fullyFormedMeasure=this.DEFINITION_DATA.EVALUATION.COLUMN_NAME;if(this.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){var c=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(t.oConfig.TILE_PROPERTIES.id);switch(this.DEFINITION_DATA.EVALUATION.GOAL_TYPE){case"MI":T.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");T.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");T.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");T.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");T.fullyFormedMeasure+=t.formSelectStatement(T);if(c&&c.data&&c.data.results&&c.data.results.length){T.trendValue=Number(c.data.results[0][T.sTrend]);T.targetValue=Number(c.data.results[0][T.sTarget]);T.criticalHighValue=Number(c.data.results[0][T.sCriticalHigh]);T.warningHighValue=Number(c.data.results[0][T.sWarningHigh]);}break;case"MA":T.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");T.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");T.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");T.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");T.fullyFormedMeasure+=t.formSelectStatement(T);if(c&&c.data&&c.data.results&&c.data.results.length){T.criticalLowValue=Number(c.data.results[0][T.sCriticalLow]);T.warningLowValue=Number(c.data.results[0][T.sWarningLow]);T.trendValue=Number(c.data.results[0][T.sTrend]);T.targetValue=Number(c.data.results[0][T.sTarget]);}break;case"RA":T.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WH","MEASURE");T.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CH","MEASURE");T.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");T.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");T.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WL","MEASURE");T.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CL","MEASURE");T.fullyFormedMeasure+=t.formSelectStatement(T);if(c&&c.data&&c.data.results&&c.data.results.length){T.criticalLowValue=Number(c.data.results[0][T.sCriticalLow]);T.warningLowValue=Number(c.data.results[0][T.sWarningLow]);T.trendValue=Number(c.data.results[0][T.sTrend]);T.targetValue=Number(c.data.results[0][T.sTarget]);T.criticalHighValue=Number(c.data.results[0][T.sCriticalHigh]);T.warningHighValue=Number(c.data.results[0][T.sWarningHigh]);}break;}}else if(this.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="RELATIVE"){T.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","MEASURE");T.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","MEASURE");T.fullyFormedMeasure+=t.formSelectStatement(T);T.criticalHighValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CH","FIXED");T.criticalLowValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CL","FIXED");T.warningHighValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WH","FIXED");T.warningLowValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WL","FIXED");}else{T.criticalHighValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CH","FIXED");T.criticalLowValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"CL","FIXED");T.warningHighValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WH","FIXED");T.warningLowValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"WL","FIXED");T.targetValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TA","FIXED");T.trendValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(t.oConfig,"TC","FIXED");}return T;}catch(e){t.logError(e);}},formSelectStatement:function(o){var t=Object.keys(o);var f="";for(var i=0;i<t.length;i++){if((o[t[i]]!==undefined)&&(o.fullyFormedMeasure)){f=f+","+o[t[i]];}}return f;},parse_sapclient:function(){var i,S,r,f,a;S="P_SAPClient";r="$$$";f=this.oConfig.EVALUATION_FILTERS;if(f.constructor!==Array){return;}if(f.length<1){return;}for(i in f){a=f[i];if(a["NAME"]===S&&a["VALUE_1"]===r){break;}a=null;}if(a){jQuery.when(sap.ushell.components.tiles.indicatorTileUtils.util.getHanaClient()).done(function(c){a["VALUE_1"]=c;});}},setTextInTile:function(){var t=this;var a=sap.ushell.components.tiles.indicatorTileUtils.util.getTileTitleSubtitle(this.oTileApi);this._updateTileModel({header:a.title||sap.ushell.components.tiles.indicatorTileUtils.util.getChipTitle(t.oConfig),subheader:a.subTitle||sap.ushell.components.tiles.indicatorTileUtils.util.getChipSubTitle(t.oConfig)});},logError:function(e){this._updateTileModel({value:"",scale:"",unit:""});if(this.getView().getViewData().deferredObj){this.getView().getViewData().deferredObj.reject();}else{this.oKpiTileView.oGenericTile.setState(sap.suite.ui.commons.LoadState.Failed);}},setNoData:function(){var v=this.getView().getViewData();if(v.parentController){v.parentController.setNoData();if(v.deferredObj){v.deferredObj.resolve();}}else{try{this._updateTileModel({value:"",scale:"",unit:"",footerNum:this.oResourceBundle.getText("sb.noDataAvailable"),footerComp:this.oResourceBundle.getText("sb.noDataAvailable")});this.oKpiTileView.oGenericTile.setState(sap.suite.ui.commons.LoadState.Loaded);}catch(e){}}},refreshHandler:function(){var t=this;var c={};if(this.firstTimeVisible){if(Number(this.oTileApi.configuration.getParameterValueAsString("isSufficient"))){if(this.KPI_VALUE_REQUIRED){var T=this.setThresholdValues();c=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(t.oConfig.TILE_PROPERTIES.id);if(t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){T.criticalHighValue=c.data.results[0][T.sCriticalHigh];T.criticalLowValue=c.data.results[0][T.sCriticalLow];T.warningHighValue=c.data.results[0][T.sWarningHigh];T.warningLowValue=c.data.results[0][T.sWarningLow];T.targetValue=c.data.results[0][T.sTarget];T.trendValue=c.data.results[0][T.sTrend];}else if(t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="RELATIVE"){T.targetValue=Number(c.data.results[0][T.sTarget]);T.criticalHighValue=T.targetValue*T.criticalHighValue/100;T.criticalLowValue=T.targetValue*T.criticalLowValue/100;T.warningHighValue=T.targetValue*T.warningHighValue/100;T.warningLowValue=T.targetValue*T.warningLowValue/100;T.trendValue=Number(c.data.results[0][T.sTrend]);}this.doProcess(this.KPIVALUE,T);}else{this.doProcess();}}else{this.fetchEvaluation(this.oConfig,function(){if(this.KPI_VALUE_REQUIRED){var T=this.setThresholdValues();c=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(t.oConfig.TILE_PROPERTIES.id);if(t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){T.criticalHighValue=c.data.results[0][T.sCriticalHigh];T.criticalLowValue=c.data.results[0][T.sCriticalLow];T.warningHighValue=c.data.results[0][T.sWarningHigh];T.warningLowValue=c.data.results[0][T.sWarningLow];T.targetValue=c.data.results[0][T.sTarget];T.trendValue=c.data.results[0][T.sTrend];}else if(t.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="RELATIVE"){T.targetValue=Number(c.data.results[0][T.sTarget]);T.criticalHighValue=T.targetValue*T.criticalHighValue/100;T.criticalLowValue=T.targetValue*T.criticalLowValue/100;T.warningHighValue=T.targetValue*T.warningHighValue/100;T.warningLowValue=T.targetValue*T.warningLowValue/100;T.trendValue=Number(c.data.results[0][T.sTrend]);}this.doProcess(this.KPIVALUE,T);}else{this.doProcess();}});}}},visibleHandler:function(i){if(!i){sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.queryServiceUriODataReadRef);sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.trendChartODataReadRef);sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.comparisionChartODataRef);}if(i){this.refreshHandler(this);}},_getEvaluationThresholdMeasures:function(){var t=[];t.push(this.oConfig.EVALUATION.COLUMN_NAME);if(this.oConfig.EVALUATION.VALUES_SOURCE==="MEASURE"){var a=this.oConfig.EVALUATION_VALUES;if(a&&a.length){for(var i=0;i<a.length;i++){if((a[i]).COLUMN_NAME&&!((a[i]).FIXED)){t.push((a[i]).COLUMN_NAME);}}}}return t;},onExit:function(){sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.queryServiceUriODataReadRef);sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.trendChartODataReadRef);sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.comparisionChartODataRef);}});
