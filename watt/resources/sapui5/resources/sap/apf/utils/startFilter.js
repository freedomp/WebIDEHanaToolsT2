/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare('sap.apf.utils.startFilter');
sap.apf.utils.StartFilter=function(a,c,b){'use strict';var e;var r;var d;var f;var g;j=j.bind(this);k=k.bind(this);s=s.bind(this);this.getPropertyName=function(){return c.property;};this.getLabel=function(){return c.label;};this.getAliasNameIfExistsElsePropertyName=function(){return c.alias||c.property;};this.isMultiSelection=function(){if(c.multiSelection==='true'||c.multiSelection===true){return true;}return false;};this.isVisible=function(){if(b&&b.type==='internalFilter'&&!c.filterResolutionRequest){return false;}return!c.invisible;};this.setRestriction=function(i){d=undefined;f=undefined;r=i;};this.getValues=function(){var l;var v=[];var p;n=n.bind(this);m=m.bind(this);if(c.valueHelpRequest&&jQuery.isArray(b)){return h().then(function(i){var v=i.data;n(b,v);return v;});}else if(b&&b.type==='internalFilter'&&c.valueHelpRequest&&c.filterResolutionRequest){l=jQuery.when(h(),s());return l.then(function(i,o){var v=i.data;m(o.data,v);return v;});}else if(c.valueHelpRequest&&((c.preselectionDefaults&&c.preselectionDefaults.length>0)||jQuery.isFunction(c.preselectionFunction))){return h().then(function(i){var v=i.data;var p;if(c.preselectionDefaults&&c.preselectionDefaults.length>0){p=c.preselectionDefaults;}else{p=c.preselectionFunction();}n(p,v);return v;});}else if(c.valueHelpRequest){return h().then(function(i){return i.data;});}else if(b&&b.type==='internalFilter'&&c.filterResolutionRequest){return s().then(function(i){return i.data;});}else if(jQuery.isArray(b)&&c.filterResolutionRequest&&!c.valueHelpRequest){return s().then(function(i){return i.data;});}else if(jQuery.isArray(b)){l=jQuery.Deferred();n(b,v);l.resolve(v);return l.promise();}else if(((c.preselectionDefaults&&c.preselectionDefaults.length>0)||jQuery.isFunction(c.preselectionFunction))&&!c.valueHelpRequest&&!c.filterResolutionRequest&&!b){if(c.preselectionDefaults&&c.preselectionDefaults.length>0){p=c.preselectionDefaults;}else{p=c.preselectionFunction();}if(this.isMultiSelection()){n(p,v);}else{n([p[0]],v);}return jQuery.Deferred().resolve(v).promise();}else if(((c.preselectionDefaults&&c.preselectionDefaults.length>0)||jQuery.isFunction(c.preselectionFunction))&&c.filterResolutionRequest&&!b){if(c.preselectionDefaults&&c.preselectionDefaults.length>0){p=c.preselectionDefaults;}else{p=c.preselectionFunction();}if(this.isMultiSelection()){n(p,v);}else{n([p[0]],v);}return jQuery.Deferred().resolve(v).promise();}else if(b&&b.type==='internalFilter'||!b){return jQuery.Deferred().resolve(null).promise();}function m(o,q){var t=k(q);for(var i=o.length-1;i>=0;i--){if(!t[o[i][this.getAliasNameIfExistsElsePropertyName()]]){q.unshift(o[i]);}}}function n(o,q){var t=k(q);var u;for(var i=o.length-1;i>=0;i--){if(!t[o[i]]){u={};u[this.getAliasNameIfExistsElsePropertyName()]=o[i];q.unshift(u);}}}};this.getMetadata=function(){if(c.valueHelpRequest){return h().then(function(i){return i.metadata.getPropertyMetadata(this.getAliasNameIfExistsElsePropertyName());}.bind(this));}else if(c.filterResolutionRequest){return s().then(function(i){return i.metadata.getPropertyMetadata(this.getAliasNameIfExistsElsePropertyName());}.bind(this));}return jQuery.Deferred().resolve({});};this.setSelectedValues=function(v){if(!g){g=true;this.getSelectedValues().done(function(i){g=i;});}if(v.type==='internalFilter'){e=v;}else{e=jQuery.extend(true,[],v);}};this.getSelectedValues=function(){var i=jQuery.Deferred();var l;var p;var m;if(e){if(!c.invisible){this.getValues().done(function(v){if(v!==null){l=[];m=k(v);e.forEach(function(o){if(m[o]){l.push(o);}});e=l;}else{l=null;}n();});}else{l=e;n();}}else if(jQuery.isFunction(c.preselectionFunction)&&!c.valueHelpRequest){l=c.preselectionFunction();n();}else if(b&&b.type==='internalFilter'&&!c.filterResolutionRequest){i.resolve(b);}else if(c.filterResolutionRequest&&!b&&!c.valueHelpRequest&&!(c.preselectionDefaults&&c.preselectionDefaults.length>0)){i.resolve(null);}else if(b&&b.type==='internalFilter'&&c.filterResolutionRequest){s().then(function(o){var q=j(o);if(this.isMultiSelection()){l=q;}else{l=[q[0]];}n();}.bind(this));}else if(c.valueHelpRequest&&!jQuery.isArray(b)){h().then(function(o){var v=[];var q=j(o);if(c.preselectionDefaults&&c.preselectionDefaults.length>0){p=c.preselectionDefaults;}else{p=c.preselectionFunction&&c.preselectionFunction();}if(p){p.forEach(function(t){if(jQuery.inArray(t,q)>-1){v.push(t);}});}else{v=q;}if(this.isMultiSelection()){l=v;}else{l=[v[0]];}n();}.bind(this));}else if(jQuery.isArray(b)){if(this.isMultiSelection()){l=b;}else{l=b[0]?[b[0]]:[];}n();}else if(c.preselectionDefaults&&c.preselectionDefaults.length>0){l=c.preselectionDefaults;if(!this.isMultiSelection()){l=[l[0]];}n();}else{i.resolve(null);}return i.promise();function n(){if(l&&l.type==='internalFilter'){i.resolve(l);}else{i.resolve(jQuery.extend(true,[],l));}}};this.serialize=function(){var i=jQuery.Deferred();var l={propertyName:this.getPropertyName()};this.getSelectedValues().done(function(v){if(v.type==='internalFilter'){v=v.mapToSapUI5FilterExpression();}l.selectedValues=v;i.resolve(l);});return i;};this.deserialize=function(i){if(i.selectedValues.filters||i.selectedValues.path){i.selectedValues=sap.apf.core.utils.Filter.transformUI5FilterToInternal(a.instance.messageHandler,i.selectedValues);}e=undefined;g=undefined;b=i.selectedValues;};this.reset=function(){if(g){e=g;}};function s(){var i;var m;var l;if(jQuery.isArray(b)){l=new sap.apf.core.utils.Filter(a.instance.messageHandler);b.forEach(function(v){l.addOr(this.getAliasNameIfExistsElsePropertyName(),'eq',v);}.bind(this));}else{l=b;}if(f){return f;}f=jQuery.Deferred();if(r){m=new sap.apf.core.utils.Filter(a.instance.messageHandler);m.addAnd(r).addAnd(l);}else{m=l;}i=a.functions.createRequest(c.filterResolutionRequest);i.sendGetInBatch(m,n,undefined);return f.promise();function n(o){f.resolve(o);}}function h(){var i;if(d){return d;}d=jQuery.Deferred();i=a.functions.createRequest(c.valueHelpRequest);i.sendGetInBatch(r,l,undefined);return d.promise();function l(m){d.resolve(m);}}function j(i){var v=[];i.data.forEach(function(l){v.push(l[this.getAliasNameIfExistsElsePropertyName()]);}.bind(this));return v;}function k(i){var v={};i.forEach(function(l){v[l[this.getAliasNameIfExistsElsePropertyName()]]=true;}.bind(this));return v;}};
