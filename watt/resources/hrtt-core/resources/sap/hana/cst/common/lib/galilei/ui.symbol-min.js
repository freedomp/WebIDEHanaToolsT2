"use strict";namespace("sap.galilei.ui.symbol");
"use strict";sap.galilei.ui.symbol.Orientation={vertical:"vertical",horizontal:"horizontal",DEFAULT:"vertical"};sap.galilei.ui.symbol.LayoutSwimlaneDirection={axis:"axis",antiAxis:"antiAxis",DEFAULT:"axis"};sap.galilei.ui.symbol.EdgeType={NONE:0,LEFT:1,RIGHT:2,TOP:4,BOTTOM:8,ALL:15};
"use strict";sap.galilei.model.metamodel("Galilei.Common",{contents:{"sap.galilei.common":{name:"Galilei.Common",classDefinition:"sap.galilei.model.Package",displayName:"Galilei Model Metamodel",namespaceName:"sap.galilei.common",classifiers:{NamedObject:{classDefinition:"sap.galilei.model.Class",name:"NamedObject",displayName:"Named Object",properties:{comment:{name:"comment",displayName:"Comment",classDefinition:"sap.galilei.model.Property",dataType:sap.galilei.model.dataTypes.gString}}},Model:{classDefinition:"sap.galilei.model.Class",name:"Model",displayName:"Model",parent:"NamedObject",properties:{isModel:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true,isInternal:true}},references:{packages:{name:"packages",displayName:"Packages",classDefinition:"sap.galilei.model.Reference",contentType:"sap.galilei.model.Package",isMany:true,isContainment:true},"Model.diagrams":{name:"diagrams",displayName:"Diagrams",classDefinition:"sap.galilei.model.Reference",contentType:"sap.galilei.model.Object",isMany:true,isContainment:true}}},Package:{classDefinition:"sap.galilei.model.Class",name:"Package",displayName:"Package",parent:"NamedObject",references:{"Package.diagrams":{name:"diagrams",displayName:"Diagrams",classDefinition:"sap.galilei.model.Reference",contentType:"sap.galilei.model.Object",isMany:true,isContainment:true}}},LinkObject:{classDefinition:"sap.galilei.model.Class",name:"LinkObject",displayName:"Link Object",parent:"NamedObject",references:{source:{name:"source",displayName:"Source",classDefinition:"sap.galilei.model.Reference",contentType:"sap.galilei.model.Object",isMany:false},target:{name:"target",displayName:"Target",classDefinition:"sap.galilei.model.Reference",contentType:"sap.galilei.model.Object",isMany:false}}}}}}});
"use strict";sap.galilei.model.metamodel("Galilei.Diagram",{contents:{stringToPointsConverter:{name:"stringToPointsConverter",classDefinition:"sap.galilei.model.Converter",convertFrom:function(sValue){if(sap.galilei.core.isInstanceOf(sValue,sap.galilei.ui.common.Points)){return sValue}return new sap.galilei.ui.common.Points({points:sValue})},convertTo:function(oPoints){return sap.galilei.ui.common.Points.toString(oPoints)}},"sap.galilei.ui.diagram":{name:"Galilei.Diagram",classDefinition:"sap.galilei.model.Package",displayName:"Galilei Diagram Metamodel",namespaceName:"sap.galilei.ui.diagram",classifiers:{Symbol:{displayName:"Symbol",onDelete:function(oEvent){oEvent.sourceSymbol=this;sap.galilei.core.Event.publish("delete.symbol",this,undefined,oEvent);this.dispose(false)},properties:{name:{dataType:sap.galilei.model.dataTypes.gString},displayMode:{dataType:sap.galilei.model.dataTypes.gString,defaultValue:sap.galilei.ui.common.ShapeLayoutModes.detail},x:{dataType:sap.galilei.model.dataTypes.gDouble,defaultValue:0},y:{dataType:sap.galilei.model.dataTypes.gDouble,defaultValue:0},width:{dataType:sap.galilei.model.dataTypes.gDouble,defaultValue:0},height:{dataType:sap.galilei.model.dataTypes.gDouble,defaultValue:0},isSymbol:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true,isInternal:true},isComposite:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false},isBoundarySymbol:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false,isInternal:true},isAdjustToContent:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true},isKeepAspectRatio:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false},isKeepCenter:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false},isKeepSize:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false},isHidden:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:false},isSelected:{dataType:sap.galilei.model.dataTypes.gBool,isInternal:true,defaultValue:false},isDrawn:{dataType:sap.galilei.model.dataTypes.gBool,isInternal:true,get:function(){return this.shape&&this.shape.isDrawn}},stroke:{dataType:sap.galilei.model.dataTypes.gString},strokeWidth:{dataType:sap.galilei.model.dataTypes.gString},fill:{dataType:sap.galilei.model.dataTypes.gString},symbolLayout:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},shape:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},eventHandlers:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},zindex:{dataType:sap.galilei.model.dataTypes.gInteger,defaultValue:0},boundaryDirection:{dataType:sap.galilei.model.dataTypes.gInteger,isInternal:true},runtimeClass:{get:function(){return this.classDefinition?this.classDefinition.runtimeClass:undefined}}},references:{object:{contentType:"sap.galilei.model.Object",isMany:false},"Symbol.symbols":{name:"symbols",contentType:"sap.galilei.ui.diagram.Symbol",isMany:true,isContainment:true,onCascadeChange:function(oEventArgs){var oInstance=oEventArgs.instance,oObject=oEventArgs.newObject,sChangeType=oEventArgs.eventType;if(sChangeType==="referenceAdd"){if(!(oInstance.isComposite)){throw"It is not possible to add SubSymbols to a Symbol that is not composite"}if(oInstance.zindex>oObject.zindex-sap.galilei.ui.common.ZINDEX_STEP){if(oInstance.updateZIndex){oInstance.updateZIndex()}}if(oObject&&oObject.updateLinkSymbolOwners){oObject.updateLinkSymbolOwners()}}else{if(sChangeType==="referenceRemove"){if(oInstance.updateZIndex){oInstance.updateZIndex()}}}}},parentSymbol:{contentType:"sap.galilei.ui.diagram.Symbol",isMany:false,get:function(){var oContainer=this.container;if(oContainer&&!(oContainer instanceof sap.galilei.ui.diagram.Diagram)){return oContainer}return undefined}},diagram:{contentType:"sap.galilei.ui.diagram.Diagram",isMany:false,get:function(){var oContainer=this.container;while(oContainer!==undefined){if(oContainer instanceof sap.galilei.ui.diagram.Diagram){return oContainer}else{oContainer=oContainer.container}}return oContainer}},owner:{contentType:"sap.galilei.model.Object",isMany:false,isContainment:false,get:function(){if(this.parentSymbol){return this.parentSymbol}return this.diagram},set:function(oOwner){var oOldCollection,oNewCollection,nOldIndex;if(oOwner){oOldCollection=this.parentSymbol?this.parentSymbol.symbols:this.diagram.symbols;if(sap.galilei.model.isInstanceOf(oOwner,"sap.galilei.ui.diagram.Diagram")||oOwner.isComposite){oNewCollection=oOwner.symbols}if(oNewCollection&&oNewCollection.indexOf(this)<0){nOldIndex=oOldCollection.indexOf(this);if(nOldIndex>=0){oOldCollection.removeAt(nOldIndex);oNewCollection.push(this)}}}}},contentSymbols:{contentType:"sap.galilei.ui.diagram.Symbol",isMany:true,get:function(){var aContentSymbols=new sap.galilei.model.ArrayCollection(),index,max,oSymbol;for(index=0,max=this.symbols.length;index<max;index++){oSymbol=this.symbols.get(index);if(!oSymbol.isBoundarySymbol){aContentSymbols.push(oSymbol)}}return aContentSymbols}},boundarySymbols:{contentType:"sap.galilei.ui.diagram.Symbol",isMany:true,get:function(){var aBoundarySymbols=new sap.galilei.model.ArrayCollection(),index,max,oSymbol;for(index=0,max=this.symbols.length;index<max;index++){oSymbol=this.symbols.get(index);if(oSymbol.isBoundarySymbol){aBoundarySymbols.push(oSymbol)}}return aBoundarySymbols}}},methods:{getOwner:function(){return this.parentSymbol||this.diagram},on:function(sEventName,fnEventHandler,oScope){if(sEventName){var oEventHandler,aEventArgs=Array.prototype.slice.call(arguments,3),aEventHandlers,oExistingEventHandler;this.eventHandlers=this.eventHandlers||{};aEventHandlers=this.eventHandlers[sEventName]||[];if(fnEventHandler){if(typeof fnEventHandler==="function"){oEventHandler={callback:fnEventHandler};if(oScope){oEventHandler.scope=oScope}if(aEventArgs&&aEventArgs.length>0){oEventHandler["arguments"]=aEventArgs}}}if(oEventHandler){if(this.eventHandlers[sEventName]){oExistingEventHandler=this.findEventHandler(sEventName,fnEventHandler,oScope);if(oExistingEventHandler){aEventHandlers["arguments"]=aEventArgs}else{aEventHandlers.push(oEventHandler)}}else{this.eventHandlers[sEventName]=[oEventHandler]}this.registerEventHandler(sEventName,oEventHandler)}}return this},off:function(sEventName,fnEventHandler,oScope){if(this.eventHandlers&&sEventName&&this.eventHandlers[sEventName]){var aEventHandlers=this.eventHandlers[sEventName],index,oEventHandler;for(index=aEventHandlers.length-1;index>=0;index--){oEventHandler=aEventHandlers[index];if((oEventHandler.callback===fnEventHandler||fnEventHandler===undefined)&&(oEventHandler.scope===oScope||oScope===undefined)){this.unregisterEventHandler(sEventName,oEventHandler);this.eventHandlers[sEventName].splice(index,1);if(this.eventHandlers[sEventName].length===0){delete this.eventHandlers[sEventName];if(!sap.galilei.core.hasObjects(this.eventHandlers)){this.eventHandlers=undefined}}}}}},findEventHandler:function(sEventName,fnEventHandler,oScope){if(this.eventHandlers&&sEventName&&fnEventHandler){var aEventHandlers=this.eventHandlers[sEventName],oEventHandler,index;if(aEventHandlers){for(index=0;index<aEventHandlers.length;index++){oEventHandler=aEventHandlers[index];if(oEventHandler.callback===fnEventHandler&&oEventHandler.scope===oScope){return oEventHandler}}}}return undefined},enableEventHandler:function(sEventName,fnEventHandler,oScope,bEnable){if(this.eventHandlers&&sEventName&&this.eventHandlers[sEventName]){var shape=this.getOrCreateShape(),aEventHandlers=this.eventHandlers[sEventName],index,oEventHandler;for(index=0;index<aEventHandlers.length;index++){oEventHandler=aEventHandlers[index];if((oEventHandler.callback===fnEventHandler||fnEventHandler===undefined)&&(oEventHandler.scope===oScope||oScope===undefined)){if(!bEnable){oEventHandler.disabled=true}else{if(oEventHandler.disabled){delete oEventHandler.disabled}}}}if(shape){shape.enableEventHandler(sEventName,fnEventHandler,oScope,bEnable)}}return this},registerEventHandler:function(sEventName,oEventHandler){var self=this,shape,oScope,fnEventHandler,aEventArgs,bDisabled,aOnArgs;function symbolEventHandler(oEvent){if(!bDisabled&&fnEventHandler){oEvent.sourceSymbol=self;if(!oScope){oScope=self}fnEventHandler.apply(oScope,arguments)}}if(this.eventHandlers&&sEventName&&oEventHandler){shape=this.getOrCreateShape();oScope=oEventHandler.scope;fnEventHandler=oEventHandler.callback;aEventArgs=oEventHandler["arguments"];bDisabled=oEventHandler.disabled;if(shape&&shape.isDrawn&&fnEventHandler){aOnArgs=[sEventName,symbolEventHandler];if(oScope){aOnArgs.push(oScope)}if(aEventArgs&&aEventArgs.length>0){if(!oScope){aOnArgs.push(oScope)}aOnArgs=aOnArgs.concat(aEventArgs)}shape.on.apply(shape,aOnArgs);oEventHandler.registeredEventHandler=symbolEventHandler}}return this},unregisterEventHandler:function(sEventName,oEventHandler){if(sEventName&&oEventHandler){if(this._shape){this._shape.off(sEventName,oEventHandler.registeredEventHandler,oEventHandler.scope)}}},registerEventHandlers:function(){if(this.eventHandlers){var sEventName,aEventHandlers,index;for(sEventName in this.eventHandlers){aEventHandlers=this.eventHandlers[sEventName];for(index=0;index<aEventHandlers.length;index++){this.registerEventHandler(sEventName,aEventHandlers[index])}}}return this},unregisterEventHandlers:function(){if(this.eventHandlers){var sEventName,aEventHandlers,index;for(sEventName in this.eventHandlers){aEventHandlers=this.eventHandlers[sEventName];for(index=0;index<aEventHandlers.length;index++){this.unregisterEventHandler(sEventName,aEventHandlers[index])}}}return this},createLayoutTemplate:function(){var oLayoutTemplate=sap.galilei.ui.diagram.Symbol.createLayoutTemplate(this.classDefinition);if(!oLayoutTemplate){throw"The layoutTemplate static property should be defined or the createLayoutTemplate() function should be overridden."}return oLayoutTemplate},getOrCreateSymbolLayout:function(){return sap.galilei.ui.diagram.Symbol.getOrCreateSymbolLayout(this.classDefinition)},defaultDispose:function(bCascade){var index,oSymbol,oLinks;if(this._shape){this._shape.dispose();this._shape=undefined}this.unregisterEventHandlers();if(bCascade||bCascade===undefined){oLinks=this.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=0;index<oLinks.length;index++){oSymbol=oLinks[index];oSymbol.dispose()}}if(this.isComposite){for(index=0;index<this.symbols.length;index++){oSymbol=this.symbols.get(index);oSymbol.dispose()}}}},dispose:function(bCascade){this.defaultDispose(bCascade)},defaultDeleteSymbol:function(bDeleteObject){var oObject,oLinks,nLoop,index,oSymbol,aSynonyms;this.dispose();oLinks=this.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=oLinks.length-1;index>=0;index--){oLinks[index].deleteSymbol(bDeleteObject)}}if(bDeleteObject){aSynonyms=this.getSynonymSymbols();for(index=0;index<aSynonyms.length;index++){aSynonyms[index].deleteSymbol(false)}}if(this.isComposite&&this.symbols.length>0){for(nLoop=0;nLoop<2;nLoop++){for(index=this.symbols.length-1;index>=0;index--){oSymbol=this.symbols.get(index);if((nLoop===0&&oSymbol.isLinkSymbol)||(nLoop===1&&!oSymbol.isLinkSymbol)){oSymbol.deleteSymbol(bDeleteObject)}}}}oObject=this.object;if(oObject){this.object=undefined}if(bDeleteObject&&oObject&&oObject.deleteObject){oObject.deleteObject()}this.deleteObject()},deleteSymbol:function(bDeleteObject){this.defaultDeleteSymbol(bDeleteObject)},createShape:function(){var oSymbolLayout=this.getOrCreateSymbolLayout();if(oSymbolLayout){return oSymbolLayout.createShape(this)}return undefined},getOrCreateShape:function(){if(!this.shape){this.shape=this.createShape()}return this.shape},getBoundaryShape:function(){if(this.shape){return this.shape.boundaryShape}return undefined},getMainShape:function(){if(this.shape){return this.shape.mainShape}return undefined},getContentShape:function(){if(this.shape){return this.shape.contentShape}return undefined},getBBox:function(bIncludeAllSubSymbols){var oRect,oShape;if(bIncludeAllSubSymbols){oShape=this.getOrCreateShape();if(oShape&&oShape.domClass==="nodeGroup"){oRect=oShape.getBBox()}}if(!oRect){oRect=new sap.galilei.ui.common.Rect(this.x,this.y,this.width,this.height)}return oRect},setBBox:function(oRect,options,oViewer,oTransitionDef){if(oRect){var oNewRect=oRect.clone().normalize(),oMoveOptions={},oResizeOptions={};options=options||{};oMoveOptions.moveSubSymbols=options.moveSubSymbols;oMoveOptions.moveLinkSymbols=options.moveLinkSymbols;oResizeOptions.keepAspectRatio=options.keepAspectRatio;oResizeOptions.keepCenter=options.keepCenter;this.moveTo(oNewRect.left,oNewRect.top,oMoveOptions,oViewer,oTransitionDef);this.resize(oNewRect.width,oNewRect.height,oResizeOptions,oViewer,oTransitionDef)}},canSetBBox:function(oRect){if(this.isComposite&&this.symbols&&this.contentSymbols.length>0){var oSubBBox=this.getSubSymbolsBBox(undefined,true);if(oSubBBox&&!oRect.isRectInRect(oSubBBox)){return false}}return true},getCenter:function(bRound){var cx=0,cy=0;if(this.x!==undefined&&!isNaN(this.x)&&this.y!==undefined&&!isNaN(this.y)){cx=this.x;cy=this.y;if(this.width!==undefined&&!isNaN(this.width)&&this.height!==undefined&&!isNaN(this.height)){cx=this.x+this.width/2;cy=this.y+this.height/2;if(bRound){cx=Math.round(cx);cy=Math.round(cy)}}}return[cx,cy]},setCenter:function(cx,cy,viewer,oTransitionDef){var aCenter,cx0,cy0;aCenter=this.getCenter();cx0=aCenter[0];cy0=aCenter[1];if(cx0!==undefined&&!isNaN(cx0)&&cy0!==undefined&&!isNaN(cy0)&&cx!==undefined&&!isNaN(cx)&&cy!==undefined&&!isNaN(cy)){this.moveBy(cx-cx0,cy-cy0,undefined,viewer,oTransitionDef)}},isPointInSymbol:function(vPoint){var oShape;if(vPoint){oShape=this.getBoundaryShape();if(oShape){return oShape.isPointInShape(vPoint,this.getBBox())}}return false},isPointOnBorder:function(vPoint,nRadius){var oShape;if(vPoint){oShape=this.getBoundaryShape();if(oShape){return oShape.isPointOnBorder(vPoint,this.getBBox(),nRadius)}}return false},drawSymbol:function(oViewer,oTransitionDef,aAttributes){var oShape=this.getOrCreateShape(),bMoved=false,bResized=false,oEvent={};if(this.parentSymbol&&(!this.parentSymbol.shape||!this.parentSymbol.shape.isDrawn)){return}if(oShape){if(!oShape.isDrawn){if(!oShape.isDisableDrawing){oShape.draw(oViewer,undefined,oTransitionDef)}oShape._oldWidth=this.width;oShape._oldHeight=this.height;this.registerEventHandlers()}else{if(oShape.x!==this.x||oShape.y!==this.y){oShape.x=this.x;oShape.y=this.y;bMoved=true}if(oShape._oldWidth!==this.width||oShape._oldHeight!==this.height){this.updateLayout(false);oShape._oldWidth=this.width;oShape._oldHeight=this.height;bResized=true}oShape.zindex=this.getShapeZIndex();if(oViewer){if(bMoved||bResized){oEvent.sourceSymbol=this;oEvent.transitionDefinition=oTransitionDef;sap.galilei.core.Event.publish(bResized?"resize.symbol.before":"move.symbol.before",this,undefined,oEvent)}oShape.updateDrawing(oViewer,oTransitionDef,aAttributes);if(bMoved||bResized){setTimeout(function(){sap.galilei.core.Event.publish(bResized?"resize.symbol.after":"move.symbol.after",oEvent.sourceSymbol,undefined,oEvent)},oTransitionDef?oTransitionDef.duration:0)}}}}if(this.isComposite){this.drawSubSymbols(oViewer,oTransitionDef,aAttributes)}},updateZIndex:function(){var i,length,min,oSymbol;for(i=0,length=this.symbols.length;i<length;i++){oSymbol=this.symbols.get(i);if(oSymbol&&!oSymbol.isLinkSymbol){if(min===undefined||min>oSymbol.zindex){min=oSymbol.zindex}}}min=min===undefined?sap.galilei.ui.common.ZINDEX_STEP:min;if(this.zindex!==min-sap.galilei.ui.common.ZINDEX_STEP){this.zindex=min-sap.galilei.ui.common.ZINDEX_STEP;if(this.parentSymbol){this.parentSymbol.updateZIndex()}}},getShapeZIndex:function(){return this.isComposite?this.zindex-2*sap.galilei.ui.common.ZINDEX_STEP_MINOR:this.zindex},adjustToContent:function(viewer,oTransitionDef){if((!this.isKeepSize||this.width===undefined||this.height===undefined)){var oSymbolLayout=this.getOrCreateSymbolLayout(),left=this.x,right=this.x+this.width,top=this.y,bottom=this.y+this.height,width=this.width,height=this.height,oBBox=this.getBBox(),oSubSymbolsBBox,oContentAreaBBox;if(oSymbolLayout){if(!this.isAdjustToContent){this.isAdjustToContent=true}if(this.isComposite){this.updateSubSymbolsLayout(viewer,oTransitionDef);oContentAreaBBox=this.getContentAreaBBox();if(!oContentAreaBBox){oContentAreaBBox=oBBox.clone()}oSubSymbolsBBox=this.getSubSymbolsBBox(undefined,true);if(!oSubSymbolsBBox){oSubSymbolsBBox=oContentAreaBBox.clone()}left=oSubSymbolsBBox.left-(oContentAreaBBox.left-left);top=oSubSymbolsBBox.top-(oContentAreaBBox.top-top);width=(oSubSymbolsBBox.right+(right-oContentAreaBBox.right))-left;height=(oSubSymbolsBBox.bottom+(bottom-oContentAreaBBox.bottom))-top;if(left!==this.x||top!==this.y){this.moveTo(left,top,{moveSubSymbols:false},viewer,oTransitionDef)}}oSymbolLayout.layoutShape(this,this.shape,width,height,this.isKeepAspectRatio,this.symbols.length>0?this.isKeepCenter:true);if(viewer){this.drawSymbol(viewer,oTransitionDef)}}}},defaultExtendToContent:function(options,edgeOption,oViewer,oTransitionDef){if((!this.isKeepSize||this.width===undefined||this.height===undefined)){var oSymbolLayout=this.getOrCreateSymbolLayout(),left=this.x,top=this.y,right=this.x+this.width,bottom=this.y+this.height,width=this.width,height=this.height,oSubSymbolsBBox,oContentAreaBBox,oOldBBox=this.getBBox(),bExtendParent,bMove;if(oSymbolLayout){if(this.isComposite&&this.symbols.length>0){options=options||{};bExtendParent=options.extendParent!==undefined?options.extendParent:false;this.updateSubSymbolsLayout();oContentAreaBBox=this.getContentAreaBBox();oSubSymbolsBBox=this.getSubSymbolsBBox(undefined,true);if(oSubSymbolsBBox){if(oContentAreaBBox.left>oSubSymbolsBBox.left&&(edgeOption&&(edgeOption&sap.galilei.ui.symbol.EdgeType.LEFT)!==0)){left-=oContentAreaBBox.left-oSubSymbolsBBox.left;bMove=true}if(oContentAreaBBox.top>oSubSymbolsBBox.top&&(edgeOption&&(edgeOption&sap.galilei.ui.symbol.EdgeType.TOP)!==0)){top-=oContentAreaBBox.top-oSubSymbolsBBox.top;bMove=true}if(oContentAreaBBox.right<oSubSymbolsBBox.right&&(edgeOption&&(edgeOption&sap.galilei.ui.symbol.EdgeType.RIGHT)!==0)){right+=oSubSymbolsBBox.right-oContentAreaBBox.right}if(oContentAreaBBox.bottom<oSubSymbolsBBox.bottom&&(edgeOption&&(edgeOption&sap.galilei.ui.symbol.EdgeType.BOTTOM)!==0)){bottom+=oSubSymbolsBBox.bottom-oContentAreaBBox.bottom}width=right-left;height=bottom-top;if(bMove){this.moveTo(left,top,{moveSubSymbols:false,moveLinkSymbols:false},oViewer,oTransitionDef)}}}oSymbolLayout.layoutShape(this,this.shape,width,height,this.isKeepAspectRatio,this.isKeepCenter);if(oViewer){this.drawSymbol(oViewer,oTransitionDef)}if(options.updateBoundarySymbols||options.updateBoundarySymbols===undefined){this.updateBoundarySymbols(oOldBBox,this.getBBox(),true,oViewer,oTransitionDef)}if(options.updateLinkSymbols){this.updateLinkSymbolRoutings(oOldBBox,this.getBBox(),true,false,oViewer,oTransitionDef)}else{if(oViewer){this.drawLinkSymbols(oViewer,oTransitionDef)}}if(bExtendParent&&this.parentSymbol&&this.parentSymbol.extendToContent){this.parentSymbol.extendToContent({extendParent:true},edgeOption,oViewer,oTransitionDef)}}}},extendToContent:function(options,edgeOption,oViewer,oTransitionDef){this.defaultExtendToContent(options,edgeOption,oViewer,oTransitionDef)},updateLayout:function(bCanChangeSymbol,viewer,oTransitionDef){var oSymbolLayout=this.getOrCreateSymbolLayout();if(oSymbolLayout){oSymbolLayout.layoutShape(this,this.shape,this.width,this.height,this.isKeepAspectRatio,this.isKeepCenter,bCanChangeSymbol);if(viewer){this.drawSymbol(viewer,oTransitionDef)}}},updateSymbol:function(viewer,oTransitionDef){if(this.isComposite){this.updateSubSymbolsLayout(viewer,oTransitionDef)}this.updateLayout(false,viewer,oTransitionDef)},moveBy:function(dx,dy,options,oViewer,oTransitionDef){var self=this,x=this.x,y=this.y,bMoveSubSymbols=(!options||options.moveSubSymbols===undefined||options.moveSubSymbols),bMoveLinkSymbols=(!options||options.moveLinkSymbols===undefined||options.moveLinkSymbols);if(x===undefined||isNaN(x)){x=0}if(y===undefined||isNaN(y)){y=0}if(dx!==undefined&&!isNaN(dx)){x+=dx}else{dx=0}if(dy!==undefined&&!isNaN(dy)){y+=dy}else{dy=0}this.x=x;this.y=y;if((dx!==0||dy!==0)&&this.shape){this.shape.x=x;this.shape.y=y;if(oViewer){this.shape.updateDrawing(oViewer,oTransitionDef,["groupTransform"])}}if(this.isComposite&&bMoveSubSymbols){this.moveSubSymbolsBy(dx,dy,options,oViewer,oTransitionDef)}if(bMoveLinkSymbols){this.moveLinkSymbolsBy(dx,dy,oViewer,oTransitionDef)}},moveTo:function(x,y,options,oViewer,oTransitionDef){var x0=this.x,y0=this.y,dx=0,dy=0;if(x0===undefined||isNaN(x0)){x0=0}if(y0===undefined||isNaN(y0)){y0=0}if(x!==undefined&&!isNaN(x)){dx=x-x0}if(y!==undefined&&!isNaN(y)){dy=y-y0}if(dx!==0||dy!==0){this.moveBy(dx,dy,options,oViewer,oTransitionDef)}},resize:function(width,height,options,oViewer,oTransitionDef){if((!this.isKeepSize||this.width===undefined||this.height===undefined)&&(width!==this.width||height!==this.height)){var oSymbolLayout=this.getOrCreateSymbolLayout(),oldWidth=this.width,oldHeight=this.height,bKeepAspectRatio,bKeepCenter;if(oSymbolLayout){options=options||{};bKeepAspectRatio=options.keepAspectRatio===undefined?this.isKeepAspectRatio:options.keepAspectRatio;bKeepCenter=options.keepCenter===undefined?this.isKeepCenter:options.keepCenter;oSymbolLayout.layoutShape(this,this.shape,width,height,bKeepAspectRatio,bKeepCenter);if(this.isAdjustToContent&&(this.width!==oldWidth||this.height!==oldHeight)){this.isAdjustToContent=false}if(oViewer){this.drawSymbol(oViewer,oTransitionDef)}if(oViewer){this.drawLinkSymbols(oViewer,oTransitionDef)}}}},show:function(oViewer,oTransitionDef){if(this.isHidden){var shape=this.getOrCreateShape();if(shape&&shape.isDrawn){shape.opacity=1;shape.setAllProperties({isVisible:true});if(oViewer){shape.updateDrawing(oViewer,oTransitionDef,["opacity"]);this.showLinkSymbols(oViewer,oTransitionDef)}}this.isHidden=false}},hide:function(oViewer,oTransitionDef){if(!this.isHidden){var shape=this.getOrCreateShape();if(shape&&shape.isDrawn){if(oViewer&&oTransitionDef&&shape.opacity===undefined){shape.opacity=1;shape.updateDrawing(oViewer,undefined,["opacity"])}shape.opacity=0;shape.setAllProperties({isVisible:false});if(oViewer){shape.updateDrawing(oViewer,oTransitionDef,["opacity"]);this.hideLinkSymbols(oViewer,oTransitionDef)}}this.isHidden=true}},highlight:function(oStyleSheet,fnStyleSheetFilter,oViewer,oTransitionDefinition){var oShape=this.shape;if(oShape){return oShape.highlight(oStyleSheet,fnStyleSheetFilter,true,oViewer,oTransitionDefinition)}return false},unhighlight:function(oViewer,oTransitionDefinition){var oShape=this.shape;if(oShape){return oShape.unhighlight(true,oViewer,oTransitionDefinition)}return false},grayOut:function(oViewer,oTransitionDefinition){var oShape=this.shape;if(oShape){return oShape.grayOut(true,oViewer,oTransitionDefinition)}return false},getSubSymbolsBBox:function(fnCustomFilter,bIncludeAllSubSymbols){var aContentSymbols,oRect,i,oSymbol;if(this.isComposite){aContentSymbols=this.contentSymbols;for(i=0;i<aContentSymbols.length;i++){oSymbol=aContentSymbols.get(i);if(!oSymbol.isLinkSymbol){if(fnCustomFilter&&fnCustomFilter.call(this,oSymbol)){if(oRect===undefined){oRect=oSymbol.getSubSymbolsBBox(fnCustomFilter,bIncludeAllSubSymbols)}else{oRect.unionRect(oSymbol.getSubSymbolsBBox(fnCustomFilter,bIncludeAllSubSymbols))}continue}if(oRect===undefined){oRect=oSymbol.getBBox(bIncludeAllSubSymbols)}else{oRect.unionRect(oSymbol.getBBox(bIncludeAllSubSymbols))}if(oSymbol.isComposite){oRect.unionRect(oSymbol.getSubSymbolsBBox(fnCustomFilter,bIncludeAllSubSymbols))}}}}return oRect},getContentAreaBBox:function(){var oRect,oBoundaryMargin;if(this.shape&&this.shape.contentShape&&this.shape.contentShape.contentLayoutRect){oRect=this.shape.contentShape.contentLayoutRect.clone();oBoundaryMargin=this.getBoundarySymbolsMargin();oRect.inflate(-oBoundaryMargin.left,-oBoundaryMargin.top,-oBoundaryMargin.right,-oBoundaryMargin.bottom);oRect.x+=this.x;oRect.y+=this.y;return oRect}return this.getBBox()},drawSubSymbols:function(viewer,oTransitionDef,aAttributes){if(this.isComposite){var aLinkSymbols=[],index,max,oSubSymbol;for(index=0,max=this.symbols.length;index<max;index++){oSubSymbol=this.symbols.get(index);if(oSubSymbol.isLinkSymbol){aLinkSymbols.push(oSubSymbol)}else{oSubSymbol.drawSymbol(viewer,oTransitionDef,aAttributes)}}for(index=0,max=aLinkSymbols.length;index<max;index++){aLinkSymbols[index].drawSymbol(viewer,oTransitionDef,aAttributes)}}},updateSubSymbolsLayout:function(bCanChangeSymbol,viewer,oTransitionDef){if(this.isComposite){var index,max,oSubSymbol;for(index=0,max=this.contentSymbols.length;index<max;index++){oSubSymbol=this.contentSymbols.get(index);oSubSymbol.updateLayout(bCanChangeSymbol,viewer,oTransitionDef)}}},moveSubSymbolsBy:function(dx,dy,options,oViewer,oTransitionDef){if(this.isComposite){var index,max,oSubSymbol;for(index=0,max=this.symbols.length;index<max;index++){oSubSymbol=this.symbols.get(index);if(!oSubSymbol.isLinkSymbol){oSubSymbol.moveBy(dx,dy,options,oViewer,oTransitionDef)}}}},updateBoundarySymbols:function(oOldParentBBox,oNewParentBBox,bMoveLinkSymbols,oViewer,oTransitionDef){if(this.isComposite){var index,max,oBoundarySymbol;for(index=0,max=this.boundarySymbols.length;index<max;index++){oBoundarySymbol=this.boundarySymbols.get(index);this.updateBoundarySymbol(oBoundarySymbol,oOldParentBBox,oNewParentBBox,bMoveLinkSymbols,oViewer,oTransitionDef)}}},updateBoundarySymbol:function(oBoundarySymbol,oOldParentBBox,oNewParentBBox,bMoveLinkSymbols,oViewer,oTransitionDef){if(oBoundarySymbol){var oBoundarySymbolBBox,options={},oNewBBox=this.computeBoundarySymbolBBox(oBoundarySymbol,undefined,oOldParentBBox,oNewParentBBox);if(bMoveLinkSymbols){options.moveLinkSymbols=true}if(oNewBBox!==oBoundarySymbolBBox){oBoundarySymbol.moveTo(oNewBBox.x,oNewBBox.y,options,oViewer,oTransitionDef)}}},computeBoundarySymbolBBox:function(oBoundarySymbol,oBoundarySymbolBBox,oOldParentBBox,oNewParentBBox){var oBoundaryShape,oBoundaryRect,aOldCenter,aCenter,aNewCenter,oPoint,oMatrix;oBoundaryShape=this.getBoundaryShape();if(oBoundaryShape&&(oBoundarySymbol||oBoundarySymbolBBox)){if(oBoundarySymbol&&!oBoundarySymbolBBox){oBoundarySymbolBBox=oBoundarySymbol.getBBox()}aOldCenter=aCenter=oBoundarySymbolBBox.getCenter();if(!oNewParentBBox){oNewParentBBox=this.getBBox()}if(oOldParentBBox&&oNewParentBBox&&!oNewParentBBox.equals(oOldParentBBox)){oMatrix=new sap.galilei.ui.common.Matrix();oMatrix.transformRectangles(oOldParentBBox,oNewParentBBox);oPoint=new sap.galilei.ui.common.Point(aOldCenter);oPoint.matrixTransform(oMatrix);aCenter=[oPoint.x,oPoint.y]}oBoundaryRect=oBoundaryShape.getBBox();if(oNewParentBBox){oBoundaryRect=oBoundaryRect.clone();oBoundaryRect.width=oNewParentBBox.width;oBoundaryRect.height=oNewParentBBox.height}aNewCenter=oBoundaryShape.getClosestPointOnBorder(aCenter,oBoundaryRect,oNewParentBBox);if(aNewCenter&&(aNewCenter[0]!==aOldCenter[0]||aNewCenter[1]!==aOldCenter[1])){oBoundarySymbolBBox=oBoundarySymbolBBox.clone();oBoundarySymbolBBox.setCenter(aNewCenter[0],aNewCenter[1])}if(oBoundarySymbol){oBoundarySymbol.boundaryDirection=oNewParentBBox.getPointDirection(aNewCenter)}}return oBoundarySymbolBBox},getBoundarySymbolsMargin:function(){var oParentBBox=this.getBBox(),index,max,oBoundarySymbol,oBoundaryBBox,vDirection,nWest=0,nEast=0,nNorth=0,nSouth=0;if(this.isComposite){for(index=0,max=this.boundarySymbols.length;index<max;index++){oBoundarySymbol=this.boundarySymbols.get(index);if(oBoundarySymbol.boundaryDirection!==undefined){vDirection=oBoundarySymbol.boundaryDirection}else{oBoundaryBBox=oBoundarySymbol.getBBox();vDirection=oParentBBox.getPointDirection(oBoundaryBBox.getCenter())}switch(vDirection){case sap.galilei.ui.common.LinkDirection.west:nWest=Math.max(nWest,oBoundarySymbol.width/2);break;case sap.galilei.ui.common.LinkDirection.east:nEast=Math.max(nEast,oBoundarySymbol.width/2);break;case sap.galilei.ui.common.LinkDirection.north:nNorth=Math.max(nNorth,oBoundarySymbol.height/2);break;case sap.galilei.ui.common.LinkDirection.south:nSouth=Math.max(nSouth,oBoundarySymbol.height/2);break}}}return{left:nWest,right:nEast,top:nNorth,bottom:nSouth}},getLinkSymbols:function(bIncludeSource,bIncludeTarget){var oRef,aLinks,aLinks2;if(bIncludeSource||bIncludeSource===undefined){oRef=this.classDefinition.getReverseReference(this,"sap.galilei.ui.diagram.LinkSymbol.sourceSymbol");if(oRef&&oRef.values&&oRef.values.length>0){aLinks=oRef.values}}if(bIncludeTarget||bIncludeTarget===undefined){oRef=this.classDefinition.getReverseReference(this,"sap.galilei.ui.diagram.LinkSymbol.targetSymbol");if(oRef&&oRef.values&&oRef.values.length>0){aLinks2=oRef.values}}if(aLinks&&aLinks2){aLinks=aLinks.concat(aLinks2)}else{if(!aLinks&&aLinks2){aLinks=aLinks2}}return aLinks},getSynonymSymbols:function(){var i,oRef,aResult=[];if(this.object){oRef=this.object.classDefinition.getReverseReference(this.object,"sap.galilei.ui.diagram.Symbol.object");if(oRef&&oRef.values&&oRef.values.length>0){for(i=0;i<oRef.values.length;i++){if(oRef.values[i]!==this){aResult.push(oRef.values[i])}}}}return aResult},hasLinkSymbol:function(){var aOutgoings,aIncomings;if(!this.isLinkSymbol){aOutgoings=this.classDefinition.getReverseReference(this,"sap.galilei.ui.diagram.LinkSymbol.sourceSymbol");if(aOutgoings&&aOutgoings.values&&aOutgoings.values.length>0){return true}aIncomings=this.classDefinition.getReverseReference(this,"sap.galilei.ui.diagram.LinkSymbol.targetSymbol");if(aIncomings&&aIncomings.values&&aIncomings.values.length>0){return true}}return false},drawLinkSymbols:function(viewer,oTransitionDef,aAttributes){var oLinks,oLinkSymbol,index;oLinks=this.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=0;index<oLinks.length;index++){oLinkSymbol=oLinks[index];if(oLinkSymbol&&this.diagram===oLinkSymbol.diagram&&oLinkSymbol.targetSymbol!==undefined&&oLinkSymbol.sourceSymbol!==undefined){oLinkSymbol.drawSymbol(viewer,oTransitionDef,aAttributes)}}}},moveLinkSymbolsBy:function(dx,dy,oViewer,oTransitionDef){var aLinks,oLinkSymbol,i,length,aPoints,bPreserveAttachPoints=false;aLinks=this.getLinkSymbols();if(aLinks&&aLinks.length>0){for(i=0,length=aLinks.length;i<length;i++){oLinkSymbol=aLinks[i];if(oLinkSymbol&&oLinkSymbol.points){if(oLinkSymbol.points.length>=2){aPoints=oLinkSymbol.points.clone();if(oLinkSymbol.sourceSymbol===this){aPoints[0][0]+=dx;aPoints[0][1]+=dy}else{if(oLinkSymbol.targetSymbol===this){aPoints[aPoints.length-1][0]+=dx;aPoints[aPoints.length-1][1]+=dy}}oLinkSymbol.points=aPoints;bPreserveAttachPoints=true}oLinkSymbol.isAutomaticRouting=true;oLinkSymbol.updateLinkRouting(bPreserveAttachPoints,oViewer,oTransitionDef)}}}},updateLinkSymbolRoutings:function(oOldBBox,oNewBBox,bIsAutomaticRouting,bIsUpdateLinkRouting,oViewer,oTransitionDef){var aLinks=this.getLinkSymbols(),index,max,oLinkSymbol;if(aLinks){for(index=0,max=aLinks.length;index<max;index++){oLinkSymbol=aLinks[index];oLinkSymbol.isAutomaticRouting=bIsAutomaticRouting;oLinkSymbol.updateLinkRouting(bIsUpdateLinkRouting,oViewer,oTransitionDef)}}},updateLinkSymbolOwners:function(){var i,length,oSymbol,aLinkSymbols;aLinkSymbols=this.getLinkSymbols();if(aLinkSymbols&&aLinkSymbols.length>0){for(i=0,length=aLinkSymbols.length;i<length;i++){aLinkSymbols[i].updateOwner()}}if(this.isComposite){for(i=0,length=this.symbols.length;i<length;i++){oSymbol=this.symbols.get(i);if(oSymbol){oSymbol.updateLinkSymbolOwners()}}}},showLinkSymbols:function(viewer,oTransitionDef){var oLinks,oLinkSymbol,index;oLinks=this.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=0;index<oLinks.length;index++){oLinkSymbol=oLinks[index];oLinkSymbol.show(viewer,oTransitionDef)}}},hideLinkSymbols:function(viewer,oTransitionDef){var oLinks,oLinkSymbol,index;oLinks=this.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=0;index<oLinks.length;index++){oLinkSymbol=oLinks[index];oLinkSymbol.hide(viewer,oTransitionDef)}}},getAttachPoints:function(){if(this.isLinkSymbol){return}var aPoints,oBBox=this.getBBox(),dx=12,dy=12,nHorzPoints=0,nVertPoints=0,index;if(this.isKeepSize){return[[oBBox.x+0.5*oBBox.width,oBBox.y+0.5*oBBox.height],[oBBox.x+0.5*oBBox.width,oBBox.y],[oBBox.x,oBBox.y+0.5*oBBox.height],[oBBox.x+oBBox.width,oBBox.y+0.5*oBBox.height],[oBBox.x+0.5*oBBox.width,oBBox.y+oBBox.height]]}else{if(oBBox.width<48){nHorzPoints=0}else{if(oBBox.width<80){nHorzPoints=1}else{if(oBBox.width<200){nHorzPoints=2}}}if(oBBox.height<48){nVertPoints=0}else{if(oBBox.height<80){nVertPoints=1}else{if(oBBox.height<200){nVertPoints=2}}}aPoints=[[oBBox.x+0.5*oBBox.width,oBBox.y+0.5*oBBox.height],[oBBox.x+0.5*oBBox.width,oBBox.y],[oBBox.x,oBBox.y+0.5*oBBox.height],[oBBox.x+oBBox.width,oBBox.y+0.5*oBBox.height],[oBBox.x+0.5*oBBox.width,oBBox.y+oBBox.height]];for(index=1;index<=nHorzPoints;index++){aPoints.push([oBBox.x+0.5*oBBox.width-dx*index,oBBox.y]);aPoints.push([oBBox.x+0.5*oBBox.width+dx*index,oBBox.y]);aPoints.push([oBBox.x+0.5*oBBox.width-dx*index,oBBox.y+oBBox.height]);aPoints.push([oBBox.x+0.5*oBBox.width+dx*index,oBBox.y+oBBox.height])}for(index=1;index<=nVertPoints;index++){aPoints.push([oBBox.x,oBBox.y+0.5*oBBox.height-dy*index]);aPoints.push([oBBox.x,oBBox.y+0.5*oBBox.height+dy*index]);aPoints.push([oBBox.x+oBBox.width,oBBox.y+0.5*oBBox.height-dy*index]);aPoints.push([oBBox.x+oBBox.width,oBBox.y+0.5*oBBox.height+dy*index])}return aPoints}},getAnchors:function(){var aAnchors=[],oAnchor;oAnchor=sap.galilei.ui.editor.anchor.Anchor.getDefaultAnchor({symbol:this});aAnchors.push(oAnchor);return aAnchors}},statics:{objectClass:{value:undefined},createLayoutTemplate:function(oClassDefinition){var oRuntimeClass,oLayoutTemplate,oSymbolLayout;if(oClassDefinition){oRuntimeClass=oClassDefinition.runtimeClass;if(oRuntimeClass){oLayoutTemplate=oRuntimeClass.layoutTemplate;if(oLayoutTemplate){if(oLayoutTemplate instanceof Array){oSymbolLayout=sap.galilei.ui.symbol.SymbolLayoutSerializer.load(oLayoutTemplate[0])}else{if((typeof oLayoutTemplate)=="object"){oSymbolLayout=sap.galilei.ui.symbol.SymbolLayoutSerializer.load(oLayoutTemplate)}}}}}return oSymbolLayout},getOrCreateSymbolLayout:function(oClassDefinition){var oRuntimeClass,oSymbolLayout;if(oClassDefinition){oRuntimeClass=oClassDefinition.runtimeClass;if(oRuntimeClass){if(!oRuntimeClass.symbolLayout){oRuntimeClass.symbolLayout=sap.galilei.ui.diagram.Symbol.createLayoutTemplate(oClassDefinition)}oSymbolLayout=oRuntimeClass.symbolLayout}}return oSymbolLayout},traverseSubSymbols:function(oSymbol,aResult,escapeCallback){var i;if(!oSymbol||(escapeCallback&&escapeCallback.call(undefined,oSymbol))){return}aResult.push(oSymbol);if(oSymbol.isComposite&&oSymbol.symbols.length>0){for(i=0;i<oSymbol.symbols.length;i++){sap.galilei.ui.diagram.Symbol.traverseSubSymbols(oSymbol.symbols.get(i),aResult,escapeCallback)}}}}},LinkSymbol:{displayName:"Link Symbol",parent:"Symbol",onInitialize:function(oResource,oParam){oParam.isAdjustToContent=false},properties:{points:{dataType:sap.galilei.model.dataTypes.gBlob,defaultValue:undefined,converter:"stringToPointsConverter"},lineStyle:{dataType:sap.galilei.model.dataTypes.gShort,defaultValue:sap.galilei.ui.common.LineStyle.rounded},sourceAttachPoint:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true,get:function(){if(this.points&&this.points.length>=2){return this.points[0]}return undefined},set:function(value){var points=new sap.galilei.ui.common.Points();points.set(this.points);points.splice(0,1,value);this.points=points}},targetAttachPoint:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true,get:function(){if(this.points&&this.points.length>=2){return this.points[this.points.length-1]}return undefined},set:function(value){var points=new sap.galilei.ui.common.Points();points.set(this.points);if(points.length>=2){points.pop();points.push(value)}else{if(points.length===0){points.push(undefined)}points.push(value)}this.points=points}},sourceDirection:{defaultValue:undefined,dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},targetDirection:{defaultValue:undefined,dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true},isAutomaticRouting:{defaultValue:true,dataType:sap.galilei.model.dataTypes.gBool,isInternal:true},isLinkSymbol:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true,isInternal:true},middleArrowShape:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true,defaultValue:undefined},sourceContentShape:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true,defaultValue:undefined},middleContentShape:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true,defaultValue:undefined},targetContentShape:{dataType:sap.galilei.model.dataTypes.gBlob,isInternal:true,defaultValue:undefined}},references:{sourceSymbol:{contentType:"sap.galilei.ui.diagram.Symbol",isMany:false,isContainment:false,onCascadeChange:function(oEventArgs){var oInstance=oEventArgs.instance,oObject=oEventArgs.newObject;if(oObject&&oInstance.updateOwner){oInstance.updateOwner()}}},targetSymbol:{contentType:"sap.galilei.ui.diagram.Symbol",isMany:false,isContainment:false,onCascadeChange:function(oEventArgs){var oInstance=oEventArgs.instance,oObject=oEventArgs.newObject;if(oObject&&oInstance.updateOwner){oInstance.updateOwner()}}}},methods:{createLayoutTemplate:function(){var oLayoutTemplate=sap.galilei.ui.diagram.LinkSymbol.createLayoutTemplate(this.classDefinition);if(!oLayoutTemplate){throw"The layoutTemplate static property should be defined or the createLayoutTemplate() function should be overridden."}return oLayoutTemplate},getOrCreateSymbolLayout:function(){return sap.galilei.ui.diagram.LinkSymbol.getOrCreateSymbolLayout(this.classDefinition)},getLinkShape:function(){var oShape=this.getOrCreateShape();if(oShape&&oShape.shapes.length>0){return oShape.shapes[0]}return oShape},getMainShape:function(){return this.getLinkShape()},updateLinkRouting:function(bPreserveAttachPoints,oViewer,oTransitionDef){var oSymbolLayout;if(this.isAutomaticRouting||!this.points||this.points.length<2){oSymbolLayout=this.getOrCreateSymbolLayout();if(oSymbolLayout){oSymbolLayout.updateLinkRouting(this,bPreserveAttachPoints);if(oViewer){this.drawSymbol(oViewer,oTransitionDef)}}}},drawSymbol:function(oViewer,oTransitionDef,aAttributes){if(this.sourceSymbol&&this.targetSymbol&&this.sourceSymbol.isDrawn&&this.targetSymbol.isDrawn){var oShape=this.getOrCreateShape(),oLinkShape=this.getLinkShape(),oSymbolLayout,aOldPoints,bModified,oEvent={};if(oShape&&oLinkShape){aOldPoints=oLinkShape.points.clone();oSymbolLayout=this.getOrCreateSymbolLayout();if(oSymbolLayout){if(!this.points||this.points.length<2){oSymbolLayout.updateLinkRouting(this,false)}oSymbolLayout.layoutLinkShape(this,oLinkShape)}if(!oShape.isDrawn){if(!oShape.isDisableDrawing){oShape.draw(oViewer,undefined,oTransitionDef)}this.registerEventHandlers()}else{oShape.zindex=this.getShapeZIndex();if(oViewer){bModified=aOldPoints&&!aOldPoints.equals(oLinkShape.points);if(bModified){oEvent.sourceSymbol=this;oEvent.transitionDefinition=oTransitionDef;sap.galilei.core.Event.publish("modify.linksymbol.before",this,undefined,oEvent)}oShape.updateDrawing(oViewer,oTransitionDef,aAttributes);if(bModified){setTimeout(function(){sap.galilei.core.Event.publish("modify.linksymbol.after",oEvent.sourceSymbol,undefined,oEvent)},oTransitionDef?oTransitionDef.duration:0)}}}}}},getShapeZIndex:function(){return -1*sap.galilei.ui.common.ZINDEX_STEP_MINOR},updateOwner:function(){var oOwner=this.getOwner(),oNewOwner,oOldColl;if(!oOwner){return undefined}oOldColl=oOwner.symbols;if(this.sourceSymbol&&this.targetSymbol){oNewOwner=sap.galilei.ui.diagram.LinkSymbol.getLinkSymbolOwner(this.sourceSymbol,this.targetSymbol);if(oNewOwner&&oOwner!==oNewOwner){oOldColl.removeAt(oOldColl.indexOf(this));oNewOwner.symbols.push(this);return oNewOwner}}return oOwner},moveBy:function(dx,dy,options,oViewer,oTransitionDef){var aPoints;if(dx!==undefined&&dy!==undefined&&!isNaN(dx)&&!isNaN(dy)&&this.points){aPoints=this.points.clone();aPoints.moveBy(dx,dy);this.points=aPoints;if(oViewer){this.drawSymbol(oViewer,oTransitionDef)}}},getCenter:function(){var oLinkShape=this.getLinkShape(),aPoints,length,middleIndex,bOdd;if(oLinkShape!==undefined){aPoints=oLinkShape.points;length=aPoints.length;if(length>1){bOdd=length%2===0?false:true;middleIndex=Math.ceil(length/2)-1;if(bOdd){return aPoints[middleIndex]}else{return[(aPoints[middleIndex][0]+aPoints[middleIndex+1][0])/2,(aPoints[middleIndex][1]+aPoints[middleIndex+1][1])/2]}}}},getBBox:function(bIncludeAllSubSymbols){if(this.points){return this.points.getBBox()}return new sap.galilei.ui.common.Rect()}},statics:{createLayoutTemplate:function(oClassDefinition){var oRuntimeClass,oLayoutTemplate;if(oClassDefinition){oRuntimeClass=oClassDefinition.runtimeClass;if(oRuntimeClass&&oRuntimeClass.layoutTemplate){oLayoutTemplate=sap.galilei.ui.symbol.LinkSymbolLayoutSerializer.load(oRuntimeClass.layoutTemplate)}}return oLayoutTemplate},getOrCreateSymbolLayout:function(oClassDefinition){var oRuntimeClass,oSymbolLayout;if(oClassDefinition){oRuntimeClass=oClassDefinition.runtimeClass;if(oRuntimeClass){if(!oRuntimeClass.symbolLayout){oRuntimeClass.symbolLayout=sap.galilei.ui.diagram.LinkSymbol.createLayoutTemplate(oClassDefinition)}oSymbolLayout=oRuntimeClass.symbolLayout}}return oSymbolLayout},getLinkSymbolOwner:function(oSourceSymbol,oTargetSymbol){var oSourceOwner,oTargetOwner;if(oSourceSymbol&&oTargetSymbol){oTargetOwner=oTargetSymbol.getOwner();while(oTargetOwner){oSourceOwner=oSourceSymbol.getOwner();while(oSourceOwner){if((oSourceOwner===oTargetOwner)&&(!oSourceOwner.isSwimlaneSymbol||oSourceOwner.isLeafSwimlaneSymbol)){return oSourceOwner}oSourceOwner=oSourceOwner.getOwner()}oTargetOwner=oTargetOwner.getOwner()}return oSourceSymbol.diagram}}}},SwimlaneSymbol:{displayName:"Swimlane Symbol",parent:"Symbol",properties:{orientation:{dataType:sap.galilei.model.dataTypes.gString,defaultValue:sap.galilei.ui.symbol.Orientation.DEFAULT},isVertical:{get:function(){return this.orientation===sap.galilei.ui.symbol.Orientation.vertical}},length:{get:function(){return this.orientation===sap.galilei.ui.symbol.Orientation.vertical?this.height:this.width},set:function(value){if(this.orientation===sap.galilei.ui.symbol.Orientation.vertical){this.height=value}else{this.width=value}}},size:{get:function(){return this.orientation===sap.galilei.ui.symbol.Orientation.vertical?this.width:this.height},set:function(value){if(this.orientation===sap.galilei.ui.symbol.Orientation.vertical){this.width=value}else{this.height=value}}},isSwimlaneSymbol:{get:function(){return true}},isLeafSwimlaneSymbol:{get:function(){return this.symbols.length===0||!this.symbols.get(0).isSwimlaneSymbol}},isRootSwimlaneSymbol:{get:function(){return !this.parentSymbol||!this.parentSymbol.isSwimlaneSymbol}}},methods:{layoutSwimlanes:function(sLayoutSwimlaneDirection,viewer,oTransitionDef){var i,oSubSymbol,dCurrentPos,dSize=0,dSubSize,oContentAreaBBox,dSubLength,dHeaderLength,bSubSymbolMoved;if(!sLayoutSwimlaneDirection){sLayoutSwimlaneDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT}if(this.symbols===undefined){return}this.updateLayout(true,viewer,oTransitionDef);if(this.symbols.length>0){oContentAreaBBox=this.getContentAreaBBox();dHeaderLength=this.isVertical?oContentAreaBBox.top-this.y:oContentAreaBBox.left-this.x;dSubLength=this.length-dHeaderLength;if(sLayoutSwimlaneDirection!==sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis){dCurrentPos=this.isVertical?oContentAreaBBox.left:oContentAreaBBox.top;for(i=0;i<this.symbols.length;i++){oSubSymbol=this.symbols.get(i);if(oSubSymbol.isSwimlaneSymbol){if(this.isVertical){oSubSymbol.moveTo(dCurrentPos,oContentAreaBBox.top,undefined,viewer,oTransitionDef);oSubSymbol.length=dSubLength;oSubSymbol.layoutSwimlanes(sLayoutSwimlaneDirection,viewer,oTransitionDef);dSubSize=oSubSymbol.size}else{oSubSymbol.moveTo(oContentAreaBBox.left,dCurrentPos,undefined,viewer,oTransitionDef);oSubSymbol.length=dSubLength;oSubSymbol.layoutSwimlanes(sLayoutSwimlaneDirection,viewer,oTransitionDef);dSubSize=oSubSymbol.size}if(dSubSize>0){dSize+=dSubSize;dCurrentPos+=dSubSize}}}}else{dCurrentPos=this.isVertical?oContentAreaBBox.right:oContentAreaBBox.bottom;for(i=this.symbols.length-1;i>=0;i--){oSubSymbol=this.symbols.get(i);if(oSubSymbol.isSwimlaneSymbol){if(this.isVertical){oSubSymbol.length=dSubLength;oSubSymbol.layoutSwimlanes(sLayoutSwimlaneDirection,viewer,oTransitionDef);dSubSize=oSubSymbol.size;oSubSymbol.moveTo(dCurrentPos-dSubSize,oContentAreaBBox.top,undefined,viewer,oTransitionDef);bSubSymbolMoved=true}else{oSubSymbol.length=dSubLength;oSubSymbol.layoutSwimlanes(sLayoutSwimlaneDirection,viewer,oTransitionDef);dSubSize=oSubSymbol.size;oSubSymbol.moveTo(oContentAreaBBox.left,dCurrentPos-dSubSize,undefined,viewer,oTransitionDef);bSubSymbolMoved=true}if(dSubSize>0){dSize+=dSubSize;dCurrentPos-=dSubSize}}}if(bSubSymbolMoved){if(this.isVertical){this.moveTo(dCurrentPos,this.y,{moveSubSymbols:this.isLeafSwimlaneSymbol},viewer,oTransitionDef)}else{this.moveTo(this.x,dCurrentPos,{moveSubSymbols:this.isLeafSwimlaneSymbol},viewer,oTransitionDef)}}}if(dSize>0){this.size=dSize}}this.updateLayout(true,viewer,oTransitionDef)},getContentAreaBBox:function(){var oRect,marginLeft,marginRight,marginTop,marginBottom;if(this.shape&&this.shape.contentShape&&this.shape.contentShape.contentLayoutRect){oRect=this.shape.contentShape.contentLayoutRect.clone();if(!this.isLeafSwimlaneSymbol){marginLeft=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginLeft,0);marginRight=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginRight,0);marginTop=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginTop,0);marginBottom=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginBottom,0);oRect.inflate(marginLeft,marginTop,marginRight,marginBottom)}oRect.x+=this.x;oRect.y+=this.y;return oRect}return this.getBBox()},getHeaderAreaBBox:function(){var oRect,oBBox=this.getBBox(),marginLeft,marginRight,marginTop,marginBottom;if(this.shape&&this.shape.contentShape&&this.shape.contentShape.contentLayoutRect){oRect=this.shape.contentShape.contentLayoutRect.clone();marginLeft=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginLeft,0);marginRight=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginRight,0);marginTop=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginTop,0);marginBottom=sap.galilei.core.validateNumeric(this.shape.contentShape.contentMarginBottom,0);if(this.isVertical){oBBox.height-=(oRect.height+marginTop+marginBottom)}else{oBBox.width-=(oRect.width+marginLeft+marginRight)}}return oBBox},getLeafSwimlanes:function(aSwimlanes,bReverse){var i,oSubSymbol;aSwimlanes=aSwimlanes||[];if(this.isSwimlaneSymbol&&this.symbols.length>0&&!this.isLeafSwimlaneSymbol){if(bReverse){for(i=this.symbols.length-1;i>=0;i--){oSubSymbol=this.symbols.get(i);if(oSubSymbol.isLeafSwimlaneSymbol){aSwimlanes.push(oSubSymbol)}if(!oSubSymbol.getLeafSwimlanes){continue}oSubSymbol.getLeafSwimlanes(aSwimlanes,bReverse)}}else{for(i=0;i<this.symbols.length;i++){oSubSymbol=this.symbols.get(i);if(oSubSymbol.isLeafSwimlaneSymbol){aSwimlanes.push(oSubSymbol)}if(!oSubSymbol.getLeafSwimlanes){continue}oSubSymbol.getLeafSwimlanes(aSwimlanes,bReverse)}}}},extendToContent:function(options,edgeOption,oViewer,oTransitionDef){var sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT;options=options||{};if(this.isRootSwimlaneSymbol&&!this.isLeafSwimlaneSymbol){this.defaultExtendToContent(undefined,edgeOption,oViewer,oTransitionDef);if(this.isVertical){if((edgeOption&sap.galilei.ui.symbol.EdgeType.LEFT)!==0){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis}}else{if((edgeOption&sap.galilei.ui.symbol.EdgeType.TOP)!==0){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis}}this.layoutSwimlanes(sLayoutDirection,oViewer,oTransitionDef);if(this.parentSymbol){this.parentSymbol.extendToContent(options,edgeOption,oViewer,oTransitionDef)}}else{this.defaultExtendToContent(options,edgeOption,oViewer,oTransitionDef)}},drawSymbol:function(oViewer,oTransitionDef,aAttributes){var shape=this.getOrCreateShape(),bNeedLayout=false,bMoved=false,bResized=false,oEvent={};if(this.parentSymbol&&(!this.parentSymbol.shape||!this.parentSymbol.shape.isDrawn)){return}if(shape){if(!shape.isDrawn){shape.draw(oViewer,undefined,oTransitionDef);this.registerEventHandlers();shape._oldWidth=this.width;shape._oldHeight=this.height;bNeedLayout=true}else{if(shape.x!==this.x||shape.y!==this.y){shape.x=this.x;shape.y=this.y;bMoved=true}if(shape._oldWidth!==this.width||shape._oldHeight!==this.height){this.updateLayout(false);shape._oldWidth=this.width;shape._oldHeight=this.height;bResized=true}shape.zindex=this.getShapeZIndex();if(oViewer){if(bMoved||bResized){oEvent.sourceSymbol=this;oEvent.transitionDefinition=oTransitionDef;sap.galilei.core.Event.publish(bResized?"resize.symbol.before":"move.symbol.before",this,undefined,oEvent)}shape.updateDrawing(oViewer,oTransitionDef,aAttributes);if(bMoved||bResized){setTimeout(function(){sap.galilei.core.Event.publish(bResized?"resize.symbol.after":"move.symbol.after",oEvent.sourceSymbol,undefined,oEvent)},oTransitionDef?oTransitionDef.duration:0)}}}}if(this.isComposite){this.drawSubSymbols(oViewer,oTransitionDef,aAttributes)}if(bNeedLayout&&this.isRootSwimlaneSymbol){}}},statics:{getRootSwimlaneSymbol:function(oSymbol){var oParentSymbol=oSymbol,oRootSwimlane;while(oParentSymbol){if(oParentSymbol.isSwimlaneSymbol){oRootSwimlane=oParentSymbol}oParentSymbol=oParentSymbol.parentSymbol}return oRootSwimlane}}},PackageSymbol:{onInitialize:function(oResource,oParam){oParam.isAdjustToContent=false},displayName:"Package Symbol",parent:"Symbol",statics:{layoutTemplate:{mainShape:{shape:"Package",domClass:"package",stroke:"#997C35",strokeWidth:1,fill:"#FFFFD6",width:70,height:60,minWidth:70,minHeight:60},contentShape:{shape:"Stack",horizontalAlignment:"width",verticalAlignment:"height",innerPadding:0,shapes:{shape:"Text",marginTop:8,text:"{object/displayName}",font:"14px Calibri",fill:"black",horizontalAlignment:"width",verticalAlignment:"height",isWordWrap:true}}}}},Diagram:{displayName:"Diagram",properties:{name:{dataType:sap.galilei.model.dataTypes.gString},isDiagram:{dataType:sap.galilei.model.dataTypes.gBool,defaultValue:true,isInternal:true}},references:{model:{contentType:"sap.galilei.model.Object",reverseReference:"sap.galilei.common.Model.diagrams",isMany:false},"Diagram.symbols":{name:"symbols",contentType:"sap.galilei.ui.diagram.Symbol",isMany:true,isContainment:true,onCascadeChange:function(oEventArgs){var oObject=oEventArgs.newObject,sChangeType=oEventArgs.eventType;if(sChangeType==="referenceAdd"){if(oObject&&oObject.updateLinkSymbolOwners){oObject.updateLinkSymbolOwners()}}}}},methods:{defaultDispose:function(){var index,oSymbol;if(this.symbols){for(index=0;index<this.symbols.length;index++){oSymbol=this.symbols.get(index);oSymbol.dispose()}}},dispose:function(){this.defaultDispose()},getOwner:function(){return null},_getAllSubsymbols:function(oSymbols,aSymbols){var oSymbol,index,max;if(oSymbols&&aSymbols){for(index=0,max=oSymbols.length;index<max;index++){oSymbol=oSymbols.get(index);aSymbols.push(oSymbol);if(oSymbol.isComposite){this._getAllSubsymbols(oSymbol.symbols,aSymbols)}}}},getAllSymbols:function(){var aSymbols=[];this._getAllSubsymbols(this.symbols,aSymbols);return aSymbols},_getDisplayedObjectsMap:function(oSymbols,oObjectsMap){var oSymbol,index,max;if(oSymbols&&oObjectsMap){for(index=0,max=oSymbols.length;index<max;index++){oSymbol=oSymbols.get(index);if(oSymbol.object&&oSymbol.object.objectId){oObjectsMap[oSymbol.object.objectId]=oSymbol.object}if(oSymbol.isComposite){this._getDisplayedObjectsMap(oSymbol.symbols,oObjectsMap)}}}},getDisplayedObjects:function(){var aObjects=[],oObjectsMap={},sId;this._getDisplayedObjectsMap(this.symbols,oObjectsMap);for(sId in oObjectsMap){if(oObjectsMap.hasOwnProperty(sId)){aObjects.push(oObjectsMap[sId])}}return aObjects}}}}}}});
"use strict";sap.galilei.model.loadMetamodels();sap.galilei.model.metamodelExtension("Galilei.Core.SymbolExtension",{contents:{Object:{name:"Object",references:{relatedSymbols:{name:"relatedSymbols",contentType:"sap.galilei.ui.diagram.Symbol",isMany:true,reverseReference:"sap.galilei.ui.diagram.Symbol.object"}}}}});sap.galilei.model.loadMetamodelExtension("Galilei.Core.SymbolExtension",sap.galilei.model.internal.galileiM3Resource);
namespace("sap.galilei.ui.symbol.binding");
"use strict";sap.galilei.ui.symbol.binding.PropertyBinding=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.binding.PropertyBinding,fullClassName:"sap.galilei.ui.symbol.binding.PropertyBinding",properties:{symbol:undefined},methods:{getObjectProperty:function(){var aParts,oObject,index,sPath,sBindingPath,bRelative=true,formatter,oFormatterContext,vValue,sValue;if(this.objectContext&&(this.path||this.formatter)){oObject=this.objectContext;sBindingPath=this.path;if(sBindingPath&&sBindingPath.length>0&&sBindingPath[0]==="/"){bRelative=false;sBindingPath=sBindingPath.slice(1,sBindingPath.length)}aParts=sBindingPath.split("/");if(aParts.length>1){for(index=0;index<aParts.length-1;index++){sPath=aParts[index];oObject=oObject[sPath];if(!oObject){break}}if(oObject){sBindingPath=aParts[aParts.length-1]}else{return undefined}}formatter=this.formatter;oFormatterContext=this.symbol;if(!formatter&&this.type&&this.type.formatValue){formatter=this.type.formatValue;oFormatterContext=this.type}if(formatter&&this.symbol){if((typeof formatter==="string")&&this.symbol.runtimeClass&&this.symbol.runtimeClass.formatters){formatter=this.symbol.runtimeClass.formatters[formatter]}if(typeof formatter==="function"){if(!sBindingPath||sBindingPath.length===0){return formatter.call(oFormatterContext,undefined,oObject,this.symbol)}else{return formatter.call(oFormatterContext,oObject[sBindingPath],oObject,this.symbol)}}else{if((typeof formatter==="object")&&sBindingPath){vValue=oObject[sBindingPath];if(vValue){sValue=vValue.toString();if(formatter.hasOwnProperty(sValue)){return formatter[sValue]}}if(formatter.hasOwnProperty("DEFAULT")){return formatter.DEFAULT}return undefined}}}return oObject[sBindingPath]}return undefined},registerPropertyChangedListener:function(){var oBinding=this,aParts,oObject,index,sPath,bRelative=true,sBindingPath;if(this.objectContext&&this.path){oObject=this.objectContext;sBindingPath=this.path;if(sBindingPath&&sBindingPath.length>0&&sBindingPath[0]==="/"){bRelative=false;sBindingPath=sBindingPath.slice(1,sBindingPath.length)}aParts=sBindingPath.split("/");if(aParts.length>=1){for(index=0;index<aParts.length;index++){sPath=aParts[index];if(oObject instanceof sap.galilei.model.Object){oObject.addPropertyListener({onPropertyChanged:this.onPropertyChanged,optionalArguments:{binding:this}},sPath)}if(index<aParts.length-1){oObject=oObject[sPath];if(!oObject){break}}}}}},unregisterPropertyChangedListener:function(){var aParts,oObject,index,sPath,bRelative=true,sBindingPath;if(this.objectContext&&this.path&&this._onPropertyChanged){oObject=this.objectContext;sBindingPath=this.path;if(sBindingPath&&sBindingPath.length>0&&sBindingPath[0]==="/"){bRelative=false;sBindingPath=sBindingPath.slice(1,sBindingPath.length)}aParts=sBindingPath.split("/");if(aParts.length>=1){for(index=0;index<aParts.length;index++){sPath=aParts[index];if(oObject instanceof sap.galilei.model.Object){oObject.removePropertyListener({onPropertyChanged:this.onPropertyChanged},sPath)}if(index<aParts.length-1){oObject=oObject[sPath];if(!oObject){break}}}}}},onPropertyChanged:function(oEventArgs){var oBinding,vNewValue,oEvent;if(oEventArgs){oBinding=oEventArgs.binding;if(oBinding&&oBinding.objectContext){vNewValue=oBinding.getObjectProperty();if(oBinding.symbol&&oBinding.symbol.shape){if(oBinding.shape&&oBinding.propertyName){oBinding.setShapeProperty(vNewValue);if(oBinding.symbol.shape.isDrawn){if(!sap.galilei.model.isInUndoRedo()){oBinding.symbol.updateSymbol();oEvent={sourceSymbol:oBinding.symbol};sap.galilei.core.Event.publish("update.symbol",this,undefined,oEvent)}else{oBinding.symbol.updateLayout(false)}}}}}}},dispose:function(){this.unregisterPropertyChangedListener();this.removeBinding()}}});
"use strict";sap.galilei.ui.symbol.SymbolLayout=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.symbol.SymbolLayout",fields:{_symbol:undefined,_object:undefined},properties:{displayMode:sap.galilei.ui.common.ShapeLayoutModes.detail,zoomScale:undefined,minimumZoomScale:undefined,maximumZoomScale:undefined,mainShape:undefined,contentShape:undefined,objectContext:{get:function(){return this._object}}},methods:{createShape:function(oSymbol){var oGroupShape,oMainShape,oContentShape,layoutRect=new sap.galilei.ui.common.Rect(),width,height;this._symbol=oSymbol;this._object=oSymbol;oGroupShape=new sap.galilei.ui.common.shape.ContentGroup({domClass:"nodeGroup"});if(oSymbol){oGroupShape.id=oSymbol.objectId;oGroupShape.displayMode=oSymbol.displayMode;oGroupShape.isAdjustToContent=oSymbol.isAdjustToContent;oGroupShape.zindex=oSymbol.getShapeZIndex()}else{oGroupShape.displayMode=this.displayMode}if(this.mainShape){oMainShape=this.replaceBinding(this.mainShape);if(oMainShape){oGroupShape.shapes.add(oMainShape);oGroupShape.mainShape=oMainShape}}if(this.contentShape){oContentShape=this.replaceBinding(this.contentShape);if(oContentShape){oGroupShape.shapes.add(oContentShape);oGroupShape.contentShape=oContentShape}}layoutRect.x=0;layoutRect.y=0;if(oSymbol&&oSymbol.width!==undefined&&oSymbol.width!==0){layoutRect.width=oSymbol.width}else{layoutRect.width=oGroupShape.boundaryShape.width}if(oSymbol&&oSymbol.height!==undefined&&oSymbol.height!==0){layoutRect.height=oSymbol.height}else{layoutRect.height=oGroupShape.boundaryShape.height}layoutRect=oGroupShape.layout(layoutRect,false);width=layoutRect.width;height=layoutRect.height;if(oSymbol&&oSymbol.width!==undefined&&oSymbol.width!==0){width=oSymbol.width}if(oSymbol&&oSymbol.height!==undefined&&oSymbol.height!==0){height=oSymbol.height}layoutRect.width=width;layoutRect.height=height;layoutRect=oGroupShape.layout(layoutRect,true);if(oSymbol&&oSymbol.x!==undefined&&oSymbol.y!==undefined&&(oSymbol.x!==0||oSymbol.y!==0)){oGroupShape.x=oSymbol.x;oGroupShape.y=oSymbol.y}if(oSymbol&&(oSymbol.width===undefined||oSymbol.width===0||oSymbol.height===undefined||oSymbol.height===0)){oSymbol.width=layoutRect.width;oSymbol.height=layoutRect.height}this._symbol=undefined;this._object=undefined;return oGroupShape},layoutShape:function(oSymbol,oShape,nNewWidth,nNewHeight,bKeepAspectRatio,bKeepCenter,bCanChangeSymbol){if(oSymbol&&oShape&&nNewWidth!==undefined&&nNewHeight!==undefined){var layoutRect=new sap.galilei.ui.common.Rect(),dx=0,dy=0;bKeepAspectRatio=bKeepAspectRatio===undefined?oSymbol.isKeepAspectRatio:bKeepAspectRatio;bKeepCenter=bKeepCenter===undefined?oSymbol.isKeepCenter:bKeepCenter;bCanChangeSymbol=bCanChangeSymbol===undefined?true:bCanChangeSymbol;layoutRect.x=0;layoutRect.y=0;layoutRect.width=oSymbol.width;layoutRect.height=oSymbol.height;layoutRect.resize(nNewWidth,nNewHeight,false,bKeepAspectRatio,bKeepCenter);dx=layoutRect.x;dy=layoutRect.y;nNewWidth=layoutRect.width;nNewHeight=layoutRect.height;if(nNewWidth!==this.width||nNewHeight!==this.height){oShape.isAdjustToContent=false}layoutRect.x=0;layoutRect.y=0;layoutRect=oShape.layout(layoutRect,false);layoutRect.x=0;layoutRect.y=0;layoutRect.width=nNewWidth;layoutRect.height=nNewHeight;layoutRect=oShape.layout(layoutRect,true);if(bCanChangeSymbol){if(oSymbol.width!==nNewWidth){oSymbol.width=nNewWidth}if(oSymbol.height!==nNewHeight){oSymbol.height=nNewHeight}if(dx!==0||dy!==0){oSymbol.moveBy(dx,dy)}}}},replaceBinding:function(oShape){if(oShape){var sProperty,vValue,oBindingProperties,oParam={},oCloneShape,oBinding,oBindings={};for(sProperty in oShape){if(oShape.hasOwnProperty(sProperty)&&sProperty!=="_shapes"&&sProperty!=="_bindings"){vValue=oShape[sProperty];oParam[sProperty]=(vValue instanceof sap.galilei.ui.common.Points)?vValue.clone():vValue}}for(sProperty in oShape.bindings){if(sap.galilei.core.hasProperty(oShape,sProperty)&&sProperty!=="shapes"){oBindingProperties=oShape.bindings[sProperty];vValue=undefined;if(this.objectContext&&oBindingProperties){if(this._symbol&&(oBindingProperties.path||oBindingProperties.formatter)){oBinding=new sap.galilei.ui.symbol.binding.PropertyBinding({objectContext:this.objectContext,propertyName:sProperty,path:oBindingProperties.path,formatter:oBindingProperties.formatter,type:oBindingProperties.type,symbol:this._symbol});vValue=oBinding.getObjectProperty();oBindings[sProperty]=oBinding}}oParam[sProperty]=(vValue instanceof sap.galilei.ui.common.Points)?vValue.clone():vValue}}oCloneShape=sap.galilei.ui.common.shape.ShapeRegistry.createShape(oShape.name,oParam);if(oShape.shapes.length>0){this.replaceChildBindings(oCloneShape,oShape)}for(sProperty in oBindings){oBinding=oBindings[sProperty];oBinding.shape=oCloneShape;oBinding.registerPropertyChangedListener()}if(sap.galilei.core.hasObjects(oBindings)){oCloneShape.bindings=oBindings}if(oShape.name==="Stack"&&oCloneShape.shapes.length===0){return undefined}return oCloneShape}return undefined},replaceChildBindings:function(oCloneShape,oShape){if(oCloneShape&&oShape){var iShape,oCloneSubShape;for(iShape=0;iShape<oShape.shapes.length;iShape++){oCloneSubShape=this.replaceBinding(oShape.shapes[iShape]);if(oCloneSubShape){oCloneShape.shapes.add(oCloneSubShape)}}}return oCloneShape}}});
"use strict";sap.galilei.ui.symbol.LinkSymbolLayout=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.symbol.LinkSymbolLayout",parent:sap.galilei.ui.symbol.SymbolLayout,properties:{linkShape:undefined,sourceArrow:undefined,middleArrow:undefined,targetArrow:undefined,sourceContent:undefined,middleContent:undefined,targetContent:undefined},methods:{createShape:function(oSymbol){if(oSymbol&&oSymbol.sourceSymbol&&oSymbol.targetSymbol){var oGroup,oLink,oMiddleArrow,oSourceContent,oMiddleContent,oTargetContent;this._symbol=oSymbol;this._object=oSymbol;oGroup=new sap.galilei.ui.common.shape.Group({id:this._symbol.objectId,domClass:"linkGroup",zindex:oSymbol.getShapeZIndex()});if(this.linkShape){oLink=this.replaceBinding(this.linkShape);if(oLink){oGroup.shapes.add(oLink)}}if(this.middleArrow){oMiddleArrow=this.replaceBinding(this.middleArrow);if(oMiddleArrow){oGroup.shapes.add(oMiddleArrow);oSymbol.middleArrowShape=oMiddleArrow}}if(this.sourceContent){oSourceContent=this.replaceBinding(this.sourceContent);if(oSourceContent){oGroup.shapes.add(oSourceContent);oSymbol.sourceContentShape=oSourceContent}}if(this.middleContent){oMiddleContent=this.replaceBinding(this.middleContent);if(oMiddleContent){oGroup.shapes.add(oMiddleContent);oSymbol.middleContentShape=oMiddleContent}}if(this.targetContent){oTargetContent=this.replaceBinding(this.targetContent);if(oTargetContent){oGroup.shapes.add(oTargetContent);oSymbol.targetContentShape=oTargetContent}}this._symbol=undefined;this._object=undefined;return oGroup}return undefined},calculateLinkDirections:function(oLinkSymbol,oSourceSymbol,oTargetSymbol,vSourceAttachPoint,vTargetAttachPoint){function initWeight(oWeights){oWeights[sap.galilei.ui.common.LinkDirection.south]=0;oWeights[sap.galilei.ui.common.LinkDirection.west]=0;oWeights[sap.galilei.ui.common.LinkDirection.north]=0;oWeights[sap.galilei.ui.common.LinkDirection.east]=0}function getDirectionBySlope(aPoint1,aPoint2){var xDistance,yDistance,south=sap.galilei.ui.common.LinkDirection.south,west=sap.galilei.ui.common.LinkDirection.west,north=sap.galilei.ui.common.LinkDirection.north,east=sap.galilei.ui.common.LinkDirection.east;if(!aPoint1||!aPoint2){return undefined}xDistance=aPoint2[0]-aPoint1[0];yDistance=aPoint2[1]-aPoint1[1];if(xDistance>=0){if(yDistance>=0){return(yDistance>=xDistance)?[south,east]:[east,south]}else{return(Math.abs(yDistance)>=xDistance)?[north,east]:[east,north]}}else{if(yDistance>=0){return(yDistance>=Math.abs(xDistance))?[south,west]:[west,south]}else{return(Math.abs(yDistance)>=Math.abs(xDistance))?[north,west]:[west,north]}}}function getEdgeDistanceRatio(oRect,aPoint,bSource){var south,west,north,east,onEdges=[];if(oRect&&aPoint&&oRect.width>0&&oRect.height>0){south=Math.abs(aPoint[1]-(oRect.y+oRect.height));west=Math.abs(aPoint[0]-oRect.x);north=Math.abs(aPoint[1]-oRect.y);east=Math.abs(aPoint[0]-(oRect.x+oRect.width));if(south<3){onEdges.push(sap.galilei.ui.common.LinkDirection.south)}if(west<3){onEdges.push(sap.galilei.ui.common.LinkDirection.west)}if(north<3){onEdges.push(sap.galilei.ui.common.LinkDirection.north)}if(east<3){onEdges.push(sap.galilei.ui.common.LinkDirection.east)}return onEdges}}function getMaxWeightDirection(oWeights){var maxWeight,maxDirection,sKey;for(sKey in oWeights){if(maxWeight===undefined||maxWeight<oWeights[sKey]){maxWeight=oWeights[sKey];maxDirection=sKey}}return parseInt(maxDirection)}var aSourceAttachPoint=sap.galilei.ui.common.Point.getPointArray(vSourceAttachPoint),aTargetAttachPoint=sap.galilei.ui.common.Point.getPointArray(vTargetAttachPoint),oSourceBBox=oSourceSymbol.getBBox(),oTargetBBox=oTargetSymbol.getBBox(),oSourceWeight={},oTargetWeight={},result,directions,i;initWeight(oSourceWeight);initWeight(oTargetWeight);if(sap.galilei.ui.common.LinkDirection.verify(oLinkSymbol.sourceDirection)){oSourceWeight[oLinkSymbol.sourceDirection]+=4}if(sap.galilei.ui.common.LinkDirection.verify(oLinkSymbol.targetDirection)){oTargetWeight[oLinkSymbol.targetDirection]+=4}directions=getDirectionBySlope(aSourceAttachPoint,aTargetAttachPoint);if(directions&&directions.length===2){oSourceWeight[directions[0]]+=0.5;oSourceWeight[directions[1]]+=0.3;oTargetWeight[sap.galilei.ui.common.LinkDirection.opposite(directions[0])]+=0.5;oTargetWeight[sap.galilei.ui.common.LinkDirection.opposite(directions[1])]+=0.3}result=getEdgeDistanceRatio(oSourceBBox,aSourceAttachPoint,true);if(result&&result.length>0){for(i=0;i<result.length;i++){oSourceWeight[result[i]]+=2}}result=getEdgeDistanceRatio(oTargetBBox,aTargetAttachPoint,false);if(result&&result.length>0){for(i=0;i<result.length;i++){oTargetWeight[result[i]]+=2}}return{source:getMaxWeightDirection(oSourceWeight),target:getMaxWeightDirection(oTargetWeight)}},updateLinkRouting:function(oSymbol,bPreserveAttachPoints){var aSourceEdgePt,aTargetEdgePt,oSourceSymbol,oTargetSymbol,aSourceAttachPt,aTargetAttachPt,oSourceBoundaryShape,oTargetBoundaryShape,oSourceRect,oTargetRect,aSymbolPoints,aNewPoints,aLinkPoints,oDirections;function computeEdgePoint(aPoint,direction,oShape,oParentRect){var oSegment,aTempPoint;if(oShape){switch(direction){case sap.galilei.ui.common.LinkDirection.south:aTempPoint=[aPoint[0],oParentRect.bottom+50];break;case sap.galilei.ui.common.LinkDirection.north:aTempPoint=[aPoint[0],oParentRect.top-50];break;case sap.galilei.ui.common.LinkDirection.west:aTempPoint=[oParentRect.left-50,aPoint[1]];break;case sap.galilei.ui.common.LinkDirection.east:aTempPoint=[oParentRect.right+50,aPoint[1]];break}if(aTempPoint){oSegment=new sap.galilei.ui.common.Segment(aPoint,aTempPoint);return oShape.getIntersection(oSegment,oParentRect)}}}function setBoundarySymbolAttachPoint(oLinkSymbol,oBoundarySymbol){if(oLinkSymbol&&oBoundarySymbol&&oBoundarySymbol.isBoundarySymbol&&oBoundarySymbol.parentSymbol){var oBoundaryBBox=oBoundarySymbol.getBBox(),oParentBBox=oBoundarySymbol.parentSymbol.getBBox(),vDirection=oParentBBox.getPointDirection(oBoundaryBBox.getCenter()),aPoint;vDirection=sap.galilei.ui.common.LinkDirection.toDockPosition(vDirection);aPoint=oBoundaryBBox.getPoint(vDirection);if(aPoint){if(oBoundarySymbol===oLinkSymbol.sourceSymbol){oLinkSymbol.sourceAttachPoint=aPoint}else{oLinkSymbol.targetAttachPoint=aPoint}}}}if(oSymbol&&oSymbol.isLinkSymbol&&oSymbol.sourceSymbol&&oSymbol.targetSymbol){oSourceSymbol=oSymbol.sourceSymbol;oTargetSymbol=oSymbol.targetSymbol;if(oSourceSymbol.isBoundarySymbol){setBoundarySymbolAttachPoint(oSymbol,oSourceSymbol)}if(oTargetSymbol.isBoundarySymbol){setBoundarySymbolAttachPoint(oSymbol,oTargetSymbol)}if(bPreserveAttachPoints&&oSymbol.points&&oSymbol.points.length>=2){aSourceAttachPt=oSymbol.sourceAttachPoint;aTargetAttachPt=oSymbol.targetAttachPoint}else{aSourceAttachPt=oSourceSymbol.getCenter();aTargetAttachPt=oTargetSymbol.getCenter()}if(!aSourceAttachPt||!aTargetAttachPt){return}oSourceBoundaryShape=oSourceSymbol.getBoundaryShape();oTargetBoundaryShape=oTargetSymbol.getBoundaryShape();if(!oSourceBoundaryShape||!oTargetBoundaryShape){return}oSourceRect=oSourceSymbol.getBBox();oTargetRect=oTargetSymbol.getBBox();oDirections=this.calculateLinkDirections(oSymbol,oSourceSymbol,oTargetSymbol,aSourceAttachPt,aTargetAttachPt);if(oDirections&&oDirections.source!==undefined&&oDirections.target!==undefined){aSourceEdgePt=computeEdgePoint(aSourceAttachPt,oDirections.source,oSourceBoundaryShape,oSourceRect)||aSourceAttachPt;aTargetEdgePt=computeEdgePoint(aTargetAttachPt,oDirections.target,oTargetBoundaryShape,oTargetRect)||aTargetAttachPt;aSymbolPoints=new sap.galilei.ui.common.Points();aSymbolPoints.set([aSourceAttachPt,aTargetAttachPt]);aLinkPoints=sap.galilei.ui.common.layout.PointsLayout.routeLinkPoints(aSourceEdgePt,aTargetEdgePt,oSourceRect,oTargetRect,oDirections.source,oDirections.target);if(aLinkPoints&&aLinkPoints.length>=2){Array.prototype.splice.apply(aSymbolPoints,[1,0].concat(aLinkPoints.slice(1,aLinkPoints.length-1)))}aNewPoints=sap.galilei.ui.common.layout.PointsLayout.removeElbows(aSymbolPoints);if(aNewPoints&&aNewPoints.length>=2&&aNewPoints.length!==aSymbolPoints.length&&(!oSourceBoundaryShape||oSourceBoundaryShape.isPointInShape(aNewPoints[0],oSourceRect))&&(!oTargetBoundaryShape||oTargetBoundaryShape.isPointInShape(aNewPoints[aNewPoints.length-1],oTargetRect))){oSymbol.points=aNewPoints}else{oSymbol.points=aSymbolPoints}}}},layoutLinkShape:function(oSymbol,oLinkShape){var aSourceEdgePt,aTargetEdgePt,oSourceSymbol,oTargetSymbol,oSourceBoundaryShape,oTargetBoundaryShape,oSourceRect,oTargetRect,aLinkPoints;function computeEdgePoint(aInnerPoint,aOuterPoint,direction,oShape,oParentRect){var oSegment,aTempPoint;if(oShape){direction=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(aInnerPoint,aOuterPoint);switch(direction){case sap.galilei.ui.common.LinkDirection.east:case sap.galilei.ui.common.LinkDirection.west:aTempPoint=[aOuterPoint[0],aInnerPoint[1]];break;case sap.galilei.ui.common.LinkDirection.north:case sap.galilei.ui.common.LinkDirection.south:aTempPoint=[aInnerPoint[0],aOuterPoint[1]];break}if(aTempPoint){oSegment=new sap.galilei.ui.common.Segment(aInnerPoint,aTempPoint);return oShape.getIntersection(oSegment,oParentRect)}}}if(oSymbol&&oSymbol.isLinkSymbol&&oLinkShape&&oSymbol.sourceSymbol&&oSymbol.targetSymbol){if(oSymbol.points.length>=2){oSourceSymbol=oSymbol.sourceSymbol;oTargetSymbol=oSymbol.targetSymbol;oSourceBoundaryShape=oSourceSymbol.getBoundaryShape();oTargetBoundaryShape=oTargetSymbol.getBoundaryShape();oSourceRect=oSourceSymbol.getBBox();oTargetRect=oTargetSymbol.getBBox();aLinkPoints=oSymbol.points.clone();aSourceEdgePt=computeEdgePoint(oSymbol.points[0],oSymbol.points[1],undefined,oSourceBoundaryShape,oSourceRect);aTargetEdgePt=computeEdgePoint(oSymbol.points[oSymbol.points.length-1],oSymbol.points[oSymbol.points.length-2],undefined,oTargetBoundaryShape,oTargetRect);if(aSourceEdgePt&&aTargetEdgePt){aLinkPoints[0]=aSourceEdgePt;aLinkPoints[aLinkPoints.length-1]=aTargetEdgePt}oLinkShape.points=aLinkPoints}this.layoutMiddleArrow(oSymbol,oLinkShape);this.layoutLinkContent(oSymbol,oLinkShape)}},layoutMiddleArrow:function(oSymbol,oLink){if(oSymbol&&oLink){var aMiddlePoint,sTransform,middleArrowAngle,aPoints=oLink.points,length=aPoints.length,middleIndex;if(aPoints&&length>=2){aMiddlePoint=oSymbol.getCenter();if(aMiddlePoint){if(oSymbol.middleArrowShape){oSymbol.middleArrowShape.x=aMiddlePoint[0]-oSymbol.middleArrowShape.width*0.5;oSymbol.middleArrowShape.y=aMiddlePoint[1]-oSymbol.middleArrowShape.height*0.5}}}}},layoutLinkContent:function(oSymbol,oLinkShape){if(oSymbol&&oLinkShape&&oLinkShape.points){var aPoints=oLinkShape.points,length=aPoints.length,middleIndex=Math.ceil(length/2)-1,offset=10,middleOffset=20,aStartPoint=aPoints[0],aMiddlePoint=oSymbol.getCenter(),aEndPoint=aPoints[length-1],textHeight=sap.galilei.ui.common.Font.getFontHeight(),textWidth,sourceLength,middleLength,targetLength,direction;if(aPoints&&length>=2){if(oSymbol.middleContentShape){textWidth=sap.galilei.ui.common.Text.measureTextLineWidth(oSymbol.middleContentShape.text);if(aMiddlePoint){oSymbol.middleContentShape.width=textWidth+offset;oSymbol.middleContentShape.height=textHeight;oSymbol.middleContentShape.x=aMiddlePoint[0]-oSymbol.middleContentShape.width/2;oSymbol.middleContentShape.y=aMiddlePoint[1]-oSymbol.middleContentShape.height/2;if(aPoints[middleIndex][0]===aPoints[middleIndex+1][0]){oSymbol.middleContentShape.x+=middleOffset}else{oSymbol.middleContentShape.y-=middleOffset}}}if(oSymbol.sourceContentShape){textWidth=sap.galilei.ui.common.Text.measureTextLineWidth(oSymbol.sourceContentShape.text);if(aStartPoint){oSymbol.sourceContentShape.width=textWidth+offset;oSymbol.sourceContentShape.height=textHeight;direction=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(aPoints[0],aPoints[1]);switch(direction){case sap.galilei.ui.common.LinkDirection.east:oSymbol.sourceContentShape.x=aStartPoint[0]+offset;oSymbol.sourceContentShape.y=aStartPoint[1]-textHeight-offset;break;case sap.galilei.ui.common.LinkDirection.south:oSymbol.sourceContentShape.x=aStartPoint[0]+offset;oSymbol.sourceContentShape.y=aStartPoint[1]+offset;break;case sap.galilei.ui.common.LinkDirection.west:oSymbol.sourceContentShape.x=aStartPoint[0]-offset-textWidth;oSymbol.sourceContentShape.y=aStartPoint[1]-textHeight-offset;break;case sap.galilei.ui.common.LinkDirection.north:oSymbol.sourceContentShape.x=aStartPoint[0]+offset;oSymbol.sourceContentShape.y=aStartPoint[1]-textHeight-offset;break}}}if(oSymbol.targetContentShape){textWidth=sap.galilei.ui.common.Text.measureTextLineWidth(oSymbol.targetContentShape.text);if(aEndPoint){oSymbol.targetContentShape.width=textWidth+offset;oSymbol.targetContentShape.height=textHeight;direction=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(aPoints[length-1],aPoints[length-2]);switch(direction){case sap.galilei.ui.common.LinkDirection.east:oSymbol.targetContentShape.x=aEndPoint[0]+offset;oSymbol.targetContentShape.y=aEndPoint[1]-textHeight-offset;break;case sap.galilei.ui.common.LinkDirection.south:oSymbol.targetContentShape.x=aEndPoint[0]+offset;oSymbol.targetContentShape.y=aEndPoint[1]+offset;break;case sap.galilei.ui.common.LinkDirection.west:oSymbol.targetContentShape.x=aEndPoint[0]-offset-textWidth;oSymbol.targetContentShape.y=aEndPoint[1]-textHeight-offset;break;case sap.galilei.ui.common.LinkDirection.north:oSymbol.targetContentShape.x=aEndPoint[0]+offset;oSymbol.targetContentShape.y=aEndPoint[1]-textHeight-offset;break}}}}}}}});
"use strict";sap.galilei.ui.symbol.LinkSymbolLayoutSerializer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.symbol.LinkSymbolLayoutSerializer",statics:{load:function(aLinkSymbolLayout){if(aLinkSymbolLayout){if(sap.galilei.core.isInstanceOf(aLinkSymbolLayout,"Array")){return this.loadSymbolLayouts(aLinkSymbolLayout)}else{if(sap.galilei.core.isInstanceOf(aLinkSymbolLayout,"Object")){return this.loadOneSymbolLayout(aLinkSymbolLayout)}}}return undefined},loadOneSymbolLayout:function(aLinkSymbolLayout){if(aLinkSymbolLayout&&sap.galilei.core.isInstanceOf(aLinkSymbolLayout,"Object")){var oLinkSymbolLayoutParams={},sProperty,vValue,oShape,oBindings={};for(sProperty in aLinkSymbolLayout){vValue=aLinkSymbolLayout[sProperty];switch(sProperty){case"sourceArrow":if(sap.galilei.ui.common.binding.Binding.isBindingExpression(vValue)){oBindings.markerStart=vValue}else{oLinkSymbolLayoutParams[sProperty]=vValue}break;case"targetArrow":if(sap.galilei.ui.common.binding.Binding.isBindingExpression(vValue)){oBindings.markerEnd=vValue}else{oLinkSymbolLayoutParams[sProperty]=vValue}break;case"middleArrow":case"sourceContent":case"middleContent":case"targetContent":if(sap.galilei.core.isInstanceOf(vValue,"sap.galilei.ui.common.shape.Shape")){oShape=vValue}else{oShape=sap.galilei.ui.common.shape.ShapeSerializer.load(vValue)}if(oShape){oLinkSymbolLayoutParams[sProperty]=oShape}break;default:if(sap.galilei.ui.common.binding.Binding.isBindingExpression(vValue)){oBindings[sProperty]=vValue}else{oLinkSymbolLayoutParams[sProperty]=vValue}break}}if(!oLinkSymbolLayoutParams.stroke){oLinkSymbolLayoutParams.stroke="black"}if(!oLinkSymbolLayoutParams.strokeWidth){oLinkSymbolLayoutParams.strokeWidth=1}oLinkSymbolLayoutParams.linkShape=new sap.galilei.ui.common.shape.Polyline(oLinkSymbolLayoutParams);oLinkSymbolLayoutParams.linkShape.bindProperty(oBindings);if(oLinkSymbolLayoutParams.sourceArrow&&!oBindings.markerStart){oLinkSymbolLayoutParams.linkShape.markerStart=oLinkSymbolLayoutParams.sourceArrow}if(oLinkSymbolLayoutParams.targetArrow&&!oBindings.markerEnd){oLinkSymbolLayoutParams.linkShape.markerEnd=oLinkSymbolLayoutParams.targetArrow}return new sap.galilei.ui.symbol.LinkSymbolLayout(oLinkSymbolLayoutParams)}return undefined},loadSymbolLayouts:function(aLinkSymbolLayout){if(aLinkSymbolLayout&&sap.galilei.core.isInstanceOf(aLinkSymbolLayout,"Array")){var iLayout,oLayoutDef,oLayout,aLayouts=[];for(iLayout=0;iLayout<aLinkSymbolLayout.length;++iLayout){oLayoutDef=aLinkSymbolLayout[iLayout];oLayout=this.loadOneSymbolLayout(oLayoutDef);if(oLayout){aLayouts.push(oLayout)}}return aLayouts}return undefined}}});
"use strict";sap.galilei.ui.symbol.SymbolLayoutSerializer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.symbol.SymbolLayoutSerializer",statics:{load:function(aSymbolLayout){if(aSymbolLayout){if(sap.galilei.core.isInstanceOf(aSymbolLayout,"Array")){return this.loadSymbolLayouts(aSymbolLayout)}else{if(sap.galilei.core.isInstanceOf(aSymbolLayout,"Object")){return this.loadOneSymbolLayout(aSymbolLayout)}}}return undefined},loadOneSymbolLayout:function(oSymbolLayout){if(oSymbolLayout&&sap.galilei.core.isInstanceOf(oSymbolLayout,"Object")){var oSymbolLayoutClone={},sProperty,vValue,oShape;for(sProperty in oSymbolLayout){vValue=oSymbolLayout[sProperty];switch(sProperty){case"mainShape":case"contentShape":if(sap.galilei.core.isInstanceOf(vValue,"sap.galilei.ui.common.shape.Shape")){oShape=vValue}else{oShape=sap.galilei.ui.common.shape.ShapeSerializer.load(vValue)}if(oShape){oSymbolLayoutClone[sProperty]=oShape}break;default:oSymbolLayoutClone[sProperty]=vValue;break}}return new sap.galilei.ui.symbol.SymbolLayout(oSymbolLayoutClone)}return undefined},loadSymbolLayouts:function(aSymbolLayout){if(aSymbolLayout&&sap.galilei.core.isInstanceOf(aSymbolLayout,"Array")){var iLayout,oLayoutDef,oLayout,aLayouts=[];for(iLayout=0;iLayout<aSymbolLayout.length;++iLayout){oLayoutDef=aSymbolLayout[iLayout];oLayout=this.loadOneSymbolLayout(oLayoutDef);if(oLayout){aLayouts.push(oLayout)}}return aLayouts}return undefined}}});
