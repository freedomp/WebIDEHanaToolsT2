// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.services.AppConfiguration");function A(){var m={},c=null,I=[];this.getCurrentAppliction=function(a){return c;};this.getMetadata=function(a){if(!a){a=c;}if(a){var k=this.getApplicationUrl(a);if(!(m.hasOwnProperty(k))){this.addMetadata(a);}if(!m[k]){m[k]={};}if(!m[k].title){m[k].title=a.text||sap.ushell.resources.i18n.getText("default_app_title");}return m[k];}return{};};this.setCurrentApplication=function(a){c=a;};this.setHeaderHiding=function(e){var s=sap.ui.getCore().byId('shell');if(s){if(sap.ui.Device.system.phone){s.setHeaderHiding(e);}else{jQuery.sap.log.warning("Application configuration could not be trigger setHeaderHiding on Shell as the running devic is not a phone");}}else{jQuery.sap.log.warning("Application configuration could not be trigger setHeaderHiding on Shell");}};this.addApplicationSettingsButtons=function(b){var i,a=[];for(i=0;i<b.length;i++){var C=b[i];a.push(C.getId());C.setIcon(C.getIcon()||sap.ui.core.IconPool.getIconURI('action-settings'));}if(sap.ushell.Container&&sap.ushell.Container.getRenderer("fiori2")){if(I.length){sap.ushell.Container.getRenderer("fiori2").hideActionButton(I,true);}I=a;sap.ushell.Container.getRenderer("fiori2").showActionButton(a,true,undefined,true);}};this.setWindowTitle=function(t){window.document.title=t;};this.setIcons=function(i){jQuery.sap.setIcons(i);};this.getSettingsControl=function(){jQuery.sap.require("sap.ushell.ui.footerbar.SettingsButton");return new sap.ushell.ui.footerbar.SettingsButton();};this.getApplicationName=function(a){var M,s=(a&&a.additionalInformation)||null;if(s){M=/^SAPUI5\.Component=(.+)$/i.exec(s);if(M){return M[1];}}return null;};this.getApplicationUrl=function(a){var u=(a&&a.url)||null,s="P_TCODE",i;if(u){if(a.applicationType==="NWBC"&&u.indexOf(s)){return u;}i=u.indexOf("?");if(i>=0){u=u.slice(0,i);}if(u.slice(-1)!=='/'){u+='/';}}return u;};this.getPropertyValueFromConfig=function(C,p,r){var v;if(r&&C.hasOwnProperty(p+"Resource")){v=r.getText(C[p+"Resource"]);}else if(C.hasOwnProperty(p)){v=C[p];}return v;};this.getPropertyValueFromManifest=function(l,p,P){var M=p[P].manifestEntryKey,s=p[P].path,o=l.getManifestEntry(M);return jQuery.sap.getObject(s,undefined,o);};this.addMetadata=function(a){try{var C=this.getApplicationName(a),u=this.getApplicationUrl(a),o,l,b,p={"fullWidth":{"manifestEntryKey":"sap.fiori","path":"fullWidth"},"hideLightBackground":{"manifestEntryKey":"sap.fiori","path":"hideLightBackground"},"title":{"manifestEntryKey":"sap.app","path":"title"},"icon":{"manifestEntryKey":"sap.ui","path":"icons.icon"},"favIcon":{"manifestEntryKey":"sap.ui","path":"icons.favIcon"},"homeScreenIconPhone":{"manifestEntryKey":"sap.ui","path":"icons.phone"},"homeScreenIconPhone@2":{"manifestEntryKey":"sap.ui","path":"icons.phone@2"},"homeScreenIconTablet":{"manifestEntryKey":"sap.ui","path":"icons.tablet"},"homeScreenIconTablet@2":{"manifestEntryKey":"sap.ui","path":"icons.tablet@2"},"startupImage320x460":{"manifestEntryKey":"sap.ui","path":"icons.startupImage640x920"},"startupImage640x920":{"manifestEntryKey":"sap.ui","path":"icons.startupImage640x920"},"startupImage640x1096":{"manifestEntryKey":"sap.ui","path":"icons.startupImage640x1096"},"startupImage768x1004":{"manifestEntryKey":"sap.ui","path":"icons.startupImage768x1004"},"startupImage748x1024":{"manifestEntryKey":"sap.ui","path":"icons.startupImage748x1024"},"startupImage1536x2008":{"manifestEntryKey":"sap.ui","path":"icons.startupImage1536x2008"},"startupImage1496x2048":{"manifestEntryKey":"sap.ui","path":"icons.startupImage1496x2048"},"compactContentDensity":{"manifestEntryKey":"sap.ui5","path":"contentDensities.compact"},"cozyContentDensity":{"manifestEntryKey":"sap.ui5","path":"contentDensities.cozy"}},d,s,i,M,P,e,r;if(u&&!(m.hasOwnProperty(u))){m[u]={};o=sap.ui.component.load({url:u,name:C});l=o.getMetadata();if(l){b=l.getConfig();M=(l.getManifest()!==undefined);if(b){e=b.resourceBundle||"";if(e){if(e.slice(0,1)!=='/'){e=u+e;}r=jQuery.sap.resources({url:e,locale:sap.ui.getCore().getConfiguration().getLanguage()});}}for(P in p){if(p.hasOwnProperty(P)){if(M){m[u][P]=this.getPropertyValueFromManifest(l,p,P);}if(b&&m[u][P]===undefined){m[u][P]=this.getPropertyValueFromConfig(b,P,r);}}}}}m[u].version=l.getVersion();m[u].libraryName=l.getLibraryName();d=["favIcon","homeScreenIconPhone","homeScreenIconPhone@2","homeScreenIconTablet","homeScreenIconTablet@2","startupImage320x460","startupImage640x920","startupImage640x1096","startupImage768x1004","startupImage748x1024","startupImage1536x2008","startupImage1496x2048"];s=(u&&u[u.length-1]==='/')?u.substring(0,u.length-1):u;i=function(u){if(u.match(/^https?:\/\/.*/)){return false;}return u&&u[0]!=='/';};d.forEach(function(g){var O=m[u][g],F=null;if(O){F=i(O)?s+"/"+O:O;}m[u][g]=F;});}catch(f){jQuery.sap.log.warning("Application configuration could not be parsed");}};}sap.ushell.services.AppConfiguration=new A();}());
