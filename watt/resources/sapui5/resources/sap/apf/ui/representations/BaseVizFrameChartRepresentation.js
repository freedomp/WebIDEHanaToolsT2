/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.apf.ui.representations.BaseVizFrameChartRepresentation");jQuery.sap.require("sap.apf.ui.representations.BaseUI5ChartRepresentation");jQuery.sap.require('sap.apf.ui.representations.utils.vizFrameDatasetHelper');jQuery.sap.require("sap.apf.ui.utils.constants");(function(){'use strict';sap.apf.ui.representations.BaseVizFrameChartRepresentation=function(a,p){sap.apf.ui.representations.BaseUI5ChartRepresentation.apply(this,[a,p]);};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype=Object.create(sap.apf.ui.representations.BaseUI5ChartRepresentation.prototype);sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.constructor=sap.apf.ui.representations.BaseVizFrameChartRepresentation;sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.destroy=function(){if(this.chart){this.chart.destroyDataset();this.chart.destroyFeeds();this.chart.detachRenderComplete(this.fnDrawSelectionOnMainChart);this.fnDrawSelectionOnMainChart=null;}if(this.thumbnailChart){this.thumbnailChart.destroyDataset();this.thumbnailChart.destroyFeeds();this.thumbnailChart.detachRenderComplete(this.fnDrawSelectionOnThumbnailChart);this.fnDrawSelectionOnThumbnailChart=null;}sap.apf.ui.representations.BaseUI5ChartRepresentation.prototype.destroy.call(this);};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getMeasures=function(){return this.measure;};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getMainContent=function(s,w,h){var a=this;var b=this;var c=h||600;c=c+"px";var d=w||1000;d=d+"px";this.title=s;if(!this.chartType){this.chartType=this.getChartTypeFromRepresentationType(this.type);}this.createDataset();if(!this.chart){this.chart=new sap.viz.ui5.controls.VizFrame({vizType:this.chartType,dataset:this.dataset,width:d,height:c,uiConfig:{applicationSet:"fiori"}});this.chart.setVizProperties({title:{visible:true,text:this.title},categoryAxis:{title:{visible:true},label:{visible:true}},valueAxis:{title:{visible:true},label:{visible:true}},legend:{visible:this.legendBoolean,title:{visible:this.legendBoolean},isScrollable:true},sizeLegend:{visible:true},valueAxis2:{visible:true,title:{visible:true},label:{visible:true}},plotArea:{animation:{dataLoading:false,dataUpdating:false},isFixedDataPointSize:false},tooltip:{visible:true,label:{visible:true}},interaction:{behaviorType:null}});this.validateSelectionModes();this.fnDrawSelectionOnMainChart=this.drawSelectionOnMainChart.bind(a);this.chart.attachRenderComplete(this.fnDrawSelectionOnMainChart);if(this.metadata){var m={};var f;this.measure.forEach(function(e){var F=b.getFormatStringForMeasure(e);f=F;m.measure=e;m.formatString=F;a.setFormatStringOnChart(m);});this.setFormatString("tooltip",f);if(this.handleCustomFormattingOnChart){this.handleCustomFormattingOnChart();}}b.attachSelectionAndFormatValue.call(this,s);}else{if(w){this.chart.setWidth(d);}if(h){this.chart.setHeight(c);}this.chart.destroyDataset();this.chart.removeAllFeeds();this.chart.destroyFeeds();this.chart.vizUpdate({'data':this.dataset});}this._createAndAddFeedItemBasedOnId(this.chart);this.chart.setModel(this.oModel);return this.chart;};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.setFormatStringOnChart=function(m){var f=m.formatString;var c=m.measure.axisfeedItemId;this.setFormatString(c,f);};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.setFormatString=function(c,f){var s=this;var i=s.getIsAllMeasureSameUnit();switch(c){case sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS:if(i){this.chart.setVizProperties({valueAxis:{label:{formatString:f}}});}break;case sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS2:if(i){this.chart.setVizProperties({valueAxis2:{label:{formatString:f}}});}break;case sap.apf.core.constants.vizFrame.feedItemTypes.CATEGORYAXIS:this.chart.setVizProperties({categoryAxis:{label:{formatString:f}}});break;case sap.apf.core.constants.vizFrame.feedItemTypes.BUBBLEWIDTH:this.chart.setVizProperties({sizeLegend:{formatString:f}});break;case"tooltip":this.chart.setVizProperties({tooltip:{formatString:f}});break;default:break;}};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype._createAndAddFeedItemBasedOnId=function(c){var s=this;var f=s.UI5ChartHelper.datasetObj;var a=this._createFeedItemGroup(f.measures);this._addFeedItemsToChart(c,a,"Measure");var b=this._createFeedItemGroup(f.dimensions);this._addFeedItemsToChart(c,b,"Dimension");};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype._createFeedItemGroup=function(d){var s={};d.forEach(function(a){var f=s[a.axisfeedItemId];if(f){var F=f.some(function(D){return D.name===a.name;});if(!F){f.push(a);}}else{s[a.axisfeedItemId]=[a];}});return s;};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype._addFeedItemsToChart=function(c,g,f){for(var k in g){var F={};var a=[];var i=0;for(i in g[k]){a.push(g[k][i].name);F.feedItemId=g[k][0].axisfeedItemId;}F.value=a;var b=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:F.feedItemId,type:f,values:F.value});c.addFeed(b);}};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.validateSelectionModes=function(){if(this.parameter.requiredFilters===undefined||this.parameter.requiredFilters.length===0){this.chart.setVizProperties({interaction:{selectability:{mode:'none'},behaviorType:null}});}else{this.chart.setVizProperties({interaction:{selectability:{mode:'multiple'},behaviorType:null}});if(this.parameter.dimensions.length>1){if(this.parameter.requiredFilters[0]===this.parameter.dimensions[1].fieldName){this.chart.setVizProperties({interaction:{selectability:{axisLabelSelection:false}}});}else if(this.parameter.requiredFilters[0]===this.parameter.dimensions[0].fieldName){this.chart.setVizProperties({interaction:{selectability:{legendSelection:false}}});}}}};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getThumbnailContent=function(){var s=this;var a=this;var h=sap.apf.ui.utils.CONSTANTS.thumbnailDimensions.HEIGHT;var w=sap.apf.ui.utils.CONSTANTS.thumbnailDimensions.WIDTH;if(!this.chartType){this.chartType=this.getChartTypeFromRepresentationType(this.type);}this.createDataset();if(!this.thumbnailChart){this.thumbnailChart=new sap.viz.ui5.controls.VizFrame({vizType:this.chartType,width:w,height:h,dataset:this.dataset});this.thumbnailChart.setVizProperties({title:{visible:false},categoryAxis:{visible:false,title:{visible:false}},valueAxis:{visible:false,title:{visible:false}},valueAxis2:{visible:false,title:{visible:false}},legend:{visible:false,title:{visible:false}},sizeLegend:{visible:false},tooltip:{visible:false},interaction:{selectability:{axisLabelSelection:false,legendSelection:false,plotLassoSelection:false,plotStdSelection:false},enableHover:false},background:{visible:false},general:{layout:{padding:0}},plotArea:{markerSize:4,marker:{visible:true,size:4},animation:{dataLoading:false,dataUpdating:false},gridline:{visible:false},dataLabel:{visible:false},lineStyle:{rules:[{properties:{width:1}}]}}});this.fnDrawSelectionOnThumbnailChart=this.drawSelectionOnThumbnailChart.bind(s);this.thumbnailChart.attachRenderComplete(this.fnDrawSelectionOnThumbnailChart);}else{this.thumbnailChart.destroyDataset();this.thumbnailChart.removeAllFeeds();this.thumbnailChart.destroyFeeds();this.thumbnailChart.vizUpdate({'data':this.dataset});}this._createAndAddFeedItemBasedOnId(this.thumbnailChart);a.createThumbnailLayout.call(this);return this.thumbnailLayout;};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.setSelectionOnMainChart=function(s){this.chart.vizSelection(s);};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.setSelectionOnThumbnailChart=function(s){this.aStoredSelection=s;this.clearSelectionFromThumbnailChart();this.thumbnailChart.vizSelection(s);};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.clearSelectionFromMainChart=function(){this.chart.vizSelection([],{clearSelection:true});};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.clearSelectionFromThumbnailChart=function(){this.thumbnailChart.vizSelection([],{clearSelection:true});};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getSelectionFromChart=function(){var s=this.chart.vizSelection();return s;};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getChartTypeFromRepresentationType=function(r){var R=sap.apf.ui.utils.CONSTANTS.representationTypes;var v=sap.apf.ui.utils.CONSTANTS.vizFrameChartTypes;var V;switch(r){case R.COLUMN_CHART:V=v.COLUMN;break;case R.LINE_CHART:V=v.LINE;break;case R.PIE_CHART:V=v.PIE;break;case R.STACKED_COLUMN_CHART:V=v.STACKED_COLUMN;break;case R.PERCENTAGE_STACKED_COLUMN_CHART:V=v.PERCENTAGE_STACKED_COLUMN;break;case R.SCATTERPLOT_CHART:V=v.SCATTERPLOT;break;case R.BUBBLE_CHART:V=v.BUBBLE;break;case R.BAR_CHART:V=v.BAR;break;case R.STACKED_BAR_CHART:V=v.STACKED_BAR;break;case R.PERCENTAGE_STACKED_BAR_CHART:V=v.PERCENTAGE_STACKED_BAR;break;default:this.oMessageObject=this.oApi.createMessageObject({code:"6000",aParameters:[r]});this.oApi.putMessage(this.oMessageObject);break;}return V;};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getIsGroupTypeChart=function(){return this.bIsGroupTypeChart?this.bIsGroupTypeChart:false;};sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getDataSetHelper=function(){var i=this.getIsGroupTypeChart();var d=new sap.apf.ui.representations.utils.vizFrameDatasetHelper(i);return d;};}());
