jQuery.sap.declare('sap.ui.vk.library-all');if(!jQuery.sap.isDeclared('sap.ui.vk.DvlException')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
jQuery.sap.declare('sap.ui.vk.DvlException');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.Exception');sap.ui.define("sap/ui/vk/DvlException",["jquery.sap.global","sap/ui/base/Exception"],function(q,E){"use strict";var D=function(c,m){this.name="DvlException";this.code=c;this.message=m;};D.prototype=q.sap.newObject(E.prototype);return D;});};if(!jQuery.sap.isDeclared('sap.ui.vk.FlexibleControlRenderer')){jQuery.sap.declare('sap.ui.vk.FlexibleControlRenderer');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/vk/FlexibleControlRenderer",['jquery.sap.global'],function(q){"use strict";var F={};F.render=function(r,f){var a=r;a.write("<div");a.writeControlData(f);a.addClass("sapUiFlexControl");if(f.getWidth()&&f.getWidth()!=''){a.addStyle("width",f.getWidth());}if(f.getHeight()&&f.getHeight()!=''){a.addStyle("height",f.getHeight());}a.writeStyles();a.writeClasses();a.write(">");var c=f.getContent();var l=f.getLayout();var b="sapUiFlexCellStacked";if(l=="Vertical"){b="sapUiFlexCellVertical";}for(var i=0;i<c.length;i++){var d=c[i];a.write("<div id=\""+f.getId()+"Content_"+i+"\" class=\""+b+"\"");var e=d.getLayoutData();if(e&&l!="Stacked"){a.write(" style=\"");if(e.getSize()&&e.getSize()!=''){a.write("height: "+e.getSize()+";");}if(e.getMinSize()&&e.getMinSize()!=''){a.write("min-height: "+e.getMinSize()+";");}if(e.getMarginTop()&&e.getMarginTop()!=''){a.write("margin-top: "+e.getMarginTop()+";");}if(e.getMarginBottom()&&e.getMarginBottom()!=''){a.write("margin-bottom: "+e.getMarginBottom()+";");}a.write("\"");}a.write(">");a.renderControl(d);a.write("</div>");}a.write("</div>");};return F;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.InputDeviceMouse')){jQuery.sap.declare('sap.ui.vk.InputDeviceMouse');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.EventProvider');sap.ui.define("sap/ui/vk/InputDeviceMouse",["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";var M=E.extend("sap.ui.vk.InputDeviceMouse",{metadata:{publicMethods:["isSupported","enable","disable"]},constructor:function(L){this._loco=L;this._buttons=0;this._buttonFlagsValue=0;this._zoomOrigin={x:0,y:0};},_buttonFlags:function(b,d){if(d){this._buttonFlagsValue|=(1<<b);}else{this._buttonFlagsValue&=~(1<<b);}return this._buttonFlagsValue;},_eventToInput:function(e,b){var a=(e.buttons!=undefined)?e.buttons:this._buttonFlagsValue;if(b){a=b;}var i={x:0,y:0,z:0,d:0,n:0,buttons:a,scroll:e.wheelDelta,points:[],handled:false};var n=0;switch(a){case 0:case 1:n=1;i.points.push({x:e.pageX,y:e.pageY,z:0});break;case 3:case 4:n=2;i.points.push({x:e.pageX,y:e.pageY,z:0});i.points.push({x:e.pageX,y:e.pageY,z:0});break;case 2:n=2;i.points.push({x:this._zoomOrigin.x,y:e.pageY,z:0});i.points.push({x:this._zoomOrigin.x,y:e.pageY+(this._zoomOrigin.y-e.pageY)*2,z:0});break;default:n=0;break;}i.n=n;return i;},_onmouseup:function(e){var b=(e.buttons!=undefined)?e.buttons:this._buttonFlags(e.button,false);if(e._sapui_handledByControl){return;}var i=this._eventToInput(e,this._buttons);this._loco.endGesture(i);if(b==2){this._zoomOrigin.x=e.pageX;this._zoomOrigin.y=e.pageY;}var i=this._eventToInput(e);if(b!=0){i.handled=false;this._loco.beginGesture(i);}this._buttons=b;if(i.handled){e.preventDefault();}e._sapui_handledByControl=true;},_onmousemove:function(e){var b=(e.buttons!=undefined)?e.buttons:this._buttonFlagsValue;if(e._sapui_handledByControl||b==0){return;}var i=this._eventToInput(e);this._loco.move(i);if(i.handled){e._sapui_handledByControl=true;e.preventDefault();}},_onmousedown:function(e){var b=(e.buttons!=undefined)?e.buttons:this._buttonFlags(e.button,true);if(e._sapui_handledByControl){return;}if(this._buttons!=0){var i=this._eventToInput(e,this._buttons);this._loco.endGesture(i);}if(b==2){this._zoomOrigin.x=e.pageX;this._zoomOrigin.y=e.pageY;}var i=this._eventToInput(e);i.handled=false;this._loco.beginGesture(i);this._prevButtons=b;this._buttons=b;if(i.handled){e._sapui_handledByControl=true;e.preventDefault();}},_onmousewheel:function(e){var a=e.originalEvent?e.originalEvent:e;if(a._sapui_handledByControl||this._buttons!=0){return;}this._zoomOrigin.x=a.pageX;this._zoomOrigin.y=a.pageY;var s={pageX:a.pageX,pageY:a.pageY,buttons:2,wheelDelta:a.wheelDelta};var i=this._eventToInput(s);this._loco.beginGesture(i);var d=a.detail?a.detail*(-40):a.wheelDelta;s.pageY-=d/5;i=this._eventToInput(s);i.handled=false;this._loco.move(i);i.handled=false;this._loco.endGesture(i);if(i.handled){a._sapui_handledByControl=true;a.preventDefault();}},_oncontextmenu:function(e){var i=this._eventToInput(e);this._loco.contextMenu(i);if(i.handled){e._sapui_handledByControl=true;e.preventDefault();}},isSupported:function(){return true;},enable:function(c){this._buttonFlagsValue=0;this._buttons=0;this._mousedownProxy=this._onmousedown.bind(this);this._mouseupProxy=this._onmouseup.bind(this);this._mousemoveProxy=this._onmousemove.bind(this);this._mousewheelProxy=this._onmousewheel.bind(this);this._contextmenuProxy=this._oncontextmenu.bind(this);this._control=c;var f=(this._control)?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f('mousedown',this._mousedownProxy,false);f('mouseup',this._mouseupProxy,false);f('mousemove',this._mousemoveProxy,false);f('mousewheel',this._mousewheelProxy,false);f('DOMMouseScroll',this._mousewheelProxy,false);f("contextmenu",this._contextmenuProxy,false);},disable:function(){var f=(this._control)?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f('mousedown',this._mousedownProxy);f('mouseup',this._mouseupProxy);f('mousemove',this._mousemoveProxy);f('mousewheel',this._mousewheelProxy);f('DOMMouseScroll',this._mousewheelProxy);f("contextmenu",this._contextmenuProxy);}});return M;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.InputDevicePointer')){jQuery.sap.declare('sap.ui.vk.InputDevicePointer');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.EventProvider');sap.ui.define("sap/ui/vk/InputDevicePointer",["jquery.sap.global","sap/ui/base/EventProvider","./InputDeviceMouse"],function(q,E,I){"use strict";var P=E.extend("sap.ui.vk.InputDevicePointer",{metadata:{publicMethods:["isSupported","enable","disable"]},constructor:function(L){this._loco=L;this._pointerIds=[];this._pointers=[];this._count=0;this._points=0;this._buttons=0;this._mouse=new I(this._loco);},_clearPointers:function(){this._pointerIds=[];this._pointers=[];this._count=0;this._points=0;this._buttons=0;},_addPointer:function(i,_,a){if(this._pointerIds[i]==null){this._pointerIds[i]=this._count;}var b=this._pointerIds[i];if(this._pointers.length<=b||this._pointers[b]==null){this._count++;}this._pointers[b]={x:_,y:a};return this._count;},_removePointer:function(i){if(this._pointerIds[i]==null){return this._count;}var a=this._pointerIds[i];this._pointerIds[i]=null;if(this._pointers.length>a&&this._pointers[a]!=null){this._count--;}this._pointers[a]=null;return this._count;},_eventToInput:function(e){var a={x:0,y:0,z:0,d:0,n:this._count,buttons:0,scroll:0,points:[],handled:false};var t=this._pointers;var l=t.length;for(var i=0;i<l;i++){var b=t[i];if(b!=null){a.points.push({x:b.x,y:b.y,z:0});}}return a;},_onpointerdown:function(e){var a=e.originalEvent?e.originalEvent:e;if(a.pointerType!="touch"&&a.pointerType!="pen"){this._buttons=a.buttons;this._mouse._onmousedown(a);return;}if(a.isPrimary){this._clearPointers();}this._addPointer(a.pointerId,a.pageX,a.pageY);a.target.setPointerCapture(a.pointerId);var i=this._eventToInput(a);if(this._points!=0&&this._points!=i.n){this._loco.endGesture(i);}this._points=i.n;i.handled=false;this._loco.beginGesture(i);if(i.handled){a._sapui_handledByControl=true;a.preventDefault();}else{this._removePointer(a.pointerId);}},_onpointerup:function(e){var a=e.originalEvent?e.originalEvent:e;if(a.pointerType!="touch"&&a.pointerType!="pen"){this._buttons=0;this._mouse._onmouseup(a);return;}this._removePointer(a.pointerId);a.target.releasePointerCapture(a.pointerId);var i=this._eventToInput(a);this._loco.endGesture(i);if(i.n!=0&&this._points!=i.n){i.handled=false;this._loco.beginGesture(i);}this._points=i.n;if(i.handled){a._sapui_handledByControl=true;a.preventDefault();}},_onpointermove:function(e){var a=e.originalEvent?e.originalEvent:e;if(a.pointerType!="touch"&&a.pointerType!="pen"){if(this._buttons!=a.buttons){this._mouse._onmousedown(a);this._buttons=a.buttons;}else{this._mouse._onmousemove(a);}return;}this._addPointer(a.pointerId,a.pageX,a.pageY);var i=this._eventToInput(a);if(this._points!=i.n){this._loco.endGesture(i);i.handled=false;this._loco.beginGesture(i);this._points=i.n;}else{this._loco.move(i);}if(i.handled){a._sapui_handledByControl=true;a.preventDefault();}},isSupported:function(){return typeof window.onpointerdown!=='undefined';},enable:function(c){this._pointerIds=[];this._pointers=[];this._points=0;this._count=0;this._buttons=0;this._mouse._buttons=0;this._pointerdownProxy=this._onpointerdown.bind(this);this._pointerupProxy=this._onpointerup.bind(this);this._pointermoveProxy=this._onpointermove.bind(this);this._mousewheelProxy=this._mouse._onmousewheel.bind(this._mouse);this._contextmenuProxy=this._mouse._oncontextmenu.bind(this._mouse);this._control=c;var f=(this._control)?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f('pointerdown',this._pointerdownProxy,false);f('pointerup',this._pointerupProxy,false);f('pointermove',this._pointermoveProxy,false);f('mousewheel',this._mousewheelProxy,false);f('DOMMouseScroll',this._mousewheelProxy,false);f("contextmenu",this._contextmenuProxy,false);},disable:function(){var f=(this._control)?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f('pointerdown',this._pointerdownProxy);f('pointerup',this._pointerupProxy);f('pointermove',this._pointermoveProxy);f('mousewheel',this._mousewheelProxy);f('DOMMouseScroll',this._mousewheelProxy);f("contextmenu",this._contextmenuProxy);}});return P;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.InputDeviceSAPUI5')){jQuery.sap.declare('sap.ui.vk.InputDeviceSAPUI5');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.EventProvider');sap.ui.define("sap/ui/vk/InputDeviceSAPUI5",["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";var T=E.extend("sap.ui.vk.InputDeviceSAPUI5",{metadata:{publicMethods:["isSupported","enable","disable"]},constructor:function(L){this._loco=L;this._points=0;},_eventToInput:function(e){var a={x:0,y:0,z:0,d:0,n:e.touches.length,buttons:0,scroll:0,points:[],handled:false};for(var i=0;i<a.n;i++){var b=e.touches[i];a.points.push({x:b.pageX,y:b.pageY,z:0});}return a;},_ontouchdown:function(e){var i=this._eventToInput(e);if(this._points!=0&&this._points!=i.n){this._loco.endGesture(i);}this._points=i.n;i.handled=false;this._loco.beginGesture(i);if(i.handled){e._sapui_handledByControl=true;e.preventDefault();}},_ontouchup:function(e){var i=this._eventToInput(e);this._loco.endGesture(i);this._points=0;if(i.handled){e._sapui_handledByControl=true;e.preventDefault();}},_ontouchmove:function(e){var i=this._eventToInput(e);if(this._points!=i.n){this._loco.endGesture(i);i.handled=false;this._loco.beginGesture(i);this._points=i.n;}else{this._loco.move(i);}if(i.handled){e._sapui_handledByControl=true;e.preventDefault();}},isSupported:function(){return typeof window.ontouchstart!=='undefined';},enable:function(c){this._points=0;this._touchdownProxy=this._ontouchdown.bind(this);this._touchupProxy=this._ontouchup.bind(this);this._touchmoveProxy=this._ontouchmove.bind(this);this._control=c;if(!this._control){return;}c.attachBrowserEvent("saptouchstart",this._touchdownProxy,false);c.attachBrowserEvent("saptouchend",this._touchupProxy,false);c.attachBrowserEvent("saptouchmove",this._touchmoveProxy,false);c.attachBrowserEvent("touchstart",this._touchdownProxy,false);c.attachBrowserEvent("touchend",this._touchupProxy,false);c.attachBrowserEvent("touchmove",this._touchmoveProxy,false);},disable:function(){if(!this._control){return;}this._control.detachBrowserEvent("saptouchstart",this._touchdownProxy,false);this._control.detachBrowserEvent("saptouchend",this._touchupProxy,false);this._control.detachBrowserEvent("saptouchmove",this._touchmoveProxy,false);this._control.detachBrowserEvent("touchstart",this._touchdownProxy,false);this._control.detachBrowserEvent("touchend",this._touchupProxy,false);this._control.detachBrowserEvent("touchmove",this._touchmoveProxy,false);}});return T;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.InputDeviceTouch')){jQuery.sap.declare('sap.ui.vk.InputDeviceTouch');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.EventProvider');sap.ui.define("sap/ui/vk/InputDeviceTouch",["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";var T=E.extend("sap.ui.vk.InputDeviceTouch",{metadata:{publicMethods:["isSupported","enable","disable"]},constructor:function(L){this._loco=L;this._points=0;},_eventToInput:function(e){var a={x:0,y:0,z:0,d:0,n:e.touches.length,buttons:0,scroll:0,points:[],handled:false};for(var i=0;i<a.n;i++){var b=e.touches[i];a.points.push({x:b.pageX,y:b.pageY,z:0});}return a;},_ontouchdown:function(e){var i=this._eventToInput(e);if(this._points!=0&&this._points!=i.n){this._loco.endGesture(i);}this._points=i.n;i.handled=false;this._loco.beginGesture(i);if(i.handled){e._sapui_handledByControl=true;e.preventDefault();}},_ontouchup:function(e){var i=this._eventToInput(e);this._loco.endGesture(i);this._points=0;if(i.handled){e._sapui_handledByControl=true;e.preventDefault();}},_ontouchmove:function(e){var i=this._eventToInput(e);if(this._points!=i.n){this._loco.endGesture(i);i.handled=false;this._loco.beginGesture(i);this._points=i.n;}else{this._loco.move(i);}if(i.handled){e._sapui_handledByControl=true;e.preventDefault();}},isSupported:function(){return typeof window.ontouchstart!=='undefined';},enable:function(c){this._points=0;this._touchdownProxy=this._ontouchdown.bind(this);this._touchupProxy=this._ontouchup.bind(this);this._touchmoveProxy=this._ontouchmove.bind(this);this._control=c;var f=(this._control)?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f('touchstart',this._touchdownProxy,false);f('touchend',this._touchupProxy,false);f('touchmove',this._touchmoveProxy,false);},disable:function(){var f=(this._control)?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f('touchstart',this._touchdownProxy);f('touchend',this._touchupProxy);f('touchmove',this._touchmoveProxy);}});return T;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.Loco')){jQuery.sap.declare('sap.ui.vk.Loco');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.EventProvider');sap.ui.define("sap/ui/vk/Loco",["jquery.sap.global","sap/ui/base/EventProvider","./InputDevicePointer","./InputDeviceMouse","./InputDeviceTouch"],function(q,E,I,a,b){"use strict";var L=E.extend("sap.ui.vk.Loco",{metadata:{publicMethods:["addHandler","removeHandler","beginGesture","move","endGesture","contextMenu"]},constructor:function(){if(L._instance){return L._instance;}E.apply(this);this._handlers=[];this._gesture=false;this._touchOrigin={x:0,y:0,z:0};this._touchMoved=false;this._touchButton=0;this._touchStart=0;this._touchEnd=0;this._clickTimer=0;this._isDoubleClick=false;L._instance=this;},destroy:function(){this._gesture=false;this._handlers=[];},addHandler:function(h){this._handlers.push(h);var v=h.getViewport();var p=new I(this);if(p.isSupported()){p.enable(v);v._pointer=p;}else{var m=new a(this);if(m.isSupported()){m.enable(v);v._mouse=m;}var t=new b(this);if(t.isSupported()){t.enable(v);v._touch=t;}}},removeHandler:function(c){var h=this._handlers;var d=h.length;var v=c.getViewport();for(var i=0;i<d;i++){if(h[i]==c){h.splice(i,1);if(v._pointer){v._pointer.disable();v._pointer=null;}if(v._touch){v._touch.disable();v._touch=null;}if(v._mouse){v._mouse.disable();v._mouse=null;}break;}}},_processClick:function(d){this._clickTimer=0;var e={x:0,y:0,z:0,d:0,n:0,buttons:0,scrolls:[],points:[],handled:false};e.x=this._touchOrigin.x;e.y=this._touchOrigin.y;e.z=this._touchOrigin.z;e.buttons=this._touchButton;var h=this._handlers;var c=h.length;for(var i=0;i<c;i++){if(d){h[i].doubleClick(e);}else{h[i].click(e);}if(e.handled){break;}}},_processInput:function(e){var c=e.points;switch(e.n){case 0:e.x=0;e.y=0;e.z=0;e.d=0;break;case 2:var d=c[0].x-c[1].x,f=c[0].y-c[1].y,g=c[0].z-c[1].z;e.x=(c[0].x+c[1].x)/2;e.y=(c[0].y+c[1].y)/2;e.z=(c[0].z+c[1].z)/2;e.d=Math.sqrt(d*d+f*f+g*g);break;default:e.x=c[0].x;e.y=c[0].y;e.z=c[0].z;e.d=0;break;}return e;},beginGesture:function(e){if(this._gesture){return;}if(this._clickTimer>0){clearTimeout(this._clickTimer);this._clickTimer=0;this._isDoubleClick=true;if(e.n==1&&e.buttons<=1&&this._touchButton<=1){this._processClick(true);}}this._processInput(e);var h=this._handlers;var c=h.length;for(var i=0;i<c;i++){h[i].beginGesture(e);if(e.handled){break;}}var n=new Date();this._touchStart=n.getTime();this._touchMoved=false;this._gesture=true;this._touchOrigin.x=e.x;this._touchOrigin.y=e.y;this._touchOrigin.z=e.z;this._touchButton=e.buttons;if(this._touchEnd!=0&&this._touchStart-this._touchEnd<50){this._touchMoved=true;}},move:function(e){if(!this._gesture){return;}this._processInput(e);var h=this._handlers;var c=h.length;for(var i=0;i<c;i++){h[i].move(e);if(e.handled){break;}}var d=this._touchOrigin.x-e.x;var f=this._touchOrigin.y-e.y;var g=this._touchOrigin.z-e.z;if((d*d+f*f+g*g)>8){this._touchMoved=true;}},endGesture:function(e){if(!this._gesture){return;}this._processInput(e);var h=this._handlers;var c=h.length;for(var i=0;i<c;i++){h[i].endGesture(e);if(e.handled){break;}}var n=new Date();this._touchEnd=n.getTime();if(!this._touchMoved&&!this._isDoubleClick&&(this._touchEnd-this._touchStart)<2000){this._clickTimer=setTimeout(function(t){t._processClick(false);},200,this);}this._isDoubleClick=false;this._gesture=false;},contextMenu:function(e){this._processInput(e);var h=this._handlers;var c=h.length;for(var i=0;i<c;i++){h[i].contextMenu(e);if(e.handled){break;}}}});return L;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.NativeViewportRenderer')){jQuery.sap.declare('sap.ui.vk.NativeViewportRenderer');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/vk/NativeViewportRenderer",["jquery.sap.global"],function(q){"use strict";var N={};N.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitNativeViewport");r.writeClasses();r.write(">");r.write("</div>");};return N;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.OverlayRenderer')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
jQuery.sap.declare('sap.ui.vk.OverlayRenderer');sap.ui.define("sap/ui/vk/OverlayRenderer",function(){"use strict";var O={};O.render=function(r,c){r.write("<div align='center'");r.writeControlData(c);r.addClass("sapUiVkOverlay");r.writeClasses(c);r.write(">");r.write("</div>");var a;if((a=c._update())){c._load(a);}};return O;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.SceneTreeRenderer')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
jQuery.sap.declare('sap.ui.vk.SceneTreeRenderer');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/vk/SceneTreeRenderer",["jquery.sap.global"],function(q){"use strict";var S={};S.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiSizeCompact");r.addClass("sapRULTSceneTree");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_tree"));r.write("</div>");};return S;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.StepNavigationRenderer')){jQuery.sap.declare('sap.ui.vk.StepNavigationRenderer');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/vk/StepNavigationRenderer",["jquery.sap.global"],function(q){"use strict";var S={};S.render=function(r,c){if(!c.getVisible()){return;}if(c.getShowToolbar()||c.getShowThumbnails){var w=c.getWidth()!=="auto"?c.getWidth():"100%";var h=c.getHeight()!=="auto"?c.getHeight():"auto";r.write("<div");r.addStyle("width",w);r.addStyle("height",h);r.writeControlData(c);r.addClass("sapVizKitStepNavigation");r.writeClasses();var t=c.getTooltip_AsString();if(t){r.writeAttributeEscaped("title",t);}if(!c.getVisible()){r.addStyle("visibility","hidden");}r.writeStyles();r.write(">");if(c.getShowThumbnails()){S._renderScrollerDiv(r,c);}r.write("</div>");}};S._renderScrollerDiv=function(r,c){r.renderControl(c.getAggregation("layout"));};return S;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.ToolbarRenderer')){jQuery.sap.declare('sap.ui.vk.ToolbarRenderer');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/vk/ToolbarRenderer",["jquery.sap.global"],function(q){"use strict";var T={};T.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitToolbar");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_toolbar"));r.write("</div>");};return T;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.TransformationMatrix')){jQuery.sap.declare('sap.ui.vk.TransformationMatrix');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.DataType');sap.ui.define("sap/ui/vk/TransformationMatrix",["jquery.sap.global","sap/ui/base/DataType"],function(q,D){"use strict";var T=D.createType("sap.ui.vk.TransformationMatrix",{isValid:function(v){return T.getBaseType().isValid(v)&&v.length===12;}},D.getType("float[]"));T.parseValue=function(v){var c=T.getComponentType();return v.split(/\s*,\s*|\s+/).map(c.parseValue.bind(c));};T.convertTo4x4=function(a){var m=a;return[m[0],m[1],m[2],0,m[3],m[4],m[5],0,m[6],m[7],m[8],0,m[9],m[10],m[11],1];};T.convertTo4x3=function(a){var m=a;return[m[0],m[1],m[2],m[4],m[5],m[6],m[8],m[9],m[10],m[12],m[13],m[14]];};q.sap.setObject("sap.ui.vk.TransformationMatrix",T);return T;});};if(!jQuery.sap.isDeclared('sap.ui.vk.ViewerRenderer')){jQuery.sap.declare('sap.ui.vk.ViewerRenderer');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/vk/ViewerRenderer",["jquery.sap.global"],function(q){"use strict";var V={};V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewer");r.writeClasses();r.addStyle("width",c.getWidth());r.addStyle("height",c.getHeight());r.writeStyles();r.write(">");r.renderControl(c.getAggregation("_layout"));r.write("</div>");};return V;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.ViewportHandler')){jQuery.sap.declare('sap.ui.vk.ViewportHandler');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.EventProvider');jQuery.sap.require('sap.ui.core.ResizeHandler');sap.ui.define("sap/ui/vk/ViewportHandler",["jquery.sap.global","sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(q,E,R){"use strict";var V=E.extend("sap.ui.vk.ViewportHandler",{metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(a){this._viewport=a;this._rect=null;this._evt={x:0,y:0,z:0,d:0,initd:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false;},destroy:function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false;},_getOffset:function(o){var p={x:o.offsetLeft,y:o.offsetTop};var f=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;while(o.offsetParent){var a=o.offsetParent;if(a==document.getElementsByTagName("body")[0]||a.parentElement==f){break;}p.x=p.x+a.offsetLeft-a.scrollLeft;p.y=p.y+a.offsetTop-a.scrollTop;o=o.offsetParent;}return p;},_inside:function(e){if(this._rect==null||true){var i=this._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);},_onresize:function(e){this._gesture=false;this._rect=null;},beginGesture:function(a){if(this._inside(a)&&!this._gesture){this._gesture=true;var x=a.x-this._rect.x,y=a.y-this._rect.y;this._evt.x=x;this._evt.y=y;this._evt.d=a.d;this._evt.initd=a.d;this._evt.avgd=a.d;this._evt.avgx=0;this._evt.avgy=0;q.sap.log.debug("Loco: beginGesture: "+x+", "+y);this._viewport.queueCommand(function(){this._viewport.beginGesture(x,y);}.bind(this));a.handled=true;if(document.activeElement){try{document.activeElement.blur();}catch(e){}}var d=document.getElementById(this._viewport.getIdForLabel());d.focus();}this._nomenu=false;},move:function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;var d=x-this._evt.x;var a=y-this._evt.y;var b=e.d-this._evt.d;this._evt.x=x;this._evt.y=y;this._evt.d=e.d;this._evt.avgx=this._evt.avgx*0.99+d*0.01;this._evt.avgy=this._evt.avgy*0.99+a*0.01;var z=1.0;if(this._evt.initd>0){z=1.0+b*(1.0/this._evt.initd);}else if(e.n==2){if(e.points[0].y>e.points[1].y){z=1.0-b*0.005;if(z<0.333){z=0.333;}}else{z=1.0+b*0.005;if(z>3){z=3;}}}if(this._evt.initd>0){var c=Math.sqrt(this._evt.avgx*this._evt.avgx+this._evt.avgy*this._evt.avgy);q.sap.log.debug("AvgDist: "+c);if((Math.abs(e.d-this._evt.avgd)/this._evt.avgd)<(c/10)){z=1.0;}}this._evt.avgd=this._evt.avgd*0.97+e.d*0.03;switch(e.n){case 1:q.sap.log.debug("Loco: Rotate: "+(d)+", "+(a));this._viewport.queueCommand(function(){this._viewport.rotate(d,a);}.bind(this));break;case 2:q.sap.log.debug("Loco: Pan: "+(d)+", "+(a));if(z!=0&&z!=1.0){q.sap.log.debug("Loco: Zoom: "+(z));}this._viewport.queueCommand(function(){this._viewport.pan(d,a);if(d<10&&a<10&&z!=0&&z!=1.0){this._viewport.zoom(z);}}.bind(this));break;default:break;}this._nomenu=true;e.handled=true;}},endGesture:function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: endGesture: "+x+", "+y);this._viewport.queueCommand(function(){this._viewport.endGesture();}.bind(this));this._gesture=false;e.handled=true;}},click:function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: click: "+(x)+", "+(y));this._viewport.queueCommand(function(){this._viewport.tap(x,y,false);}.bind(this));e.handled=true;}},doubleClick:function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: doubleClick: "+(x)+", "+(y));this._viewport.queueCommand(function(){this._viewport.tap(x,y,true);}.bind(this));e.handled=true;}},contextMenu:function(e){if(this._inside(e)||this._nomenu){this._nomenu=false;e.handled=true;}},getViewport:function(){return this._viewport;}});return V;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.ViewportRenderer')){jQuery.sap.declare('sap.ui.vk.ViewportRenderer');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/vk/ViewportRenderer",["jquery.sap.global"],function(q){"use strict";var V={};V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewport");r.writeClasses();r.write(">");r.write("</div>");};return V;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.library')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
jQuery.sap.declare('sap.ui.vk.library');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/vk/library",["jquery.sap.global","./TransformationMatrix","./DvlException"],function(q,T,D){"use strict";sap.ui.getCore().initLibrary({name:"sap.ui.vk",dependencies:["sap.ui.core","sap.ui.unified","sap.ui.vbm"],types:["sap.ui.vk.ContentResourceSourceCategory","sap.ui.vk.TransformationMatrix"],interfaces:[],controls:["sap.ui.vk.NativeViewport","sap.ui.vk.Overlay","sap.ui.vk.Viewer","sap.ui.vk.Viewport","sap.ui.vk.SceneTree"],elements:["sap.ui.vk.OverlayArea"],noLibraryCSS:false,version:"1.32.3"});sap.ui.vk.GraphicsCoreApi={LegacyDvl:"LegacyDvl"};sap.ui.vk.ContentResourceSourceCategory={"3D":"3D","2D":"2D"};sap.ui.vk.ContentResourceSourceTypeToCategoryMap={"vds":sap.ui.vk.ContentResourceSourceCategory["3D"],"png":sap.ui.vk.ContentResourceSourceCategory["2D"],"jpg":sap.ui.vk.ContentResourceSourceCategory["2D"],"gif":sap.ui.vk.ContentResourceSourceCategory["2D"]};sap.ui.vk.dvl={checkResult:function(r){if(r<0){throw new D(r,sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(r):"");}return r;},getPointer:function(p){if(p.indexOf("errorcode")===0){var c=parseInt(p.substr(15),16)-0x100;throw new D(c,sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(c):"");}return p;},getJSONObject:function(o){if(q.type(o)==="number"){throw new D(o,sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(o):"");}return o;}};return sap.ui.vk;});};if(!jQuery.sap.isDeclared('sap.ui.vk.BaseNodeProxy')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
jQuery.sap.declare('sap.ui.vk.BaseNodeProxy');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.Object');sap.ui.define("sap/ui/vk/BaseNodeProxy",["jquery.sap.global","./library","sap/ui/base/Object"],function(q,l,B){"use strict";var g=sap.ui.vk.dvl.getJSONObject;var a=B.extend("sap.ui.vk.BaseNodeProxy",{metadata:{publicMethods:["getNodeId","getName","getNodeMetadata","getHasChildren"]},constructor:function(n,b){this.init(n,b);},init:function(n,b){this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneId=n?n._getDvlSceneId():null;this._dvlNodeId=b;},reset:function(){this._dvlNodeId=null;this._dvlSceneId=null;this._dvl=null;},getNodeId:function(){return this._dvlNodeId;},getName:function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,this._dvlNodeId,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName;},getNodeMetadata:function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneId,this._dvlNodeId)).metadata;},getHasChildren:function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,this._dvlNodeId,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN;}});return a;});};if(!jQuery.sap.isDeclared('sap.ui.vk.CheckEye')){jQuery.sap.declare('sap.ui.vk.CheckEye');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.commons.CheckBox');sap.ui.define("sap/ui/vk/CheckEye",['jquery.sap.global','sap/ui/commons/CheckBox','./library'],function(q,C,l){"use strict";var a=C.extend("sap.ui.vk.CheckEye",{metadata:{library:"sap.ui.vk",properties:{}},onAfterRendering:function(){var $=this.$();$.removeClass('sapUiCb');$.removeClass('sapUiCbChk');$.removeClass('sapUiCbInteractive');$.removeClass('sapUiCbStd');$.addClass('sapUiCheckEye');},renderer:{}});return a;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.ContentResource')){jQuery.sap.declare('sap.ui.vk.ContentResource');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.ManagedObject');sap.ui.define("sap/ui/vk/ContentResource",["jquery.sap.global","./library","sap/ui/base/ManagedObject"],function(q,l,M){"use strict";var C=M.extend("sap.ui.vk.ContentResource",{metadata:{properties:{source:"sap.ui.core.URI",sourceType:"string",sourceId:"string",localMatrix:"sap.ui.vk.TransformationMatrix",name:"string"},aggregations:{contentResources:"sap.ui.vk.ContentResource"}},isTreeBinding:function(n){return n==="contentResources";},constructor:function(i,s,S){M.apply(this,arguments);this._loaded=false;this._file=null;this._nodeProxy=null;},destroy:function(){this._nodeProxy=null;this._file=null;M.prototype.destroy.call(this);},setFile:function(f){this._file=f;this.setSource(f.name);var i=f.name.lastIndexOf(".");if(i>=0&&i<f.name.length-1){this.setSourceType(f.name.substr(i+1));}else{this.setSourceType(undefined);}return this;},getFile:function(){return this._file;},setLoaded:function(){if(this._loaded){q.sap.log.warning("Content resource can be marked as loaded only once.");}this._loaded=true;return this;},getLoaded:function(){return this._loaded;},_setNodeProxy:function(n){this._nodeProxy=n;return this;},getNodeProxy:function(){return this._nodeProxy;},setProperty:function(n,v,s){if(this._loaded){q.sap.log.warning("Content resource's property "+n+" cannot be changed after the content resource has been loaded.");}else{M.prototype.setProperty.apply(this,arguments);}return this;}});return C;});};if(!jQuery.sap.isDeclared('sap.ui.vk.DownloadManager')){jQuery.sap.declare('sap.ui.vk.DownloadManager');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.EventProvider');sap.ui.define("sap/ui/vk/DownloadManager",["jquery.sap.global","./library","sap/ui/base/EventProvider"],function(q,l,E){"use strict";var D=E.extend("sap.ui.vk.DownloadManager",{metadata:{publicMethods:["start","attachItemSucceeded","detachItemSucceeded","attachItemFailed","detachItemFailed","attachAllItemsCompleted","detachAllItemsCompleted"],events:{itemSucceeded:{parameters:{source:{type:"any"},response:{type:"object"}}},itemFailed:{parameters:{source:{type:"any"},status:{type:"any"},statusText:{type:"string"}}},allItemsCompleted:{}}},constructor:function(s,m){E.apply(this);this._maxParallelTasks=m||5;this._sourcesToProcess=s.slice();this._sourcesBeingProcessed=[];},start:function(){while(this._pickAndDispatchTask()){}return this;},_pickAndDispatchTask:function(){if(this._sourcesToProcess.length>0&&this._sourcesBeingProcessed.length<this._maxParallelTasks){var s=this._sourcesToProcess.shift();this._sourcesBeingProcessed.push(s);this._runTask(s);return true;}return false;},_taskFinished:function(s){var i=this._sourcesBeingProcessed.indexOf(s);if(i>=0){this._sourcesBeingProcessed.splice(i,1);}return this._sourcesToProcess.length===0&&this._sourcesBeingProcessed.length===0;},_runTask:function(s){var t=this;if(typeof s==="string"){var x=new XMLHttpRequest();x.onreadystatechange=function(e){if(x.readyState===x.DONE){var i=t._taskFinished(s);t._pickAndDispatchTask();if(x.status===200){t.fireItemSucceeded({source:s,response:x.response});}else{t.fireItemFailed({source:s,status:x.status,statusText:x.statusText});}if(i){t.fireAllItemsCompleted({});}}};x.open("GET",s,true);x.responseType="arraybuffer";x.send(null);}else if(s instanceof File){var f=new FileReader();f.onload=function(e){var i=t._taskFinished(s);t._pickAndDispatchTask();t.fireItemSucceeded({source:s,response:f.result});if(i){t.fireAllItemsCompleted({});}};f.onerror=function(e){var i=t._taskFinished(s);t._pickAndDispatchTask();t.fireItemFailed({source:s,status:f.error.name,statusText:f.error.message});if(i){t.fireAllItemsCompleted({});}};f.readAsArrayBuffer(s);}else{throw new Error("Unsupported type of the 'source' parameter");}return this;},attachItemSucceeded:function(d,f,a){return this.attachEvent("itemSucceeded",d,f,a);},detachItemSucceeded:function(f,a){return this.detachEvent("itemSucceeded",f,a);},fireItemSucceeded:function(p,a,e){return this.fireEvent("itemSucceeded",p,a,e);},attachItemFailed:function(d,f,a){return this.attachEvent("itemFailed",d,f,a);},detachItemFailed:function(f,a){return this.detachEvent("itemFailed",f,a);},fireItemFailed:function(p,a,e){return this.fireEvent("itemFailed",p,a,e);},attachAllItemsCompleted:function(d,f,a){return this.attachEvent("allItemsCompleted",d,f,a);},detachAllItemsCompleted:function(f,a){return this.detachEvent("allItemsCompleted",f,a);},fireAllItemsCompleted:function(p,a,e){return this.fireEvent("allItemsCompleted",p,a,e);}});return D;});};if(!jQuery.sap.isDeclared('sap.ui.vk.FlexibleControl')){jQuery.sap.declare('sap.ui.vk.FlexibleControl');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.ui.core.EnabledPropagator');sap.ui.define("sap/ui/vk/FlexibleControl",['jquery.sap.global','sap/ui/core/Control','sap/ui/core/EnabledPropagator','./library'],function(q,C,E,l){"use strict";var F=C.extend("sap.ui.vk.FlexibleControl",{metadata:{library:"sap.ui.vk",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},layout:{type:"string",group:"Behavior",defaultValue:"Stacked"},enabled:{type:"boolean",group:"Behavior",defaultValue:true}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},designTime:true}});E.call(F.prototype);return F;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.FlexibleControlLayoutData')){jQuery.sap.declare('sap.ui.vk.FlexibleControlLayoutData');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.LayoutData');sap.ui.define("sap/ui/vk/FlexibleControlLayoutData",['jquery.sap.global','sap/ui/core/LayoutData','./library'],function(q,L,l){"use strict";var F=L.extend("sap.ui.vk.FlexibleControlLayoutData",{metadata:{library:"sap.ui.vk",properties:{size:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'auto'},minSize:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'0px'},marginTop:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'0px'},marginBottom:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'0px'}}}});return F;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.NativeViewport')){jQuery.sap.declare('sap.ui.vk.NativeViewport');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.ui.core.ResizeHandler');sap.ui.define("sap/ui/vk/NativeViewport",["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","./Loco","./ViewportHandler"],function(q,l,C,R,L,V){"use strict";var N=C.extend("sap.ui.vk.NativeViewport",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","endGesture","pan","rotate","zoom","tap","queueCommand","getViewInfo","setViewInfo","loadUrl"],events:{"resize":{parameters:{oldSize:"object",size:"object"}},"move":{parameters:{pan:"object",zoom:"float"}}}},init:function(){if(C.prototype.init){C.prototype.init(this);}this._canvas=null;this._canvas=document.createElement("div");this._canvas.style.overflow="none";this._canvas.style.width="100%";this._canvas.style.height="100%";this._canvas.id=q.sap.uid();this._resizeListenerId=null;this._viewportHandler=new V(this);this._loco=new L();this._loco.addHandler(this._viewportHandler);this._img=null;this._reset();this._gx=0;this._gy=0;this._imageW=0;this._imageH=0;},exit:function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();this._inputDevice.disable();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(C.prototype.exit){C.prototype.exit.apply(this);}},onBeforeRendering:function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}},onAfterRendering:function(){if(this._canvas){var d=this.getDomRef();d.appendChild(this._canvas);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._bestFit();this._handleResize({size:{width:d.clientWidth,height:d.clientHeight}});}},_handleResize:function(e){this.fireResize({oldSize:e.oldSize,size:e.size});this._update();},_reset:function(){this._x=0;this._y=0;this._s=1.0;this._r=0;},_update:function(){if(this._img!=null){var x=this._x-(this._imageW-this._canvas.clientWidth)/2;var y=this._y-(this._imageH-this._canvas.clientHeight)/2;var t="matrix("+this._s+",0,0,"+this._s+","+x+","+y+")";this._img.style.transform=t;this._img.style.webkitTransform=t;this._img.style.msTransform=t;this._img.style.MozTransform=t;this._img.style.OTransform=t;}},_bestFit:function(){this._reset();var s=this._canvas.clientWidth/this._imageW;var a=this._canvas.clientHeight/this._imageH;this._s=s<a?s:a;if(this._s==0){this._s=1.0;}this._x=0;this._y=0;this._update();},loadUrl:function(u,o,a,b,r){if(/^(jpg|png|gif)$/.test(r)==false){q.sap.log.error("Unsupported content resource type "+r);return this;}while(this._canvas.lastChild){this._canvas.removeChild(this._canvas.lastChild);}this._reset();this._img=new Image();this._img.onload=function(){this._imageW=this._img.width;this._imageH=this._img.height;this._canvas.appendChild(this._img);this._bestFit();o();}.bind(this);this._img.onerror=function(){a();};this._img.src=u;return this;},beginGesture:function(x,y){this._gx=(x-this._canvas.clientWidth/2-this._x)/this._s;this._gy=(y-this._canvas.clientHeight/2-this._y)/this._s;return this;},endGesture:function(){this._gx=0;this._gy=0;return this;},pan:function(d,a){this._x+=d;this._y+=a;this._update();this.fireMove({pan:{x:d,y:a},zoom:1.0});return this;},rotate:function(d,a){this._x+=d;this._y+=a;this._update();this.fireMove({pan:{x:d,y:a},zoom:1.0});return this;},zoom:function(z){var g=this._gx*this._s;var a=this._gy*this._s;this._s*=z;var b=this._gx*this._s;var c=this._gy*this._s;var d=g-b;var e=a-c;this._x+=d;this._y+=e;this._update();this.fireMove({pan:{x:d,y:e},zoom:z});return this;},tap:function(x,y,i){if(i){this._bestFit();}return this;},queueCommand:function(c){c();return this;},getViewInfo:function(){var v={};v.camera=[this._s,0,0,this._s,this._x,this._y];return v;},setViewInfo:function(v){var c=v.camera;this._s=c[0];this._x=c[4];this._y=c[5];this._update();return this;}});return N;});};if(!jQuery.sap.isDeclared('sap.ui.vk.NodeProxy')){jQuery.sap.declare('sap.ui.vk.NodeProxy');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.ManagedObject');sap.ui.define("sap/ui/vk/NodeProxy",["jquery.sap.global","./library","sap/ui/base/ManagedObject"],function(q,l,M){"use strict";var g=sap.ui.vk.dvl.getJSONObject;var N=M.extend("sap.ui.vk.NodeProxy",{metadata:{properties:{nodeId:"string",name:"string",localMatrix:{type:"sap.ui.vk.TransformationMatrix",bindable:"bindable"},worldMatrix:{type:"sap.ui.vk.TransformationMatrix",bindable:"bindable"},opacity:{type:"float",bindable:"bindable"},tintColorABGR:{type:"int",bindable:"bindable"},nodeMetadata:"object",hasChildren:"boolean",closed:"boolean"}},constructor:function(n,a){M.call(this);this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneId=n?n._getDvlSceneId():null;this._dvlNodeId=a;},destroy:function(){this._dvlNodeId=null;this._dvlSceneId=null;this._dvl=null;M.prototype.destroy.call(this);},getNodeId:function(){return this._dvlNodeId;},getName:function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._getDvlSceneId,this._dvlNodeId,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName;},getLocalMatrix:function(){return sap.ui.vk.TransformationMatrix.convertTo4x3(g(this._dvl.Scene.GetNodeLocalMatrix(this._dvlSceneId,this._dvlNodeId)).matrix);},setLocalMatrix:function(v){this._dvl.Scene.SetNodeLocalMatrix(this._dvlSceneId,this._dvlNodeId,sap.ui.vk.TransformationMatrix.convertTo4x4(v));this.setProperty("localMatrix",v,true);return this;},getWorldMatrix:function(){return sap.ui.vk.TransformationMatrix.convertTo4x3(g(this._dvl.Scene.GetNodeWorldMatrix(this._dvlSceneId,this._dvlNodeId)).matrix);},setWorldMatrix:function(v){this._dvl.Scene.SetNodeWorldMatrix(this._dvlSceneId,this._dvlNodeId,sap.ui.vk.TransformationMatrix.convertTo4x4(v));this.setProperty("worldMatrix",v,true);return this;},getOpacity:function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,this._dvlNodeId,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_OPACITY)).Opacity;},setOpacity:function(v){this._dvl.Scene.SetNodeOpacity(this._dvlSceneId,this._dvlNodeId,v);this.setProperty("opacity",v,true);return this;},getTintColorABGR:function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,this._dvlNodeId,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_HIGHLIGHT_COLOR)).HighlightColor;},setTintColorABGR:function(v){this._dvl.Scene.SetNodeHighlightColor(this._dvlSceneId,this._dvlNodeId,v);this.setProperty("tintColorABGR",v,true);return this;},getNodeMetadata:function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneId,this._dvlNodeId)).metadata;},getHasChildren:function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,this._dvlNodeId,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN;},getClosed:function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,this._dvlNodeId,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)!==0;}});delete N.prototype.setClosed;delete N.prototype.setHasChildren;delete N.prototype.setName;delete N.prototype.setNodeId;delete N.prototype.setNodeMetadata;return N;});};if(!jQuery.sap.isDeclared('sap.ui.vk.Overlay')){
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
jQuery.sap.declare('sap.ui.vk.Overlay');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.ui.core.IconPool');jQuery.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-widget');jQuery.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-core');jQuery.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-mouse');jQuery.sap.require('sap.ui.thirdparty.jqueryui.jquery-ui-draggable');jQuery.sap.require('sap.ui.vbm.lib.sapvbi');sap.ui.define("sap/ui/vk/Overlay",['jquery.sap.global','./library','sap/ui/core/Control','sap/ui/core/IconPool','sap/ui/thirdparty/jqueryui/jquery-ui-widget','sap/ui/thirdparty/jqueryui/jquery-ui-core','sap/ui/thirdparty/jqueryui/jquery-ui-mouse','sap/ui/thirdparty/jqueryui/jquery-ui-draggable','sap/ui/vbm/lib/sapvbi'],function(q,l,C,I,j,a,b,c,d){"use strict";var O=C.extend("sap.ui.vk.Overlay",{metadata:{library:"sap.ui.vk",properties:{zoomOnResize:{type:"boolean",group:"Behavior",defaultValue:true}},aggregations:{areas:{type:"sap.ui.vk.OverlayArea",multiple:true,singularName:"area"}},associations:{target:{type:"sap.ui.core.Control",cardinality:"0..1"}},events:{click:{parameters:{clientX:{type:"int"},clientY:{type:"int"},pos:{type:"string"}}},contextMenu:{parameters:{pos:{type:"string"},menu:{type:"sap.ui.unified.Menu"}}}}}});O.prototype.getPositionInteractive=function(p,e){if(!this.mIACreateCB&&e&&typeof(e)==="function"){this.mIACreateCB=e;var t="POS";if(p){t+="ARRAY";}var L={"SAPVB":{"Automation":{"Call":{"handler":"OBJECTCREATIONHANDLER","name":"CreateObject","object":"MainScene","scene":"MainScene","instance":"","Param":{"name":"data","#":"{"+t+"}"}}}}};this._load(L);return true;}else{return false;}};O.prototype.openContextMenu=function(m){this._openContextMenu("Overlay",this,m);};O.prototype.init=function(){this.aLoadQueue=null;this.oTargetDomRef=null;this.mVBIContext=new VBI.VBIContext(this);this.resizeID="";this.bVosDirty=true;this.bWindowsDirty=true;this.bSceneDirty=true;this.bDataDeltaUpdate=false;this.bHandleDataChangeActive=false;this.bForceDataUpdate=false;this.mAddMenuItems=[];};O.prototype.exit=function(){if(this.mVBIContext){this.mVBIContext.clear();}if(this.resizeID!=""){sap.ui.core.ResizeHandler.deregister(this.resizeID);this.resizeID="";}};O.prototype.resize=function(e){var f=(this.oControl!=undefined)?this.oControl:this;var g=f.mVBIContext;if(g){var s=g.GetMainScene();if(s){if(f.getZoomOnResize()&&e&&e.oldSize.width>0){var z=Math.log2(e.size.width/e.oldSize.width);s.ZoomToGeoPosition(s.GetCenterPos(),s.GetCurrentZoomlevel()+z,false,true,true);}s.resizeCanvas(e,true,true);}}f._adaptSizeOfTarget();};O.prototype.setTarget=function(t){var e=this;this.setAssociation("target",t);if(t instanceof sap.m.Image){t.addEventDelegate({onAfterRendering:function(E){e.oTargetDomRef=t.getDomRef();e.oTargetDomRef.addEventListener("load",q.proxy(e._adaptSizeOfTarget,e));}});}if(t instanceof sap.ui.vk.NativeViewport){t.addEventDelegate({onAfterRendering:function(E){e.oTargetDomRef=t.getDomRef();e._adaptSizeOfTarget();}});}};O.prototype._adaptSizeOfTarget=function(){var t=this.oTargetDomRef;var f=this.getDomRef();if(t){try{var T=q(t);var p={top:T.offset().top,left:T.offset().left,width:T.outerWidth(),height:T.outerHeight()};q(f).width(p.width).height(p.height).css("position","absolute");q(f).css("top","0px").css("left","0px").css("visibility","");}catch(e){q.sap.log.error(e);}q(f).insertAfter(t);}else{q(f).css("position","fixed").width("0px").height("0px").css("top","0px").css("left","0px").css("visibility","hidden");}};O.prototype.onAfterRendering=function(){if(this.$oldContent.length>0){this.$().append(this.$oldContent);}this._adaptSizeOfTarget();if(this.aLoadQueue){var n;for(n=0;n<this.aLoadQueue.length;++n){this._load(this.aLoadQueue[n]);}this.aLoadQueue=null;}if(this.resizeID==""){this.resize();this.resizeID=sap.ui.core.ResizeHandler.register(this,this.resize);}var o=this.getId();if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.Awake(o);}};O.prototype.onBeforeRendering=function(){this.$oldContent=sap.ui.core.RenderManager.findPreservedContent(this.getId());};O.prototype.invalidate=function(s){this.bSceneDirty=true;if(s instanceof sap.ui.vk.OverlayArea){this.bVosDirty=true;this.bDataDeltaUpdate=this.bHandleDataChangeActive;}sap.ui.core.Control.prototype.invalidate.apply(this,arguments);};O.prototype._load=function(e){if(!this.isRendered()){if(!this.aLoadQueue){this.aLoadQueue=[];}this.aLoadQueue.push(e);return;}this._loadHtml(e);};O.prototype._loadHtml=function(e){var o=this.getId();var f=null;if(typeof e=='string'){f=JSON.parse(e.indexOf('{')?e.substr(e.indexOf('{')):e);}else if(typeof e=='object'){f=e;}if(!f){return;}if(!f["SAPVB"]){var m;if(this.mVBIContext&&(m=(new VBI.Adaptor(this.mVBIContext)).CreateLoadData(f))){this.loadHtml(m);return;}else{return;}}var M=false;var g=false;var h=false;if(q.type(f)=='object'){if(f.SAPVB){if(f.SAPVB.Config){this.mVBIContext.GetConfig().load(f.SAPVB.Config,this.mVBIContext);}if(f.SAPVB.Resources){this.mVBIContext.GetResources().load(f.SAPVB.Resources,this.mVBIContext);}if(f.SAPVB.DataTypes){if(!this.mVBIContext.m_DataTypeProvider){this.mVBIContext.m_DataTypeProvider=new VBI.DataTypeProvider();}this.mVBIContext.m_DataTypeProvider.load(f.SAPVB.DataTypes,this.mVBIContext);}if(f.SAPVB.Data){if(!this.mVBIContext.m_DataProvider){this.mVBIContext.m_DataProvider=new VBI.DataProvider();}this.mVBIContext.m_DataProvider.load(f.SAPVB.Data,this.mVBIContext);M=true;}if(f.SAPVB.Windows){if(!this.mVBIContext.m_Windows){this.mVBIContext.m_Windows=new VBI.Windows();}this.mVBIContext.m_Windows.load(f.SAPVB.Windows,this.mVBIContext);h=true;}if(f.SAPVB.Actions){if(!this.mVBIContext.m_Actions){this.mVBIContext.m_Actions=new VBI.Actions();}this.mVBIContext.m_Actions.load(f.SAPVB.Actions,this.mVBIContext);}if(f.SAPVB.Automation){if(!this.mVBIContext.m_Automations){this.mVBIContext.m_Automations=new VBI.Automations();}this.mVBIContext.m_Automations.load(f.SAPVB.Automation,this.mVBIContext);}if(f.SAPVB.Menus){if(!this.mVBIContext.m_Menus){this.mVBIContext.m_Menus=new VBI.Menus();}this.mVBIContext.m_Menus.load(f.SAPVB.Menus,this.mVBIContext);}if(f.SAPVB.Scenes){if(!this.mVBIContext.m_SceneManager){this.mVBIContext.m_SceneManager=new VBI.SceneManager();}this.mVBIContext.m_SceneManager.load(f.SAPVB.Scenes,this.mVBIContext);g=true;}}if(M){if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.NotifyDataChange();}}if(g||h){if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.Awake(o);}}if(g||M){if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.RenderAsync();}}}};O.prototype._openContextMenu=function(t,i,m){if(m&&m.vbi_data&&m.vbi_data.VBIName=="DynContextMenu"){if(!this.mVBIContext.m_Menus){this.mVBIContext.m_Menus=new window.VBI.Menus();}for(var n=0;n<this.mAddMenuItems.length;++n){m.addItem(this.mAddMenuItems[n]);}this.mVBIContext.m_Menus.m_menus.push(m);this._loadHtml({"SAPVB":{"version":"2.0","Automation":{"Call":{"earliest":"0","handler":"CONTEXTMENUHANDLER","instance":i.sId,"name":"SHOW","object":t,"refID":"CTM","Param":[{"name":"x","#":i.mClickPos[0]},{"name":"y","#":i.mClickPos[1]},{"name":"scene","#":"MainScene"}]}}}});}this.mAddMenuItems=[];};O.prototype._update=function(){var A={SAPVB:{}};if(this.bSceneDirty){this._updateScene(A);}this._updateWindows(A);if(A.SAPVB.Actions){Array.prototype.push.apply(A.SAPVB.Actions.Set.Action,this._getActionArray());}return this._minimizeApp(A);};O.prototype._minimizeApp=function(A){var t,s;s=null;if(!this.bWindowsDirty){(t=A)&&(t=t.SAPVB)&&(t=t.Windows)&&(s=JSON.stringify(t))&&(s==this.mCurWindows)&&(delete A.SAPVB.Windows)||(this.mCurWindows=s?s:this.mCurWindows);}else{this.bWindowsDirty=false;}s=null;(t=A)&&(t=t.SAPVB)&&(t=t.Scenes)&&(s=JSON.stringify(t))&&(s==this.mCurScenes)&&(delete A.SAPVB.Scenes)||(this.mCurScenes=s?s:this.mCurScenes);s=null;(t=A)&&(t=t.SAPVB)&&(t=t.Actions)&&(s=JSON.stringify(t))&&(s==this.mCurActions)&&(delete A.SAPVB.Actions)||(this.mCurActions=s?s:this.mCurActions);s=null;(t=A)&&(t=t.SAPVB)&&(t=t.DataTypes)&&(s=JSON.stringify(t))&&(s==this.mCurDataTypes)&&(delete A.SAPVB.DataTypes)||(this.mCurDataTypes=s?s:this.mCurDataTypes);if(!this.bForceDataUpdate){s=null;(t=A)&&(t=t.SAPVB)&&(t=t.Data)&&(s=JSON.stringify(t))&&(s==this.mCurData)&&(delete A.SAPVB.Data)||(this.mCurData=s?s:this.mCurData);}else{this.bForceDataUpdate=false;}return A;};O.prototype._updateWindows=function(A){A.SAPVB.Windows={"Set":[{"name":"Main","Window":{"id":"Main","caption":"MainWindow","type":"geo","refParent":"","refScene":"MainScene","modal":"true"}}]};};O.prototype._updateScene=function(A){var s=[];var e=[];var f=[];var g=[];this._updateVOData(s,e,f,g);var _=JSON.stringify(s);var m=true;if(!this.saVO){((((A.SAPVB.Scenes={}).Set={}).SceneGeo={id:"MainScene",scaleVisible:"false",navControlVisible:"false",VisualFrame:{minLOD:6,maxLOD:14},NavigationDisablement:{move:"true",zoom:"true"},initialZoom:"10",initialStartPosition:"0.5;0.5;0"}).VO=s);}else if(this.bRefMapLayerStackDirty||!(this.saVO===_)){(A.SAPVB.Scenes=this._getSceneVOdelta(JSON.parse(this.m_saVO),s));}else{m=false;}this.saVO=_;if(this.bDataDeltaUpdate){A.SAPVB.Data=[];for(var n=0;n<e.length;++n){A.SAPVB.Data.push({Set:{name:e[n].name,type:"N",N:e[n]}});}}else{((A.SAPVB.Data={}).Set={}).N=e;}if(m){(((A.SAPVB.DataTypes={}).Set={}).N=f);}if(m){(((A.SAPVB.Actions={}).Set={}).Action=g);}this.bSceneDirty=this.bVosDirty=this.bDataDeltaUpdate=false;};O.prototype._isEventRegistered=function(A,e){var f=this.getAggregation(A);if(!f){return false;}for(var n=0;n<f.length;++n){var i=f[n];if(i.hasListeners(e)){return true;}}return false;};O.prototype._getTemplateBindingInfo=function(A){var B=this.getBindingInfo(A);if(B&&B.template){return B.template.mBindingInfos;}};O.prototype._getBindInfo=function(A){var B={};var t=this._getTemplateBindingInfo(A);B.C=(t)?t.hasOwnProperty("color"):true;B.CB=(t)?t.hasOwnProperty("colorBorder"):true;B.DCH=(t)?t.hasOwnProperty("deltaColorHot"):true;B.CS=(t)?t.hasOwnProperty("colorSelect"):true;B.CNS=(t)?t.hasOwnProperty("colorNonSelect"):true;B.TT=(t)?t.hasOwnProperty("tooltip"):true;B.M=(t)?t.hasOwnProperty("changeable"):true;B.hasTemplate=(t)?true:false;return B;};O.prototype._updateVOData=function(s,e,f,g){var B,v;this.AreaBindInfo=B=(this.AreaBindInfo)?this.AreaBindInfo:this._getBindInfo("areas");v=(B.hasTemplate)?this.getBindingInfo("areas").template:null;var o={id:"OverlayArea",datasource:"OverlayArea",type:"{00100000-2012-0004-B001-F311DE491C77}"};o['posarray.bind']=o.id+".P";if(B.C){o['color.bind']=o.id+".C";}else{o.color=v.getColor();}if(B.CB){o['colorBorder.bind']=o.id+".C";}else{o.colorBorder=v.getColorBorder();}if(B.DCH){o['hotDeltaColor.bind']=o.id+".DCH";}else{o.hotDeltaColor=v.getDeltaColorHot();}if(B.CS){o['colorSelect.bind']=o.id+".C";}else{o.colorSelect=v.getColorSelect();}if(B.CNS){o['colorNonSelect.bind']=o.id+".C";}else{o.colorNonSelect=v.getColorNonSelect();}if(!B.M){o['VB:c']=v.getChangeable();}s.push(o);var h={name:o.id,key:'K'};h.A=[{"name":"K","alias":"K","type":"string"},{"name":"VB:s","alias":"VB:s","type":"boolean"},{"name":"P","alias":"P","type":"vectorarray","changeable":"true"}];if(B.C){h.A.push({"name":"C","alias":"C","type":"color"});}if(B.CB){h.A.push({"name":"CB","alias":"CB","type":"string"});}if(B.DCH){h.A.push({"name":"DCH","alias":"DCH","type":"string"});}if(B.CS){h.A.push({"name":"CS","alias":"CS","type":"string"});}if(B.CNS){h.A.push({"name":"CNS","alias":"CNS","type":"string"});}if(B.TT){h.A.push({"name":"TT","alias":"TT","type":"string"});}f.push(h);var i=o.id;if(this._isEventRegistered("areas","click")){g.push({"id":i+"1","name":"click","refScene":"MainScene","refVO":i,"refEvent":"Click","AddActionProperty":[{"name":"pos"}]});}if(this._isEventRegistered("areas","contextMenu")){g.push({"id":i+"2","name":"contextMenu","refScene":"MainScene","refVO":i,"refEvent":"ContextMenu"});}if(this._isEventRegistered("areas","edgeClick")){g.push({"id":i+"7","name":"edgeClick","refScene":"MainScene","refVO":i,"refEvent":"EdgeClick"});}g.push({"id":i+"4","name":"handleMoved","refScene":"MainScene","refVO":i,"refEvent":"HandleMoved"});g.push({"id":i+"5","name":"handleContextMenu","refScene":"MainScene","refVO":i,"refEvent":"HandleContextMenu"});g.push({"id":i+"8","name":"edgeContextMenu","refScene":"MainScene","refVO":i,"refEvent":"EdgeContextMenu"});if(this._isEventRegistered("areas","handleClick")){g.push({"id":i+"6","name":"handleClick","refScene":"MainScene","refVO":i,"refEvent":"HandleClick"});}var k={name:o.id,E:[]};var m=this.getAreas();for(var n=0;n<m.length;++n){k.E.push(m[n].getDataElement());}e.push(k);};O.prototype._getSceneVOdelta=function(o,n){var v=[];var r=[];var V={};for(var e=0,f=o.length;e<f;++e){V[o[e].id]=o[e];}for(var g=0;g<n.length;++g){if(V[n[g].id]){if(JSON.stringify(n[g])!=JSON.stringify(V[n[g].id])){r.push({"id":n[g].id,"type":"VO"});v.push(n[g]);}}else{v.push(n[g]);}delete V[n[g].id];}for(var i in V){r.push({"id":i,"type":"VO"});}var h={"Merge":{"name":"MainScene","type":"SceneGeo","SceneGeo":{"id":"MainScene"}}};if(r.length){h.Merge.SceneGeo.Remove=r;}if(v.length){h.Merge.SceneGeo.VO=v;}return h;};O.prototype._getActionArray=function(){var A=[];if(this.mEventRegistry["click"]){A.push({"id":"Overlay1","name":"click","refScene":"MainScene","refVO":"Map","refEvent":"Click","AddActionProperty":[{"name":"pos"}]});}if(this.mEventRegistry["contextMenu"]){A.push({"id":"Overlay2","name":"contextMenu","refScene":"MainScene","refVO":"Map","refEvent":"ContextMenu","AddActionProperty":[{"name":"pos"}]});}A.push({"id":"Overlay3","name":"GetPosComplete","refScene":"MainScene","refVO":"General","refEvent":"CreateComplete"});return A;};O.prototype._handleChangedData=function(n){try{this.bHandleDataChangeActive=true;if(n&&n.length){for(var e=0,N;e<n.length;++e){N=n[e];if(N.E&&N.E.length){for(var f=0,E,i;f<N.E.length;++f){E=N.E[f];i=this._findInstance(E.K);if(i){i.handleChangedData(E);}}}}}this.bHandleDataChangeActive=false;}catch(g){this.bHandleDataChangeActive=false;throw g;}};O.prototype._findInstance=function(i){var e=(i.indexOf(".")!==-1)?i.split(".")[1]:i;var A=this.getAreas();for(var n=0;n<A.length;++n){var E=A[n];if(E.getId()===e){return E;}}return null;};O.prototype._handleAggregationEvent=function(e){var E;if((E=this._findInstance(e.Action.instance))){try{E.handleEvent(e);}catch(f){q.sap.log.error("Event handler failed: "+f.message);}}};O.prototype.isRendered=function(){return this.getDomRef()?true:false;};O.prototype.fireSubmit=function(e){var f=JSON.parse(e.data);if(f.Data&&f.Data.Merge){this._handleChangedData(f.Data.Merge.N);}if(f.Action.object==="OverlayArea"){this._handleAggregationEvent(f);}else{var A=f.Action.name,g;if(A==="click"||A==="contextMenu"){g=[f.Action.Params.Param[0]['#'],f.Action.Params.Param[1]['#']];}switch(A){case"GetPosComplete":if(this.mIACreateCB){try{this.mIACreateCB(f.Action.Params.Param[0]['#']);this.mIACreateCB=null;}catch(h){this.mIACreateCB=null;throw h;}}break;case"click":this.fireClick({clientX:g[0],clientY:g[1],pos:f.Action.AddActionProperties.AddActionProperty[0]['#']});break;case"contextMenu":q.sap.require("sap.ui.unified.Menu");if(this.mVBIContext.m_Menus){this.mVBIContext.m_Menus.deleteMenu("DynContextMenu");}var m=new sap.ui.unified.Menu();m.vbi_data={};m.vbi_data.menuRef="CTM";m.vbi_data.VBIName="DynContextMenu";this.mClickPos=g;this.fireContextMenu({pos:f.Action.AddActionProperties.AddActionProperty[0]['#'],menu:m});break;default:break;}}};O.prototype.fireRender=function(e){};O.prototype.fireMove=function(e){};O.prototype.fireZoom=function(e){};O.prototype.fireOpenWindow=function(e){};O.prototype.fireCloseWindow=function(e){};return O;});};if(!jQuery.sap.isDeclared('sap.ui.vk.OverlayArea')){jQuery.sap.declare('sap.ui.vk.OverlayArea');jQuery.sap.require('sap.ui.core.Element');sap.ui.define("sap/ui/vk/OverlayArea",['./library','sap/ui/core/Element'],function(l,E){"use strict";var O=E.extend("sap.ui.vk.OverlayArea",{metadata:{library:"sap.ui.vk",properties:{key:{type:"string",group:"Misc",defaultValue:null},position:{type:"string",group:"Misc",defaultValue:null},color:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 0.3)"},colorBorder:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 1.0)"},colorSelect:{type:"string",group:"Misc",defaultValue:null},colorNonSelect:{type:"string",group:"Misc",defaultValue:null},deltaColorHot:{type:"string",group:"Misc",defaultValue:'RHLSA(0;1.3;1.0;1.0)'},select:{type:"boolean",group:"Misc",defaultValue:false},changeable:{type:"boolean",group:"Misc",defaultValue:false}},events:{click:{clientX:{type:"int"},clientY:{type:"int"}},contextMenu:{parameters:{menu:{type:"sap.ui.unified.Menu"}}},edgeClick:{parameters:{index:{type:"int"}}},edgeContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleMoved:{},handleContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleClick:{index:{type:"int"}}}}});O.prototype.openContextMenu=function(m){this.getParent().openContextMenu("OverlayArea",this,m);};O.prototype.getDataElement=function(){var e={};var b=this.getParent().AreaBindInfo;e.K=this.getId();if(b.C){e.C=this.getColor();}if(b.CB){e.CB=this.getColorBorder();}if(b.DCH){e.DCH=this.getDeltaColorHot();}if(b.CS){e.CS=this.getColorSelect();}if(b.CNS){e.CNS=this.getColorNonSelect();}if(b.TT){e.TT=this.getTooltip();}e['VB:s']=this.getSelect();e.P=this.getPosition();if(b.M){e['VB:c']=this.getChangeable();}return e;};O.prototype.handleChangedData=function(e){if(e.P){this.setPosition(e.P);}};O.prototype.handleEvent=function(e){var a=e.Action.name;var f="fire"+a[0].toUpperCase()+a.slice(1);if(a==="contextMenu"||a==="edgeContextMenu"||a==="handleContextMenu"){var p=this.getParent();this.mClickPos=[e.Action.Params.Param[0]['#'],e.Action.Params.Param[1]['#']];jQuery.sap.require("sap.ui.unified.Menu");if(p.mVBIContext.m_Menus){p.mVBIContext.m_Menus.deleteMenu("DynContextMenu");}var m=new sap.ui.unified.Menu();m.vbi_data={};m.vbi_data.menuRef="CTM";m.vbi_data.VBIName="DynContextMenu";var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vk.i18n");if(this.getChangeable()){if(a==="edgeContextMenu"){var s=e.Action.Params.Param[2]['#'];p.mAddMenuItems.push(new sap.ui.unified.MenuItem({text:r.getText("OVL_AREA_EDGE_SPLIT"),select:this._handleCtxFunction.bind(this,"SPLIT",s)}));}else if(a==="handleContextMenu"){var h=e.Action.Params.Param[2]['#'];p.mAddMenuItems.push(new sap.ui.unified.MenuItem({text:r.getText("OVL_AREA_HANDLE_REMOVE"),select:this._handleCtxFunction.bind(this,"REMOVE",h)}));}}if(this.hasListeners(a)){if(a==="contextMenu"){this.firecontextMenu({menu:m});}else{this[f]({index:e.Action.Params.Param[2]['#'],menu:m});}}else{p._openContextMenu(e.Action.object,this,m);}}else{if(a=="click"){this.mClickPos=e.Action.AddActionProperties.AddActionProperty[0]['#'];this.fireClick({clientX:e.Action.Params.Param[0]['#'],clientY:e.Action.Params.Param[1]['#']});}else if(a.indexOf("Click")>-1){this[f]({index:e.Action.Params.Param[2]['#']});}else{this[f]();}}};O.prototype.getKey=function(){var k=this.getProperty("key");if(!k){k=this.getId();}return k;};O.prototype._handleCtxFunction=function(f,c){var p=this.getPosition().split(";");var o=c*3;if(f==="REMOVE"){p.splice(o,3);}else if(f==="SPLIT"){var s=[p[o],p[o+1]];var e=(o+3<p.length)?[p[o+3],p[o+4]]:[p[0],p[1]];var m=[parseFloat(s[0])+(e[0]-s[0])/2,parseFloat(s[1])+(e[1]-s[1])/2];p.splice(o+3,0,m[0].toString(),m[1].toString(),"0");}this.setPosition(p.toString().replace(/,/g,';'));};return O;});};if(!jQuery.sap.isDeclared('sap.ui.vk.SceneTree')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
jQuery.sap.declare('sap.ui.vk.SceneTree');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.ui.table.TreeTable');jQuery.sap.require('sap.ui.table.Column');jQuery.sap.require('sap.ui.model.json.JSONModel');jQuery.sap.require('sap.m.Title');sap.ui.define("sap/ui/vk/SceneTree",["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/table/TreeTable","sap/ui/table/Column","sap/ui/model/json/JSONModel","sap/m/Title","./CheckEye"],function(q,l,C,T,a,J,b,c){"use strict";var S=C.extend("sap.ui.vk.SceneTree",{metadata:{library:"sap.ui.vk",properties:{},events:{},associations:{},aggregations:{_tree:{type:"sap.ui.table.TreeTable",multiple:false,visibility:"visible"}}},setScene:function(s,v){this._scene=s;this._viewStateManager=v;if(this._viewStateManager){this._viewStateManager.attachSelectionChanged(null,this._nodeSelectionChanged.bind(this));this._viewStateManager.attachVisibilityChanged(null,this._nodeVisibilityChanged.bind(this));}this.refresh();},init:function(){if(C.prototype.init){C.prototype.init.apply(this);}this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vk.i18n");var _=new b({text:this.oResourceBundle.getText("SCENETREE_TITLE"),tooltip:this.oResourceBundle.getText("SCENETREE_TITLE")});_.onAfterRendering=function(){var $=this.$();$.addClass('sapUiVkTitle');};this._tree=new T({title:_,columns:[new a({label:this.oResourceBundle.getText("SCENETREE_NAME"),tooltip:this.oResourceBundle.getText("SCENETREE_NAME"),template:"name"}),new a({label:this.oResourceBundle.getText("SCENETREE_VISIBLE"),tooltip:this.oResourceBundle.getText("SCENETREE_VISIBLE"),template:new c().bindProperty("checked","visible"),width:"2.8em",resizable:false,hAlign:"Center"})],selectionMode:"Multi",selectionBehavior:"Row",visibleRowCountMode:"Auto",expandFirstLevel:false,collapseRecursive:true,enableSelectAll:false,rowHeight:32});this.setAggregation("_tree",this._tree,true);this._model=new J();this._tree.setModel(this._model);this._tree.bindRows({path:'/root'});this._tree.attachToggleOpenState(this._nodeOpenToggle.bind(this));this._tree.attachRowSelectionChange(this._nodeSelection.bind(this));this._tree.getBinding("rows").attachChange(this._dataChange.bind(this));this._viewStateManager=null;this._scene=null;this._syncing=false;this._selected={};this._toggled={};this._vsmSelected={};this._forwardTimer=0;this._reverseTimer=0;this._toExpand=null;this._vSyncing=false;this._lastChangeIsExpand=false;this._forwardVTimer=0;this._reverseVTimer=0;this._scrollTimer=0;},exit:function(){},onBeforeRendering:function(){this._tree.setVisible(true);},_pathToNode:function(p,d,t){p=p.substr(1);if(d==undefined){d=this._model.getData();}var n=d;var e=n;var f="";while(p.length>0){var g=p.indexOf('/');if(g>=0){f=p.substr(0,g);p=p.substr(g+1);}else{f=p;p="";}e=n;n=e[f];}if(t!=undefined){e[f]=t;}return n;},_indexToNodeId:function(i){var d=this._tree.getContextByIndex(i);if(d){var n=this._pathToNode(d.sPath,d.oModel.oData);return n.id;}else{return null;}},_deselectHidden:function(){var v=this._vsmSelected;var d=this._viewStateManager;var e=[];var u={};for(var i=0;;i++){var f=this._indexToNodeId(i);if(f==null){break;}if(v.hasOwnProperty(f)){u[f]=true;}}for(var k in v){if(v.hasOwnProperty(k)&&v[k]==true&&!u.hasOwnProperty(k)&&k!=""){e.push(k);v[k]=false;}}if(e.length>0){this._syncing=true;d.setSelectionState(e,false);this._syncing=false;}},_nodeSelection:function(e){if(this._tree.getBinding("rows")._aSelectedContexts!=undefined){return;}if(!this._syncing){if(this._forwardTimer>0){clearTimeout(this._forwardTimer);}var p=e.mParameters;var d=p.rowIndices;var f=this._tree.getSelectedIndices();if(d.length>=1&&f.length==1){if(d.indexOf(f[0])!=-1){this._deselectHidden();}}for(var i=0;i<d.length;i++){var g=d[i];if(this._toggled.hasOwnProperty(g)){this._toggled[g]=!this._toggled[g];}else{this._toggled[g]=true;}if(!this._selected.hasOwnProperty(g)){this._selected[g]=false;}}this._forwardTimer=setTimeout(this._resyncSelectionForward.bind(this),100);}},_nodeSelectionChanged:function(e){if(!this._syncing){if(this._reverseTimer>0){clearTimeout(this._reverseTimer);}var s=e.mParameters.selected;var d=e.mParameters.unselected;for(var i=0;i<d.length;i++){if(this._vsmSelected[d[i]]!=undefined){delete this._vsmSelected[d[i]];}}for(var i=0;i<s.length;i++){this._vsmSelected[s[i]]=true;}if(s.length==1){this._toExpand=s[0];}this._reverseTimer=setTimeout(this._resyncSelectionReverse.bind(this),100,true);}},_resyncSelectionForward:function(){this._forwardTimer=0;if(this._syncing){return false;}this._syncing=true;var v=this._viewStateManager;var d=this._vsmSelected;var s=this._selected;for(var i in s){if(s.hasOwnProperty(i)){var e=this._indexToNodeId(i);if(e==null||e==""){continue;}var f=s[i];if(this._toggled[i]){f=!f;}v.setSelectionState(e,f);s[i]=f;d[e]=f;}}this._toggled={};this._syncing=false;},_resyncSelectionReverse:function(s){this._reverseTimer=0;if(this._syncing){return;}if(this._toExpand){this._expandToNode(this._toExpand);this._toExpand=null;}this._syncing=true;var v=this._viewStateManager;var t=this._tree;var d=0;var e=-1;this._selected={};for(var i=0;;i++){var f=this._indexToNodeId(i);if(f==null||f==""){break;}var g=v.getSelectionState(f);if(g){this._selected[i]=true;d++;e=i;}if(g!=t.isIndexSelected(i)){if(g){t.addSelectionInterval(i,i);}else{t.removeSelectionInterval(i,i);}}}if(s&&d==1){if(this._scrollTimer>0){clearTimeout(this._scrollTimer);}this._scrollTimer=setTimeout(this._scrollToSelection.bind(this),300,e);}this._syncing=false;},_scrollToSelection:function(s){this._scrollTimer=0;var t=this._tree;var d=t._getScrollTop();var r=t.getRowHeight();var e=t._getScrollHeight();var n=e/r;while(d+n<=s||d>s){if(d+n<=s){t._scrollPageDown();}else{t._scrollPageUp();}var f=t._getScrollTop();if(f==d){break;}d=f;}},_expandToNode:function(n){if(n.constructor===Array){if(n.length>0){n=n[0];}else{return;}}var d=this._scene.getDefaultNodeHierarchy();var p=[];d.enumerateAncestors(n,function(j){p.push(j.getNodeId());});if(p.length<1){return;}var e=0;for(var i=0;e<p.length;i++){var f=this._indexToNodeId(i);if(f==null){break;}if(f==p[e]){if(!this._tree.isExpanded(i)){var g=this._tree.getContextByIndex(i);if(g){var h=this._pathToNode(g.sPath,g.oModel.oData);this._restoreChildren(h,g.sPath);}this._tree.expand(i);}e++;}}},_restoreChildren:function(n,p){var d=this._scene.getDefaultNodeHierarchy();var e=this._tree.getBinding("rows");var v=this._viewStateManager;var i=0;d.enumerateChildren(n.id,function(f){var g=f.getNodeId();var t={name:f.getName(),id:g,visible:v.getVisibilityState(g)};if(f.getHasChildren()){var h=p+'/'+i;if(e.mContextInfo&&e.mContextInfo[h]!=undefined&&e.mContextInfo[h].bExpanded){this._restoreChildren(t,h);}else{t[0]={};}}n[i]=t;i+=1;}.bind(this));},_restoreChildrenCollapsed:function(n,p){var d=this._scene.getDefaultNodeHierarchy();var e=this._tree.getBinding("rows");var v=this._viewStateManager;var i=0;d.enumerateChildren(n.id,function(f){var g=f.getNodeId();var t={name:f.getName(),id:g,visible:v.getVisibilityState(g)};if(f.getHasChildren()){t[0]={};var h=p+'/'+i;if(e.mContextInfo[h]!=undefined){e.mContextInfo[h].bExpanded=false;}}n[i]=t;i+=1;});},_nodeOpenToggle:function(e){if(this._reverseTimer>0){clearTimeout(this._reverseTimer);}var p=e.mParameters;var d=p.rowContext.oModel.oData;var f=p.rowContext.sPath;var n=this._pathToNode(f,d);if(p.expanded){this._restoreChildren(n,f);}else if(n[0]!=undefined){var g={name:n.name,id:n.id,visible:this._viewStateManager.getVisibilityState(n.id),0:{}};this._pathToNode(f,d,g);}this._lastChangeIsExpand=true;this._reverseTimer=setTimeout(this._resyncSelectionReverse.bind(this),100,false);},_dataChange:function(e){if(this._viewStateManager==null||this._scene==null||this._vSyncing){return;}if(this._lastChangeIsExpand){this._lastChangeIsExpand=false;return;}if(this._forwardVTimer>0){clearTimeout(this._forwardVTimer);}this._forwardVTimer=setTimeout(this._resyncVisibilityForward.bind(this),100);},_resyncVisibilityForward:function(){if(!this._vSyncing){this._vSyncing=true;this._forwardVTimer=0;this._setNodeVisibility_r(this._model.getData().root,this._viewStateManager);this._vSyncing=false;}},_setNodeVisibility_r:function(n,v){if(n.id!=null&&v.getVisibilityState(n.id)!=n.visible){v.setVisibilityState(n.id,n.visible);}for(var i=0;n[i]!=null;i++){this._setNodeVisibility_r(n[i],v);}},_nodeVisibilityChanged:function(e){if(!this._vSyncing){if(this._reverseVTimer>0){clearTimeout(this._reverseVTimer);}this._reverseVTimer=setTimeout(this._resyncVisibilityReverse.bind(this),100);}},_resyncVisibilityReverse:function(){if(!this._vSyncing){this._vSyncing=true;this._forwardVTimer=0;this._getNodeVisibility_r(this._model.getData().root,this._viewStateManager);this._tree.getBinding("rows").refresh();this._vSyncing=false;}},_getNodeVisibility_r:function(n,v){if(n.id!=null){n.visible=v.getVisibilityState(n.id);}for(var i=0;n[i]!=null;i++){this._getNodeVisibility_r(n[i],v);}},refresh:function(){if(this._scene==null){this._model.setData([]);return;}var n=this._scene.getDefaultNodeHierarchy();var v=this._viewStateManager;var d={root:{name:"root",visible:true,0:{}}};var i=0;n.enumerateChildren(null,function(p){var e=p.getNodeId();var t={name:p.getName(),id:e,visible:v.getVisibilityState(e)};if(p.getHasChildren()){t[0]={};}d.root[i]=t;i+=1;});this._model.setData(d);},onAfterRendering:function(){}});return S;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.StepNavigation')){jQuery.sap.declare('sap.ui.vk.StepNavigation');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.ui.core.ResizeHandler');jQuery.sap.require('sap.ui.core.Popup');jQuery.sap.require('sap.ui.core.IconPool');sap.ui.define("sap/ui/vk/StepNavigation",["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","./Loco","./ViewportHandler","sap/ui/core/Popup","sap/ui/core/IconPool"],function(q,l,C,R,L,V,P,I){"use strict";var S=C.extend("sap.ui.vk.StepNavigation",{metadata:{library:"sap.ui.vk",properties:{settings:"sap.ui.core.object",width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},showThumbnails:{type:"boolean",group:"Appearance",defaultValue:true},showToolbar:{type:"boolean",group:"Appearance",defaultValue:true},showStepInfo:{type:"boolean",group:"Appearance",defaultValue:false}},publicMethods:["setGraphicsCore","setScene","playStep","pauseStep","playAllSteps","getStep","getNextStep","getPreviousStep","getProceduresAndSteps","refresh","clear"],associations:{},aggregations:{procedureItemTemplate:{type:"sap.ui.core.Item",multiple:false},stepInfoPopup:{type:"sap.ui.core.Control",multiple:false},layout:{type:"sap.m.Panel",multiple:false}},events:{"resize":{parameters:{oldSize:"object",size:"object"}},"stepChanged":{parameters:{clientId:"object",type:"object",stepId:"object"}}}},setGraphicsCore:function(g){if(g!=this._graphicsCore){this._graphicsCore=g;}this.instanceSettings={};this.oDvl=this._graphicsCore.getApi(sap.ui.vk.GraphicsCoreApi.LegacyDvl);this.oDvl.Client.OnStepEvent=function(c,t,s){var o=this.getSettings();this.instanceSettings.currentStepId=s;switch(t){case DvlEnums.DVLSTEPEVENT.DVLSTEPEVENT_FINISHED:o.currentStepFinished=true;o.currentStepPaused=false;o.playAllActive=false;o.isPlaying=false;this._togglePlayPause(true);break;case DvlEnums.DVLSTEPEVENT.DVLSTEPEVENT_SWITCHED:case DvlEnums.DVLSTEPEVENT.DVLSTEPEVENT_STARTED:o.currentStepId=s;o.currentStepFinished=false;this._highlightStep(s);if(o.currentStepPaused){this.pauseStep();}break;}this.fireStepChanged({clientId:c,type:t,stepId:s});}.bind(this);return this;},hasGraphicsCore:function(){if(this._graphicsCore){return true;}return false;},setScene:function(s){this._scene=s;if(this["_getStepThumbnails"]){if(!this._graphicsCore){this.setGraphicsCore(this._scene.getGraphicsCore());}delete this._procedures;var p=this.getProcedureList();var o=this.getSettings();o.reset();p.unbindItems();p.setSelectedItem(p.getFirstItem());if(o.stepInfo.stepMessagePopup){if(!o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(this.oResourceBundle.getText("STEP_NAV_STEPDESCRIPTIONHEADING"));}var d=this._getStepThumbnails();this.oModel.setData(d);sap.ui.getCore().setModel(this.oModel);this._togglePlayPause(true);this._refreshControl();}this.refresh();},init:function(){if(C.prototype.init){C.prototype.init(this);}if(this.getSettings()==undefined){this.setSettings(new this._settings());}this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vk.i18n");this._graphicsCore=null;this.oModel=new sap.ui.model.json.JSONModel();this._layout=new sap.m.Panel({expandable:false});this._layoutToolbar=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid});this._layout.addContent(new sap.m.ScrollContainer(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false,focusable:true}));this.setAggregation("layout",this._layout);this.playPreviousButton=new sap.m.Button(this.getId()+"-playPreviousButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-left",tooltip:this.oResourceBundle.getText("STEP_NAV_PREVIOUSSTEPBUTTON"),visible:true,press:function(e){var s=this.getSettings();var p=this.getPreviousStep(s.currentProcedureIndex);if(p){s.currentStepPaused=false;this.playStep(p.id,true,s.playAllActive);this._togglePlayPause(false);}}.bind(this)});this.playNextButton=new sap.m.Button(this.getId()+"-playNextButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-right",tooltip:this.oResourceBundle.getText("STEP_NAV_NEXTSTEPBUTTON"),visible:true,press:function(e){var s=this.getSettings();var n=this.getNextStep(s.currentProcedureIndex);if(n){s.currentStepPaused=false;this.playStep(n.id,true,s.playAllActive);this._togglePlayPause(false);}}.bind(this)});this.playOptionButton=new sap.m.Button(this.getId()+"-playOptionButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-play",tooltip:this.oResourceBundle.getText("STEP_NAV_PLAYBUTTON_PLAY"),visible:true,press:function(e){var k=this.getPlayMenuButton().getSelectedKey();var s=this.getSettings();var f=null;switch(k){case"0":if(!s.currentStepId){f=this.getNextStep(s.currentProcedureIndex);if(f){s.currentStepId=f.id;}else{return;}}s.playAllActive=false;this.playStep(s.currentStepId,!s.currentStepPaused,s.playAllActive);s.isPlaying=true;s.currentStepPaused=false;this._togglePlayPause(false);break;case"1":s.playAllActive=true;s.currentStepPaused=false;this.playAllSteps(s.currentProcedureId);s.isPlaying=true;this._togglePlayPause(false);break;case"2":if(!s.currentStepId){f=this.getNextStep(s.currentProcedureIndex);if(f){s.currentStepId=f.id;}else{return;}}s.playAllActive=true;var p=!s.currentStepPaused;s.currentStepPaused=false;this.playStep(s.currentStepId,p,s.playAllActive);s.isPlaying=true;this._togglePlayPause(false);break;default:break;}}.bind(this)});this.procedureList=new sap.m.Select(this.getId()+"-procedureList",{tooltip:this.oResourceBundle.getText("STEP_NAV_PROCEDURESLISTHEADING"),selectedKey:"0",type:sap.m.SelectType.Default,enabled:true,width:"30%",autoAdjustWidth:true,change:function(c){var p=this.getProcedureList();var s=this.getSettings();s.currentProcedureIndex=0;s.currentProcedureId=this.instanceSettings.currentProcedureId=p.getSelectedKey();s.currentStepId=this.instanceSettings.currentStepId=null;for(var i=0;i<this.oModel.oData.procedures.length;i++){if(this.oModel.oData.procedures[i].id==s.currentProcedureId){s.currentProcedureIndex=i;s.currentProcedure=this.oModel.oData.procedures[i];break;}}if(s.stepInfo.stepMessagePopup){if(!s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close();}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;}this._refreshItems();}.bind(this)});this.procedureList.addStyleClass("sapVizKitStepNavigationProcedureList");this.setAggregation("procedureItemTemplate",(new sap.ui.core.ListItem().bindProperty("text","name").bindProperty("key","id").bindProperty("tooltip","name")));this.playMenuButton=(new sap.m.Select(this.getId()+"-playMenuButtonIcon",{selectedKey:"0",type:sap.m.SelectType.Default,tooltip:this.oResourceBundle.getText("STEP_NAV_PLAYMENU_PLAYOPTIONS"),enabled:true,autoAdjustWidth:false,items:[new sap.ui.core.ListItem({key:"0",icon:"sap-icon://media-play",text:this.oResourceBundle.getText("STEP_NAV_PLAYMENU_PLAY"),tooltip:this.oResourceBundle.getText("STEP_NAV_PLAYMENU_PLAY")}),new sap.ui.core.ListItem({key:"1",icon:"sap-icon://media-play",text:this.oResourceBundle.getText("STEP_NAV_PLAYMENU_PLAYALL"),tooltip:this.oResourceBundle.getText("STEP_NAV_PLAYMENU_PLAYALL")}),new sap.ui.core.ListItem({key:"2",icon:"sap-icon://media-play",text:this.oResourceBundle.getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING"),tooltip:this.oResourceBundle.getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING")})]}));this.playMenuButton.addStyleClass("sapVizKitStepNavigationPlayOptionsSelect");this.pauseButton=new sap.m.Button(this.getId()+"-pauseButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-pause",visible:false,tooltip:this.oResourceBundle.getText("STEP_NAV_PLAYMENU_PAUSE"),press:function(e){var s=this.getSettings();this.pauseStep();s.currentStepPaused=true;s.isPlaying=false;this._togglePlayPause(true);}.bind(this)});this.showStepInfoButton=new sap.m.ToggleButton(this.getId()+"-showStepInfoButton",{icon:"sap-icon://hide",type:sap.m.ButtonType.Transparent,pressed:false,text:this.oResourceBundle.getText("STEP_NAV_STEPDESCRIPTIONHEADING"),tooltip:this.oResourceBundle.getText("STEP_NAV_STEPDESCRIPTIONHEADING"),press:function(e){var t=e.getSource();if(t.getPressed()){this.setShowStepInfo(true);t.setIcon("sap-icon://show");t.setTooltip(this.oResourceBundle.getText("STEP_NAV_SHOWSTEPDESCRIPTIONBUTTON"));}else{this.setShowStepInfo(false);t.setIcon("sap-icon://hide");t.setTooltip(this.oResourceBundle.getText("STEP_NAV_HIDESTEPDESCRIPTIONBUTTON"));}}.bind(this)});this._layoutToolbar.addContent(this.playPreviousButton);this._layoutToolbar.addContent(this.playOptionButton);this._layoutToolbar.addContent(this.pauseButton);this._layoutToolbar.addContent(this.playMenuButton);this._layoutToolbar.addContent(this.procedureList);this._layoutToolbar.addContent(this.showStepInfoButton);this._layoutToolbar.addContent(new sap.m.ToolbarSpacer());this._layoutToolbar.addContent(this.playNextButton);this._layout.setHeaderToolbar(this._layoutToolbar);},getScroller:function(){var i=this.getId()+"-scroller";var c=sap.ui.getCore().byId(i);var a=this.getLayout();return a.getContent()[a.indexOfContent(c)];},getProcedureList:function(){var i=this.getId()+"-procedureList";var h=this.getLayout().getHeaderToolbar();var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];},getPlayMenuButton:function(){var i=this.getId()+"-playMenuButtonIcon";var h=this.getLayout().getHeaderToolbar();var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];},getPlayOptionButton:function(){var i=this.getId()+"-playOptionButton";var h=this.getLayout().getHeaderToolbar();var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];},getPauseButton:function(){var i=this.getId()+"-pauseButton";var h=this.getLayout().getHeaderToolbar();var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];},getPlayNextButton:function(){var i=this.getId()+"-playNextButton";var h=this.getLayout().getHeaderToolbar();var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];},getPlayPreviousButton:function(){var i=this.getId()+"-playPreviousButton";var h=this.getLayout().getHeaderToolbar();var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];},getShowStepInfoButton:function(){var i=this.getId()+"-showStepInfoButton";var h=this.getLayout().getHeaderToolbar();var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];},exit:function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(C.prototype.exit){C.prototype.exit.apply(this);}},_settings:function(){return{enabled:false,toggle:{addCss:function(k,p,o,a){if(!this.targets[k]){this.targets[k]={"type":"css","property":p,"onValue":o,"offValue":a};}},addMethod:function(t,m,o,a,u){var k=t.getId();if(!this.targets[k]){this.targets[k]={"type":"method","target":t,"method":m,"onValue":o,"offValue":a,"useJQuery":u};}},targets:{}},currentProcedureIndex:0,currentProcedureId:"",currentProcedure:null,currentStepId:null,currentStep:null,currentStepPaused:false,isPlaying:false,currentStepFinished:true,playAllActive:false,showToolbar:true,showThumbnails:true,portfolioMode:false,reset:function(){this.currentStep=null;this.currentProcedure=null;this.currentProcedureIndex=0;this.currentProcedureId="";this.currentStepId=null;this.currentStepPaused=false;this.currentStepFinished=true;this.playAllActive=false;this.portfolioMode=false;},stepInfo:{lastTop:null,lastLeft:null,stepMessagePopup:null,openPopup:function(p,a,t){if(!this.stepMessagePopup){this.stepMessagePopup=new sap.m.ResponsivePopover({placement:"Top",showCloseButton:true,verticalScrolling:true,contentHeight:"10%",contentWidth:"30%"});this.stepMessagePopup.addStyleClass("sapVizKitStepNavigationPopoverStepInfo");}this.stepMessagePopup.setTitle(p);this.stepMessagePopup.removeAllContent();this.stepMessagePopup.addContent(a);this.stepMessagePopup.openBy(t);}}};},refresh:function(s){q.sap.log.info("StepNavigation refresh() called.");if(this.getVisible()&&(this["_getStepThumbnails"]&&this._scene!=null)){var p=this.getProcedureList();var o=this.getSettings();o.reset();p.setSelectedItem(p.getFirstItem());var d=this._getStepThumbnails();if(o.stepInfo.stepMessagePopup){if(!o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;}this.oModel.setData(d);sap.ui.getCore().setModel(this.oModel);this._togglePlayPause(true);this._refreshControl();}else{if(this.getVisible()){this._refreshControl();}}return true;},clear:function(){q.sap.log.info("StepNavigation clear() called.");return true;},onBeforeRendering:function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(this.getShowToolbar()){var p=this.getProcedureList();p.setModel(this.oModel);var o=this.getProcedureItemTemplate();p.bindItems("/procedures",o);}},onAfterRendering:function(){if(this._canvas){var d=this.getDomRef();d.appendChild(this._canvas);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._bestFit();this.fireResize({size:{width:d.clientWidth,height:d.clientHeight}});}var s=this.getSettings();this._togglePlayPause(!s.isPlaying);if(s.currentStepId){this._highlightStep(s.currentStepId);}},_handleResize:function(e){this.fireResize({oldSize:e.oldSize,size:e.size});this._update();},_reset:function(){this._x=0;this._y=0;this._s=1.0;this._r=0;},_update:function(){var x=this._x-(this._imageW-this._canvas.clientWidth)/2;var y=this._y-(this._imageH-this._canvas.clientHeight)/2;var t="matrix("+this._s+",0,0,"+this._s+","+x+","+y+")";this._img.style.transform=t;this._img.style.webkitTransform=t;this._img.style.msTransform=t;this._img.style.MozTransform=t;this._img.style.OTransform=t;},_bestFit:function(){this._reset();var s=this._canvas.clientWidth/this._img.width;var a=this._canvas.clientHeight/this._img.height;this._s=s<a?s:a;if(this._s==0){this._s=1.0;}this._x=0;this._y=0;this._update();},_togglePlayPause:function(p){this.togglePlayPauseActive=true;if(this.getSettings().showToolbar){if(p){this.getPauseButton().setVisible(false);this.getPlayOptionButton().setVisible(true);}else{this.getPauseButton().setVisible(true);this.getPlayOptionButton().setVisible(false);}}},_refreshControl:function(){var p=this.getProcedureList();var o=this.getProcedureItemTemplate();var s=this.getScroller();var a=this.getSettings();if(a.stepInfo.stepMessagePopup){if(!a.stepInfo.stepMessagePopup.isOpen()){a.stepInfo.stepMessagePopup.close();}a.stepInfo.stepMessagePopup.destroy();a.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(this.oResourceBundle.getText("STEP_NAV_STEPDESCRIPTIONHEADING"));}p.unbindItems();if(this.oModel.oData.procedures.length>0){var f=this.oModel.oData.procedures[0];if(this.getShowToolbar()){p.bindItems("/procedures",o);p.selectedKey=f.id;p.enabled=true;}this._refreshItems();}else{if(this.getShowToolbar()){p.bindItems("/procedures",o);p.enabled=false;}if(this.getShowThumbnails()){s.destroyContent();}}},_refreshItems:function(){var t=this;var s=[];var p=this.getProcedureList();var o=t.getSettings();var a=t.getScroller();var b=new sap.m.HBox();if(t.getShowThumbnails()){a.removeAllContent();}if(!o.currentProcedure){o.currentProcedure=t.oModel.oData.procedures[o.currentProcedureIndex];p.setSelectedItem(p.getFirstItem());}if(o.currentProcedureId!=''||t.oModel.oData.procedures.length>0){if(t.getShowThumbnails()){s=t.oModel.oData.procedures[o.currentProcedureIndex].steps;var c=function(e){o.currentStepPaused=false;var f=sap.ui.getCore().byId(e.getSource().getId());t.playStep(f.getCustomData()[0].getValue("stepId"));o.playAllActive=false;t._togglePlayPause(false);};for(var i=0;i<s.length;i++){var d=new sap.m.Image({alt:s[i].name,src:"data:image/"+s[i].thumbnailType+";base64,"+s[i].thumbnailData,densityAware:false,tooltip:s[i].name,press:c.bind(t)});d.data("stepId",s[i].id);d.addCustomData(new sap.ui.core.CustomData({key:"stepId",value:s[i].id}));d.addStyleClass("sapVizKitStepNavigationStepItem");b.addItem(d);}a.addContent(b);}}},_highlightStep:function(s){var t=this;if(t.getVisible()){var o=t.getScroller();var a=t.getSettings();var b=t.getStep(0,a.currentProcedureIndex,s);if(!a.currentProcedure){a.currentProcedure=t.oModel.oData.procedures[t.oSettings.currentProcedureIndex];}var c=b.name;var d=new sap.m.VBox({items:[new sap.m.Text({text:b.description})]});d.addStyleClass("sapVizKitStepNavigationPopoverContent");var e=t.getShowStepInfoButton();if(t.getShowStepInfo()){a.stepInfo.openPopup(c,d,e);}else if(a.stepInfo.stepMessagePopup&&a.stepInfo.stepMessagePopup.isOpen()){a.stepInfo.stepMessagePopup.close();}if(t.getShowThumbnails()){var T=o.getContent()[0].getItems();for(var i=0;i<T.length;i++){if(T[i].getCustomData()[0].getValue("stepId")==s){T[i].addStyleClass("selected");T[i].$()[0].scrollIntoView();}else{T[i].removeStyleClass("selected");}}}}},getProceduresAndSteps:function(){return this._getStepThumbnails();},_getStepThumbnails:function(){var t=this;var p=t._retrieveProcedures();if(p.sceneId!=null){var a;var e;var i;var s;for(var b in p.procedures){var o=p.procedures[b];for(var c in o.steps){s=o.steps[c];a=t.oDvl.Scene.RetrieveThumbnail(p.sceneId,s.id);e=a.substring(a.length-2);var d=a.substring(0,3);if(d=="iVB"){i="png";}else if(d!="eff"&&d!="err"){i="jpg";}else if(d=="eff"||d=="err"){i=null;a=null;}if(/,$/.test(e)||/,,$/.test(e)){a=a.substring(0,a.length-4);e=a.substring(a.length-2);}p.procedures[b].steps[c].thumbnailData=a;p.procedures[b].steps[c].thumbnailType=i;}}for(var f in p.portfolios){var g=p.portfolios[f];for(var h in g.steps){s=g.steps[h];a=t.oDvl.Scene.RetrieveThumbnail(p.sceneId,s.id);e=a.substring(a.length-2);var d=a.substring(0,3);if(d=="iVB"){i="png";}else if(d!="eff"){i="jpg";}else if(d=="eff"){i=null;}p.portfolios[f].steps[h].thumbnailData=a;p.portfolios[f].steps[h].thumbnailType=i;}}p.hasThumbnails=true;}t._procedures=p;return p;},_retrieveProcedures:function(a){var t=this;var p={};if(!t._procedures){p={sceneId:null,hasThumbnails:false,"procedures":[],"portfolios":[]};}else{p=t._procedures;}if(t._scene&&(p.sceneId!=(a||t._scene._dvlSceneId))){var s=a||t._scene._dvlSceneId;if(s!=null){var b=t.oDvl.Scene.RetrieveProcedures(s);if(b!=null){p.hasThumbnails=false;p.sceneId=t._scene._dvlSceneId;p.procedures=b.procedures;p.portfolios=b.portfolios;}else{p={sceneId:null,hasThumbnails:false,"procedures":[],"portfolios":[]};}}}return p;},getStep:function(r,a,s){var t=this;var b=t.oDvl.Settings.LastLoadedSceneId;if(b!=null){a=a!=null?a:0;var c=s?s:t.instanceSettings.currentStepId;var d=null;var p=t._retrieveProcedures(b);var e=p.procedures[a];if(e&&e.steps.length>0){d=e.steps[0];}if(c!=""){for(var f=0;f<e.steps.length;f++){var _=e.steps[f];if(_.id==c){var x=f+r;if(x<e.steps.length&&x>=0){d=e.steps[x];}else{d=null;}break;}}}}return d;},pauseStep:function(){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){t.oDvl.Scene.PauseCurrentStep(s);}},_stepCount:function(a){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;var b=0;if(s!=null){var p=t._retrieveProcedures(s);for(var c=0;c<p.procedures.length;c++){if(p.procedures[c].id==a){b=p.procedures[c].steps.length;break;}else if(a==null){b+=p.procedures[c].steps.length;}}}return b;},getPreviousStep:function(p){var t=this;return t.getStep(-1,p);},getNextStep:function(p){var t=this;return t.getStep(1,p);},playStep:function(a,f,c){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){t.instanceSettings.currentStepId=a;t.oDvl.Scene.ActivateStep(s,a,f!=null?f:true,c!=null?c:false);}},playAllSteps:function(p){var t=this;var a=t.oDvl.Settings.LastLoadedSceneId;if(a!=null){var b=t._retrieveProcedures(a);var c=0;if(p!=null&&b.procedures.length>1){for(var i=0;i<b.procedures.length;i++){if(b.procedures[i].id==p){c=i;break;}}}if(b.procedures.length>0){var s=b.procedures[c].steps[0];if(s){t.instanceSettings.currentStepId=s.id;t.oDvl.Scene.ActivateStep(a,s.id,true,true);}}}}});return S;});};if(!jQuery.sap.isDeclared('sap.ui.vk.Toolbar')){jQuery.sap.declare('sap.ui.vk.Toolbar');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.ui.model.json.JSONModel');sap.ui.define("sap/ui/vk/Toolbar",["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/model/json/JSONModel"],function(q,l,C,J){"use strict";var T=C.extend("sap.ui.vk.Toolbar",{metadata:{library:"sap.ui.vk",properties:{title:{type:"string",group:"Appearance",defaultValue:""}},events:{},associations:{viewer:{type:"sap.ui.vk.Viewer",cardinality:"0..1"}},aggregations:{_toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"visible"},_helpButton:{type:"sap.m.Button",multiple:false,visibility:"visible"},_stepNavigationButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"visible"},_sceneTreeButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"visible"},_enterFullScreenButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"visible"},_exitFullScreenButton:{type:"sap.m.Button",multiple:false,visibility:"visible"},_toolbarTitle:{type:"sap.m.Title",multiple:false,visibility:"visible"}}},_onSceneTree:function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){var n=this._sceneTreeButton.getPressed();this.oViewer.setShowSceneTree(n);}},_onStepNavigation:function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){var n=this._stepNavigationButton.getPressed();this.oViewer.setShowStepNavigation(n);}},_onFullScreen:function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){var n=this._enterFullScreenButton.getPressed();this.oViewer.setEnableFullScreen(n);}},_fullScreenHandler:function(e){var f=e.mParameters.isFullScreen;this._enterFullScreenButton.setPressed(f);if(f){this._enterFullScreenButton.setIcon("sap-icon://exit-full-screen");}else{this._enterFullScreenButton.setIcon("sap-icon://full-screen");}},init:function(){if(C.prototype.init){C.prototype.init.apply(this);}this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vk.i18n");var _=new sap.m.ToolbarSpacer();var a=new sap.m.Button({icon:"sap-icon://sys-help",type:sap.m.ButtonType.Transparent,tooltip:this.oResourceBundle.getText("VIEWER_HELPBUTTONTOOLTIP")});this.setAggregation("_helpButton",a);this._stepNavigationButton=new sap.m.ToggleButton({icon:"sap-icon://step",type:sap.m.ButtonType.Transparent,enabled:false,tooltip:this.oResourceBundle.getText("STEP_NAV_MENUBUTTONTOOLTIP"),press:this._onStepNavigation.bind(this)});this.setAggregation("_stepNavigationButton",this._stepNavigationButton);this._sceneTreeButton=new sap.m.ToggleButton({icon:"sap-icon://tree",type:sap.m.ButtonType.Transparent,tooltip:this.oResourceBundle.getText("SCENETREE_MENUBUTTONTOOLTIP"),press:this._onSceneTree.bind(this)});this.setAggregation("_sceneTreeButton",this._sceneTreeButton);this._enterFullScreenButton=new sap.m.ToggleButton({icon:"sap-icon://full-screen",type:sap.m.ButtonType.Transparent,tooltip:this.oResourceBundle.getText("VIEWER_FULLSCREENBUTTONTOOLTIP"),press:this._onFullScreen.bind(this)});this.setAggregation("_enterFullScreenButton",this._enterFullScreenButton);var b=new sap.m.Button({icon:"sap-icon://exit-full-screen",type:sap.m.ButtonType.Transparent,tooltip:this.oResourceBundle.getText("VIEWER_FULLSCREENBUTTONTOOLTIP")});this.setAggregation("_exitFullScreenButton",b);this._toolbarTitle=new sap.m.Title();this.setAggregation("_toolbarTitle",this._toolbarTitle);this._toolbar=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid,content:[this._toolbarTitle,_,new sap.m.ToolbarSeparator(),this._sceneTreeButton,new sap.m.ToolbarSeparator(),this._stepNavigationButton,new sap.m.ToolbarSeparator(),this._enterFullScreenButton]});this.setAggregation("_toolbar",this._toolbar,true);},exit:function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer){this.oViewer.detachFullScreen(this._fullScreenHandler.bind(this));}},onBeforeRendering:function(){this._toolbar.setVisible(true);this._toolbarTitle.setText(this.getTitle());},refresh:function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());this._stepNavigationButton.setPressed(this.oViewer.getShowStepNavigation());this._stepNavigationButton.setEnabled(this.oViewer.getEnableStepNavigation());this._sceneTreeButton.setPressed(this.oViewer.getShowSceneTree());this._sceneTreeButton.setEnabled(this.oViewer.getEnableSceneTree());this.oViewer.attachFullScreen(this._fullScreenHandler.bind(this));return true;},onAfterRendering:function(){this.refresh();}});return T;},true);};if(!jQuery.sap.isDeclared('sap.ui.vk.ViewStateManager')){jQuery.sap.declare('sap.ui.vk.ViewStateManager');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.ManagedObject');sap.ui.define("sap/ui/vk/ViewStateManager",["jquery.sap.global","./library","sap/ui/base/ManagedObject"],function(q,l,M){"use strict";var N;var a=q.sap.log;var V=M.extend("sap.ui.vk.ViewStateManager",{metadata:{publicMethods:["enumerateSelection","getNodeHierarchy","getSelectionState","getVisibilityState","setSelectionState","setVisibilityState"],events:{visibilityChanged:{parameters:{visible:{type:"string[]"},hidden:{type:"string[]"}},enableEventBubbling:true},selectionChanged:{parameters:{selected:{type:"string[]"},unselected:{type:"string[]"}},enableEventBubbling:true}}},constructor:function(n){a.debug("sap.ui.vk.ViewStateManager.constructor() called.");M.apply(this);var s=n.getScene();this._nodeHierarchy=n;this._dvlSceneId=s._getDvlSceneId();this._dvl=s.getGraphicsCore()._getDvl();this._dvlClientId=s.getGraphicsCore()._getDvlClientId();this._dvl.Client.attachNodeVisibilityChanged(this._handleNodeVisibilityChanged,this);this._dvl.Client.attachNodeSelectionChanged(this._handleNodeSelectionChanged,this);this._selectedNodes=new N();this._newlyVisibleNodes=[];this._newlyHiddenNodes=[];this._visibilityTimerId=null;this._selectionTimerId=null;},destroy:function(){a.debug("sap.ui.vk.ViewStateManager.destroy() called.");if(this._selectionTimerId){q.sap.clearDelayedCall(this._selectionTimerId);this._selectionTimerId=null;}if(this._visibilityTimerId){q.sap.clearDelayedCall(this._visibilityTimerId);this._visibilityTimerId=null;}this._newlyHiddenNodes=null;this._newlyVisibleNodes=null;this._selectedNodes=null;if(this._dvl){this._dvl.Client.detachNodeSelectionChanged(this._handleNodeSelectionChanged,this);this._dvl.Client.detachNodeVisibilityChanged(this._handleNodeVisibilityChanged,this);}this._dvlClientId=null;this._dvlSceneId=null;this._dvl=null;this._scene=null;M.prototype.destroy.apply(this);},getNodeHierarchy:function(){return this._nodeHierarchy;},getVisibilityState:function(n){if(Array.isArray(n)){return n.map(function(b){return(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,b,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE)!==0;}.bind(this));}else{var b=n;return(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,b,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE)!==0;}},setVisibilityState:function(n,v,r){if(!Array.isArray(n)){n=[n];}var c=q.sap.unique((r?this._collectNodesRecursively(n):n)).filter(function(b){var i=(sap.ui.vk.dvl.getJSONObject(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,b,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE)!==0;return i!==v;}.bind(this));if(c.length>0){c.forEach(function(b){this._dvl.Scene.ChangeNodeFlags(this._dvlSceneId,b,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE,v?sap.ve.dvl.DVLFLAGOPERATION.DVLFLAGOP_SET:sap.ve.dvl.DVLFLAGOPERATION.DVLFLAGOP_CLEAR);}.bind(this));this.fireVisibilityChanged({visible:v?c:[],hidden:v?[]:c});}return this;},_handleNodeVisibilityChanged:function(p){if(p.clientId===this._dvlClientId&&p.sceneId===this._dvlSceneId){this[p.visible?"_newlyVisibleNodes":"_newlyHiddenNodes"].push(p.nodeId);if(!this._visibilityTimerId){this._visibilityTimerId=q.sap.delayedCall(0,this,function(){this._visibilityTimerId=null;this.fireVisibilityChanged({visible:this._newlyVisibleNodes.splice(0,this._newlyVisibleNodes.length),hidden:this._newlyHiddenNodes.splice(0,this._newlyHiddenNodes.length)});}.bind(this));}}},enumerateSelection:function(c){this._selectedNodes.forEach(c);return this;},getSelectionState:function(n){if(Array.isArray(n)){return n.map(function(b){return(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,b,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED)!==0;}.bind(this));}else{var b=n;return(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,b,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED)!==0;}},setSelectionState:function(n,s,r){if(!Array.isArray(n)){n=[n];}var c=q.sap.unique((r?this._collectNodesRecursively(n):n)).filter(function(d){var i=(sap.ui.vk.dvl.getJSONObject(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,d,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED)!==0;return i!==s;}.bind(this));if(c.length>0){var b=this._selectedNodes[s?"add":"delete"].bind(this._selectedNodes);c.forEach(function(d){this._dvl.Scene.ChangeNodeFlags(this._dvlSceneId,d,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED,s?sap.ve.dvl.DVLFLAGOPERATION.DVLFLAGOP_SET:sap.ve.dvl.DVLFLAGOPERATION.DVLFLAGOP_CLEAR);b(d);}.bind(this));this.fireSelectionChanged({selected:s?c:[],unselected:s?[]:c});}return this;},_handleNodeSelectionChanged:function(p){if(p.clientId===this._dvlClientId&&p.sceneId===this._dvlSceneId){if(!this._selectionTimerId){this._selectionTimerId=q.sap.delayedCall(0,this,function(){this._selectionTimerId=null;var c=new N(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneId,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_SELECTED).SelectedNodes);var n=[];this._selectedNodes.forEach(function(d){if(!c.has(d)){n.push(d);}});var b=[];c.forEach(function(d){if(!this._selectedNodes.has(d)){b.push(d);}}.bind(this));this._selectedNodes=c;this.fireSelectionChanged({selected:b,unselected:n});});}}},_collectNodesRecursively:function(n){var r=[];var c=function(b){var d=typeof b==="string"?b:b.getNodeId();r.push(d);if((sap.ui.vk.dvl.getJSONObject(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,d,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){this._nodeHierarchy.enumerateChildren(d,c);}}.bind(this);n.forEach(c);return r;}});N=function(b){b=b||[];if(this._builtin){if(sap.ui.Device.browser.msie){this._set=new Set();b.forEach(this._set.add.bind(this._set));}else{this._set=new Set(b);}}else{this._set=b.slice();}};N.prototype={constructor:N,_builtin:!!Set,add:function(v){if(this._builtin){this._set.add(v);}else{if(this._set.indexOf()<0){this._set.push(v);}}return this;},delete:function(v){if(this._builtin){return this._set.delete(v);}else{var i=this._set.indexOf(v);if(i>=0){this.splice(i,1);return true;}else{return false;}}},clear:function(){if(this._builtin){this._set.clear();}else{this._set.splice(0,this._set.length);}},has:function(v){if(this._builtin){return this._set.has(v);}else{return this._set.indexOf(v)>=0;}},forEach:function(c,t){this._set.forEach(c,t);}};return V;});};if(!jQuery.sap.isDeclared('sap.ui.vk.Viewport')){jQuery.sap.declare('sap.ui.vk.Viewport');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.ui.core.ResizeHandler');sap.ui.define("sap/ui/vk/Viewport",["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","./Loco","./ViewportHandler"],function(q,l,C,R,L,V){"use strict";var a=C.extend("sap.ui.vk.Viewport",{metadata:{library:"sap.ui.vk",publicMethods:["setGraphicsCore","getGraphicsCore","setScene","setViewStateManager","beginGesture","endGesture","pan","rotate","zoom","tap","queueCommand"]},init:function(){if(C.prototype.init){C.prototype.init(this);}this._graphicsCore=null;this._dvl=null;this._dvlRendererId=null;this._canvas=null;this._resizeListenerId=null;this._viewportHandler=new V(this);this._loco=new L();this._loco.addHandler(this._viewportHandler);},exit:function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this.setViewStateManager(null);this.setScene(null);this.setGraphicsCore(null);if(C.prototype.exit){C.prototype.exit.apply(this);}},setGraphicsCore:function(g){if(g!=this._graphicsCore){if(g&&this._graphicsCore&&this._graphicsCore._getViewportCount()>0){throw new Error("Only one viewport instance is supported in the current implementation. This will change in future releases.");}if(this._graphicsCore){if(this._graphicsCore._unregisterViewport(this)){if(this._graphicsCore._getViewportCount()===0){this._dvl.Core.StopRenderLoop();}}}if(this._dvlRendererId){this._dvl.Core.DoneRenderer();this._dvlRendererId=null;}this._dvl=null;this._graphicsCore=g;if(this._graphicsCore){var s=this._graphicsCore._getViewportCount()===0;this._dvl=this._graphicsCore._getDvl();this._dvl.Core.InitRenderer();this._dvlRendererId=this._dvl.Core.GetRendererPtr();this._dvl.Renderer.SetBackgroundColor(0,0,0,0,0,0,0,0);this._setCanvas(this._graphicsCore._getCanvas());this._graphicsCore._registerViewport(this);if(s){this._dvl.Core.StartRenderLoop();}}}return this;},getGraphicsCore:function(){return this._graphicsCore;},_setCanvas:function(c){var s=this.getDomRef()&&this._canvas!==c;this._canvas=c;if(s){this.invalidate();}return this;},setScene:function(s){if(this._dvlRendererId){this._dvl.Renderer.AttachScene(s&&s._getDvlSceneId()||null);}return this;},onBeforeRendering:function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}},onAfterRendering:function(){if(this._canvas){var d=this.getDomRef();d.appendChild(this._canvas);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:d.clientWidth,height:d.clientHeight}});}},_handleResize:function(e){if(this._dvlRendererId&&this._canvas){var d=window.devicePixelRatio||1;var b=e.size.width*d;var c=e.size.height*d;this._dvl.Renderer.SetDimensions(b,c);this._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_DPI,96*d);this._canvas.width=b;this._canvas.height=c;this._canvas.style.width=e.size.width+"px";this._canvas.style.height=e.size.height+"px";return true;}},setViewStateManager:function(v){this._viewStateManager=v;return this;},shouldRenderFrame:function(){return this._dvlRendererId&&this._dvl.Renderer.ShouldRenderFrame();},renderFrame:function(){if(this._dvlRendererId){this._dvl.Renderer.RenderFrame(this._dvlRendererId);}return this;},renderFrameEx:function(v,p){if(this._dvlRendererId){this._dvl.Renderer.RenderFrameEx.apply(this,[].concat(v,p),this._dvlRendererId);}return this;},setOption:function(o,e){if(this._dvlRendererId){this._dvl.Renderer.SetOption(o,e,this._dvlRendererId);}return this;},getOption:function(o){return this._dvlRendererId&&this._dvl.Renderer.GetOption(o,this._dvlRendererId);},setOptionF:function(o,v){if(this._dvlRendererId){this._dvl.Renderer.SetOptionF(o,v,this._dvlRendererId);}return this;},getOptionF:function(o){if(this._dvlRendererId){return this._dvl.Renderer.GetOptionF(o,this._dvlRendererId);}else{return 0;}},resetView:function(){if(this._dvlRendererId){this._dvl.Renderer.ResetView(this._dvlRendererId);}return this;},canIsolateNode:function(n){if(this._dvlRendererId){return this._dvl.Renderer.CanIsolateNode(n,this._dvlRendererId);}else{return false;}},setIsolatedNode:function(n){if(this._dvlRendererId){this._dvl.Renderer.SetIsolatedNode(n,this._dvlRendererId);}return this;},getIsolatedNode:function(){if(this._dvlRendererId){return this._dvl.Renderer.GetIsolatedNode(this._dvlRendererId);}else{return"i0000000000000000";}},zoomTo:function(w,n,c){if(this._dvlRendererId){this._dvl.Renderer.ZoomTo(w,n,c,this._dvlRendererId);}},beginGesture:function(x,y){if(this._dvlRendererId){var p=window.devicePixelRatio||1;this._dvl.Renderer.BeginGesture(x*p,y*p,this._dvlRendererId);}return this;},endGesture:function(){if(this._dvlRendererId){this._dvl.Renderer.EndGesture(this._dvlRendererId);}return this;},pan:function(d,b){if(this._dvlRendererId){var p=window.devicePixelRatio||1;this._dvl.Renderer.Pan(d*p,b*p,this._dvlRendererId);}return this;},rotate:function(d,b){if(this._dvlRendererId){var p=window.devicePixelRatio||1;this._dvl.Renderer.Rotate(d*p,b*p,this._dvlRendererId);}return this;},zoom:function(d){if(this._dvlRendererId){this._dvl.Renderer.Zoom(d,this._dvlRendererId);}return this;},tap:function(x,y,i){if(this._dvlRendererId){var p=window.devicePixelRatio||1;this._dvl.Renderer.Tap(x*p,y*p,i,this._dvlRendererId);}return this;},queueCommand:function(c){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(c,this._dvlRendererId);}return this;}});return a;});};if(!jQuery.sap.isDeclared('sap.ui.vk.NodeHierarchy')){jQuery.sap.declare('sap.ui.vk.NodeHierarchy');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.EventProvider');jQuery.sap.require('sap.ui.base.ObjectPool');sap.ui.define("sap/ui/vk/NodeHierarchy",["jquery.sap.global","./library","sap/ui/base/EventProvider","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy"],function(q,l,E,O,B,N){"use strict";var g=sap.ui.vk.dvl.getJSONObject;var a=E.extend("sap.ui.vk.NodeHierarchy",{metadata:{publicMethods:["createNodeProxy","destroyNodeProxy","enumerateAncestors","enumerateChildren","getGraphicsCore","getScene"]},_baseNodeProxyPool:new O(B),constructor:function(s){E.apply(this);this._graphicsCore=s.getGraphicsCore();this._scene=s;this._dvlSceneId=this._scene._getDvlSceneId();this._dvl=this._graphicsCore._getDvl();this._nodeProxies=[];},destroy:function(){this._nodeProxies.slice().forEach(this.destroyNodeProxy.bind(this));this._dvl=null;this._dvlSceneId=null;this._scene=null;this._graphicsCore=null;E.prototype.destroy.apply(this);},getGraphicsCore:function(){return this._graphicsCore;},getScene:function(){return this._scene;},_getDvlSceneId:function(){return this._dvlSceneId;},enumerateChildren:function(n,c,s){if(typeof n==="function"){s=c;c=n;n=undefined;}var b;if(n){if(s||(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){b=g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN)).ChildNodes;}else{b=[];}}else{b=g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneId,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN)).ChildNodes;}var d=this._baseNodeProxyPool.borrowObject();try{b.forEach(function(n){d.init(this,n);c(d);d.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(d);}return this;},enumerateAncestors:function(n,c){var b=g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneId,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_PARENTS)).ParentNodes;var d=this._baseNodeProxyPool.borrowObject();try{b.forEach(function(n){d.init(this,n);c(d);d.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(d);}return this;},createNodeProxy:function(n){var b=new N(this,n);this._nodeProxies.push(b);return b;},destroyNodeProxy:function(n){var i=this._nodeProxies.indexOf(n);if(i>=0){this._nodeProxies.splice(i,1)[0].destroy();}return this;}});return a;});};if(!jQuery.sap.isDeclared('sap.ui.vk.Scene')){jQuery.sap.declare('sap.ui.vk.Scene');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.EventProvider');sap.ui.define("sap/ui/vk/Scene",["jquery.sap.global","./library","sap/ui/base/EventProvider","./NodeHierarchy"],function(q,l,E,N){"use strict";var a=q.sap.log;var S=E.extend("sap.ui.vk.Scene",{metadata:{publicMethods:["getId","getGraphicsCore","getDefaultNodeHierarchy"]},constructor:function(g,d){a.debug("sap.ui.vk.Scene.constructor() called.");E.apply(this);this._id=q.sap.uid();this._graphicsCore=g;this._dvlSceneId=d;this._defaultNodeHierarchy=null;},destroy:function(){a.debug("sap.ui.vk.Scene.destroy() called.");if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null;}this._dvlSceneId=null;this._graphicsCore=null;E.prototype.destroy.apply(this);},getId:function(){return this._id;},getGraphicsCore:function(){return this._graphicsCore;},getDefaultNodeHierarchy:function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new N(this);}return this._defaultNodeHierarchy;},_getDvlSceneId:function(){return this._dvlSceneId;}});return S;});};if(!jQuery.sap.isDeclared('sap.ui.vk.Viewer')){jQuery.sap.declare('sap.ui.vk.Viewer');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.ui.layout.Splitter');jQuery.sap.require('sap.ui.layout.SplitterLayoutData');jQuery.sap.require('sap.ui.core.ResizeHandler');sap.ui.define("sap/ui/vk/Viewer",["jquery.sap.global","./library","sap/ui/core/Control","./Scene","./Viewport","./ContentResource","./NativeViewport","./Overlay","./SceneTree","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","./FlexibleControl","./FlexibleControlLayoutData","./StepNavigation","./Toolbar","sap/ui/core/ResizeHandler"],function(q,l,C,S,V,a,N,O,b,c,d,F,e,f,g,R){"use strict";var h=q.sap.log;var i=C.extend("sap.ui.vk.Viewer",{metadata:{library:"sap.ui.vk",properties:{enableOverlay:{type:"boolean",defaultValue:false},enableSceneTree:{type:"boolean",defaultValue:false},showSceneTree:{type:"boolean",defaultValue:false},enableStepNavigation:{type:"boolean",defaultValue:false},showStepNavigation:{type:"boolean",defaultValue:false},enableToolbar:{type:"boolean",defaultValue:true},enableFullScreen:{type:"boolean",defaultValue:false},width:{type:"sap.ui.core.CSSSize",defaultValue:"auto"},height:{type:"sap.ui.core.CSSSize",defaultValue:"auto"},toolbarTitle:{type:"string",defaultValue:""}},publicMethods:["getGraphicsCore","getNativeViewport","getScene","getViewport","getViewStateManager"],aggregations:{contentResources:{type:"sap.ui.vk.ContentResource"},toolbar:{type:"sap.ui.vk.Toolbar",multiple:false,visibility:"hidden"},viewport:{type:"sap.ui.vk.Viewport",multiple:false,visibility:"hidden"},nativeViewport:{type:"sap.ui.vk.NativeViewport",multiple:false,visibility:"hidden"},stepNavigation:{type:"sap.ui.vk.StepNavigation",multiple:false,visibility:"hidden"},hotspotOverlay:{type:"sap.ui.vk.Overlay",multiple:false,visibility:"hidden"},sceneTree:{type:"sap.ui.vk.SceneTree",multiple:false,visibility:"visible"},_layout:{type:"sap.ui.vk.FlexibleControl",multiple:false,visibility:"true"},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false,visibility:"hidden"}},events:{sceneLoadingSucceeded:{parameters:{scene:{type:"sap.ui.vk.Scene"}}},sceneLoadingFailed:{},sceneDestroying:{parameters:{scene:{type:"sap.ui.vk.Scene"}}},imageLoadingSucceeded:{},imageLoadingFailed:{},selectionChanged:{parameters:{selected:{type:"string[]"},unselected:{type:"string[]"}}},fullScreen:{parameters:{isFullScreen:{type:"boolean"}}}},specialSettings:{runtimeSettings:{type:"object"},webGLContextAttributes:{type:"object"}}},applySettings:function(s){if(s){this._runtimeSettings=s.runtimeSettings;this._webGLContextAttributes=s.webGLContextAttributes;delete s.runtimeSettings;delete s.webGLContextAttributes;}return C.prototype.applySettings.apply(this,arguments);},init:function(){h.debug("sap.ui.vk.Viewer.init() called.");if(C.prototype.init){C.prototype.init.apply(this);}this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vk.i18n");this.setTooltip(this.oResourceBundle.getText("VIEWER_TITLE"));this._resizeListenerId=null;this._shouldLoadContentResources=true;this._busyIndicatorCounter=0;this._toolbar=null;this._viewport=null;this._nativeViewport=null;this._stepNavigation=null;this._hotspotOverlay=null;this._mainScene=null;this._sceneTree=null;this._updateSizeTimer=0;this._fullScreenToggle=false;this._oldWidth='100%';this._oldHeight='100%';this._content=new c(this.getId()+"-splitter",{orientation:"Horizontal"});this._stackedViewport=new F({width:"100%",height:"100%",layout:"Stacked"});this._layout=new F(this.getId()+"-flexibleControl",{width:"100%",height:"100%",layout:"Vertical"});this._stackedViewport.setLayoutData(new d({size:"100%",minSize:160,resizable:true}));this._content.addContentArea(this._stackedViewport);this.setAggregation("_layout",this._layout);},exit:function(){h.debug("sap.ui.vk.Viewer.exit() called.");if(this._sceneTree){this._sceneTree.setScene(null);}if(this._stepNavigation){this._stepNavigation.setScene(null);}this._toolbar=null;this._sceneTree=null;this._mainScene=null;this._nativeViewport=null;this._stepNavigation=null;this._viewport=null;this._setViewStateManager(null);if(this._graphicsCore){this._graphicsCore.destroy();this._graphicsCore=null;}if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(C.prototype.exit){C.prototype.exit.apply(this);}},_destroyMainScene:function(){if(this._mainScene){this.fireSceneDestroying({scene:this._mainScene});if(this._sceneTree){this._sceneTree.setScene(null,null);}if(this._stepNavigation){this._stepNavigation.setScene(null);}this._toolbar=null;this._viewport.setViewStateManager(null);this._setViewStateManager(null);if(this._viewport){this._viewport.setScene(null);}this._graphicsCore.destroyScene(this._mainScene);this._mainScene=null;}},getGraphicsCore:function(){return this._graphicsCore;},getScene:function(){return this._mainScene;},getViewStateManager:function(){return this.getAggregation("viewStateManager");},_setViewStateManager:function(v){if(!this._graphicsCore){return this;}if(v===this.getViewStateManager()){return this;}if(this.getViewStateManager()){this._graphicsCore.destroyViewStateManager(this.getViewStateManager());}this.setAggregation("viewStateManager",v,true);return this;},getViewport:function(){return this._viewport;},getNativeViewport:function(){return this._nativeViewport;},_getRuntimeSettings:function(){return this._runtimeSettings;},_getWebGLContextAttributes:function(){return this._webGLContextAttributes;},setEnableOverlay:function(p){if(p==this.getProperty("enableOverlay")){return;}this._activateOverlay(p);this.setProperty("enableOverlay",p,true);return this;},setEnableSceneTree:function(p){this.setProperty("enableSceneTree",p,true);if(!p){this.setProperty("showSceneTree",false);}this._updateLayout();return this;},setShowSceneTree:function(p){this.setProperty("showSceneTree",p,true);this._updateLayout();return this;},setEnableStepNavigation:function(p){this.setProperty("enableStepNavigation",p,true);if(!p){this.setProperty("showStepNavigation",false);}this._updateLayout();return this;},setShowStepNavigation:function(p){this.setProperty("showStepNavigation",p,true);this._updateLayout();return this;},setEnableToolbar:function(p){this.setProperty("enableToolbar",p,true);this._updateLayout();return this;},setEnableFullScreen:function(p){this.setProperty("enableFullScreen",p,true);this._fullScreenToggle=true;var v=document.getElementById(this.getId());var k=this.getProperty("enableFullScreen");var m=false;if(k){if(!(document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement)){this._oldWidth=this.getWidth();this._oldHeight=this.getHeight();var v=document.getElementById(this.getId());if(!this._fullScreenHandler){this._fullScreenHandler=function(n){if(!(document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement)){document.removeEventListener("fullscreenchange",this._fullScreenHandler.bind(this));document.removeEventListener("mozfullscreenchange",this._fullScreenHandler.bind(this));document.removeEventListener("webkitfullscreenchange",this._fullScreenHandler.bind(this));document.removeEventListener("msfullscreenchange",this._fullScreenHandler.bind(this));v.style.width=this._oldWidth;v.style.height=this._oldHeight;this._updateSize();this.fireFullScreen({isFullScreen:false});}};document.addEventListener("fullscreenchange",this._fullScreenHandler.bind(this));document.addEventListener("mozfullscreenchange",this._fullScreenHandler.bind(this));document.addEventListener("webkitfullscreenchange",this._fullScreenHandler.bind(this));document.addEventListener("msfullscreenchange",this._fullScreenHandler.bind(this));}m=true;if(v.requestFullScreen){v.requestFullScreen();}else if(v.webkitRequestFullScreen){v.webkitRequestFullScreen();}else if(v.mozRequestFullScreen){v.mozRequestFullScreen();}else if(v.msRequestFullscreen){v.msRequestFullscreen();}else{m=false;}if(m){v.style.width='100%';v.style.height='100%';}}}else{if(document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement){m=true;if(document.cancelFullScreen){document.cancelFullScreen();}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}else{m=false;}if(m){v.style.width=this._oldWidth;v.style.height=this._oldHeight;}}}if(m){this._updateSize();this.fireFullScreen({isFullScreen:k});}return this;},destroyContentResources:function(s){this._shouldLoadContentResources=true;this._destroyMainScene();return this.destroyAggregation("contentResources",s);},invalidate:function(o){q.sap.log.debug("invalidate "+(o instanceof sap.ui.base.ManagedObject?o.getId():o));if(o instanceof a){this._shouldLoadContentResources=true;}return C.prototype.invalidate.apply(this,arguments);},onBeforeRendering:function(){if(this._fullScreenToggle){this._fullScreenToggle=false;}else{this._showToolbar();this._showSceneTree();this._showStepNavigation();if(this._shouldLoadContentResources){this._destroyMainScene();this._loadAllContentResources();}}if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}},onAfterRendering:function(){var k=this.getDomRef();this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:k.clientWidth,height:k.clientHeight}});},_handleResize:function(k){this._updateSize();},_updateSize:function(){if(this._updateSizeTimer){clearTimeout(this._updateSizeTimer);}this._updateSizeTimer=setTimeout(this._doUpdateSize.bind(this),100);},_doUpdateSize:function(){var k=this.getId()+"-flexibleControl";var m=document.getElementById(k);m.style.width='100%';m.style.height='100%';var n=m.clientHeight;var o=document.getElementById(k+"Content_0");var p=document.getElementById(k+"Content_1");var r=document.getElementById(k+"Content_2");n-=o.clientHeight;if(r!=null&&r.style.visibility!='hidden'){n-=r.clientHeight;}p.style.height=n+"px";},isTreeBinding:function(n){return n==="contentResources";},setBusy:function(k){if(k){if(this._busyIndicatorCounter===0){this.setBusyIndicatorDelay(0);C.prototype.setBusy.call(this,true);}this._busyIndicatorCounter+=1;}else{this._busyIndicatorCounter-=1;if(this._busyIndicatorCounter==0){C.prototype.setBusy.call(this,false);}}},_loadAllContentResources:function(){var h=q.sap.log;var r=this.getContentResources();if(r.length===0){return this;}var k=j(r);if(k.length===1){var m=k[0];if(m===sap.ui.vk.ContentResourceSourceCategory["3D"]){this.setBusy(true);this._showSceneTree();this._showViewport();this._showStepNavigation();this._destroyMainScene();this._graphicsCore.loadContentResourcesAsync(r,function(t){if(t){h.error("Some of content resources cannot be loaded.");this.fireSceneLoadingFailed();}else{var u=this._graphicsCore.buildSceneTree(r);if(u){this._mainScene=u;this._viewport.setScene(this._mainScene);this._setViewStateManager(this._graphicsCore.createViewStateManager(this._mainScene.getDefaultNodeHierarchy()));this._viewport.setViewStateManager(this.getViewStateManager());this.fireSceneLoadingSucceeded({scene:this._mainScene});this._sceneTree.setScene(this._mainScene,this.getViewStateManager());this.setEnableSceneTree(true);this.setShowSceneTree(true);this._stepNavigation.setScene(this._mainScene);this.setEnableStepNavigation(true);this.setShowStepNavigation(true);this.setShowStepNavigation(false);}else{this.fireSceneLoadingFailed();}}this.setBusy(false);this._shouldLoadContentResources=false;}.bind(this));}else if(m===sap.ui.vk.ContentResourceSourceCategory["2D"]){this.setEnableSceneTree(false);this.setEnableStepNavigation(false);if(r.length===1){var o=function(){this._shouldLoadContentResources=false;this.setBusy(false);if(this.getEnableOverlay()){this._activateOverlay(true);}this.fireImageLoadingSucceeded();}.bind(this);var n=function(){this._shouldLoadContentResources=false;this.setBusy(false);this.fireImageLoadingFailed();}.bind(this);this._showNativeViewport();this.setBusy(true);var p=r[0];if(p.getFile()){var s=new FileReader();s.onload=function(t){this._nativeViewport.loadUrl(s.result,o,n,null,p.getSourceType());}.bind(this);s.readAsDataURL(p.getFile());}else{this._nativeViewport.loadUrl(p.getSource(),o,n,null,p.getSourceType());}}else{h.error("Loading multiple 2D files is not supported yet");}}}else if(k.length>1){throw new Error("All content resources must have same category - either 3D or 2D.");}return this;},_showToolbar:function(){if(!this._toolbar){this._toolbar=new g({title:this.getToolbarTitle()});this._toolbar.setViewer(this);this.setAggregation("toolbar",this._toolbar);}this._toolbar.setVisible(this.getEnableToolbar());this._updateLayout();return this;},_updateLayout:function(){this._layout.setWidth(this.getWidth());this._layout.removeAllContent();this._layout.setHeight(this.getHeight());var k=this.getHeight();var m=[0,0,0];if(k=="auto"){k=400;}else if(k.substr(k.length-1)=='%'){k=400;}else{k=parseInt(k,10);}if(this._toolbar!=null&&this.getEnableToolbar()){m[0]=48;}if(this._stepNavigation!=null&&this.getShowStepNavigation()){m[2]=0;}m[1]=k-m[0]-m[2];if(this._toolbar!=null&&this.getEnableToolbar()){this._toolbar.setVisible(true);this._toolbar.setLayoutData(new e({size:m[0]+"px"}));this._layout.insertContent(this._toolbar,0);}else if(this._toolbar!=null){this._toolbar.setVisible(false);}if(this._sceneTree!=null&&this.getShowSceneTree()){this._sceneTree.setVisible(true);this._sceneTree.setLayoutData(new d({size:"320px",minSize:10,resizable:true}));this._content.insertContentArea(this._sceneTree,0);}else if(this._sceneTree!=null){this._content.removeContentArea(this._sceneTree);this._sceneTree.setVisible(false);}this._content.setLayoutData(new e({size:m[1]+"px"}));this._layout.addContent(this._content);if(this._stepNavigation!=null&&this.getShowStepNavigation()){if(this._graphicsCore!=null&&!this._stepNavigation.hasGraphicsCore()){this._stepNavigation.setGraphicsCore(this._graphicsCore);}this._stepNavigation.setVisible(true);this._layout.addContent(this._stepNavigation);}else if(this._stepNavigation!=null){this._stepNavigation.setVisible(false);}this._toolbar.refresh();this._updateSize();},_showSceneTree:function(){if(!this._sceneTree){this._sceneTree=new b();this.setAggregation("sceneTree",this._sceneTree);}this._sceneTree.setVisible(this.getShowSceneTree());this._updateLayout();return this;},_showStepNavigation:function(){if(!this._stepNavigation){this._stepNavigation=new f(this.getId()+"-stepNavigation",{visible:this.getShowStepNavigation()});this.setAggregation("stepNavigation",this._stepNavigation);}this._stepNavigation.setVisible(this.getShowStepNavigation());this._updateLayout();return this;},_showViewport:function(){if(!this._viewport){this._viewport=new V(this.getId()+"-viewport");this.setAggregation("viewport",this._viewport);}if(!this._graphicsCore){q.sap.require("sap.ui.vk.GraphicsCore");this._graphicsCore=new sap.ui.vk.GraphicsCore(this._getRuntimeSettings(),q.extend({antialias:true,alpha:true,premultipliedAlpha:false},this._getWebGLContextAttributes()));this._viewport.setGraphicsCore(this._graphicsCore);}if(this._nativeViewport){this._nativeViewport.setVisible(false);}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._viewport);this._viewport.setVisible(true);return this;},_showNativeViewport:function(){if(!this._nativeViewport){this._nativeViewport=new N(this.getId()+"-nativeViewport");this.setAggregation("nativeViewport",this._nativeViewport);}if(this._viewport){this._viewport.setVisible(false);}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._nativeViewport);this._nativeViewport.setVisible(true);return this;},_activateOverlay:function(E){if(E){var o=new sap.ui.vk.Overlay();this.setAggregation("hotspotOverlay",o);o.setTarget(this._nativeViewport);this._fillMockData();this._stackedViewport.addContent(o);}else{var o=this.getAggregation("hotspotOverlay");this._stackedViewport.removeContent(1);this.removeAllAggregation("hotspotOverlay");}},_fillMockData:function(){var o=this.getAggregation("hotspotOverlay");o.addArea(new sap.ui.vk.OverlayArea({position:'0.4;0.6;0;0.6;0.6;0;0.6;0.4;0;0.4;0.4;0',tooltip:'Area 1',changeable:false}));}});function j(r){var k=[];var m={};function n(o){var s=o.getSourceType();if(s){var p=sap.ui.vk.ContentResourceSourceTypeToCategoryMap[s]||"unknown";if(!m.hasOwnProperty(p)){m[p]=true;k.push(p);}}o.getContentResources().forEach(n);}r.forEach(n);return k;}return i;});};if(!jQuery.sap.isDeclared('sap.ui.vk.GraphicsCore')){jQuery.sap.declare('sap.ui.vk.GraphicsCore');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.base.EventProvider');jQuery.sap.require('sap.ve.dvl');sap.ui.define("sap/ui/vk/GraphicsCore",["jquery.sap.global","./library","sap/ui/base/EventProvider","sap/ve/dvl","./Scene","./NodeHierarchy","./ContentResource","./DownloadManager","./ViewStateManager","./DvlException"],function(q,l,E,D,S,N,C,a,V,b){"use strict";var c={Empty:"Empty",Local:"Local",Remote:"Remote"};var d=function(e,s){var o;if(typeof s==="string"){o=c.Remote;}else if(s===undefined){o=c.Empty;}else if(s instanceof File){o=c.Local;}else{throw new Error("Unsupported type of parameter 'source'.");}Object.defineProperties(this,{"dvlSceneId":{value:e,writable:false,enumerable:true},"source":{value:s,writable:false,enumerable:true},"origin":{value:o,writable:false,enumerable:true},"modified":{value:false,writable:true,enumerable:true}});};var G=E.extend("sap.ui.vk.GraphicsCore",{metadata:{publicMethods:["buildSceneTree","createViewStateManager","destroyScene","destroyViewStateManager","getApi","loadContentResourcesAsync","showDebugInfo"]},_DVLMajorVersion:5,_DVLMinorVersion:0,constructor:function(r,w){E.apply(this);var s=q.extend({},r,{filePackagePrefixURL:q.sap.getResourcePath("sap/ve")+"/"});this._dvlClientId=q.sap.uid();this._dvl=sap.ve.dvl.createRuntime(s);this._dvl.CreateCoreInstance(this._dvlClientId);this._dvl.Core.Init(this._DVLMajorVersion,this._DVLMinorVersion);this._canvas=this._createRenderingCanvasAndContext(w);this._sceneResources=[];this._vkScenesToSceneResourcesMap={};this._vkScenes=[];this._viewports=[];this._viewStateManagers=[];},destroy:function(){this._viewports.slice().forEach(function(v){v.setGraphicsCore(null);});this._viewports=null;this._vkScenes.forEach(this.destroyScene.bind(this));this._vkScenes=null;this._viewStateManagers.slice().forEach(this.destroyViewStateManager.bind(this));this._viewStateManagers=null;this._sceneResources.slice().forEach(this._destroySceneResource.bind(this));this._sceneResources=null;this._webGLContext=null;this._canvas=null;this._dvl.Core.Release();this._dvl=null;E.prototype.destroy.apply(this);},_createRenderingCanvasAndContext:function(w){var e=document.createElement("canvas");e.id=q.sap.uid();this._webGLContext=this._dvl.Core.CreateWebGLContext(e,w);return e;},_getCanvas:function(){return this._canvas;},_getWebGLContext:function(){return this._webGLContext;},_getDvl:function(){return this._dvl;},_getDvlClientId:function(){return this._dvlClientId;},_destroySceneResource:function(r){this._dvl.Scene.Release(r.dvlSceneId);switch(r.origin){case c.Local:this._dvl.Core.DeleteFileByUrl(r.source.name,"local");break;case c.Remote:this._dvl.Core.DeleteFileByUrl(r.source,"remote");break;default:break;}this._sceneResources.splice(this._sceneResources.indexOf(r),1);return this;},_findSceneResources:function(p){var e=Object.getOwnPropertyNames(p);return this._sceneResources.filter(function(i){return e.every(function(f){return p[f]===i[f];});});},loadContentResourcesAsync:function(e,o){function f(r){var i=[];function j(r){i=i.concat(r);r.forEach(function(k){j(k.getContentResources());});}j(r);return i;}var g=f(e);var s=q.sap.unique(g.map(function(i){return i.getFile()||i.getSource();}).filter(function(u){return u;}).filter(function(u){return this._findSceneResources({source:u,modified:false}).length===0;}.bind(this)));if(s.length>0){var h;new a(s).attachItemSucceeded(function(i){var j=i.getParameter("source");var k=j instanceof File;var n=k?j.name:j;var r=i.getParameter("response");try{var m=sap.ui.vk.dvl.getPointer(this._dvl.Core.LoadFileFromArrayBuffer(r,n,null,k?"local":"remote"));this._sceneResources.push(new d(m,j));}catch(p){if(p instanceof b){h=h||[];h.push({source:i.getParameter("source"),status:p.code,statusText:p.message});}else{throw p;}}},this).attachAllItemsCompleted(function(i){g.forEach(function(r){r.setLoaded();});if(o){o(h);}},this).attachItemFailed(function(i){h=h||[];h.push({source:i.getParameter("source"),status:i.getParameter("status"),statusText:i.getParameter("statusText")});},this).start();}else if(o){o();}return this;},buildSceneTree:function(e){var v,f,r,g;if(e.length===1&&(e[0].getSource()||e[0].getFile())){g=this._findSceneResources({source:e[0].getFile()||e[0].getSource(),modified:false})[0];if(g){r=e[0].getContentResources();}else{throw new Error("Content resource "+e[0].getSource()+" is not downloaded");}}else{g=new d(this._dvl.Core.CreateEmptyScene());this._sceneResources.push(g);r=e;}g.modified=true;f=g.dvlSceneId;v=new S(this,f);this._vkScenes.push(v);var h=this._vkScenesToSceneResourcesMap[v.getId()]=[g];var n=v.getDefaultNodeHierarchy();var i=function(s){return this._dvl.Scene.RetrieveSceneInfo(s,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN).ChildNodes;}.bind(this);var m=function(j,k){var o=this._dvl.Scene.CreateNode(f,j,k.getName());var p=n.createNodeProxy(o);k._setNodeProxy(p);var s=k.getLocalMatrix();if(s){p.setLocalMatrix(s);}var t=k.getFile()||k.getSource();if(t){var u=this._findSceneResources({source:t,modified:false})[0];i(u.dvlSceneId).forEach(function(w){this._dvl.Scene.CreateNodeCopy(f,w,o,sap.ve.dvl.DVLCREATENODECOPYFLAG.COPY_CHILDREN);}.bind(this));if(h.indexOf(u)<0){h.push(u);}}k.getContentResources().forEach(m.bind(this,o));}.bind(this);r.forEach(m.bind(this,null));return v;},destroyScene:function(v){var e=v.getId();var f=this._vkScenes.indexOf(v);if(f<0){q.sap.log.warning("Scene with id '"+e+"' is not create by this GraphicsCore.");return this;}var g=this._vkScenesToSceneResourcesMap[e];this._vkScenes.splice(f,1);delete this._vkScenesToSceneResourcesMap[e];var h=Object.getOwnPropertyNames(this._vkScenesToSceneResourcesMap);g.filter(function(s){return!h.some(function(e){return this._vkScenesToSceneResourcesMap[e].indexOf(s);});}).forEach(this._destroySceneResource.bind(this));v.destroy();return this;},_registerViewport:function(v){if(this._viewports.indexOf(v)>=0){return false;}this._viewports.push(v);return true;},_unregisterViewport:function(v){var i=this._viewports.indexOf(v);if(i<0){return false;}this._viewports.splice(i,1);return true;},_getViewportCount:function(){return this._viewports.length;},createViewStateManager:function(n){var v=new V(n);this._viewStateManagers.push(v);return v;},destroyViewStateManager:function(v){var i=this._viewStateManagers.indexOf(v);if(i>=0){this._viewStateManagers.splice(i,1)[0].destroy();}return this;},showDebugInfo:function(e){this._viewports.forEach(function(v){v.setOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_SHOW_DEBUG_INFO,e);});return this;},getApi:function(e){switch(e){case sap.ui.vk.GraphicsCoreApi.LegacyDvl:return this._dvl;default:return null;}}});return G;});};
