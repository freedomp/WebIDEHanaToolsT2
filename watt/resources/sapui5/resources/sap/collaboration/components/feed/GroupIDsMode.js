/*
* ! @copyright@
*/
sap.ui.define(["./Mode","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/collaboration/components/utils/PendingRequestsUtil"],function(M,F,a,P){var G=M.extend("sap.collaboration.components.feed.GroupIDsMode",{constructor:function(f){M.apply(this,[f]);this._oPendingRequestsUtil=new P();this._oList.setModel(this._oViewDataModel);}});G.prototype.start=function(f){this._oViewDataModel.setProperty("/groups",[]);this._iOpenGroupRequests=0;this._aGroupsToLoad=jQuery.merge([],f);if(this._iOpenGroupRequests!==0){this._oGroupSelectPopover.setBusy(true);}this._oList.bindItems({path:"/groups",template:this._oItemTemplate});this._fillGroupInfo();};G.prototype.onBatchCompleted=function(e){this._oJamModel.setUseBatch(false);if(this._iOpenGroupRequests===0){if(this._oGroupSelectPopover!==undefined){this._oGroupSelectPopover.setBusy(false);}}};G.prototype.stop=function(){this._oPendingRequestsUtil.abortAll();};G.prototype.onGroupSelected=function(e){var g=e.getSource().getSelectedItem().getBindingContext().getObject();this._oViewDataModel.setProperty("/groupSelected",g);this._oViewDataModel.setProperty("/url","/Groups('"+g.Id+"')/FeedEntries");this._oGroupSelectPopover.close();};G.prototype.onGroupSelectorButtonPress=function(e){if(this._oGroupSelectPopover===undefined){this._oList.bindAggregation("items",{path:"/groups",template:this._oItemTemplate});this._oList.setModel(this._oViewDataModel);this._oList.setSelectedItem(this._oList.getItems()[0]);if(this._iOpenGroupRequests!==0){this._oLabel.setVisible(false);this._oList.setVisible(false);this._oGroupSelectPopover.setBusy(true);}}this._oGroupSelectPopover.openBy(e.getSource());};G.prototype.onGroupSelectorUpdateStarted=function(c){};G.prototype.onGroupSelectorUpdateFinished=function(c){var r=c.getParameter("reason");if(r==="Refresh"||r==="Change"){this._oList.setSelectedItem(this._oList.getItems()[0]);}};G.prototype._fillGroupInfo=function(){var b=10;var B=0;var i=0;var g=0;var c=20;this._oJamModel.setUseBatch(true);var f="$filter=Id eq '";this.oResult;var o;for(var l=0,d=this._aGroupsToLoad.length;l<d;l++){if(!(l%c==0)){f=f.concat(" or Id eq '"+this._aGroupsToLoad[l]+"'");}else{f=f.concat(this._aGroupsToLoad[l]+"'");};g++;if(g===c||l+1===d){this._iOpenGroupRequests++;var r=undefined;this._loadGroups(f,B).done((function(D,e){if(D.results&&D.results!=[]){r=D.results;}else{if(D&&D!=[]){r=D;};};o=r.length;if(r!=undefined&&o>0){var I=this._aGroupsToLoad.indexOf(r[0].Id);for(var C=0;C<o;C++){if(this._oViewDataModel.getProperty("/groupSelected/Id")===r[C].Id){this._oViewDataModel.setProperty("/groupSelected",r[C]);};I++;this._oViewDataModel.setProperty("/groups/"+I,r[C]);}};this._iOpenGroupRequests--;if(this._iOpenGroupRequests===0){var R=this._oViewDataModel.getProperty("/groups/");R=R.filter(function(n){return n!=undefined});this._oViewDataModel.setProperty("/groups/",R);if(this._oViewDataModel.getProperty("/groupSelected/Id")===undefined&&R.length>0){this._oViewDataModel.setProperty("/groupSelected",R[0]);this._oViewDataModel.setProperty("/url","/Groups('"+R[0].Id+"')/FeedEntries");}};}).bind(this));i++;g=0;var f="$filter=Id eq '";};if(i==b){B++;i=0;}};var R=this._oViewDataModel.getProperty("/groups/");R=R.filter(function(n){return n!=undefined});this._oViewDataModel.getProperty("/groups/",R);};G.prototype._loadGroups=function(f,b){if(!this._oFeedController._isJamConfigured()){return;}var t=this;var l=jQuery.Deferred();var p="/Groups/";var m={"urlParameters":f+"&$select=Id,Name,WebURL","success":function(d,c){l.resolveWith(t,[d,c]);},"error":function(e){l.rejectWith(t,[e]);t._oFeedController.logError("The group information was not retrieved.");},"batchGroupId":b};var r=this._oJamModel.read(p,m);this._oPendingRequestsUtil.add(r);var o=l.promise(r);o.always(function(){this._oPendingRequestsUtil.remove(r);});return o;};G.prototype.addPost=function(c,g){var p="/Groups('"+g+"')/FeedEntries";return M.prototype.addPost.apply(this,[c,p]);};return G;},true);
