tinymce.PluginManager.add('noneditable',function(a){var T=tinymce.dom.TreeWalker;var b='contenteditable',c='data-mce-'+b;var V=tinymce.util.VK;function g(e){var i;if(e.nodeType===1){i=e.getAttribute(c);if(i&&i!=="inherit"){return i;}i=e.contentEditable;if(i!=="inherit"){return i;}}return null;}function d(e){var s;while(e){s=g(e);if(s){return s==="false"?e:null;}e=e.parentNode;}}function h(){var i=a.dom,s=a.selection,l='mce_noneditablecaret',m='\uFEFF';function o(e){while(e){if(e.id===l){return e;}e=e.parentNode;}}function q(e){var w;if(e){w=new T(e,e);for(e=w.current();e;e=w.next()){if(e.nodeType===3){return e;}}}}function r(e,p){var w,x;if(g(e)==="false"){if(i.isBlock(e)){s.select(e);return;}}x=i.createRng();if(g(e)==="true"){if(!e.firstChild){e.appendChild(a.getDoc().createTextNode('\u00a0'));}e=e.firstChild;p=true;}w=i.create('span',{id:l,'data-mce-bogus':true},m);if(p){e.parentNode.insertBefore(w,e);}else{i.insertAfter(w,e);}x.setStart(w.firstChild,1);x.collapse(true);s.setRng(x);return w;}function t(e){var p,w,x;if(e){p=s.getRng(true);p.setStartBefore(e);p.setEndBefore(e);w=q(e);if(w&&w.nodeValue.charAt(0)==m){w=w.deleteData(0,1);}i.remove(e,true);s.setRng(p);}else{while((e=i.get(l))&&e!==x){w=q(e);if(w&&w.nodeValue.charAt(0)==m){w=w.deleteData(0,1);}i.remove(e,true);x=e;}}}function u(){var e,p,w,x,y;function z(y,A){var B,C,D,E,F;B=x.startContainer;C=x.startOffset;if(B.nodeType==3){F=B.nodeValue.length;if((C>0&&C<F)||(A?C==F:C===0)){return;}}else{if(C<B.childNodes.length){var G=!A&&C>0?C-1:C;B=B.childNodes[G];if(B.hasChildNodes()){B=B.firstChild;}}else{return!A?y:null;}}D=new T(B,y);while((E=D[A?'prev':'next']())){if(E.nodeType===3&&E.nodeValue.length>0){return;}else if(g(E)==="true"){return E;}}return y;}t();w=s.isCollapsed();e=d(s.getStart());p=d(s.getEnd());if(e||p){x=s.getRng(true);if(w){e=e||p;if((y=z(e,true))){r(y,true);}else if((y=z(e,false))){r(y,false);}else{s.select(e);}}else{x=s.getRng(true);if(e){x.setStartBefore(e);}if(p){x.setEndAfter(p);}s.setRng(x);}}}function v(e){var w=e.keyCode,x,y,z,A;function B(O,P){while((O=O[P?'previousSibling':'nextSibling'])){if(O.nodeType!==3||O.nodeValue.length>0){return O;}}}function C(O,P){s.select(O);s.collapse(P);}function D(O){var M,N,P,x;function Q(S){var U=N;while(U){if(U===S){return;}U=U.parentNode;}i.remove(S);u();}function R(){var S,J,U=a.schema.getNonEmptyElements();J=new tinymce.dom.TreeWalker(N,a.getBody());while((S=(O?J.prev():J.next()))){if(U[S.nodeName.toLowerCase()]){break;}if(S.nodeType===3&&tinymce.trim(S.nodeValue).length>0){break;}if(g(S)==="false"){Q(S);return true;}}if(d(S)){return true;}return false;}if(s.isCollapsed()){M=s.getRng(true);N=M.startContainer;P=M.startOffset;N=o(N)||N;if((x=d(N))){Q(x);return false;}if(N.nodeType==3&&(O?P>0:P<N.nodeValue.length)){return true;}if(N.nodeType==1){N=N.childNodes[P]||N;}if(R()){return false;}}return true;}u();z=s.getStart();A=s.getEnd();x=d(z)||d(A);var E=a.selection.getNode();var F=w==V.LEFT||w==V.RIGHT||w==V.UP||w==V.DOWN;var G=w==V.LEFT||w==V.UP;if(x&&(w<112||w>124)&&w!=V.DELETE&&w!=V.BACKSPACE){if((tinymce.isMac?e.metaKey:e.ctrlKey)&&(w==67||w==88||w==86)){return;}e.preventDefault();if(F){if(a.dom.isBlock(x)){var H=G?x.previousSibling:x.nextSibling;if(!H||H&&g(H)==='false'){var p=i.create('p',null,'&nbsp;');p.className='mceTmpParagraph';var I=G?x:H;if(I&&I.parentNode){I.parentNode.insertBefore(p,I);}else if(!H&&!G){x.parentNode.appendChild(p);}H=p;}var J=new T(H,H);var K=G?J.prev():J.next();C(K,!G);}else{C(x,G);}}}else{if(F||w==V.BACKSPACE||w==V.DELETE){y=o(z);if(y){if(w==V.LEFT||w==V.BACKSPACE){x=B(y,true);if(x&&g(x)==="false"){e.preventDefault();if(w==V.LEFT){C(x,true);}else{i.remove(x);return;}}else{t(y);}}if(w==V.RIGHT||w==V.DELETE){x=B(y,true);if(x&&g(x)==="false"){e.preventDefault();if(w==V.RIGHT){C(x,false);}else{i.remove(x);return;}}else{t(y);}}}else{if(F){if(E&&E.className.indexOf('mceTmpParagraph')!==-1&&E[G?'previousSibling':'nextSibling']){var L=E[G?'previousSibling':'nextSibling'];if(E.innerHTML==='&nbsp;'||E.innerHTML===''||E.innerHTML===' '){i.remove(E);}else{E.className=E.className.replace('mceTmpParagraph','');}C(L,!G);}}var M=s.getRng(true);var N=M.endContainer;if(i.isBlock(N)&&i.isBlock(N.nextSibling)&&M.endOffset==1&&w==V.DELETE){x=d(N.nextSibling);}if(x&&(w==V.DELETE||w==V.BACKSPACE)&&i.isBlock(x)){e.preventDefault();i.remove(x);return;}}if((w==V.BACKSPACE||w==V.DELETE)&&!D(w==V.BACKSPACE)){e.preventDefault();return false;}}}}a.on('mousedown',function(e){var p=a.selection.getNode();if(p&&p.className.indexOf('mceTmpParagraph')!==-1&&p!==e.target){if(p.innerHTML==='&nbsp;'||p.innerHTML===''||p.innerHTML===' '){i.remove(p);}else{p.className=p.className.replace('mceTmpParagraph','');}}if(g(p)==="false"&&p==e.target){u();}});a.on('mouseup',u);a.on('keydown',v);}var f,n,j;function k(e){var i=j.length,l=e.content,m=tinymce.trim(n);if(e.format=="raw"){return;}while(i--){l=l.replace(j[i],function(o){var p=arguments,q=p[p.length-2];if(q>0&&l.charAt(q-1)=='"'){return o;}return('<span class="'+m+'" data-mce-content="'+a.dom.encode(p[0])+'">'+a.dom.encode(typeof p[1]==="string"?p[1]:p[0])+'</span>');});}e.content=l;}f=" "+tinymce.trim(a.getParam("noneditable_editable_class","mceEditable"))+" ";n=" "+tinymce.trim(a.getParam("noneditable_noneditable_class","mceNonEditable"))+" ";j=a.getParam("noneditable_regexp");if(j&&!j.length){j=[j];}a.on('PreInit',function(){h();if(j){a.on('BeforeSetContent',k);}a.parser.addAttributeFilter('class',function(e){var i=e.length,l,m;while(i--){m=e[i];l=" "+m.attr("class")+" ";if(l.indexOf(f)!==-1){m.attr(c,"true");}else if(l.indexOf(n)!==-1){m.attr(c,"false");}}});a.serializer.addAttributeFilter(c,function(e){var i=e.length,l;while(i--){l=e[i];if(j&&l.attr('data-mce-content')){l.name="#text";l.type=3;l.raw=true;l.value=l.attr('data-mce-content');}else{l.attr(b,null);l.attr(c,null);}}});a.parser.addAttributeFilter(b,function(e){var i=e.length,l;while(i--){l=e[i];l.attr(c,l.attr(b));l.attr(b,null);}});});a.on('drop',function(e){if(d(e.target)){e.preventDefault();}});});
