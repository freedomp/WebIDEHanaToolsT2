tinymce.PluginManager.add('autolink',function(a){var A;a.on("keydown",function(e){if(e.keyCode==13){return c(a);}});if(tinymce.Env.ie){a.on("focus",function(){if(!A){A=true;try{a.execCommand('AutoUrlDetect',false,true);}catch(e){}}});return;}a.on("keypress",function(e){if(e.keyCode==41){return h(a);}});a.on("keyup",function(e){if(e.keyCode==32){return b(a);}});function h(a){p(a,-1,'(',true);}function b(a){p(a,0,'',true);}function c(a){p(a,-1,'',false);}function p(a,e,d){var r,f,s,g,i,t,m,j,l,k;function n(u,v){if(v<0){v=0;}if(u.nodeType==3){var l=u.data.length;if(v>l){v=l;}}return v;}function o(u,v){if(u.nodeType!=1||u.hasChildNodes()){r.setStart(u,n(u,v));}else{r.setStartBefore(u);}}function q(u,v){if(u.nodeType!=1||u.hasChildNodes()){r.setEnd(u,n(u,v));}else{r.setEndAfter(u);}}if(a.selection.getNode().tagName=='A'){return;}r=a.selection.getRng(true).cloneRange();if(r.startOffset<5){j=r.endContainer.previousSibling;if(!j){if(!r.endContainer.firstChild||!r.endContainer.firstChild.nextSibling){return;}j=r.endContainer.firstChild.nextSibling;}l=j.length;o(j,l);q(j,l);if(r.endOffset<5){return;}f=r.endOffset;g=j;}else{g=r.endContainer;if(g.nodeType!=3&&g.firstChild){while(g.nodeType!=3&&g.firstChild){g=g.firstChild;}if(g.nodeType==3){o(g,0);q(g,g.nodeValue.length);}}if(r.endOffset==1){f=2;}else{f=r.endOffset-1-e;}}s=f;do{o(g,f>=2?f-2:0);q(g,f>=1?f-1:0);f-=1;k=r.toString();}while(k!=' '&&k!==''&&k.charCodeAt(0)!=160&&(f-2)>=0&&k!=d);if(r.toString()==d||r.toString().charCodeAt(0)==160){o(g,f);q(g,s);f+=1;}else if(r.startOffset===0){o(g,0);q(g,s);}else{o(g,f);q(g,s);}t=r.toString();if(t.charAt(t.length-1)=='.'){q(g,s-1);}t=r.toString();m=t.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i);if(m){if(m[1]=='www.'){m[1]='http://www.';}else if(/@$/.test(m[1])&&!/^mailto:/.test(m[1])){m[1]='mailto:'+m[1];}i=a.selection.getBookmark();a.selection.setRng(r);a.execCommand('createlink',false,m[1]+m[2]);a.selection.moveToBookmark(i);a.nodeChanged();}}});
