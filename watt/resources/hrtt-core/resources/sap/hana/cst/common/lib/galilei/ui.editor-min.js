"use strict";namespace("sap.galilei.ui.editor");
namespace("sap.galilei.ui.editor.tracker");
"use strict";namespace("sap.galilei.ui.editor.command");sap.galilei.ui.editor.command.Command=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.command.Command",parent:sap.galilei.ui.common.command.Command,properties:{isReadOnly:true,editor:undefined,viewer:{get:function(){if(this.editor){return this.editor.viewer}return undefined}},diagram:{get:function(){if(this.editor){return this.editor.diagram}return undefined}},resource:{get:function(){if(this.diagram){return this.diagram.resource}}}}});sap.galilei.ui.editor.command.defineCommand=function(oCommandDef){var CommandClass;if(oCommandDef){if(!oCommandDef.parent){oCommandDef.parent=sap.galilei.ui.editor.command.Command}CommandClass=sap.galilei.core.defineClass(oCommandDef)}return CommandClass};
"use strict";sap.galilei.ui.editor.command.SelectValueCommand=sap.galilei.ui.editor.command.defineCommand({fullClassName:"sap.galilei.ui.editor.command.SelectValueCommand",properties:{values:undefined,currentValue:undefined,object:undefined,symbol:undefined,selectedValue:undefined,isValueChanged:false,internalValues:{field:"_internalValues",get:function(){return this._internalValues}},labels:{field:"_labels",get:function(){return this._labels}},icons:{field:"_icons",get:function(){return this._icons}}},methods:{getValues:function(){var aInitialValues=this.values,index,vValue,vInternalValue,sLabel,sIcon;this._internalValues=[];this._labels=[];this._icons=[];if(aInitialValues){for(index=0;index<aInitialValues.length;index++){vValue=aInitialValues[index];if(typeof vValue==="object"){vInternalValue=vValue.value;sLabel=vValue.label;if(!sLabel){sLabel=vValue}sIcon=vValue.icon}else{vInternalValue=vValue;sLabel=vValue}if(!sLabel){sLabel="<None>"}if(vInternalValue!=this.currentValue&&this.onVerifyValue(vValue)){this._internalValues.push(vInternalValue);this._labels.push(sLabel);this._icons.push(sIcon)}}}return this._internalValues},onVerifyValue:function(vValue){return true},getButtonDefinitions:function(){var index,oButtons=[],vInternalValue,sLabel,sIcon,sCommand,oCommand;function executeSelectValue(oParam){if(this.parameters&&this.parameters.length>0&&this._parentCommand){var vValue=this.parameters[0];if(vValue!==this._parentCommand.currentValue){this._parentCommand.selectedValue=vValue;this._parentCommand.isValueChanged=true;if(this._parentCommand.onValueChanged){this._parentCommand.onValueChanged()}}}}this.getValues();if(this.internalValues){for(index=0;index<this.internalValues.length;index++){vInternalValue=this.internalValues[index];sLabel=this.labels[index];sIcon=this.icons[index];sCommand=this.name+"-to-"+vInternalValue;oCommand=new sap.galilei.ui.editor.command.Command({editor:this.editor,name:sCommand,displayName:sLabel,parameters:[vInternalValue,sLabel],smallIcon:sIcon,execute:executeSelectValue});oCommand._parentCommand=this;sap.galilei.ui.common.command.addCommand(sCommand,oCommand);oButtons.push({commandName:sCommand})}}return oButtons},getValueIndex:function(){return sap.galilei.ui.editor.command.SelectValueCommand.getValueIndex(this.values,this.selectedValue)},createValuePicker:function(oParam){if(oParam){var oContextButton=oParam.source,aButtons,oBBox;if(oContextButton){aButtons=this.getButtonDefinitions();oBBox=oContextButton.getSvgBBox(true);if(oContextButton.popupContextButtonPad){oContextButton.popupContextButtonPad.dispose()}oContextButton.popupContextButtonPad=new sap.galilei.ui.editor.widget.ContextButtonPad({editor:this.editor,attachToBBox:oBBox,offsetX:0,offsetY:0,buttonsDefinition:aButtons})}}},execute:function(oParam){if(oParam){var oContextButton=oParam.source;if(oContextButton){if(!this.editor&&oParam.editor){this.editor=oParam.editor}if(oParam.symbol){this.symbol=oParam.symbol;if(oParam.symbol.object){this.object=oParam.symbol.object}}this.createValuePicker(oParam)}}},onValueChanged:function(){},defaultDispose:function(){this.internalValues=undefined;this.labels=undefined;this.icons=undefined},dispose:function(){this.defaultDispose()}},statics:{getValueIndex:function(aValues,sValue){var index;if(aValues){for(index=0;index<aValues.length;index++){if(aValues[index].value===sValue){return index}}}return -1}}});
"use strict";sap.galilei.ui.editor.command.ChangePropertyCommand=sap.galilei.ui.editor.command.defineCommand({fullClassName:"sap.galilei.ui.editor.command.ChangePropertyCommand",parent:sap.galilei.ui.editor.command.SelectValueCommand,properties:{isReadOnly:{value:false,writable:false,configurable:false},attribute:undefined},methods:{execute:function(oParam){if(oParam){var oContextButton=oParam.source;if(oContextButton){if(!this.editor&&oParam.editor){this.editor=oParam.editor}if(oParam.symbol){this.symbol=oParam.symbol;if(oParam.symbol.object){this.object=oParam.symbol.object}}if(this.object&&this.attribute&&sap.galilei.core.hasProperty(this.object,this.attribute)){this.currentValue=this.object[this.attribute]}this.createValuePicker(oParam)}}},onValueChanged:function(){this.changeObjectProperty()},changeObjectProperty:function(){var self=this;function changeObjectProperty(){self.object[self.attribute]=self.selectedValue}if(this.object&&this.attribute&&sap.galilei.core.hasProperty(this.object,this.attribute)){this.resource.applyUndoableAction(changeObjectProperty,"Change Object Property")}},onVerifyValue:function(vValue){if(this.editor&&this.object){var oParam={};oParam[this.attribute]=vValue.value;if(!this.editor.canSetObjectProperties(this.object,oParam)){return false}}return true},dispose:function(){this.defaultDispose();this.object=undefined}}});
"use strict";namespace("sap.galilei.ui.editor.tool");sap.galilei.ui.editor.tool.Tool=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.tool.Tool",parent:sap.galilei.ui.editor.command.Command,initialize:function(options){if(options){this.set(options)}this.onInitialize()},properties:{cursor:undefined,cursorWidth:32,cursorHeight:32,isSelected:false},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}},onSelected:function(){},onUnselected:function(){},dispose:function(){}}});sap.galilei.ui.editor.tool.defineTool=function(oToolDef){var sToolName,sToolType,ToolClass,oProperties;if(oToolDef){if(!oToolDef.parent){oToolDef.parent=sap.galilei.ui.editor.tool.Tool}oProperties=oToolDef.properties||{};sToolName=oToolDef.toolName;if(sToolName){oProperties.name=sToolName;delete oToolDef.toolName}sToolType=oToolDef.toolType;if(sToolType){oProperties.type=sToolType;delete oToolDef.toolType}oToolDef.properties=oProperties;ToolClass=sap.galilei.core.defineClass(oToolDef)}return ToolClass};sap.galilei.ui.editor.tool.Types={tool:"Tool",pointerTool:"PointerTool",lassoTool:"LassoTool",createNodeSymbolTool:"CreateNodeSymbolTool",createLinkSymbolTool:"CreateLinkSymbolTool",compoundCreateNodeSymbolTool:"CompoundCreateNodeSymbolTool"};sap.galilei.ui.editor.tool.getTool=function(sToolName){var oTool;if(sToolName&&sap.galilei.ui.editor.tool.ToolRegistry){oTool=sap.galilei.ui.editor.tool.ToolRegistry.get(sToolName)}return oTool};sap.galilei.ui.editor.tool.addTool=function(sToolName,oTool){if(sToolName&&oTool&&sap.galilei.ui.editor.tool.ToolRegistry){sap.galilei.ui.editor.tool.ToolRegistry.add(sToolName,oTool)}};sap.galilei.ui.editor.tool.removeTool=function(sToolName){if(sToolName&&sap.galilei.ui.editor.tool.ToolRegistry){sap.galilei.ui.editor.tool.ToolRegistry.remove(sToolName)}};(function(){sap.galilei.ui.editor.tool.ToolRegistry=new sap.galilei.core.DefaultLookupClass()})();
"use strict";namespace("sap.galilei.ui.editor.anchor");sap.galilei.ui.editor.anchor.Anchor=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.anchor.Anchor",initialize:function(options){if(options){this.set(options)}this.onInitialize()},properties:{symbol:undefined,boundaryShape:{field:"_boundaryShape",get:function(){if(!this._boundaryShape){if(this.symbol){return this.symbol.isLinkSymbol?this.symbol.getLinkShape():this.symbol.getBoundaryShape()}}return this._boundaryShape},set:function(oShape){this._boundaryShape=oShape}},anchorCenter:{field:"_anchorCenter",get:function(){if(this.symbol&&this.boundaryShape){var oRect,oParentBBox;oRect=this.boundaryShape.getBBox();oParentBBox=this.isRelativeCoordinate?this.symbol.getBBox():undefined;if(oParentBBox){oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}return oRect.getCenter()}return this._anchorCenter},set:function(aCenter){this._anchorCenter=aCenter}},isRelativeCoordinate:true,isAttachToCenter:false,isSupportSource:true,isSupportTarget:true},methods:{onInitialize:function(){if(!this.symbol){throw"The symbol of anchor must be defined."}},isPointInAnchor:function(aPoint){if(this.symbol&&this.boundaryShape&&aPoint){return this.boundaryShape.isPointInShape(aPoint,this.isRelativeCoordinate?this.symbol.getBBox():undefined)}return false},getAnchorPoint:function(aPoint){if(this.symbol&&this.boundaryShape&&aPoint){var aNewPoint,bAttachToCenter=this.isAttachToCenter;if(!bAttachToCenter){if(!this.isPointInAnchor(aPoint)){bAttachToCenter=true}else{aNewPoint=[aPoint[0],aPoint[1]]}}if(bAttachToCenter){aNewPoint=this.anchorCenter}return aNewPoint}return aPoint}},statics:{getDefaultAnchor:function(oAnchorParam){return new sap.galilei.ui.editor.anchor.Anchor(oAnchorParam)}}});
"use strict";namespace("sap.galilei.ui.editor.widget");sap.galilei.ui.editor.widget.Widget=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.editor.widget.Widget",widgetName:"EditorWidget",properties:{editor:undefined,viewer:{field:"_viewer",get:function(){if(this._viewer){return this._viewer}if(this.editor){return this.editor.viewer}return undefined},set:function(oViewer){this._viewer=oViewer}},diagram:{get:function(){if(this.editor){return this.editor.diagram}return undefined}},symbol:{field:"_symbol",get:function(){return this._symbol},set:function(oSymbol){var oBBox;this._symbol=oSymbol;this.updateAttachTo()}},isHideOnUnselect:false},methods:{updateAttachTo:function(){if(this._symbol){if(this._symbol.isLinkSymbol){this.attachTo=this._symbol.getCenter();switch(this.alignPosition){case sap.galilei.ui.common.DockPosition.topLeft:case sap.galilei.ui.common.DockPosition.topRight:this.alignPosition=sap.galilei.ui.common.DockPosition.top;break;case sap.galilei.ui.common.DockPosition.bottomLeft:case sap.galilei.ui.common.DockPosition.bottomRight:this.alignPosition=sap.galilei.ui.common.DockPosition.bottom;break}}else{this.attachTo=this._symbol.getBBox()}}},addEventHandlers:function(){this.addWidgetEventHandlers();if(this.isHideOnUnselect){sap.galilei.core.Event.subscribe("symbol.selected",this.onSelectSymbol,this);sap.galilei.core.Event.subscribe("symbol.unselected",this.onUnselectSymbol,this);sap.galilei.core.Event.subscribe("symbols.selection.changed",this.onSelectionChanged,this)}sap.galilei.core.Event.subscribe("move.symbol.dragstart",this.onHideWidget,this);sap.galilei.core.Event.subscribe("move.symbol.before",this.onHideWidget,this);sap.galilei.core.Event.subscribe("move.symbol.after",this.onShowWidget,this);sap.galilei.core.Event.subscribe("delete.symbol",this.onRemoveWidget,this);sap.galilei.core.Event.subscribe("resize.symbol.handle.dragstart",this.onHideWidget,this);sap.galilei.core.Event.subscribe("resize.symbol.before",this.onHideWidget,this);sap.galilei.core.Event.subscribe("resize.symbol.after",this.onShowWidget,this);sap.galilei.core.Event.subscribe("resize.symbol.pinch",this.onHideWidget,this)},removeEventHandlers:function(){this.removeWidgetEventHandlers();if(this.isHideOnUnselect){sap.galilei.core.Event.unSubscribeScope("symbol.unselected",this);sap.galilei.core.Event.unSubscribeScope("symbols.selection.changed",this)}sap.galilei.core.Event.unSubscribeScope("move.symbol.dragstart",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.after",this);sap.galilei.core.Event.unSubscribeScope("delete.symbol",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.handle.dragstart",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.after",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.pinch",this)},onSelectSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){}},onUnselectSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.removeWidget()}},onSelectionChanged:function(oEvent){if(oEvent&&this.symbol&&oEvent.selectedSymbols&&oEvent.selectedSymbols.length>1){this.removeWidget()}},onShowWidget:function(oEvent){if(oEvent&&(oEvent.source===this.viewer||(oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol))){this.showWidget()}},onHideWidget:function(oEvent){if(oEvent&&(oEvent.source===this.viewer||(oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol))){this.hideWidget()}},onRemoveWidget:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.dispose()}},dispose:function(){this.disposeWidget()}}});
namespace("sap.galilei.ui.editor.util");
"use strict";sap.galilei.ui.editor.util.twinDiagramEditor=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.util.twinDiagramEditor",initialize:function(oEditor1,oEditor2){if(oEditor1&&oEditor2){this.editor1=oEditor1;this.editor2=oEditor2;this.synchronize()}else{if(oEditor1){this.set(oEditor1);this.synchronize()}}},fields:{_isSynchronized:false,_disableZoomPan1:true,_disableZoomPan2:true},properties:{editor1:undefined,editor2:undefined,viewer1:{get:function(){return this.editor1&&this.editor1.viewer}},viewer2:{get:function(){return this.editor2&&this.editor2.viewer}}},methods:{defaultSynchronize:function(){var self=this;function showGlobalViewHelper(){self.showGlobalView()}if(!this._isSynchronized&&this.editor1&&this.editor2){this.viewer1.showGlobalView=showGlobalViewHelper;this.viewer2.showGlobalView=showGlobalViewHelper;sap.galilei.core.Event.subscribe("viewer.zoompan.before",function(oEvent){if(oEvent&&this===self){if(oEvent.source===this.viewer1){if(!self._disableZoomPan1&&(this.viewer2.zoomScale!==oEvent.scale||this.viewer2.zoomTranslate[0]!==oEvent.translate[0]||this.viewer2.zoomTranslate[1]!==oEvent.translate[1])){self.disableZoomPan1=true;this.viewer2.zoomTo(oEvent.scale,oEvent.translate,oEvent.useAnimation);self._disableZoomPan1=false}}else{if(oEvent.source===this.viewer2){if(!self._disableZoomPan2&&(this.viewer1.zoomScale!==oEvent.scale||this.viewer1.zoomTranslate[0]!==oEvent.translate[0]||this.viewer1.zoomTranslate[1]!==oEvent.translate[1])){self.disableZoomPan2=true;this.viewer1.zoomTo(oEvent.scale,oEvent.translate,oEvent.useAnimation);self._disableZoomPan2=false}}}}},this);this._isSynchronized=true;this._disableZoomPan1=false;this._disableZoomPan2=false}},synchronize:function(){this.defaultSynchronize()},showGlobalView:function(){var oRect1,oRect2,oRect;if(this.viewer1&&this.viewer2){oRect1=this.viewer1.getGlobalViewRect();oRect2=this.viewer2.getGlobalViewRect();if(oRect1){oRect=oRect1}if(oRect2){if(oRect){oRect.unionRect(oRect2)}else{oRect=oRect2}}if(oRect){this.viewer1.zoomToRect(oRect.x,oRect.y,oRect.width,oRect.height);if(!this._isSynchronized){this.viewer2.zoomToRect(oRect.x,oRect.y,oRect.width,oRect.height)}}}},bringSymbolsToView:function(oSymbol1,oSymbol2,bPreserveZoomScale,bCenterInView){var bInView1,bInView2,oRect1,oRect2,oRect,aDelta;if(this.viewer1&&this.viewer2){bInView1=(oSymbol1!==undefined)&&this.editor1.isSymbolInView(oSymbol1);bInView2=(oSymbol2!==undefined)&&this.editor2.isSymbolInView(oSymbol2);if((oSymbol1&&!oSymbol2&&bInView1)||(!oSymbol1&&oSymbol2&&bInView2)||(bInView1&&bInView2)){return}if(bPreserveZoomScale===undefined){bPreserveZoomScale=true}if(oSymbol1){oRect1=oSymbol1.getBBox()}if(oSymbol2){oRect2=oSymbol2.getBBox()}if(oRect1){oRect=oRect1}if(oRect2){if(oRect){oRect.unionRect(oRect2)}else{oRect=oRect2}}if(oRect1&&oRect2){aDelta=this.viewer1.pageDeltaToViewDelta([40,40]);oRect.inflate(aDelta[0],aDelta[1])}if(oRect){this.viewer1.zoomToRect(oRect.x,oRect.y,oRect.width,oRect.height,bPreserveZoomScale,bCenterInView);if(!this._isSynchronized){this.viewer2.zoomToRect(oRect.x,oRect.y,oRect.width,oRect.height,bPreserveZoomScale,bCenterInView)}}}}}});
"use strict";sap.galilei.ui.editor.tracker.SymbolHighlighter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.tracker.SymbolHighlighter",initialize:function(oParam){if(oParam.editor){this._editor=oParam.editor;delete oParam.editor}if(!this._editor){throw"Diagram editor must be specified."}this.set(oParam);if(!this.transitionDefinition){this.transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:200})}},fields:{_highlightShape:undefined},properties:{editor:{get:function(){return this._editor}},viewer:{get:function(){if(this._editor){return this._editor.viewer}return undefined}},highlighted:{get:function(){return this._highlighted}},strokeWidth:5,highlightColor:sap.galilei.ui.common.style.Color.orange,highlightDiagram:true,radius:1,transitionDefinition:undefined},methods:{highlight:function(x,y,skipPickingByPoint,canHighlight){var oSymbol,aSymbols;aSymbols=this.editor.getSymbolsByPoint(x,y,undefined,true,+this.radius,skipPickingByPoint);if(aSymbols&&aSymbols.length>0){if(!canHighlight||canHighlight.call(this.editor,aSymbols[aSymbols.length-1])){oSymbol=aSymbols[aSymbols.length-1]}}if(this.highlightDiagram&&(!aSymbols||aSymbols.length===0)){if(!canHighlight||canHighlight.call(this.editor,this.editor.diagram)){this._highlighted=this.editor.diagram;this.hideSymbolHighlight();return true}}else{if(oSymbol){this.onSymbolHighlight(x,y,oSymbol);this.showSymbolHighlight(oSymbol);this._highlighted=oSymbol;return true}}this.dispose();return false},onSymbolHighlight:function(x,y,oSymbol){},showSymbolHighlight:function(oSymbol,oOptions){var oShape,oParam={};if(oSymbol&&this._highlighted!==oSymbol){this.hideSymbolHighlight();if(!oSymbol.isLinkSymbol){oShape=oSymbol.getBoundaryShape()}else{oShape=oSymbol.getLinkShape()}if(oShape){oParam={fill:"none",stroke:this.highlightColor,strokeWidth:this.strokeWidth,isVisible:true,opacity:0.8,strokeDashArray:"",domClass:undefined};if(!oSymbol.isLinkSymbol){oParam.x=oSymbol.x;oParam.y=oSymbol.y}else{oParam.points=oShape.points.clone()}this._highlightShape=sap.galilei.ui.common.shape.ShapeRegistry.cloneShape(oShape);this._highlightShape.set(oParam);this._highlightShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition)}}},hideSymbolHighlight:function(bUseTransition){var self=this;if(this._highlightShape&&this._highlightShape.isDrawn){if(bUseTransition===true&&this.transitionDefinition){this._highlightShape.hide(this.viewer,this.transitionDefinition);setTimeout(function(){self._highlightShape.dispose()},this.transitionDefinition.duration)}else{this._highlightShape.dispose();this._highlightShape=undefined}}},dispose:function(){this._highlighted=undefined;this.hideSymbolHighlight()}}});
"use strict";sap.galilei.ui.editor.tracker.SwimlaneSymbolHighlighter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.tracker.SwimlaneSymbolHighlighter",parent:sap.galilei.ui.editor.tracker.SymbolHighlighter,fields:{_index:undefined},properties:{swimlaneIndex:{get:function(){return this._index}}},methods:{showSymbolHighlight:function(oSymbol,oOptions){var x,y,width,height,oRect=oOptions.rect,nIndex=oOptions.index;if(this._highlighted!==oSymbol||this._index!==nIndex){if(oOptions.isVertical){if(oOptions.minorSide){x=oOptions.insertAsChild?oRect.left:oRect.left-3;y=oRect.top}else{x=oOptions.insertAsChild?oRect.left:oRect.right-3;y=oRect.top}width=oOptions.insertAsChild?oRect.width:6;height=oRect.height}else{if(oOptions.minorSide){x=oRect.left;y=oOptions.insertAsChild?oRect.top:oRect.top-3}else{x=oRect.left;y=oOptions.insertAsChild?oRect.top:oRect.bottom-3}width=oRect.width;height=oOptions.insertAsChild?oRect.height:6}if(x!==undefined&&y!==undefined&&width!==undefined&&height!==undefined){this.hideSymbolHighlight();this._highlightShape=new sap.galilei.ui.common.shape.Rectangle();this._highlightShape.set({x:x,y:y,width:width,height:height,isVisible:true,stroke:oOptions.insertAsChild?this.highlightColor:"none",strokeWidth:oOptions.insertAsChild?6:0,fill:oOptions.insertAsChild?"none":this.highlightColor,opacity:0.8});this._highlightShape.draw(this._editor.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition)}}},highlight:function(x,y,skipPickingByPoint,canHighlight){var aSymbols,oSymbol,oHighlightedSymbol,oHeaderBBox,i,oBBox,oSubSymbol,aViewPoint,bInsertAsChild=false;aSymbols=this.editor.getSymbolsByPoint(x,y,this._editor.viewer.mainShapeLayer.d3Layer,true,1,skipPickingByPoint);aViewPoint=this.editor.viewer.clientPointToViewPoint([x,y]);x=aViewPoint[0];y=aViewPoint[1];if(aSymbols&&aSymbols.length>0){oSymbol=aSymbols[aSymbols.length-1]}if(!aSymbols||aSymbols.length===0){if(!canHighlight||canHighlight.call(this._editor,this._editor.diagram)){this._highlighted=this._editor.diagram;this.hideSymbolHighlight();return true}}else{if(oSymbol&&oSymbol.isSwimlaneSymbol){oHeaderBBox=oSymbol.getHeaderAreaBBox();if(oSymbol.symbols.length===0&&!oHeaderBBox.isPointInRect([x,y])&&(!canHighlight||canHighlight.call(this._editor,oSymbol))){bInsertAsChild=true;oHighlightedSymbol=oSymbol}else{if(oSymbol.parentSymbol&&oSymbol.parentSymbol.isSwimlaneSymbol&&(!canHighlight||canHighlight.call(this._editor,oSymbol.parentSymbol))){oHighlightedSymbol=oSymbol.parentSymbol}}if(oHighlightedSymbol&&oHighlightedSymbol.isSwimlaneSymbol){if(oHighlightedSymbol.symbols.length>0){for(i=0;i<oHighlightedSymbol.symbols.length;i++){oSubSymbol=oHighlightedSymbol.symbols.get(i);oBBox=oSubSymbol.getBBox();if(oSubSymbol.isVertical){if(x>oBBox.left&&x<=oBBox.right){if(x>(oBBox.left+oBBox.width/2)){this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:true,minorSide:false,index:i+1});this._index=i+1}else{this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:true,minorSide:true,index:i});this._index=i}}}else{if(y>oBBox.top&&y<=oBBox.bottom){if(y>(oBBox.top+oBBox.height/2)){this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:false,minorSide:false,index:i+1});this._index=i+1}else{this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:false,minorSide:true,index:i});this._index=i}}}}}else{oBBox=oHighlightedSymbol.getBBox();if(oHighlightedSymbol.isVertical){if(bInsertAsChild){oHeaderBBox=oHighlightedSymbol.getHeaderAreaBBox();oBBox.top+=oHeaderBBox.height;oBBox.height-=oHeaderBBox.height}if(x>(oBBox.left+oBBox.right/2)){this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:true,minorSide:false,insertAsChild:bInsertAsChild,index:1});this._index=1}else{this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:true,minorSide:true,insertAsChild:bInsertAsChild,index:0});this._index=0}}else{if(bInsertAsChild){oHeaderBBox=oHighlightedSymbol.getHeaderAreaBBox();oBBox.left+=oHeaderBBox.width;oBBox.width-=oHeaderBBox.width}if(y>(oBBox.top+oBBox.height/2)){this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:false,minorSide:false,insertAsChild:bInsertAsChild,index:1});this._index=1}else{this.showSymbolHighlight(oHighlightedSymbol,{rect:oBBox,isVertical:false,minorSide:true,insertAsChild:bInsertAsChild,index:0});this._index=0}}}this._highlighted=oHighlightedSymbol;return true}}}this.dispose();return false},dispose:function(){this._highlighted=undefined;this._index=undefined;this.hideSymbolHighlight()}}});
"use strict";sap.galilei.ui.editor.tracker.ExtremitySymbolHighlighter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.tracker.ExtremitySymbolHighlighter",parent:sap.galilei.ui.editor.tracker.SymbolHighlighter,fields:{_attachPoints:undefined,_highlightedAttachPoint:undefined,_attachPointShapes:undefined,_highlightedAttachPointShape:undefined},properties:{highlightedAttachPoint:{get:function(){return this._highlightedAttachPoint}},snapDistance:5,forceHighlightAttachPoints:false},methods:{onSymbolHighlight:function(x,y,oSymbol){var aViewPoint,i,aPoint,aOldPoint;if(oSymbol){aOldPoint=this._highlightedAttachPoint;this._highlightedAttachPoint=undefined;if(this.forceHighlightAttachPoints||oSymbol.hasLinkSymbol()){this._attachPoints=(this._highlighted!==oSymbol)?oSymbol.getAttachPoints():this._attachPoints;if(this._attachPoints){aViewPoint=this.viewer.clientPointToViewPoint([x,y]);for(i=0;i<this._attachPoints.length;i++){aPoint=this._attachPoints[i];if(Math.abs(aPoint[0]-aViewPoint[0])<=+this.snapDistance&&Math.abs(aPoint[1]-aViewPoint[1])<=+this.snapDistance){this._highlightedAttachPoint=aPoint;break}}}}else{this._highlightedAttachPoint=oSymbol.getCenter()}if(!this._highlightedAttachPoint||(aOldPoint&&this._highlightedAttachPoint&&(aOldPoint[0]!==this._highlightedAttachPoint[0]||(aOldPoint[1]!==this._highlightedAttachPoint[1])))){this.hideHighlightedAttachPoint()}}},showSymbolHighlight:function(oSymbol,oOptions){var oShape,i,aAttachPoint,oAttachShape;if(oSymbol){if(this._highlighted!==oSymbol){this.hideSymbolHighlight();oShape=oSymbol.getBoundaryShape();if(oShape){this._highlightShape=sap.galilei.ui.common.shape.ShapeRegistry.cloneShape(oShape);this._highlightShape.set({x:oSymbol.x,y:oSymbol.y,stroke:this.highlightColor,strokeWidth:this.strokeWidth,isVisible:true,opacity:0.7,domClass:undefined});this._highlightShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition);if(this._attachPoints){this._attachPointShapes=[];for(i=0;i<this._attachPoints.length;i++){aAttachPoint=this._attachPoints[i];oAttachShape=new sap.galilei.ui.common.shape.Circle({cx:aAttachPoint[0],cy:aAttachPoint[1],r:3,stroke:"none",fill:"grey"});oAttachShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition);this._attachPointShapes.push(oAttachShape)}}}}if(this._highlightedAttachPoint&&this._attachPointShapes&&this._attachPointShapes.length>0){if(!this._highlightedAttachPointShape){this._highlightedAttachPointShape=new sap.galilei.ui.common.shape.Circle({cx:this._highlightedAttachPoint[0],cy:this._highlightedAttachPoint[1],r:5+this.strokeWidth/2,stroke:this.highlightColor,strokeWidth:this.strokeWidth,fill:"none"});this._highlightedAttachPointShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition)}else{this._highlightedAttachPointShape.cx=this._highlightedAttachPoint[0];this._highlightedAttachPointShape.cy=this._highlightedAttachPoint[1];this._highlightedAttachPointShape.updateDrawing(this.viewer,this.transitionDefinition)}}}},hideSymbolHighlight:function(bUseTransition){var i,oAttachShape,self=this;function delayedDispose(oShape,duration){setTimeout(function(){oShape.dispose()},duration)}if(this._highlightShape&&this._highlightShape.isDrawn){if(bUseTransition===true&&this.transitionDefinition){this._highlightShape.hide(this.viewer,this.transitionDefinition);setTimeout(function(){self._highlightShape.dispose()},this.transitionDefinition.duration)}else{this._highlightShape.dispose();this._highlightShape=undefined}}if(this._attachPointShapes){for(i=0;i<this._attachPointShapes.length;i++){oAttachShape=this._attachPointShapes[i];if(oAttachShape&&oAttachShape.isDrawn){if(bUseTransition===true&&this.transitionDefinition){oAttachShape.hide(this.viewer,this.transitionDefinition);delayedDispose(oAttachShape,this.transitionDefinition.duration)}else{oAttachShape.dispose()}}}if(bUseTransition!==true){this._attachPointShapes=undefined}}this.hideHighlightedAttachPoint(bUseTransition)},hideHighlightedAttachPoint:function(bUseTransition){if(this._highlightedAttachPointShape&&this._highlightedAttachPointShape.isDrawn){if(bUseTransition===true&&this.transitionDefinition){this._highlightedAttachPointShape.hide(this.viewer,this.transitionDefinition);setTimeout(function(){self._highlightedAttachPointShape.dispose()},this.transitionDefinition.duration)}else{this._highlightedAttachPointShape.dispose();this._highlightedAttachPointShape=undefined}}},dispose:function(){this._highlighted=undefined;this._attachPoints=undefined;this._highlightedAttachPoint=undefined;this.hideSymbolHighlight()}}});
"use strict";sap.galilei.ui.editor.tracker.RectangularSymbolTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.RectangularSymbolTracker",trackerName:"RectangularSymbolTracker",parent:sap.galilei.ui.common.tracker.ResizeTracker,fields:{_parentHighlighter:undefined},properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},diagram:{get:function(){return this.editor.diagram}},resource:{get:function(){return this.diagram.resource}},symbol:undefined,parentHighlighter:{field:"_parentHighlighter",get:function(){return this._parentHighlighter}}},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}this.isReadOnly=this.editor.isReadOnly;this.snapToGrid=this.editor.snapToGrid;this.gridSize=this.editor.gridSize;this.snapToShapes=this.editor.snapToShapes;this.snapToShapesCenter=this.editor.snapToShapesCenter;this.snapToShapesBorder=this.editor.snapToShapesBorder;if(this.symbol){this.initialBBox=this.symbol.getBBox();this.mainShape=this.symbol.getOrCreateShape();if(this.snapToShapes){this.snapToShapesHandler=new sap.galilei.ui.editor.tracker.SnapToSymbols({editor:this.editor,transitionDefinition:new sap.galilei.ui.common.TransitionDefinition({duration:200}),snapToShapesCenter:this.snapToShapesCenter,snapToShapesBorder:this.snapToShapesBorder})}}else{throw"The symbol must be defined."}},addEventHandlers:function(){this.defaultAddEventHandlers();sap.galilei.core.Event.subscribe("move.symbol.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("move.symbol.after",this.onAfterMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("delete.symbol",this.onDeleteSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.after",this.onAfterMoveResizeSymbol,this)},removeEventHandlers:function(){this.defaultRemoveEventHandlers();sap.galilei.core.Event.unSubscribeScope("move.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.after",this);sap.galilei.core.Event.unSubscribeScope("delete.symbol",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.after",this)},onBeforeMoveResizeSymbol:function(oEvent){if(oEvent&&oEvent.source!==this&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){var oldTransition;this.resizedBBox=this.symbol.getBBox();this.movedBBox=this.resizedBBox.clone();this.initialBBox=this.resizedBBox.clone();this.movedBBox=this.resizedBBox.clone();if(oEvent.transitionDefinition){oldTransition=this.endTransitionDefinition;this.endTransitionDefinition=oEvent.transitionDefinition;this.updateHandles(true);this.endTransitionDefinition=oldTransition}else{this.updateHandles(true)}}},onAfterMoveResizeSymbol:function(oEvent){if(oEvent&&oEvent.source!==this&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){}},onDeleteSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.onBeforeMoveResizeSymbol(oEvent);this.dispose()}},getOrCreateParentHighlighter:function(){if(!this._parentHighlighter){this._parentHighlighter=new sap.galilei.ui.editor.tracker.SymbolHighlighter({editor:this.editor,radius:5,strokeWidth:5})}return this._parentHighlighter},onDragStartHandle:function(oEvent,oHandle){if(this.snapToShapesHandler){this.snapToShapesHandler.initializeSymbolSnapLines()}this.defaultOnDragStartHandle(oEvent,oHandle)},canDragStartHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&!this.isKeepSize){var oResizedRect=this.resizedBBox.normalize(true);oEvent.cancel=false;oEvent.handle=oHandle;oEvent.handlePosition=oHandle._position;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentBBox=oResizedRect;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("resize.symbol.handle.dragstart",this.editor,this.editor,oEvent);return !oEvent.cancel}return false},canDragHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this.isDraggingHandle){var oResizedRect=this.resizedBBox.normalize(true);oEvent.cancel=false;oEvent.handle=oHandle;oEvent.handlePosition=oHandle._position;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentPoint=[oHandle.cx,oHandle.cy];oEvent.currentBBox=oResizedRect;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("resize.symbol.handle.drag",this.editor,this.editor,oEvent);return !oEvent.cancel}return false},onPinchStartShape:function(oEvent){if(this.snapToShapesHandler){this.snapToShapesHandler.initializeSymbolSnapLines()}},defaultCanResizeShape:function(oEvent,oHandle){if(oEvent){var oResizedRect=this.resizedBBox.normalize(true);oEvent.cancel=false;this.editor.addEventProperties(oEvent,this.symbol);if(oHandle){oEvent.handle=oHandle;oEvent.handlePosition=oHandle._position;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentPoint=[oHandle.cx,oHandle.cy];oEvent.currentBBox=oResizedRect;sap.galilei.core.Event.publish("resize.symbol.handle.dragend",this.editor,this.editor,oEvent)}else{oEvent.currentBBox=oResizedRect;sap.galilei.core.Event.publish("resize.symbol.pinchend",this.editor,this.editor,oEvent)}return !oEvent.cancel}return false},canPinchShape:function(oEvent){if(oEvent){oEvent.cancel=false;oEvent.currentBBox=this.resizedBBox;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("resize.symbol.pinch",this,undefined,oEvent);return !oEvent.cancel}return false},canDragStartShape:function(oEvent){if(oEvent&&!this.isKeepPosition){this.viewer.normalizePointerEvent(oEvent);var aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentBBox=this.movedBBox;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("move.symbol.dragstart",this,undefined,oEvent);return !oEvent.cancel}return false},onDragStartShape:function(oEvent){if(this.snapToShapesHandler){this.snapToShapesHandler.initializeSymbolSnapLines()}this.defaultOnDragStartShape(oEvent)},canDragShape:function(oEvent){if(oEvent&&this.isDraggingShape){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY],oBoundaryBBox;oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("move.symbol.drag",this,undefined,oEvent);if(!oEvent.cancel){if(this.symbol.isBoundarySymbol&&this.symbol.parentSymbol){oBoundaryBBox=this.symbol.parentSymbol.computeBoundarySymbolBBox(this.symbol,this.movedBBox);this.movedBBox.set(oBoundaryBBox)}}return !oEvent.cancel}return false},onDragShape:function(oEvent){var aClientPoint,aViewPoint,self=this,highlighter;this.defaultOnDragShape(oEvent);if(this.isDraggingShape&&!this.symbol.isBoundarySymbol){aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);highlighter=this.getOrCreateParentHighlighter();highlighter.highlight(aClientPoint[0],aClientPoint[1],function(oSymbol){var oParentSymbol=oSymbol;if(oSymbol.isLinkSymbol){return true}while(oParentSymbol){if(oParentSymbol===self.symbol){return true}oParentSymbol=oParentSymbol.parentSymbol}return false},function(oSymbol){return self.editor.canAttachSymbol(oSymbol,self.symbol,{point:aViewPoint})})}},canResizeShape:function(oEvent,oHandle){return this.defaultCanResizeShape(oEvent,oHandle)},resizeShape:function(){var self=this,resizeEdgeType=sap.galilei.ui.symbol.EdgeType.NONE,oBBox=this.symbol.getBBox(),oEvent={};if(oBBox.left!==this.resizedBBox.left){resizeEdgeType|=sap.galilei.ui.symbol.EdgeType.LEFT}if(oBBox.right!==this.resizedBBox.right){resizeEdgeType|=sap.galilei.ui.symbol.EdgeType.RIGHT}if(oBBox.top!==this.resizedBBox.top){resizeEdgeType|=sap.galilei.ui.symbol.EdgeType.TOP}if(oBBox.bottom!==this.resizedBBox.bottom){resizeEdgeType|=sap.galilei.ui.symbol.EdgeType.BOTTOM}this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("resize.symbol.before",this,undefined,oEvent);function resizeSymbolAction(){var oOldBBox=self.symbol.getBBox();self.symbol.setBBox(self.resizedBBox,{moveSubSymbols:false,moveLinkSymbols:false},self.viewer,self.endTransitionDefinition);self.symbol.extendToContent({extendParent:true,updateBoundarySymbols:false},resizeEdgeType,self.viewer,self.endTransitionDefinition);if(self.symbol.parentSymbol&&self.symbol.parentSymbol.extendToContent){self.symbol.parentSymbol.extendToContent({extendParent:true},resizeEdgeType,self.viewer,self.endTransitionDefinition)}self.symbol.updateBoundarySymbols(oOldBBox,self.symbol.getBBox(),true,self.viewer,self.endTransitionDefinition);self.symbol.updateLinkSymbolRoutings(oOldBBox,self.symbol.getBBox(),true,false,self.viewer,self.endTransitionDefinition)}this.resource.applyUndoableAction(resizeSymbolAction,"Resize Symbol");setTimeout(function(){sap.galilei.core.Event.publish("resize.symbol.after",self,undefined,oEvent);self.resizedBBox=self.symbol.getBBox();self.initialBBox=self.resizedBBox.clone();self.movedBBox=self.resizedBBox.clone();self.updateHandles()},this.endTransitionDefinition?this.endTransitionDefinition.duration:0)},defaultCanMoveShape:function(oEvent){if(oEvent){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY],oBoundaryBBox;oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("move.symbol.dragend",this,undefined,oEvent);if(!oEvent.cancel){if(this.symbol.isBoundarySymbol&&this.symbol.parentSymbol){oBoundaryBBox=this.symbol.parentSymbol.computeBoundarySymbolBBox(this.symbol,this.movedBBox);this.movedBBox.set(oBoundaryBBox)}}return !oEvent.cancel}return true},moveShape:function(){var self=this,oEvent={},bUpdateOrder;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("move.symbol.before",this,undefined,oEvent);function moveSymbolAction(){var oOldOwner=self.symbol.container,oOldOwners={},oObjectOwner;oOldOwners[self.symbol.objectId]=oOldOwner;function changeOwner(oOwner){if(oOwner&&this.container!==oOwner){var sClass=this.classDefinition.qualifiedName,sOldReference,oOldReference,sReference,oReference;sReference=oOwner.classDefinition.getContainingReference(sClass);oReference=oOwner[sReference];if(oReference&&oReference.indexOf(this)<0){if(this.container){sOldReference=this.container.classDefinition.getContainingReference(sClass);oOldReference=this.container[sOldReference];if(oOldReference){oOldReference.removeAt(oOldReference.indexOf(this))}}oReference.push(this)}}}if(self._parentHighlighter){if(self._parentHighlighter.highlighted){self.symbol.owner=self._parentHighlighter.highlighted;if(oOldOwner!==self._parentHighlighter.highlighted){bUpdateOrder=true}if(self.symbol.object){oObjectOwner=self.editor.getParentObjectByParentSymbol(self._parentHighlighter._highlighted,self.symbol.object.classDefinition.qualifiedName)||self.editor.model;if(oObjectOwner&&oObjectOwner!==self.symbol.object.container){if(self.symbol.object.container!==undefined){changeOwner.call(self.symbol.object,oObjectOwner)}}}}self._parentHighlighter.dispose();self._parentHighlighter=undefined}self.editor.moveSymbolsBy(self.symbol,self.movedBBox.x-self.symbol.x,self.movedBBox.y-self.symbol.y,self.viewer,self.endTransitionDefinition);if(self.symbol.parentSymbol&&self.symbol.parentSymbol.extendToContent){self.symbol.parentSymbol.extendToContent({extendParent:true},sap.galilei.ui.symbol.EdgeType.ALL,self.viewer,self.endTransitionDefinition)}self.editor.postMoveSymbols([self.symbol],oOldOwners)}this.resource.applyUndoableAction(moveSymbolAction,"Move Symbol");self.movedBBox=self.symbol.getBBox();self.resizedBBox=self.movedBBox.clone();self.initialBBox=self.movedBBox.clone();self.updateHandles(true);if(bUpdateOrder){this.editor.updateSymbolDrawingOrder(this.endTransitionDefinition)}setTimeout(function(){sap.galilei.core.Event.publish("move.symbol.after",self,undefined,oEvent)},this.endTransitionDefinition?this.endTransitionDefinition.duration:0)},onShapeTap:function(oEvent){if(oEvent){sap.galilei.core.Event.publish("symbol.tap",this,undefined,this.editor.addEventProperties(oEvent,this.symbol))}},onShapeDoubleTap:function(oEvent){if(oEvent){sap.galilei.core.Event.publish("symbol.doubletap",this,undefined,this.editor.addEventProperties(oEvent,this.symbol))}},onShapeHold:function(oEvent){if(oEvent){sap.galilei.core.Event.publish("symbol.hold",this,undefined,this.editor.addEventProperties(oEvent,this.symbol))}},cancel:function(){this.defaultCancel();if(this._parentHighlighter){this._parentHighlighter.dispose();this._parentHighlighter=undefined}},dispose:function(){this.defaultDispose();if(this._parentHighlighter){this._parentHighlighter.dispose();this._parentHighlighter=undefined}if(this.symbol){delete this.symbol._tracker}}}});
"use strict";sap.galilei.ui.editor.tracker.SwimlaneSymbolTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.SwimlaneSymbolTracker",trackerName:"SwimlaneSymbolTracker",parent:sap.galilei.ui.editor.tracker.RectangularSymbolTracker,methods:{onDragEndHandle:function(oEvent,oHandle){var self=this,nHandleEdgeType=sap.galilei.ui.symbol.EdgeType.NONE,sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT,oRootSymbol,nOffset,aSwimlanes,oSymbol,oSubBBox,oContentBBox,nAvailable,j;function resizeSwimlaneAction(){var oResizedBBox=self.resizedBBox.clone();if(self.symbol.isVertical){if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.LEFT)!==0){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis;self.setSwimlaneSize(self.symbol,sLayoutDirection,oResizedBBox.left-self.symbol.x,oResizedBBox.width-self.symbol.width,self.viewer,self.endTransitionDefinition)}else{if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.RIGHT)!==0){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.axis;self.setSwimlaneSize(self.symbol,sLayoutDirection,0,oResizedBBox.width-self.symbol.width,self.viewer,self.endTransitionDefinition)}}oRootSymbol=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(self.symbol);if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.TOP)!==0){nOffset=oResizedBBox.top-self.symbol.y;if(nOffset>0){aSwimlanes=[];oRootSymbol.getLeafSwimlanes(aSwimlanes);for(j=0;j<aSwimlanes.length;j++){oSymbol=aSwimlanes[j];oSubBBox=oSymbol.getSubSymbolsBBox();if(oSubBBox){oContentBBox=oSymbol.getContentAreaBBox();nAvailable=oSubBBox.top-oContentBBox.top;if(nAvailable<nOffset){nOffset=nAvailable}}}}self.setSwimlaneLength(oRootSymbol,nOffset,-nOffset,self.viewer,self.endTransitionDefinition)}else{if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.BOTTOM)!==0){nOffset=oResizedBBox.bottom-(self.symbol.y+self.symbol.height);if(nOffset<0){aSwimlanes=[];oRootSymbol.getLeafSwimlanes(aSwimlanes);for(j=0;j<aSwimlanes.length;j++){oSymbol=aSwimlanes[j];oSubBBox=oSymbol.getSubSymbolsBBox();if(oSubBBox){oContentBBox=oSymbol.getContentAreaBBox();nAvailable=oSubBBox.bottom-oContentBBox.bottom;if(nAvailable>nOffset){nOffset=nAvailable}}}}self.setSwimlaneLength(oRootSymbol,0,nOffset,self.viewer,self.endTransitionDefinition)}}oRootSymbol.layoutSwimlanes(sLayoutDirection,self.viewer,self.endTransitionDefinition)}else{if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.TOP)!==0){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis;self.setSwimlaneSize(self.symbol,sLayoutDirection,oResizedBBox.top-self.symbol.y,oResizedBBox.height-self.symbol.height,self.viewer,self.endTransitionDefinition)}else{if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.BOTTOM)!==0){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.axis;self.setSwimlaneSize(self.symbol,sLayoutDirection,0,oResizedBBox.height-self.symbol.height,self.viewer,self.endTransitionDefinition)}}oRootSymbol=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(self.symbol);if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.LEFT)!==0){nOffset=oResizedBBox.left-self.symbol.x;if(nOffset>0){aSwimlanes=[];oRootSymbol.getLeafSwimlanes(aSwimlanes);for(j=0;j<aSwimlanes.length;j++){oSymbol=aSwimlanes[j];oSubBBox=oSymbol.getSubSymbolsBBox();if(oSubBBox){oContentBBox=oSymbol.getContentAreaBBox();nAvailable=oSubBBox.left-oContentBBox.left;if(nAvailable<nOffset){nOffset=nAvailable}}}}self.setSwimlaneLength(oRootSymbol,nOffset,-nOffset,self.viewer,self.endTransitionDefinition)}else{if((nHandleEdgeType&sap.galilei.ui.symbol.EdgeType.RIGHT)!==0){nOffset=oResizedBBox.right-(self.symbol.x+self.symbol.width);if(nOffset<0){aSwimlanes=[];oRootSymbol.getLeafSwimlanes(aSwimlanes);for(j=0;j<aSwimlanes.length;j++){oSymbol=aSwimlanes[j];oSubBBox=oSymbol.getSubSymbolsBBox();if(oSubBBox){oContentBBox=oSymbol.getContentAreaBBox();nAvailable=oSubBBox.right-oContentBBox.right;if(nAvailable>nOffset){nOffset=nAvailable}}}}self.setSwimlaneLength(oRootSymbol,0,nOffset,self.viewer,self.endTransitionDefinition)}}oRootSymbol.layoutSwimlanes(sLayoutDirection,self.viewer,self.endTransitionDefinition)}}if(oEvent&&oHandle&&self.isDraggingHandle){this.isDraggingHandle=false;this.resizedBBox.normalize();if(this.snapToShapesHandler){this.snapToShapesHandler.highlightAndHideSnapLines(this.endTransitionDefinition)}if(this.canResizeShape(oEvent,oHandle)){if(this.symbol.isSwimlaneSymbol){switch(oEvent.handlePosition){case sap.galilei.ui.common.DockPosition.top:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.TOP;break;case sap.galilei.ui.common.DockPosition.topLeft:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.TOP;nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.LEFT;break;case sap.galilei.ui.common.DockPosition.topRight:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.TOP;nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.RIGHT;break;case sap.galilei.ui.common.DockPosition.left:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.LEFT;break;case sap.galilei.ui.common.DockPosition.right:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.RIGHT;break;case sap.galilei.ui.common.DockPosition.bottom:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.BOTTOM;break;case sap.galilei.ui.common.DockPosition.bottomLeft:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.LEFT;nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.BOTTOM;break;case sap.galilei.ui.common.DockPosition.bottomRight:nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.BOTTOM;nHandleEdgeType|=sap.galilei.ui.symbol.EdgeType.RIGHT;break}this.resource.applyUndoableAction(resizeSwimlaneAction,"Resize Swimlane");this.resizedBBox=this.symbol.getBBox();this.initialBBox=this.resizedBBox.clone();this.movedBBox=this.resizedBBox.clone();this.updateHandles(true)}else{this.resizeShape()}}else{this.resizedBBox=this.initialBBox.clone();this.movedBBox=this.initialBBox.clone();this.updateHandles()}}},setSwimlaneSize:function(oSymbol,sLayoutDirection,nOffset,nDeltaSize,oViewer,oTransitionDef){var oSubSymbol;if(!sLayoutDirection){sLayoutDirection=sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT}if(oSymbol&&oSymbol.isSwimlaneSymbol){if(oSymbol.isVertical){oSymbol.moveBy(nOffset,0,{moveSubSymbols:false},oViewer,oTransitionDef);oSymbol.resize(oSymbol.width+nDeltaSize,oSymbol.height,{},oViewer,oTransitionDef);if(oSymbol.symbols.length>0&&!oSymbol.isLeafSwimlaneSymbol){oSubSymbol=oSymbol.symbols.get((sLayoutDirection===sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis)?0:oSymbol.symbols.length-1);this.setSwimlaneSize(oSubSymbol,sLayoutDirection,nOffset,nDeltaSize,oViewer,oTransitionDef)}oSymbol.extendToContent({extendParent:false},sap.galilei.ui.symbol.EdgeType.LEFT|sap.galilei.ui.symbol.EdgeType.RIGHT,oViewer,oTransitionDef)}else{oSymbol.moveBy(0,nOffset,{moveSubSymbols:false},oViewer,oTransitionDef);oSymbol.resize(oSymbol.width,oSymbol.height+nDeltaSize,{},oViewer,oTransitionDef);if(oSymbol.symbols.length>0&&!oSymbol.isLeafSwimlaneSymbol){oSubSymbol=oSymbol.symbols.get((sLayoutDirection===sap.galilei.ui.symbol.LayoutSwimlaneDirection.antiAxis)?0:oSymbol.symbols.length-1);this.setSwimlaneSize(oSubSymbol,sLayoutDirection,nOffset,nDeltaSize,oViewer,oTransitionDef)}oSymbol.extendToContent({extendParent:false},sap.galilei.ui.symbol.EdgeType.TOP|sap.galilei.ui.symbol.EdgeType.BOTTOM,oViewer,oTransitionDef)}}},setSwimlaneLength:function(oSymbol,nOffset,nDeltaLength,oViewer,oTransitionDef){var oSubSymbol,i;if(oSymbol&&oSymbol.isSwimlaneSymbol){if(oSymbol.isVertical){oSymbol.moveBy(0,nOffset,{moveSubSymbols:false},oViewer,oTransitionDef);oSymbol.resize(oSymbol.width,oSymbol.height+nDeltaLength,{},oViewer,oTransitionDef);if(oSymbol.symbols.length>0&&!oSymbol.isLeafSwimlaneSymbol){for(i=0;i<oSymbol.symbols.length;i++){oSubSymbol=oSymbol.symbols.get(i);this.setSwimlaneLength(oSubSymbol,nOffset,nDeltaLength,oViewer,oTransitionDef)}}}else{oSymbol.moveBy(nOffset,0,{moveSubSymbols:false},oViewer,oTransitionDef);oSymbol.resize(oSymbol.width+nDeltaLength,oSymbol.height,{},oViewer,oTransitionDef);if(oSymbol.symbols.length>0&&!oSymbol.isLeafSwimlaneSymbol){for(i=0;i<oSymbol.symbols.length;i++){oSubSymbol=oSymbol.symbols.get(i);this.setSwimlaneLength(oSubSymbol,nOffset,nDeltaLength,oViewer,oTransitionDef)}}}}},getOrCreateParentHighlighter:function(){if(!this._parentHighlighter){this._parentHighlighter=new sap.galilei.ui.editor.tracker.SwimlaneSymbolHighlighter({editor:this.editor})}return this._parentHighlighter},onDragShape:function(oEvent){var aClientPoint,aViewPoint,oThis=this,highlighter;this.defaultOnDragShape(oEvent);if(this.isDraggingShape){aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);highlighter=this.getOrCreateParentHighlighter();highlighter.highlight(aClientPoint[0],aClientPoint[1],function(oSymbol){var oParentSymbol=oSymbol;if(oSymbol.isLinkSymbol){return true}while(oParentSymbol){if(oParentSymbol===oThis.symbol){return true}oParentSymbol=oParentSymbol.parentSymbol}return false},function(oSymbol){return oThis.editor.canAttachSymbol(oSymbol,oThis.symbol,{point:aViewPoint})})}},canMoveShape:function(oEvent){if(!this.defaultCanMoveShape(oEvent)){return false}if(this._parentHighlighter&&!this._parentHighlighter.highlighted){if(this.symbol.isSwimlaneSymbol&&!this.symbol.isRootSwimlaneSymbol){return true}oEvent.cancel=true;return false}return true},moveShape:function(){var self=this,oNewParent,oOldParent,nNewIndex,nOldIndex,oRootSwimlane,oOldRootSwimlane,oEvent={},oHighlighted,bUpdateOrder;this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("move.symbol.before",this.editor,this.editor,oEvent);function moveSymbolAction(){var oBBox,oOldOwner=self.symbol.getOwner(),oOldOwners={};oOldOwners[self.symbol.objectId]=oOldOwner;if(self._parentHighlighter){oHighlighted=self._parentHighlighter.highlighted;if(oHighlighted&&oHighlighted.isSwimlaneSymbol){oNewParent=oHighlighted;nNewIndex=self._parentHighlighter.swimlaneIndex;oOldParent=self.symbol.parentSymbol;if(oOldParent){oOldRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(self.symbol);nOldIndex=oOldParent.symbols.indexOf(self.symbol);if(oOldParent&&oNewParent===oOldParent&&nNewIndex>nOldIndex){nNewIndex--}oOldParent.symbols.removeAt(nOldIndex)}else{nOldIndex=self.symbol.diagram.symbols.indexOf(self.symbol);self.symbol.diagram.symbols.removeAt(nOldIndex)}if(oNewParent.symbols.length===0){oNewParent.symbols.push(self.symbol)}else{oNewParent.symbols.insert(nNewIndex,self.symbol)}oBBox=oNewParent.getContentAreaBBox();self.symbol.moveTo(oNewParent.isVertical?self.movedBBox.x:oBBox.x,oNewParent.isVertical?oBBox.y:self.movedBBox.y,undefined,self.viewer,self.endTransitionDefinition);if(oOldOwner!==oHighlighted){bUpdateOrder=true}if(self.symbol.parentSymbol&&self.symbol.parentSymbol.extendToContent){self.symbol.parentSymbol.extendToContent({extendParent:true},sap.galilei.ui.symbol.EdgeType.ALL,self.viewer,self.endTransitionDefinition)}}else{if(oHighlighted&&sap.galilei.model.isInstanceOf(oHighlighted,"sap.galilei.ui.diagram.Diagram")){oOldRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(self.symbol);self.symbol.owner=oHighlighted;oRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(self.symbol);self.editor.moveSymbolsBy(self.symbol,self.movedBBox.x-self.symbol.x,self.movedBBox.y-self.symbol.y,self.viewer,self.endTransitionDefinition);if(oOldOwner!==oHighlighted){bUpdateOrder=true}if(self.symbol.parentSymbol&&self.symbol.parentSymbol.extendToContent){self.symbol.parentSymbol.extendToContent({extendParent:true},sap.galilei.ui.symbol.EdgeType.ALL,self.viewer,self.endTransitionDefinition)}}else{if(!self.symbol.isRootSwimlaneSymbol||!oHighlighted){oRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(self.symbol);self.editor.moveSymbolsBy(oRootSwimlane,self.movedBBox.x-self.symbol.x,self.movedBBox.y-self.symbol.y,self.viewer,self.endTransitionDefinition)}}}if(oOldRootSwimlane&&oOldRootSwimlane!==oRootSwimlane){oOldRootSwimlane.layoutSwimlanes(sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT,self.viewer,self.endTransitionDefinition)}self._parentHighlighter.dispose();self._parentHighlighter=undefined;self.editor.postMoveSymbols([self.symbol],oOldOwners)}}this.resource.applyUndoableAction(moveSymbolAction,"Move Symbol");self.movedBBox=self.symbol.getBBox();self.resizedBBox=self.movedBBox.clone();self.initialBBox=self.movedBBox.clone();self.updateHandles(true);if(bUpdateOrder){this.editor.updateSymbolDrawingOrder(this.endTransitionDefinition)}setTimeout(function(){sap.galilei.core.Event.publish("move.symbol.after",self.editor,self.editor,oEvent)},this.endTransitionDefinition?this.endTransitionDefinition.duration:0)}}});
"use strict";sap.galilei.ui.editor.tracker.MultiSelectionTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.MultiSelectionTracker",trackerName:"MultiSelectionTracker",properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},diagram:{get:function(){return this.editor.diagram}},resource:{get:function(){return this.diagram.resource}},snapToGrid:false,gridSize:sap.galilei.ui.common.svg.Viewer.GRID_SIZE,snapToShapes:true,snapToShapesCenter:true,snapToShapesBorder:true,isReadOnly:false,frameShape:undefined,frameBBox:undefined,selectionShape:undefined,selectionBBox:{get:function(){var oRect,oSelectionBBox,index,oSymbol;for(index=0;index<this.selectedSymbols.length;index++){oSymbol=this.selectedSymbols[index];oRect=oSymbol.getBBox();if(index===0){oSelectionBBox=oRect}else{oSelectionBBox.unionRect(oRect)}}return oSelectionBBox}},selectedSymbols:{get:function(){return this.editor.selectedSymbols}},initialBBox:undefined,movedBBox:undefined,isDraggingSymbols:false,snapToShapesHandler:undefined},methods:{onInitialize:function(){var oSelectionBBox=this.selectionBBox;if(!this.editor){throw"The editor must be defined."}this.isReadOnly=this.editor.isReadOnly;this.snapToGrid=this.editor.snapToGrid;this.gridSize=this.editor.gridSize;this.snapToShapes=this.editor.snapToShapes;this.snapToShapesCenter=this.editor.snapToShapesCenter;this.snapToShapesBorder=this.editor.snapToShapesBorder;if(oSelectionBBox){this.initialBBox=oSelectionBBox.clone()}else{this.initialBBox=new sap.galilei.ui.common.Rect()}this.movedBBox=this.initialBBox.clone();if(this.snapToShapes){this.snapToShapesHandler=new sap.galilei.ui.editor.tracker.SnapToSymbols({editor:this.editor,transitionDefinition:new sap.galilei.ui.common.TransitionDefinition({duration:200}),snapToShapesCenter:this.snapToShapesCenter,snapToShapesBorder:this.snapToShapesBorder})}},onPointerDownDiagramBackground:function(oEvent){console.log("pointerdown multi-select");oEvent.preventDefault();oEvent.stopPropagation()},onPointerUpDiagramBackground:function(oEvent){console.log("pointerup multi-select")},onDragStartDiagramBackground:function(oEvent){this.viewer.normalizePointerEvent(oEvent);var aStartPt=[oEvent.startClientViewX,oEvent.startClientViewY];this.frameBBox=new sap.galilei.ui.common.Rect(aStartPt[0],aStartPt[1],1,1);if(!this.frameShape){this.frameShape=new sap.galilei.ui.common.shape.Rectangle({x:aStartPt[0],y:aStartPt[1],width:1,height:1,fill:"#C9E0ED",stroke:"#6EB1FA",fillOpacity:"0.4"});this.frameShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}},onDragDiagramBackground:function(oEvent){var aEndPt=this.viewer.normalizePointerEvent(oEvent);this.frameBBox.width=aEndPt[0]-this.frameBBox.x;this.frameBBox.height=aEndPt[1]-this.frameBBox.y;this.frameShape.setBBox(this.frameBBox.normalize(true));this.frameShape.updateDrawing(this.viewer);if(this.diagram){this.updateSymbolSelection(this.frameBBox.normalize(true),this.diagram.symbols)}},onDragEndDiagramBackground:function(oEvent){if(this.frameShape){this.frameShape.dispose();this.frameShape=undefined}if(this.selectedSymbols.length>1){this.getOrCreateSelectionFrame()}else{if(this.selectedSymbols.length===1){var oSymbol=this.selectedSymbols[0];this.unselectSymbol(oSymbol);this.editor.selectSymbol(oSymbol,true,this.transitionDefinition)}}},getOrCreateSelectionFrame:function(){if(!this.selectionShape){var oRect=this.selectionBBox;oRect.inflate(2,2);this.selectionShape=new sap.galilei.ui.common.shape.Rectangle({x:oRect.x,y:oRect.y,width:oRect.width,height:oRect.height,fill:"none",stroke:sap.galilei.ui.common.style.Color.orange,strokeWidth:2,strokeDashArray:"3,3"});this.selectionShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}return this.selectionShape},updateSelectionFrame:function(){var oShape=this.getOrCreateSelectionFrame(),oRect=this.selectionBBox;oRect.inflate(2,2);if(oShape){oShape.setBBox(oRect);oShape.updateDrawing(this.viewer,this.transitionDefinition)}},addEventHandlers:function(){sap.galilei.core.Event.subscribe("move.symbol.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("move.symbol.after",this.onAfterMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.after",this.onAfterMoveResizeSymbol,this)},removeEventHandlers:function(oSymbol){sap.galilei.core.Event.unSubscribeScope("move.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.after",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.after",this)},onBeforeMoveResizeSymbol:function(oEvent){if(oEvent&&oEvent.source!==this&&oEvent.sourceSymbol&&this.selectedSymbols.contains(oEvent.sourceSymbol)){var oldTransition;this.movedBBox=this.selectionBBox;this.resizedBBox=this.movedBBox.clone();this.initialBBox=this.movedBBox.clone();if(oEvent.transitionDefinition){oldTransition=this.transitionDefinition;this.transitionDefinition=oEvent.transitionDefinition;this.updateHandles(true);this.transitionDefinition=oldTransition}else{this.updateHandles(true)}}},onAfterMoveResizeSymbol:function(oEvent){if(oEvent&&oEvent.source!==this&&oEvent.sourceSymbol&&this.selectedSymbols.contains(oEvent.sourceSymbol)){}},updateSymbolSelection:function(oRect,oSymbols){var index,oSymbol;if(oRect&&oSymbols){for(index=0;index<oSymbols.length;++index){oSymbol=oSymbols.get(index);if(oRect.isRectInRect(oSymbol.getBBox())){this.selectSymbol(oSymbol)}else{this.unselectSymbol(oSymbol)}if(oSymbol.isComposite){this.updateSymbolSelection(oRect,oSymbol.symbols)}}}},selectSymbol:function(oSymbol){if(oSymbol){if(!this.selectedSymbols.contains(oSymbol)){oSymbol.isSelected=true;this.selectedSymbols.add(oSymbol);this.showSelection(oSymbol)}}},unselectSymbol:function(oSymbol){if(oSymbol){if(this.selectedSymbols.contains(oSymbol)){oSymbol.isSelected=false;this.selectedSymbols.remove(oSymbol);this.hideSelection(oSymbol)}}},unselectAllSymbols:function(){this.hideAllSelection();var index;for(index=this.selectedSymbols.length-1;index>=0;index--){this.selectedSymbols[index].isSelected=true}this.selectedSymbols.clear()},showSelection:function(oSymbol){if(oSymbol){var oShape=oSymbol.isLinkSymbol?oSymbol.shape:oSymbol.getBoundaryShape(),oLinkShape=oSymbol.isLinkSymbol?oSymbol.getLinkShape():undefined;if(oShape){if(oShape.filter){oShape._oldFilter=oShape.filter}oShape.filter="url(#filterSelectionGlow)";oShape.updateDrawing(this.viewer,this.transitionDefinition,["filter"]);if(oLinkShape){oShape=oLinkShape}if(oShape.strokeWidth===undefined&&oShape.stroke!=="none"){oShape.strokeWidth=1}if(oShape.strokeWidth!==undefined){oShape.strokeWidth+=2}oShape.updateDrawing(this.viewer,this.transitionDefinition,["strokeWidth"])}}},hideSelection:function(oSymbol){if(oSymbol){var oShape=oSymbol.isLinkSymbol?oSymbol.shape:oSymbol.getBoundaryShape(),oLinkShape=oSymbol.isLinkSymbol?oSymbol.getLinkShape():undefined;if(oShape){if(oShape.filter){oShape.filter=oShape._oldFilter;delete oShape._oldFilter}else{oShape.filter=null}oShape.updateDrawing(this.viewer,this.transitionDefinition,["filter"]);if(oLinkShape){oShape=oLinkShape}if(oShape.strokeWidth!==undefined){oShape.strokeWidth-=2}oShape.updateDrawing(this.viewer,this.transitionDefinition,["strokeWidth"])}}},showAllSelection:function(){var index,oSymbol;for(index=this.selectedSymbols.length-1;index>=0;index--){oSymbol=this.selectedSymbols[index];if(oSymbol._tracker){oSymbol._tracker.dispose();oSymbol._tracker=undefined}this.showSelection(oSymbol)}this.updateSelectionFrame()},hideAllSelection:function(){var index;for(index=this.selectedSymbols.length-1;index>=0;index--){this.hideSelection(this.selectedSymbols[index])}if(this.selectionShape){this.selectionShape.dispose();this.selectionShape=undefined}if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}},updateHandles:function(bUseAnimation){var oMovedRect=this.movedBBox.clone();if(this.snapToGrid){oMovedRect.snapToGrid(this.gridSize)}if(this.cloneMainShape){this.cloneMainShape.x=oMovedRect.x;this.cloneMainShape.y=oMovedRect.y;this.cloneMainShape.updateDrawing(this.viewer,bUseAnimation?this.transitionDefinition:undefined)}if(this.selectionShape){oMovedRect.inflate(2,2);this.selectionShape.setBBox(oMovedRect);this.selectionShape.updateDrawing(this.viewer,bUseAnimation?this.transitionDefinition:undefined)}},canDragStartSymbols:function(oEvent){if(oEvent&&!this.isReadOnly){this.viewer.normalizePointerEvent(oEvent);var aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentBBox=this.movedBBox;oEvent.selectedSymbols=this.selectedSymbols;this.editor.addEventProperties(oEvent);sap.galilei.core.Event.publish("move.symbols.dragstart",this.editor,this.editor,oEvent);return !oEvent.cancel}return false},defaultOnDragStartSymbols:function(oEvent){if(oEvent&&!this.isReadOnly){if(this.canDragStartSymbols(oEvent)){this.isDraggingSymbols=true;var index,oSymbol,oShape;this.initialBBox=this.selectionBBox.clone();this.movedBBox=this.selectionBBox.clone();if(!this.cloneMainShape){this.cloneMainShape=new sap.galilei.ui.common.shape.Group();this.cloneMainShape.isEnableTransform=true;this.cloneMainShape.x=this.initialBBox.x;this.cloneMainShape.y=this.initialBBox.y;for(index=0;index<this.selectedSymbols.length;index++){oSymbol=this.selectedSymbols[index];oShape=sap.galilei.ui.common.shape.ShapeRegistry.cloneShape(oSymbol.getOrCreateShape());oShape.x=oSymbol.x-this.initialBBox.x;oShape.y=oSymbol.y-this.initialBBox.y;oShape.filter=undefined;oShape.opacity=0.6;oShape.transform=undefined;if(sap.galilei.core.isInstanceOf(oShape,"sap.galilei.ui.common.shape.Group")){oShape.isEnableTransform=true;oShape.width=undefined;oShape.height=undefined}this.cloneMainShape.shapes.add(oShape)}this.cloneMainShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}if(this.snapToShapesHandler){this.snapToShapesHandler.initializeSymbolSnapLines()}}}},onDragStartSymbols:function(oEvent){this.defaultOnDragStartSymbols(oEvent)},canDragSymbols:function(oEvent){if(oEvent&&this.isDraggingSymbols){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;oEvent.selectedSymbols=this.selectedSymbols;this.editor.addEventProperties(oEvent);sap.galilei.core.Event.publish("move.symbols.drag",this.editor,this.editor,oEvent);return !oEvent.cancel}return false},getOrCreateParentHighlighter:function(){if(!this._parentHighlighter){this._parentHighlighter=new sap.galilei.ui.editor.tracker.SymbolHighlighter({editor:this.editor})}return this._parentHighlighter},defaultOnDragSymbols:function(oEvent){if(oEvent&&this.isDraggingSymbols){this.viewer.normalizePointerEvent(oEvent);var aDelta=[oEvent.deltaClientViewX,oEvent.deltaClientViewY],oOldBBox=this.movedBBox.clone(),aClientPoint,highlighter,self=this,aSelected=[],j,oSymbol;this.movedBBox.x=this.initialBBox.x+aDelta[0];this.movedBBox.y=this.initialBBox.y+aDelta[1];if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(this.movedBBox,true)}if(this.snapToGrid){this.movedBBox.snapToGrid(this.gridSize)}if(this.canDragSymbols(oEvent)){this.updateHandles();aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);highlighter=this.getOrCreateParentHighlighter();if(this.selectedSymbols){for(j=0;j<this.selectedSymbols.length;j++){oSymbol=this.selectedSymbols[j];if(!oSymbol.parentSymbol||!this.isParentSymbolSelected(oSymbol.parentSymbol)){aSelected.push(oSymbol)}}}highlighter.highlight(aClientPoint[0],aClientPoint[1],function(oSymbol){var oParentSymbol,oSelfSymbol,i;for(i=0;i<aSelected.length;i++){oParentSymbol=oSymbol;oSelfSymbol=aSelected[i];while(oParentSymbol){if(oParentSymbol===oSelfSymbol){return true}oParentSymbol=oParentSymbol.parentSymbol}}return false},function(oSymbol){var oSelfSymbol,i;for(i=0;i<aSelected.length;i++){oSelfSymbol=aSelected[i];if(!self.editor.canAttachSymbol(oSymbol,oSelfSymbol,{point:aClientPoint})){return false}}return true})}else{this.movedBBox=oOldBBox}}},onDragSymbols:function(oEvent){this.defaultOnDragSymbols(oEvent)},canMoveSymbols:function(oEvent){if(oEvent){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;oEvent.selectedSymbols=this.selectedSymbols;this.editor.addEventProperties(oEvent);sap.galilei.core.Event.publish("move.symbols.dragend",this,undefined,oEvent);return !oEvent.cancel}return false},isParentSymbolSelected:function(oParentSymbol){var index,oSymbol;for(index=0;index<this.selectedSymbols.length;index++){oSymbol=this.selectedSymbols[index];if(oSymbol===oParentSymbol){return true}}if(oParentSymbol.parentSymbol){return this.isParentSymbolSelected(oParentSymbol.parentSymbol)}return false},defaultMoveSymbols:function(){var self=this,index,oSymbol,oSelectedSymbols=[],oEvent={},bUpdateOrder;oEvent.selectedSymbols=this.selectedSymbols;sap.galilei.core.Event.publish("move.symbols.before",this,undefined,oEvent);function moveSymbolsAction(){var oParentSymbols={},sParent,oOldOwner,oOldOwners={};for(index=0;index<self.selectedSymbols.length;index++){oSymbol=self.selectedSymbols[index];oOldOwner=oSymbol.container;oOldOwners[oSymbol.objectId]=oOldOwner;if(oSymbol.parentSymbol&&self.isParentSymbolSelected(oSymbol.parentSymbol)){continue}oSelectedSymbols.push(oSymbol)}for(index=0;index<oSelectedSymbols.length;index++){oSymbol=oSelectedSymbols[index];oOldOwner=oSymbol.container;if(self._parentHighlighter){if(self._parentHighlighter.highlighted){oSymbol.owner=self._parentHighlighter.highlighted;if(oOldOwner!==self._parentHighlighter.highlighted){bUpdateOrder=true}}}if(oSymbol.parentSymbol&&!oParentSymbols[oSymbol.parentSymbol.objectId]){oParentSymbols[oSymbol.parentSymbol.objectId]=oSymbol.parentSymbol}}self.editor.moveSymbolsBy(oSelectedSymbols,self.movedBBox.x-self.initialBBox.x,self.movedBBox.y-self.initialBBox.y,self.viewer,self.endTransitionDefinition);if(self._parentHighlighter){self._parentHighlighter.dispose();self._parentHighlighter=undefined}for(sParent in oParentSymbols){if(oParentSymbols[sParent].extendToContent){oParentSymbols[sParent].extendToContent({extendParent:true},sap.galilei.ui.symbol.EdgeType.ALL,self.viewer,self.endTransitionDefinition)}}self.editor.postMoveSymbols(self.selectedSymbols,oOldOwners)}this.resource.applyUndoableAction(moveSymbolsAction,"Move Symbols");if(bUpdateOrder){this.editor.updateSymbolDrawingOrder(this.endTransitionDefinition)}self.updateHandles(true);setTimeout(function(){sap.galilei.core.Event.publish("move.symbols.after",self,undefined,oEvent);self.movedBBox=self.selectionBBox;self.resizedBBox=self.movedBBox.clone();self.initialBBox=self.movedBBox.clone()},this.endTransitionDefinition?this.endTransitionDefinition.duration:0)},moveSymbols:function(){this.defaultMoveSymbols()},defaultOnDragEndSymbols:function(oEvent){if(oEvent&&this.isDraggingSymbols){this.isDraggingSymbols=false;if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.highlightAndHideSnapLines(this.endTransitionDefinition)}if(this.canMoveSymbols(oEvent)){this.moveSymbols()}else{this.movedBBox=this.initialBBox.clone();this.updateHandles()}}},onDragEndSymbols:function(oEvent){this.defaultOnDragEndSymbols(oEvent)},cancel:function(){this.isDraggingSymbols=false;this.movedBBox=this.initialBBox.clone();this.updateHandles();if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.hideSnapLines()}},dispose:function(){this.isDraggingSymbols=false;this.hideAllSelection();this.removeEventHandlers();if(this.snapToShapesHandler){this.snapToShapesHandler.dispose();this.snapToShapesHandler=undefined}}}});
"use strict";sap.galilei.ui.editor.tracker.SwimlaneMultiSelectionTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.SwimlaneMultiSelectionTracker",trackerName:"SwimlaneMultiSelectionTracker",parent:sap.galilei.ui.editor.tracker.MultiSelectionTracker,methods:{getOrCreateParentHighlighter:function(){if(!this._parentHighlighter){this._parentHighlighter=new sap.galilei.ui.editor.tracker.SwimlaneSymbolHighlighter({editor:this.editor})}return this._parentHighlighter},canDragSymbols:function(oEvent){if(oEvent&&this.isDraggingSymbols){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY],aSelected=[],oSymbol,j,oOwner;oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;oEvent.selectedSymbols=this.selectedSymbols;this.editor.addEventProperties(oEvent);sap.galilei.core.Event.publish("move.symbols.drag",this.editor,this.editor,oEvent);if(!oEvent.cancel){if(this.selectedSymbols){for(j=0;j<this.selectedSymbols.length;j++){oSymbol=this.selectedSymbols[j];if(!oSymbol.parentSymbol||!this.isParentSymbolSelected(oSymbol.parentSymbol)){aSelected.push(oSymbol)}}}for(j=0;j<aSelected.length;j++){oSymbol=aSelected[j];if(!oOwner){oOwner=oSymbol.getOwner()}else{if(oOwner!==oSymbol.getOwner()){oEvent.cancel=true;break}}}}return !oEvent.cancel}return false},onDragSymbols:function(oEvent){if(oEvent&&this.isDraggingSymbols){this.viewer.normalizePointerEvent(oEvent);var aDelta=[oEvent.deltaClientViewX,oEvent.deltaClientViewY],oOldBBox=this.movedBBox.clone(),aClientPoint,aViewPoint,highlighter,self=this,aSelected=[],j,oSymbol;this.movedBBox.x=this.initialBBox.x+aDelta[0];this.movedBBox.y=this.initialBBox.y+aDelta[1];if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(this.movedBBox,true)}if(this.snapToGrid){this.movedBBox.snapToGrid(this.gridSize)}if(this.canDragSymbols(oEvent)){this.updateHandles();aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);highlighter=this.getOrCreateParentHighlighter();if(this.selectedSymbols){for(j=0;j<this.selectedSymbols.length;j++){oSymbol=this.selectedSymbols[j];if(!oSymbol.parentSymbol||!this.isParentSymbolSelected(oSymbol.parentSymbol)){aSelected.push(oSymbol)}}}highlighter.highlight(aClientPoint[0],aClientPoint[1],function(oSymbol){var oParentSymbol,oSelfSymbol,i;if(oSymbol.isLinkSymbol){return true}for(i=0;i<aSelected.length;i++){oParentSymbol=oSymbol;oSelfSymbol=aSelected[i];while(oParentSymbol){if(oParentSymbol===oSelfSymbol){return true}oParentSymbol=oParentSymbol.parentSymbol}}return false},function(oSymbol){var oSelfSymbol,i;for(i=0;i<aSelected.length;i++){oSelfSymbol=aSelected[i];if(!self.editor.canAttachSymbol(oSymbol,oSelfSymbol,{point:aViewPoint})){return false}}return true})}else{this.movedBBox=oOldBBox}}},moveSymbols:function(){var self=this,oEvent={},bUpdateOrder;oEvent.selectedSymbols=this.selectedSymbols;sap.galilei.core.Event.publish("move.symbols.before",this.editor,this.editor,oEvent);function moveSymbolsAction(){var aSelectedSymbols=[],index,oSymbol,oNewParent,oOldParent,nNewIndex,nOldIndex,oOldRootSwimlane,oOldRootSwimlanes={},oRootSwimlane,sOldRoot,oOldOwner;for(index=0;index<self.selectedSymbols.length;index++){oSymbol=self.selectedSymbols[index];if(oSymbol.parentSymbol&&self.isParentSymbolSelected(oSymbol.parentSymbol)){continue}aSelectedSymbols.push(oSymbol)}for(index=0;index<aSelectedSymbols.length;index++){oSymbol=aSelectedSymbols[index];oOldOwner=oSymbol.getOwner();if(self._parentHighlighter){if(self._parentHighlighter.highlighted&&self._parentHighlighter.highlighted.isSwimlaneSymbol){oNewParent=self._parentHighlighter.highlighted;nNewIndex=self._parentHighlighter.swimlaneIndex;oOldParent=oSymbol.parentSymbol;if(oOldParent){oOldRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(oSymbol);if(oOldRootSwimlane&&!oOldRootSwimlanes[oOldRootSwimlane.objectId]){oOldRootSwimlanes[oOldRootSwimlane.objectId]=oOldRootSwimlane}nOldIndex=oOldParent.symbols.indexOf(oSymbol);if(oOldParent&&oNewParent===oOldParent&&nNewIndex>nOldIndex){nNewIndex--}oOldParent.symbols.removeAt(nOldIndex)}else{nOldIndex=oSymbol.diagram.symbols.indexOf(oSymbol);oSymbol.diagram.symbols.removeAt(nOldIndex)}if(oNewParent.symbols.length===0){oNewParent.symbols.push(oSymbol)}else{oNewParent.symbols.insert(nNewIndex,oSymbol)}oRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(oNewParent);if(oOldOwner!==self._parentHighlighter.highlighted){bUpdateOrder=true}}else{if(self._parentHighlighter.highlighted&&sap.galilei.model.isInstanceOf(self._parentHighlighter.highlighted,"sap.galilei.ui.diagram.Diagram")){oOldParent=oSymbol.parentSymbol;if(oOldParent){oOldRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(oSymbol);if(oOldRootSwimlane&&!oOldRootSwimlanes[oOldRootSwimlane.objectId]){oOldRootSwimlanes[oOldRootSwimlane.objectId]=oOldRootSwimlane}nOldIndex=oOldParent.symbols.indexOf(oSymbol);oOldParent.symbols.removeAt(nOldIndex)}self._parentHighlighter.highlighted.symbols.push(oSymbol);oSymbol.moveBy(self.movedBBox.x-self.initialBBox.x,self.movedBBox.y-self.initialBBox.y,undefined,self.viewer,self.endTransitionDefinition);if(oOldOwner!==self._parentHighlighter.highlighted){bUpdateOrder=true}}}}}if(oRootSwimlane){oRootSwimlane.layoutSwimlanes(sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT,self.viewer,self.endTransitionDefinition)}if(oOldRootSwimlanes){for(sOldRoot in oOldRootSwimlanes){if(oOldRootSwimlanes[sOldRoot]&&oOldRootSwimlanes[sOldRoot]!==oRootSwimlane){oOldRootSwimlanes[sOldRoot].layoutSwimlanes(sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT,self.viewer,self.endTransitionDefinition)}}}self._parentHighlighter.dispose();self._parentHighlighter=undefined}this.resource.applyUndoableAction(moveSymbolsAction,"Move Symbols");self.movedBBox=self.selectionBBox;self.resizedBBox=self.movedBBox.clone();self.initialBBox=self.movedBBox.clone();self.updateHandles(true);if(bUpdateOrder){this.editor.updateSymbolDrawingOrder(this.endTransitionDefinition)}setTimeout(function(){sap.galilei.core.Event.publish("move.symbols.after",self,undefined,oEvent)},this.endTransitionDefinition?this.endTransitionDefinition.duration:0)},cancel:function(){this.isDraggingSymbols=false;this.movedBBox=this.initialBBox.clone();this.updateHandles();if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.hideSnapLines()}if(this._parentHighlighter){this._parentHighlighter.dispose();this._parentHighlighter=undefined}}}});
"use strict";sap.galilei.ui.editor.tracker.DiagramPointerTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.DiagramPointerTracker",trackerName:"DiagramPointerTracker",properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},diagram:{get:function(){return this.editor.diagram}},diagramBackgroundPanelShape:{get:function(){return this.viewer.backgroundPointerPanelShape}},multiSelectionTracker:{get:function(){return this.editor.multiSelectionTracker}},isLassoTool:{get:function(){if(this.editor.tool&&this.editor.tool.name===sap.galilei.ui.editor.tool.LassoTool.NAME){return true}return false}}},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}},onPointerDownDiagramBackground:function(oEvent){this.viewer.gotFocus();if(this.editor._isDraggingLink){return}console.log("pointerdown diagram");this.editor.unselectAllSymbols();if(oEvent&&(this.isLassoTool||oEvent.shiftKey)){oEvent.preventDefault();oEvent.stopPropagation();if(!this.multiSelectionTracker){this.editor.getOrCreateMultiSelectionTracker()}else{this.multiSelectionTracker.unselectAllSymbols()}}this.editor.addEventProperties(oEvent);sap.galilei.core.Event.publish("diagram.tap",this.editor,this.editor,oEvent)},onPointerUpDiagramBackground:function(oEvent){console.log("pointerup diagram")},onDragStartDiagramBackground:function(oEvent){var bShiftKey=false;if(oEvent&&oEvent.gesture&&oEvent.gesture.startEvent&&oEvent.gesture.startEvent.srcEvent){bShiftKey=oEvent.gesture.startEvent.srcEvent.shiftKey}if((this.isLassoTool||bShiftKey)&&this.multiSelectionTracker){this.multiSelectionTracker.onDragStartDiagramBackground(oEvent)}},onDragDiagramBackground:function(oEvent){var bShiftKey=false;if(oEvent&&oEvent.gesture&&oEvent.gesture.startEvent&&oEvent.gesture.startEvent.srcEvent){bShiftKey=oEvent.gesture.startEvent.srcEvent.shiftKey}if((this.isLassoTool||bShiftKey)&&this.multiSelectionTracker){this.multiSelectionTracker.onDragDiagramBackground(oEvent)}},onDragEndDiagramBackground:function(oEvent){var bShiftKey=false;if(oEvent&&oEvent.gesture&&oEvent.gesture.startEvent&&oEvent.gesture.startEvent.srcEvent){bShiftKey=oEvent.gesture.startEvent.srcEvent.shiftKey}if((this.isLassoTool||bShiftKey)&&this.multiSelectionTracker){this.multiSelectionTracker.onDragEndDiagramBackground(oEvent)}},addEventHandlers:function(){this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownDiagramBackground,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUpDiagramBackground,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartDiagramBackground,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.GestureEvents.drag,this.onDragDiagramBackground,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndDiagramBackground,this)},removeEventHandlers:function(){this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownDiagramBackground,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUpDiagramBackground,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartDiagramBackground,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragDiagramBackground,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndDiagramBackground,this)},dispose:function(){this.removeEventHandlers()}}});
"use strict";sap.galilei.ui.editor.tracker.LinkSymbolPointerTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.LinkSymbolPointerTracker",trackerName:"LinkSymbolPointerTracker",properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},diagramBackgroundPanelShape:{get:function(){return this.viewer.backgroundPointerPanelShape}},isLassoTool:{get:function(){if(this.editor.tool&&this.editor.tool.name===sap.galilei.ui.editor.tool.LassoTool.NAME){return true}return false}}},methods:{addEventHandlers:function(oSymbol){if(oSymbol){oSymbol.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onSymbolPointerDown,this);oSymbol.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onSymbolPointerUp,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onSymbolDragStart,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.drag,this.onSymbolDrag,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.dragend,this.onSymbolDragEnd,this)}else{this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onSymbolPointerDown,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onSymbolPointerUp,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onSymbolDragStart,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.GestureEvents.drag,this.onSymbolDrag,this);this.diagramBackgroundPanelShape.on(sap.galilei.ui.common.GestureEvents.dragend,this.onSymbolDragEnd,this)}},removeEventHandlers:function(oSymbol){if(oSymbol){oSymbol.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onSymbolPointerDown,this);oSymbol.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onSymbolPointerUp,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onSymbolDragStart,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.drag,this.onSymbolDrag,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.dragend,this.onSymbolDragEnd,this)}else{this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onSymbolPointerDown,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onSymbolPointerUp,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onSymbolDragStart,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.GestureEvents.drag,this.onSymbolDrag,this);this.diagramBackgroundPanelShape.off(sap.galilei.ui.common.GestureEvents.dragend,this.onSymbolDragEnd,this)}},onSymbolPointerDown:function(oEvent){var aClientPoint,oLinkSymbol,bSelected;this.viewer.gotFocus();if(this.isLassoTool){oEvent.preventDefault();oEvent.stopPropagation();return}if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol.isLinkSymbol){oLinkSymbol=oEvent.sourceSymbol}else{aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);oLinkSymbol=this.editor.getLinkSymbolByPoint(aClientPoint[0],aClientPoint[1],undefined,true,5)}if(oLinkSymbol){console.log("pointerdown link symbol.");oEvent.preventDefault();oEvent.stopPropagation();bSelected=oLinkSymbol.isSelected;if(oEvent.shiftKey){bSelected=!bSelected}else{if(!bSelected){bSelected=true}}if(bSelected&&oLinkSymbol.isSelected&&this.editor.selectedSymbols.length>1){}else{oLinkSymbol.isSelected=bSelected;if(oLinkSymbol.isSelected){if(!oEvent.shiftKey){this.editor.unselectAllSymbols(true,undefined,oLinkSymbol)}this.editor.selectSymbol(oLinkSymbol,true)}else{this.editor.unselectSymbol(oLinkSymbol,true)}}if(oLinkSymbol._tracker&&oLinkSymbol._tracker.onPointerDownShape){oLinkSymbol._tracker.onPointerDownShape(oEvent)}this._draggedSymbol=oLinkSymbol;this.editor._isDraggingLink=true}},onSymbolPointerUp:function(oEvent){this.editor._isDraggingLink=false},onSymbolDragStart:function(oEvent){if(this._draggedSymbol){var oSymbol=this._draggedSymbol;oEvent.preventDefault();oEvent.stopPropagation();if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onDragStartShape){oSymbol._tracker.onDragStartShape(oEvent)}}}},onSymbolDrag:function(oEvent){if(this._draggedSymbol){var oSymbol=this._draggedSymbol;if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onDragShape){oSymbol._tracker.onDragShape(oEvent)}}}},onSymbolDragEnd:function(oEvent){if(this._draggedSymbol){var oSymbol=this._draggedSymbol;if(this.editor.selectedSymbols.length===1){console.log("link points tracker dragend.");if(oSymbol._tracker&&oSymbol._tracker.onDragEndShape){oSymbol._tracker.onDragEndShape(oEvent);this._draggedSymbol=undefined}}}},dispose:function(){this.removeEventHandlers();this._draggedSymbol=undefined}}});
"use strict";sap.galilei.ui.editor.tracker.LinkSymbolTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.LinkSymbolTracker",trackerName:"LinkSymbolTracker",parent:sap.galilei.ui.common.tracker.PointsTracker,fields:{_extremityHighlighter:undefined},properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},diagram:{get:function(){return this.editor.diagram}},resource:{get:function(){return this.diagram.resource}},symbol:undefined},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}this.isReadOnly=this.editor.isReadOnly;if(this.symbol&&this.symbol.isLinkSymbol){this.pointsShape=this.symbol.getLinkShape();this.initialPoints=this.symbol.points.clone()}else{throw"The link symbol must be specified."}if(!this.transitionDefinition){this.transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:200})}},addEventHandlers:function(){this.defaultAddEventHandlers();sap.galilei.core.Event.subscribe("modify.linksymbol.before",this.onBeforeModifyLinkSymbol,this);sap.galilei.core.Event.subscribe("modify.linksymbol.after",this.onAfterModifyLinkSymbol,this)},removeEventHandlers:function(){this.defaultRemoveEventHandlers();sap.galilei.core.Event.unSubscribeScope("modify.linksymbol.before",this);sap.galilei.core.Event.unSubscribeScope("modify.linksymbol.after",this)},onBeforeModifyLinkSymbol:function(oEvent){if(oEvent&&oEvent.source!==this&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.initialPoints=undefined;this.updateHandles()}},onAfterModifyLinkSymbol:function(oEvent){if(oEvent&&oEvent.source!==this&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.initialPoints=this.symbol.points.clone();this.updateHandles();this.drawHandles()}},onPointerUpShape:function(oEvent,oShape){this.editor._isDraggingLink=false},isPointEditable:function(index){if(this.initialPoints){return(index===0||index===this.initialPoints.length-1)}return true},canDragStartHandle:function(oEvent,oHandle){if(oEvent&&oHandle){oEvent.cancel=!this.isPointEditable(oHandle._index);oEvent.handle=oHandle;oEvent.handleIndex=oHandle._index;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("linksymbol.handle.dragstart",this.editor,this.editor,oEvent);return !oEvent.cancel}return false},canDragHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this._isDraggingHandle){oEvent.cancel=!this.isPointEditable(oHandle._index);oEvent.handle=oHandle;oEvent.handleIndex=oHandle._index;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentPoint=[oHandle.cx,oHandle.cy];this.editor.addEventProperties(oEvent,this.symbol);sap.galilei.core.Event.publish("linksymbol.handle.drag",this.editor,this.editor,oEvent);return !oEvent.cancel}return false},getOrCreateExtremityHighlighter:function(){if(!this._extremityHighlighter){this._extremityHighlighter=new sap.galilei.ui.editor.tracker.ExtremitySymbolHighlighter({editor:this.editor,highlightDiagram:false,forceHighlightAttachPoints:true,radius:10,strokeWidth:4})}return this._extremityHighlighter},snapToAttachPoint:function(oEvent,oHandle,aPoint){var oExtremity,aClientPoint,oHighlighter,aNewPoint=aPoint,self=this,sLinkSymbolClass,sLinkObjectClass;if(oHandle&&this.symbol){aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);oHighlighter=this.getOrCreateExtremityHighlighter();if(oHighlighter){sLinkSymbolClass=this.symbol.classDefinition.qualifiedName;sLinkObjectClass=this.symbol.object?this.symbol.object.classDefinition.qualifiedName:undefined;oHighlighter.highlight(aClientPoint[0],aClientPoint[1],function(oSymbol){if(!oSymbol.isLinkSymbol){var oLinkToolDef={linkSymbolClass:sLinkSymbolClass,linkObjectClass:sLinkObjectClass};if(oHandle._index===0){oLinkToolDef.sourceSymbol=oSymbol.classDefinition.qualifiedName;oLinkToolDef.targetSymbol=self.symbol.targetSymbol.classDefinition.qualifiedName;return !self.editor.canCreateLinkSymbol(oSymbol,self.symbol.targetSymbol,oLinkToolDef)}else{if(oHandle._index===self.symbol.points.length-1){oLinkToolDef.sourceSymbol=self.symbol.sourceSymbol.classDefinition.qualifiedName;oLinkToolDef.targetSymbol=oSymbol.classDefinition.qualifiedName;return !self.editor.canCreateLinkSymbol(self.symbol.sourceSymbol,oSymbol,oLinkToolDef)}}}return true});oExtremity=oHighlighter.highlighted}if(!oExtremity){if(oHandle._index===0){oExtremity=this.symbol.sourceSymbol}else{if(oHandle._index===this.symbol.points.length-1){oExtremity=this.symbol.targetSymbol}}}if(oExtremity){if(oHighlighter&&oHighlighter.highlightedAttachPoint){aNewPoint[0]=oHighlighter.highlightedAttachPoint[0];aNewPoint[1]=oHighlighter.highlightedAttachPoint[1]}}}return aNewPoint},modifyPointsShape:function(bReroute,handleIndex){var i,length,oSourceSymbol,oTargetSymbol,oSourceBoundaryShape,oTargetBoundaryShape,oSourceRect,oTargetRect,nSourceIndex,nTargetIndex,oExtremity,aSymbolPoints,modifyLinkAction,self=this;if(this.symbol&&this.symbol.isLinkSymbol&&this.modifiedPoints){modifyLinkAction=function(){var oldSourceDirection,oldTargetDirection,sourceDirection,targetDirection;if(!bReroute&&self.symbol.points.length>=2){length=self.symbol.points.length;oldSourceDirection=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(self.symbol.points[0],self.symbol.points[1]);oldTargetDirection=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(self.symbol.points[length-1],self.symbol.points[length-2])}if(self._extremityHighlighter&&self._extremityHighlighter.highlighted){oExtremity=self._extremityHighlighter.highlighted;if(handleIndex===0&&self.symbol.sourceSymbol!==oExtremity){if(self.symbol.object){self.symbol.object[self.editor.getLinkObjectSourceReferenceName(self.symbol.object.classDefinition.qualifiedName)]=oExtremity.object}self.symbol.sourceSymbol=oExtremity}else{if(handleIndex===self.modifiedPoints.length-1&&self.symbol.targetSymbol!==oExtremity){if(self.symbol.object){self.symbol.object[self.editor.getLinkObjectTargetReferenceName(self.symbol.object.classDefinition.qualifiedName)]=oExtremity.object}self.symbol.targetSymbol=oExtremity}}}aSymbolPoints=self.modifiedPoints.clone();oSourceSymbol=self.symbol.sourceSymbol;oTargetSymbol=self.symbol.targetSymbol;if(oSourceSymbol&&oTargetSymbol){oSourceBoundaryShape=oSourceSymbol.getBoundaryShape();oTargetBoundaryShape=oTargetSymbol.getBoundaryShape();oSourceRect=oSourceSymbol.getBBox();oTargetRect=oTargetSymbol.getBBox();length=aSymbolPoints.length;if(oSourceBoundaryShape&&oTargetBoundaryShape){for(i=1;i<length;i++){if(!oSourceBoundaryShape.isPointInShape(aSymbolPoints[i],oSourceRect)){nSourceIndex=i;break}}for(i=length-2;i>=0;i--){if(!oTargetBoundaryShape.isPointInShape(aSymbolPoints[i],oTargetRect)){nTargetIndex=i;break}}if(nSourceIndex!==undefined&&nTargetIndex!==undefined&&nSourceIndex>=1&&nTargetIndex<=length-2&&nTargetIndex-nSourceIndex>=-2){aSymbolPoints.set(aSymbolPoints.slice(nSourceIndex-1,nTargetIndex+2))}if(!oSourceBoundaryShape.isPointInShape(aSymbolPoints[0],oSourceRect)||!oTargetBoundaryShape.isPointInShape(aSymbolPoints[aSymbolPoints.length-1],oTargetRect)){return}}}self.symbol.points=aSymbolPoints;self.symbol.isAutomaticRouting=bReroute;if(!bReroute){if(aSymbolPoints.length>=2){length=aSymbolPoints.length;sourceDirection=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(aSymbolPoints[0],aSymbolPoints[1]);targetDirection=sap.galilei.ui.common.layout.PointsLayout.getLinkDirection(aSymbolPoints[length-1],aSymbolPoints[length-2]);if(sourceDirection!==oldSourceDirection){self.symbol.sourceDirection=sourceDirection}if(targetDirection!==oldTargetDirection){self.symbol.targetDirection=targetDirection}}}else{if(handleIndex===0){self.symbol.sourceDirection=undefined}if(handleIndex===aSymbolPoints.length-1){self.symbol.targetDirection=undefined}}self.symbol.updateLinkRouting(true);self.symbol.drawSymbol(self.viewer,self.transitionDefinition)};this.resource.applyUndoableAction(modifyLinkAction,"Modify Link Symbol");this.initialPoints=this.symbol.points.clone()}if(this._extremityHighlighter){this._extremityHighlighter.dispose();this._extremityHighlighter=undefined}},cancel:function(){this.defaultCancel();this.editor._isDraggingLink=false;if(this._extremityHighlighter){this._extremityHighlighter.dispose();this._extremityHighlighter=undefined}}}});
"use strict";sap.galilei.ui.editor.tracker.SnapToSymbols=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.tracker.SnapToSymbols",parent:sap.galilei.ui.common.tracker.SnapToShapes,initialize:function(options){if(options){this.set(options)}this.onInitialize()},properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},diagram:{get:function(){return this.editor.diagram}}},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}},initializeSymbolSnapLines:function(bExcludeSelected){if(bExcludeSelected===undefined){bExcludeSelected=true}this.clearShapeIndexes();this.addSymbolsCoordinates(this.diagram.symbols,bExcludeSelected);this.createSnapLines()},addSymbolsCoordinates:function(oSymbols,bExcludeSelected){if(oSymbols){oSymbols.forEach(function(oSymbol){if(!oSymbol.isHidden&&!oSymbol.isLinkSymbol&&this.editor.isSymbolVisible(oSymbol)&&(!bExcludeSelected||(bExcludeSelected&&!this.editor.selectedSymbols.contains(oSymbol)))){this.addShapeBBox(oSymbol.getBBox());if(oSymbol.isComposite){this.addSymbolsCoordinates(oSymbol.symbols,bExcludeSelected)}}},this)}}}});
"use strict";sap.galilei.ui.editor.tracker.SymbolPointerTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.editor.tracker.SymbolPointerTracker",trackerName:"SymbolPointerTracker",properties:{editor:undefined,viewer:{get:function(){return this.editor.viewer}},isLassoTool:{get:function(){if(this.editor.tool&&this.editor.tool.name===sap.galilei.ui.editor.tool.LassoTool.NAME){return true}return false}}},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}},addEventHandlers:function(oSymbol){if(oSymbol){oSymbol.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onSymbolPointerDown,this);oSymbol.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onSymbolPointerUp,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onSymbolDragStart,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.drag,this.onSymbolDrag,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.dragend,this.onSymbolDragEnd,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.pinch,this.onSymbolPinch,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.tap,this.onSymbolTap,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.doubletap,this.onSymbolDoubleTap,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.hold,this.onSymbolHold,this);oSymbol.on(sap.galilei.ui.common.GestureEvents.release,this.onSymbolRelease,this)}},removeEventHandlers:function(oSymbol){if(oSymbol){oSymbol.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onSymbolPointerDown,this);oSymbol.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onSymbolPointerUp,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onSymbolDragStart,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.drag,this.onSymbolDrag,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.dragend,this.onSymbolDragEnd,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.pinch,this.onSymbolPinch,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.tap,this.onSymbolTap,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.doubletap,this.onSymbolDoubleTap,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.hold,this.onSymbolHold,this);oSymbol.off(sap.galilei.ui.common.GestureEvents.release,this.onSymbolRelease,this)}},onSymbolPointerDown:function(oEvent){this.viewer.gotFocus();if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol,bSelected=oSymbol.isSelected,aViewPoint,bCanSelect,bStopPropagation=true;if(this.editor._isDraggingLink){return}if(this.isLassoTool){oEvent.preventDefault();oEvent.stopPropagation();return}console.log("pointerdown symbol");this._isPointerMoved=false;this._isReselectSymbol=false;oEvent.preventDefault();if(oEvent.shiftKey){bSelected=!bSelected}else{if(!bSelected){bSelected=true}}if(bSelected&&oSymbol.isSelected){if(this.editor.selectedSymbols.length===1){this._isReselectSymbol=true}}else{aViewPoint=this.viewer.normalizePointerEvent(oEvent);bCanSelect=this.editor.canSelectSymbolByPoint(oSymbol,aViewPoint);bStopPropagation=bCanSelect;if(bSelected){if(!oEvent.shiftKey){this.editor.unselectAllSymbols(true,undefined,oSymbol)}if(bCanSelect){oSymbol.isSelected=true;this.editor.selectSymbol(oSymbol,true)}else{oSymbol.isSelected=false;this.editor.unselectSymbol(oSymbol,true)}}else{oSymbol.isSelected=false;this.editor.unselectSymbol(oSymbol,true)}}if(bStopPropagation){oEvent.stopPropagation()}}},onSymbolPointerUp:function(oEvent){if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol,aClientPoint;if(!this._isPointerMoved&&this._isReselectSymbol&&oSymbol.isSelected&&this.editor.selectedSymbols.length===1){aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);this.editor.enterInPlaceEditing(oSymbol,aClientPoint)}}},onSymbolDragStart:function(oEvent){if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;oEvent.preventDefault();oEvent.stopPropagation();this._isPointerMoved=true;if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onDragStartShape){oSymbol._tracker.onDragStartShape(oEvent)}}else{if(this.editor.selectedSymbols.length>1){if(this.editor.multiSelectionTracker){this.editor.multiSelectionTracker.onDragStartSymbols(oEvent)}}}}},onSymbolDrag:function(oEvent){if(oEvent&&oEvent.gesture&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onDragShape){oSymbol._tracker.onDragShape(oEvent)}}else{if(this.editor.selectedSymbols.length>1){if(this.editor.multiSelectionTracker){this.editor.multiSelectionTracker.onDragSymbols(oEvent)}}}}},onSymbolDragEnd:function(oEvent){if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onDragEndShape){oSymbol._tracker.onDragEndShape(oEvent)}}else{if(this.editor.selectedSymbols.length>1){if(this.editor.multiSelectionTracker){this.editor.multiSelectionTracker.onDragEndSymbols(oEvent)}}}}},onSymbolPinch:function(oEvent){if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onPinchShape){oSymbol._tracker.onPinchShape(oEvent)}}}},onSymbolTap:function(oEvent){if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(oSymbol._tracker&&oSymbol._tracker.onShapeTap){oSymbol._tracker.onShapeTap(oEvent)}}},onSymbolDoubleTap:function(oEvent){if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(oSymbol._tracker&&oSymbol._tracker.onShapeDoubleTap){oSymbol._tracker.onShapeDoubleTap(oEvent)}}},onSymbolHold:function(oEvent){if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(oSymbol._tracker&&oSymbol._tracker.onShapeHold){oSymbol._tracker.onShapeHold(oEvent)}}},onSymbolRelease:function(oEvent){if(oEvent&&oEvent.sourceSymbol){var oSymbol=oEvent.sourceSymbol;if(this.editor.selectedSymbols.length===1){if(oSymbol._tracker&&oSymbol._tracker.onReleaseShape){oSymbol._tracker.onReleaseShape(oEvent)}}}}}});
"use strict";sap.galilei.ui.editor.command.ChangeObjectTypeCommand=sap.galilei.ui.editor.command.defineCommand({fullClassName:"sap.galilei.ui.editor.command.ChangeObjectTypeCommand",parent:sap.galilei.ui.editor.command.ChangePropertyCommand,methods:{onValueChanged:function(){this.changeObjectType()},onVerifyValue:function(vValue){if(vValue.isChangeObject){if(this.editor){if(!this.editor.canCreateObject(vValue.value,vValue.objectParams)){return false}}}else{if(this.editor&&this.object){var oParam={};oParam[this.attribute]=vValue.value;if(!this.editor.canSetObjectProperties(this.object,oParam)){return false}}}return true},changeObjectType:function(){var self=this,oSymbol,oObject,index,sObjectClass,oObjectParams,sSymbolClass,oSymbolParams;function changeObjectType(){self.editor.ReplaceObjectAndSymbol(oSymbol,sObjectClass,oObjectParams,sSymbolClass,oSymbolParams)}if(this.symbol&&this.values&&this.editor){oSymbol=this.symbol;oObject=oSymbol.object;sObjectClass=this.selectedValue;index=this.getValueIndex();if(index>=0){oObjectParams=this.values[index].objectParams;sSymbolClass=this.values[index].symbolClass;oSymbolParams=this.values[index].symbolParams;this.resource.applyUndoableAction(changeObjectType,"Change Object Type")}}}}});
"use strict";sap.galilei.ui.editor.tool.CreateNodeSymbolTool=sap.galilei.ui.editor.tool.defineTool({fullClassName:"sap.galilei.ui.editor.tool.CreateNodeSymbolTool",statics:{NAME:sap.galilei.ui.editor.tool.Types.createNodeSymbolTool},toolName:sap.galilei.ui.editor.tool.Types.createNodeSymbolTool,toolType:sap.galilei.ui.editor.tool.Types.createNodeSymbolTool,fields:{_isInitialized:false,_parentHighlighter:undefined},properties:{isReadOnly:{value:false,writable:false,configurable:false},isCreateNodeSymbol:{value:true,writable:false,configurable:false},symbolClass:undefined,symbolParam:undefined,symbolParent:undefined,symbolIndex:undefined,symbolClassDefinition:undefined,objectClass:undefined,objectParam:undefined,objectParent:undefined,objectReference:undefined,objectIndex:undefined,objectClassDefinition:undefined,dropBBox:undefined,dropPoint:undefined,overlayPanelShape:undefined,cursorShape:undefined,transitionDefinition:undefined,snapToShapesHandler:undefined,isContextButton:{value:false},parentHighlighter:{field:"_parentHighlighter",get:function(){return this._parentHighlighter}}},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}if(!this.symbolClass){throw"The symbol class must be defined."}},onDelayedInitialize:function(){if(!this._isInitialized){if(this.symbolClass){this.symbolClassDefinition=sap.galilei.model.getClass(this.symbolClass);if(!this.symbolClassDefinition){console.log("The symbol class "+this.symbolClass+" cannot be found.")}if(!this.objectClass){this.objectClass=this.editor.getObjectClassOfSymbolClass(this.symbolClass);if(this.objectClass){this.objectClassDefinition=sap.galilei.model.getClass(this.objectClass);if(!this.objectClassDefinition){console.log("The object class "+this.objectClass+" cannot be found.")}}}}this._isInitialized=true}},onSelected:function(){if(!this.editor.isReadOnly){this._isContextButton=false;this.onDelayedInitialize();this.createOverlayPanel();this.addEventHandlers();this.transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:200});if(this.editor.snapToShapes){this.snapToShapesHandler=new sap.galilei.ui.editor.tracker.SnapToSymbols({editor:this.editor,transitionDefinition:this.transitionDefinition,snapToShapesCenter:this.editor.snapToShapesCenter,snapToShapesBorder:this.editor.snapToShapesBorder});this.snapToShapesHandler.initializeSymbolSnapLines(false)}}},onUnselected:function(){this.removeEventHandlers();if(this.overlayPanelShape){this.overlayPanelShape.dispose();this.overlayPanelShape=undefined}if(this.cursorShape){this.cursorShape.dispose();this.cursorShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.dispose();this.snapToShapesHandler=undefined}if(this._parentHighlighter){this._parentHighlighter.dispose();this._parentHighlighter=undefined}},createOverlayPanel:function(){var oLayer=this.viewer.getLayerByName(sap.galilei.ui.common.svg.Layer.FOREGROUND_POINTER_LAYER);if(!this.overlayPanelShape){this.overlayPanelShape=new sap.galilei.ui.common.shape.Rectangle({width:this.viewer.viewWidth,height:this.viewer.viewHeight,opacity:0.01,fill:"white"});this.overlayPanelShape.draw(this.viewer,oLayer.d3Layer)}},createCursor:function(x,y){if(this.cursor){this.cursorShape=new sap.galilei.ui.common.shape.Image({x:x-this.cursorWidth/2,y:y-this.cursorHeight/2,width:this.cursorWidth,height:this.cursorHeight,href:this.cursor})}else{var oSymbolLayout=sap.galilei.ui.diagram.Symbol.getOrCreateSymbolLayout(this.symbolClassDefinition),oShape,sOrientation=this.symbolClassDefinition.runtimeClass.defaultOrientation,nSize;if(oSymbolLayout){oShape=oSymbolLayout.createShape();if(oShape){if(oShape.mainShape){this.cursorShape=oShape.mainShape;if(!oShape.mainShape.isGroup){oShape.mainShape.width-=8;oShape.mainShape.height-=8}if(sOrientation&&sOrientation!==this.editor.orientation){nSize=oShape.mainShape.width;oShape.mainShape.width=oShape.mainShape.height;oShape.mainShape.height=nSize}this.cursorWidth=oShape.mainShape.width;this.cursorHeight=oShape.mainShape.height}else{this.cursorShape=oShape;if(sOrientation&&sOrientation!==this.editor.orientation){nSize=oShape.width;oShape.width=oShape.height;oShape.height=nSize}this.cursorWidth=oShape.width;this.cursorHeight=oShape.height}if(oShape.mainShape.isGroup){this.cursorShape.x=-this.cursorWidth/2;this.cursorShape.y=-this.cursorHeight/2}this.cursorShape.strokeOpacity=0.8;this.cursorShape.fillOpacity=0.6;this.cursorShape.transform="translate("+x+","+y+")"}}}if(this.cursorShape){this.cursorShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}},updateCursor:function(oEvent){if(oEvent){var aViewPoint=this.viewer.normalizePointerEvent(oEvent,true),oRect,aPoint;if(!this.cursorShape){this.createCursor(aViewPoint[0],aViewPoint[1])}else{oRect=new sap.galilei.ui.common.Rect(aViewPoint[0]-this.cursorWidth/2,aViewPoint[1]-this.cursorHeight/2,this.cursorWidth,this.cursorHeight);if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(oRect,true,undefined,false,this.cursor!==undefined)}this.dropBBox=oRect;this.dropPoint=this.dropBBox.getCenter();if(this.editor.snapToGrid){this.dropPoint=sap.galilei.ui.common.Point.snapToGrid(this.dropPoint,this.editor.gridSize)}aPoint=[oRect.x,oRect.y];if(this.cursor){this.cursorShape.x=aPoint[0];this.cursorShape.y=aPoint[1];this.cursorShape.updateDrawing(this.viewer,undefined,["x","y"])}else{this.cursorShape.transform="translate("+aPoint[0]+","+aPoint[1]+")";this.cursorShape.updateDrawing(this.viewer,undefined,["transform"])}}}},getOrCreateParentHighlighter:function(){if(!this._parentHighlighter){if(sap.galilei.model.isTypeOf(this.symbolClass,"sap.galilei.ui.diagram.SwimlaneSymbol")){this._parentHighlighter=new sap.galilei.ui.editor.tracker.SwimlaneSymbolHighlighter({editor:this.editor,radius:5,highlightColor:sap.galilei.ui.common.style.Color.lightgreen,strokeWidth:5})}else{this._parentHighlighter=new sap.galilei.ui.editor.tracker.SymbolHighlighter({editor:this.editor,radius:5,highlightColor:sap.galilei.ui.common.style.Color.lightgreen,strokeWidth:5})}}return this._parentHighlighter},canCreateSymbol:function(oEvent,aPoint,oParentSymbol){var bCanCreate,oParam;oParam={point:aPoint,parentSymbol:oParentSymbol};this.symbolParent=undefined;this.symbolIndex=undefined;this.objectParent=undefined;this.objectIndex=undefined;bCanCreate=this.editor.canCreateSymbol(this.symbolClass,oParam);this.symbolParent=oParam.parentSymbol;if(bCanCreate){this.objectClass=this.objectClass||this.editor.getObjectClassOfSymbolClass(this.symbolClass);this.objectParent=this.editor.getParentObjectByParentSymbol(this.symbolParent,this.objectClass);bCanCreate=this.editor.canCreateObject(this.objectClass,this.objectParent,this.objectParam)}return bCanCreate},canInsertSymbol:function(oEvent,aPoint,oLinkSymbol){var bCanCreate,oParam;oParam={point:aPoint,linkSymbol:oLinkSymbol};return this.editor.canInsertSymbolOnLinkSymbol(this.symbolClass,oParam)},onPointerDown:function(oEvent){if(!this.isContextButton){oEvent.preventDefault();oEvent.stopPropagation()}},onPointerUp:function(oEvent){if(!this.isContextButton){oEvent.preventDefault();oEvent.stopPropagation();this.onDrop(oEvent)}},onPointerMove:function(oEvent){if(oEvent&&!this.editor.isReadOnly){var self=this,aClientPoint,aViewPoint,highlighter;this.updateCursor(oEvent);aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);highlighter=this.getOrCreateParentHighlighter();highlighter.highlight(aClientPoint[0],aClientPoint[1],function(oSymbol){var oParentSymbol=oSymbol;while(oParentSymbol){if(oParentSymbol===self.symbol){return true}oParentSymbol=oParentSymbol.parentSymbol}return false},function(oSymbol){return(!oSymbol.isLinkSymbol&&self.canCreateSymbol(oEvent,aViewPoint,oSymbol))||(oSymbol.isLinkSymbol&&self.canInsertSymbol(oEvent,aViewPoint,oSymbol))})}},onDragOver:function(oEvent){if(oEvent&&!this.editor.isReadOnly){return false}},onDrop:function(oEvent){var aClientPoint,oParentSymbol,nSwimlaneIndex,aViewPoint,aPoint,oSymbol,oLinkSymbol;if(oEvent&&!this.editor.isReadOnly&&this.dropPoint){aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);if(this._parentHighlighter){if(this._parentHighlighter.highlighted){oParentSymbol=this._parentHighlighter.highlighted;if(oParentSymbol.isSwimlaneSymbol){nSwimlaneIndex=this._parentHighlighter.swimlaneIndex}}this._parentHighlighter.dispose();this._parentHighlighter=undefined}else{oParentSymbol=this.editor.getSymbolByPoint(aClientPoint[0],aClientPoint[1],this.viewer.mainShapeLayer.d3Layer,true)}aPoint=this.dropPoint;if(oParentSymbol&&oParentSymbol.isLinkSymbol){oLinkSymbol=oParentSymbol}if(((!oParentSymbol||!oParentSymbol.isLinkSymbol)&&this.canCreateSymbol(oEvent,aPoint,oParentSymbol))||(oLinkSymbol&&this.canInsertSymbol(oEvent,aPoint,oLinkSymbol))){if(oLinkSymbol){oSymbol=this.insertSymbolOnLinkSymbol(oLinkSymbol,aPoint[0],aPoint[1])}else{if(nSwimlaneIndex!==undefined){this.symbolIndex=nSwimlaneIndex}oSymbol=this.createSymbol(aPoint[0],aPoint[1])}}if(this.snapToShapesHandler){this.snapToShapesHandler.highlightAndHideSnapLines(this.transitionDefinition)}this.editor.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME,false);if(oSymbol){this.editor.unselectAllSymbols();if(this.editor.selectSymbolAfterCreate){this.editor.selectSymbol(oSymbol)}if(this.editor.enableInPlaceEditingAfterCreate){this.editor.enterInPlaceEditing(oSymbol)}}}return oSymbol},createSymbol:function(x,y,width,height,bUseUndoAction){var self=this,oSymbolParams=this.symbolParam||{},oSymbol,oBBox,dx,dy;sap.galilei.core.copyProperties(oSymbolParams,{x:x-this.cursorWidth/2,y:y-this.cursorHeight/2});if(width){oSymbolParams.width=width}if(height){oSymbolParams.height=height}bUseUndoAction=bUseUndoAction===undefined?true:bUseUndoAction;function createSymbolAction(){oSymbol=self.editor.createSymbolAndObject(self.symbolClass,oSymbolParams,self.symbolParent,self.symbolIndex,self.objectClass,self.objectParam,self.objectParent,self.objectReference,self.objectIndex);if(oSymbol){oBBox=oSymbol.getBBox();dx=(self.cursorWidth-oBBox.width)/2;dy=(self.cursorHeight-oBBox.height)/2;if(dx!==0||dy!==0){oSymbol.moveBy(dx,dy)}if(oSymbol.isBoundarySymbol&&self.symbolParent){self.symbolParent.updateBoundarySymbol(oSymbol,undefined,undefined,false)}self.editor.postCreateSymbol(oSymbol);self.editor.drawSymbol(oSymbol);if(self.symbolParent&&self.symbolParent.extendToContent){self.symbolParent.extendToContent({extendParent:true},sap.galilei.ui.symbol.EdgeType.ALL,self.viewer,self.transitionDefinition)}}}if(bUseUndoAction){this.resource.applyUndoableAction(createSymbolAction,"Create Symbol")}else{createSymbolAction()}if(oSymbol&&oSymbol.parentSymbol&&oSymbol.parentSymbol.symbols.length===1){this.editor.updateSymbolDrawingOrder(this.transitionDefinition)}return oSymbol},insertSymbolOnLinkSymbol:function(oLinkSymbol,x,y){var self=this,oNodeSymbol,oEditorExt,oSourceSymbol,oTargetSymbol,oLinkSymbol2;function insertSymbolAction(){oNodeSymbol=self.createSymbol(x,y,undefined,undefined,false);if(oNodeSymbol){oSourceSymbol=oLinkSymbol.sourceSymbol;oTargetSymbol=oLinkSymbol.targetSymbol;oEditorExt=self.editor.extension;if(oLinkSymbol.object){oLinkSymbol.object[self.editor.getLinkObjectTargetReferenceName(oLinkSymbol.object.classDefinition.qualifiedName)]=oNodeSymbol.object}oLinkSymbol.targetSymbol=oNodeSymbol;oLinkSymbol.isAutomaticRouting=true;oLinkSymbol.updateLinkRouting(false);oLinkSymbol2=self.editor.createLinkSymbolAndObject(oNodeSymbol,oTargetSymbol,oLinkSymbol.classDefinition.qualifiedName,undefined,oLinkSymbol.getOwner(),undefined,self.editor.cloneLinkObjectParams(oLinkSymbol.object),oLinkSymbol.object?oLinkSymbol.object.container:undefined);if(oLinkSymbol2){oLinkSymbol2.isAutomaticRouting=true;oLinkSymbol2.updateLinkRouting(false);oNodeSymbol.drawSymbol(self.viewer);oLinkSymbol.drawSymbol(self.viewer,self.transitionDefinition);oLinkSymbol2.drawSymbol(self.viewer,self.transitionDefinition)}}}if(oLinkSymbol){this.resource.applyUndoableAction(insertSymbolAction,"Insert Symbol");return oNodeSymbol}},addEventHandlers:function(){if(this.overlayPanelShape){this.overlayPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDown,this);this.overlayPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUp,this);this.overlayPanelShape.on(sap.galilei.ui.common.PointerEvents.pointermove,this.onPointerMove,this);this.overlayPanelShape.on(sap.galilei.ui.common.DragDropEvents.dragover,this.onDragOver,this);this.overlayPanelShape.on(sap.galilei.ui.common.DragDropEvents.drop,this.onDrop,this)}},removeEventHandlers:function(){if(this.overlayPanelShape){this.overlayPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDown);this.overlayPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUp);this.overlayPanelShape.off(sap.galilei.ui.common.PointerEvents.pointermove,this.onPointerMove);this.overlayPanelShape.off(sap.galilei.ui.common.DragDropEvents.dragover,this.onDragOver);this.overlayPanelShape.off(sap.galilei.ui.common.DragDropEvents.drop,this.onDrop)}},changeEventHandlers:function(){if(this.overlayPanelShape){if(this.isContextButton){this.removeEventHandlers()}else{this.addEventHandlers()}}}}});
"use strict";sap.galilei.ui.editor.tool.CompoundCreateNodeSymbolTool=sap.galilei.ui.editor.tool.defineTool({fullClassName:"sap.galilei.ui.editor.tool.CompoundCreateNodeSymbolTool",parent:sap.galilei.ui.editor.tool.CreateNodeSymbolTool,statics:{NAME:sap.galilei.ui.editor.tool.Types.compoundCreateNodeSymbolTool},toolName:sap.galilei.ui.editor.tool.Types.compoundCreateNodeSymbolTool,toolType:sap.galilei.ui.editor.tool.Types.compoundCreateNodeSymbolTool,fields:{_tools:undefined,_activeTool:undefined},properties:{toolNames:undefined},methods:{onInitialize:function(){if(!this.editor){throw"The editor must be defined."}if(!this.toolNames){throw"Concrete tools must be defined."}},onDelayedInitialize:function(){var i,oTool;if(!this._isInitialized){this._tools=[];if(this.toolNames){for(i=0;i<this.toolNames.length;i++){oTool=sap.galilei.ui.editor.tool.getTool(this.toolNames[i]);if(oTool){oTool.onDelayedInitialize();this._tools.push(oTool)}}}if(this._tools&&this._tools[0]){this.activateTool(this._tools[0])}this._isInitialized=true}},activateTool:function(oTool){var i,aParams=["symbolClass","symbolParam","symbolParent","symbolIndex","symbolClassDefinition","objectClass","objectParam","objectParent","objectReference","objectIndex","objectClassDefinition"];for(i=0;i<aParams.length;i++){this[aParams[i]]=oTool[aParams[i]]}this._activeTool=oTool},canCreateSymbol:function(oEvent,aPoint,oParentSymbol){var i,oTool;if(this._tools){for(i=0;i<this._tools.length;i++){oTool=this._tools[i];if(oTool.canCreateSymbol(oEvent,aPoint,oParentSymbol)){this.activateTool(oTool);return true}}}return false}}});
"use strict";sap.galilei.ui.editor.tool.CreateLinkSymbolTool=sap.galilei.ui.editor.tool.defineTool({fullClassName:"sap.galilei.ui.editor.tool.CreateLinkSymbolTool",statics:{NAME:sap.galilei.ui.editor.tool.Types.createLinkSymbolTool},toolName:sap.galilei.ui.editor.tool.Types.createLinkSymbolTool,toolType:sap.galilei.ui.editor.tool.Types.createLinkSymbolTool,fields:{_sourceExtremityHighlighter:undefined,_targetExtremityHighlighter:undefined},properties:{isReadOnly:{value:false,writable:false,configurable:false},isCreateLinkSymbol:{value:true,writable:false,configurable:false},linksDefinition:{onChange:function(){this.updateLinkToolsDefinition()}},sourceSymbolClasses:undefined,targetSymbolClasses:undefined,sourceSymbol:undefined,sourceAnchor:undefined,sourcePoint:undefined,currentSymbol:undefined,currentAnchor:undefined,currentPoint:undefined,targetSymbol:undefined,targetAnchor:undefined,targetPoint:undefined,linkObjectClass:undefined,linkObjectReference:undefined,linkObjectParam:undefined,linkObjectParent:undefined,linkSymbolClass:undefined,linkSymbolParam:undefined,linkSymbolParent:undefined,isCanDrag:false,isDragging:false,dragLineShape:undefined,transitionDefinition:undefined,cursor:undefined,overlayPanelShape:undefined,isContextButton:false,cursorShape:undefined},methods:{onSelected:function(){if(!this.editor.isReadOnly){this.isContextButton=false;this.createOverlayPanel();this.addEventHandlers()}},onUnselected:function(){this.removeEventHandlers();if(this.overlayPanelShape){this.overlayPanelShape.dispose();this.overlayPanelShape=undefined}if(this.cursorShape){this.cursorShape.dispose();this.cursorShape=undefined}this.isDragging=false;if(this.cursor&&this.cursor.dispose){this.cursor.dispose();this.cursor=undefined}if(this.dragLineShape){this.dragLineShape.dispose();this.dragLineShape=undefined}if(this._sourceExtremityHighlighter){this._sourceExtremityHighlighter.dispose();this._sourceExtremityHighlighter=undefined}if(this._targetExtremityHighlighter){this._targetExtremityHighlighter.dispose();this._targetExtremityHighlighter=undefined}},createCursor:function(x,y){if(this.cursor){this.cursorShape=new sap.galilei.ui.common.shape.Image({x:x-this.cursorWidth/2,y:y-this.cursorHeight/2,width:this.cursorWidth,height:this.cursorHeight,href:this.cursor})}else{if(this.symbolClassDefinition){var oSymbolLayout=sap.galilei.ui.diagram.Symbol.getOrCreateSymbolLayout(this.symbolClassDefinition),oShape,sOrientation=this.symbolClassDefinition.runtimeClass.defaultOrientation,nSize;if(oSymbolLayout){oShape=oSymbolLayout.createShape();if(oShape){if(oShape.mainShape){this.cursorShape=oShape.mainShape;if(!oShape.mainShape.isGroup){oShape.mainShape.width-=8;oShape.mainShape.height-=8}if(sOrientation&&sOrientation!==this.editor.orientation){nSize=oShape.mainShape.width;oShape.mainShape.width=oShape.mainShape.height;oShape.mainShape.height=nSize}this.cursorWidth=oShape.mainShape.width;this.cursorHeight=oShape.mainShape.height}else{this.cursorShape=oShape;if(sOrientation&&sOrientation!==this.editor.orientation){nSize=oShape.width;oShape.width=oShape.height;oShape.height=nSize}this.cursorWidth=oShape.width;this.cursorHeight=oShape.height}if(oShape.mainShape.isGroup){this.cursorShape.x=-this.cursorWidth/2;this.cursorShape.y=-this.cursorHeight/2}this.cursorShape.opacity=0.6;this.cursorShape.transform="translate("+x+","+y+")"}}}}if(this.cursorShape){this.cursorShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}},updateCursor:function(oEvent){if(oEvent){var aViewPoint=this.viewer.normalizePointerEvent(oEvent,true),oRect,aPoint;if(!this.cursorShape){this.createCursor(aViewPoint[0],aViewPoint[1])}else{oRect=new sap.galilei.ui.common.Rect(aViewPoint[0]-this.cursorWidth/2,aViewPoint[1]-this.cursorHeight/2,this.cursorWidth,this.cursorHeight);if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(oRect,true,undefined,false,this.cursor!==undefined)}this.dropBBox=oRect;this.dropPoint=this.dropBBox.getCenter();if(this.editor.snapToGrid){this.dropPoint=sap.galilei.ui.common.Point.snapToGrid(this.dropPoint,this.editor.gridSize)}aPoint=[oRect.x,oRect.y];if(this.cursor){this.cursorShape.x=aPoint[0];this.cursorShape.y=aPoint[1];this.cursorShape.updateDrawing(this.viewer,undefined,["x","y"])}else{this.cursorShape.transform="translate("+aPoint[0]+","+aPoint[1]+")";this.cursorShape.updateDrawing(this.viewer,undefined,["transform"])}}}},updateLinkToolsDefinition:function(){this.sourceSymbolClasses=[];this.targetSymbolClasses=[];if(this.linksDefinition){var index,oLinkToolDef;for(index=0;index<this.linksDefinition.length;index++){oLinkToolDef=this.linksDefinition[index];if(this.sourceSymbolClasses.indexOf(oLinkToolDef.sourceSymbol)===-1){this.sourceSymbolClasses.push(oLinkToolDef.sourceSymbol)}if(this.targetSymbolClasses.indexOf(oLinkToolDef.targetSymbol)===-1){this.targetSymbolClasses.push(oLinkToolDef.targetSymbol)}}}},createOverlayPanel:function(){if(!this.overlayPanelShape){var oLayer=this.viewer.getLayerByName(sap.galilei.ui.common.svg.Layer.FOREGROUND_POINTER_LAYER);this.overlayPanelShape=new sap.galilei.ui.common.shape.Rectangle({width:this.viewer.viewWidth,height:this.viewer.viewHeight,opacity:0,fill:"white"});this.overlayPanelShape.draw(this.viewer,oLayer.d3Layer)}if(!this.transitionDefinition){this.transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:200})}if(this.cursor){this.setCursor(this.cursor)}},setCursor:function(sCursor){if(this.overlayPanelShape&&this.overlayPanelShape.isDrawn&&sCursor){this.overlayPanelShape.d3Node.node().style.cursor=sCursor}},canSupportSourceSymbol:function(oSourceSymbol){var sQualifiedName,index;if(oSourceSymbol&&!this.editor.isReadOnly){sQualifiedName=oSourceSymbol.classDefinition.qualifiedName;if(this.sourceSymbolClasses){for(index=0;index<this.sourceSymbolClasses.length;index++){if(sQualifiedName===this.sourceSymbolClasses[index]){return true}}for(index=0;index<this.sourceSymbolClasses.length;index++){if(sap.galilei.model.isTypeOf(sQualifiedName,this.sourceSymbolClasses[index])){return true}}}}return false},canSupportTargetSymbol:function(oTargetSymbol){var sQualifiedName,index;if(oTargetSymbol&&!this.editor.isReadOnly){sQualifiedName=oTargetSymbol.classDefinition.qualifiedName;if(this.targetSymbolClasses){for(index=0;index<this.targetSymbolClasses.length;index++){if(sQualifiedName===this.targetSymbolClasses[index]){return true}}for(index=0;index<this.targetSymbolClasses.length;index++){if(sap.galilei.model.isTypeOf(sQualifiedName,this.targetSymbolClasses[index])){return true}}}}return false},canConnectSourceSymbol:function(oSourceSymbol,aPoint){var aAnchors,index,oAnchor,oClosestAnchor,nDistance,nShortestDistance,aAnchorPoint;if(oSourceSymbol&&aPoint){if(!this.canSupportSourceSymbol(oSourceSymbol)){return false}aAnchors=this.getSourceAnchors(oSourceSymbol);for(index=0;index<aAnchors.length;index++){oAnchor=aAnchors[index];if(oAnchor&&oAnchor.isSupportSource){if(oAnchor.isPointInAnchor(aPoint)){oClosestAnchor=oAnchor;break}else{if(!oClosestAnchor){oClosestAnchor=oAnchor;nShortestDistance=sap.galilei.ui.common.Point.getDistance(aPoint,oAnchor.anchorCenter)}else{nDistance=sap.galilei.ui.common.Point.getDistance(aPoint,oAnchor.anchorCenter);if(nDistance<nShortestDistance){nShortestDistance=nDistance;oClosestAnchor=oAnchor}}}}}if(oClosestAnchor&&(nShortestDistance===undefined||nShortestDistance<=20)){aAnchorPoint=oClosestAnchor.getAnchorPoint(aPoint);aPoint[0]=aAnchorPoint[0];aPoint[1]=aAnchorPoint[1];this.sourceSymbol=oSourceSymbol;this.sourceAnchor=oClosestAnchor;this.sourcePoint=aPoint;return true}}return false},canConnectTargetSymbol:function(oTargetSymbol,aPoint){var oLinkTool,aAnchors,index,oAnchor,oClosestAnchor,nDistance,nShortestDistance,aAnchorPoint;if(oTargetSymbol&&aPoint){if(!this.canSupportTargetSymbol(oTargetSymbol)){return false}if(!this.canCreateLinkSymbol(this.sourceSymbol,oTargetSymbol)){return false}aAnchors=this.getTargetAnchors(oTargetSymbol);for(index=0;index<aAnchors.length;index++){oAnchor=aAnchors[index];if(oAnchor&&oAnchor.isSupportTarget){if(oAnchor.isPointInAnchor(aPoint)){oClosestAnchor=oAnchor;break}else{if(!oClosestAnchor){oClosestAnchor=oAnchor;nShortestDistance=sap.galilei.ui.common.Point.getDistance(aPoint,oAnchor.anchorCenter)}else{nDistance=sap.galilei.ui.common.Point.getDistance(aPoint,oAnchor.anchorCenter);if(nDistance<nShortestDistance){nShortestDistance=nDistance;oClosestAnchor=oAnchor}}}}}if(oClosestAnchor&&(nShortestDistance===undefined||nShortestDistance<=20)){aAnchorPoint=oClosestAnchor.getAnchorPoint(aPoint);aPoint[0]=aAnchorPoint[0];aPoint[1]=aAnchorPoint[1];this.targetSymbol=oTargetSymbol;this.targetAnchor=oClosestAnchor;this.targetPoint=aPoint;return true}}return false},getLinkSymbolDefinitions:function(oSourceSymbol,oTargetSymbol){if(oSourceSymbol&&oTargetSymbol){var index,aLinkToolDefs,oLinkToolDef,sQualifiedSourceName,sQualifiedTargetName;for(index=0;index<this.linksDefinition.length;index++){oLinkToolDef=this.linksDefinition[index];sQualifiedSourceName=oSourceSymbol.classDefinition.qualifiedName;sQualifiedTargetName=oTargetSymbol.classDefinition.qualifiedName;if((sQualifiedSourceName===oLinkToolDef.sourceSymbol||sap.galilei.model.isTypeOf(sQualifiedSourceName,oLinkToolDef.sourceSymbol))&&(sQualifiedTargetName===oLinkToolDef.targetSymbol||sap.galilei.model.isTypeOf(sQualifiedTargetName,oLinkToolDef.targetSymbol))){if(aLinkToolDefs===undefined){aLinkToolDefs=[]}aLinkToolDefs.push(oLinkToolDef)}}return aLinkToolDefs}return undefined},selectLinkSymbolDefinition:function(oSourceSymbol,oTargetSymbol){var aLinkTools,index,oLinkTool,aValidLinkTools;aLinkTools=this.getLinkSymbolDefinitions(oSourceSymbol,oTargetSymbol);if(aLinkTools){for(index=0;index<aLinkTools.length;index++){oLinkTool=aLinkTools[index];if(this.editor.canCreateLinkSymbol(oSourceSymbol,oTargetSymbol,oLinkTool)){if(aValidLinkTools===undefined){aValidLinkTools=[]}aValidLinkTools.push(oLinkTool)}}if(aValidLinkTools&&aValidLinkTools.length>0){return aValidLinkTools[0]}}return undefined},canCreateLinkSymbol:function(oSourceSymbol,oTargetSymbol){var oLinkTool;oLinkTool=this.selectLinkSymbolDefinition(oSourceSymbol,oTargetSymbol);if(oLinkTool){this.linkSymbolClass=oLinkTool.linkSymbolClass;this.linkSymbolParam=oLinkTool.linkSymbolParam;this.linkSymbolParent=sap.galilei.ui.diagram.LinkSymbol.getLinkSymbolOwner(oSourceSymbol,oTargetSymbol);this.linkObjectClass=oLinkTool.linkObjectClass;this.linkObjectParam=oLinkTool.linkObjectParam;this.linkObjectReference=oLinkTool.linkObjectReference;this.linkObjectParent=this.editor.getParentObjectByParentSymbol(this.linkSymbolParent,this.linkObjectClass);return true}return false},getSymbolByPoint:function(aPoint,bSource,bGetAnchor){var oSymbolDef,oSymbol,oAnchor,aAnchorPoint;if(aPoint){oSymbol=this.editor.getSymbolByPoint(aPoint[0],aPoint[1],this.viewer.mainShapeLayer.d3Layer,true);if(oSymbol){oSymbolDef={};oSymbolDef.symbol=oSymbol;if(bGetAnchor){oAnchor=this.getAnchorByPoint(oSymbol,aPoint,bSource);if(oAnchor){aAnchorPoint=oAnchor.getAnchorPoint(aPoint);oSymbolDef.anchor=oAnchor;oSymbolDef.anchorPoint=aAnchorPoint}}}}return oSymbolDef},getAnchorByPoint:function(oSymbol,aPoint,bSource){var aAnchors,oClosestAnchor;if(oSymbol&&aPoint){aAnchors=oSymbol.getAnchors();if(aAnchors){oClosestAnchor=this.getClosestAnchor(aAnchors,aPoint,bSource)}}return oClosestAnchor},getClosestAnchor:function(aAnchors,aPoint,bSource){var index,oAnchor,oClosestAnchor,nShortestDistance,nDistance;if(aAnchors){for(index=0;index<aAnchors.length;index++){oAnchor=aAnchors[index];if(oAnchor&&((bSource&&oAnchor.isSupportSource)||(!bSource&&oAnchor.isSupportTarget))){if(oAnchor.isPointInAnchor(aPoint)){oClosestAnchor=oAnchor;break}else{if(!oClosestAnchor){oClosestAnchor=oAnchor;nShortestDistance=sap.galilei.ui.common.Point.getDistance(aPoint,oAnchor.anchorCenter)}else{nDistance=sap.galilei.ui.common.Point.getDistance(aPoint,oAnchor.anchorCenter);if(nDistance<nShortestDistance){nShortestDistance=nDistance;oClosestAnchor=oAnchor}}}}}if(oClosestAnchor&&(nShortestDistance===undefined||nShortestDistance<=20)){return oClosestAnchor}}return undefined},getSourceAnchors:function(oSymbol){if(oSymbol){if(this.sourceSymbol!==oSymbol){if(this._sourceAnchors){this.hideAnchors(this._sourceAnchors)}this._sourceAnchors=oSymbol.getAnchors();this.showAnchors(this._sourceAnchors)}}return this._sourceAnchors},getTargetAnchors:function(oSymbol){if(oSymbol){if(this.currentSymbol!==oSymbol){if(this._targetAnchors){this.hideAnchors(this._targetAnchors)}this._targetAnchors=oSymbol.getAnchors();this.showAnchors(this._targetAnchors)}}return this._targetAnchors},showAnchors:function(aAnchors){},hideAnchors:function(aAnchors){},highlightAnchor:function(oAnchor){},unhighlightAnchor:function(oAnchor){},getOrCreateSourceExtremityHighlighter:function(){if(!this._sourceExtremityHighlighter){this._sourceExtremityHighlighter=new sap.galilei.ui.editor.tracker.ExtremitySymbolHighlighter({editor:this.editor,highlightDiagram:false,forceHighlightAttachPoints:true,radius:10,highlightColor:sap.galilei.ui.common.style.Color.lightgreen,strokeWidth:4})}return this._sourceExtremityHighlighter},getOrCreateTargetExtremityHighlighter:function(){if(!this._targetExtremityHighlighter){this._targetExtremityHighlighter=new sap.galilei.ui.editor.tracker.ExtremitySymbolHighlighter({editor:this.editor,highlightDiagram:false,forceHighlightAttachPoints:true,radius:10,highlightColor:sap.galilei.ui.common.style.Color.lightgreen,strokeWidth:4})}return this._targetExtremityHighlighter},onPointerDown:function(oEvent){if(oEvent&&!this.editor.isReadOnly){oEvent.preventDefault();oEvent.stopPropagation();var aClientPoint,aViewPoint,oSourceSymbol;aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);if(this._sourceExtremityHighlighter){if(this._sourceExtremityHighlighter.highlighted){oSourceSymbol=this._sourceExtremityHighlighter.highlighted;if(oSourceSymbol){this.isCanDrag=true;this.sourcePoint=this._sourceExtremityHighlighter.highlightedAttachPoint?this._sourceExtremityHighlighter.highlightedAttachPoint:aViewPoint;this.highlightAnchor(this.sourceAnchor);if(this.cursorShape){this.cursorShape.hide(this.viewer,this.transitionDefinition)}}this._sourceExtremityHighlighter.dispose();this._sourceExtremityHighlighter=undefined}}else{if(this.isContextButton&&oEvent.contextButtonSymbol){oSourceSymbol=oEvent.contextButtonSymbol}else{oSourceSymbol=this.editor.getSymbolByPoint(aClientPoint[0],aClientPoint[1],undefined,true)}if(oSourceSymbol){if(this.canConnectSourceSymbol(oSourceSymbol,aViewPoint)){this.highlightAnchor(this.sourceAnchor);this.isCanDrag=true;if(this.cursorShape){this.cursorShape.hide(this.viewer,this.transitionDefinition)}}}}}},onPointerMove:function(oEvent){if(oEvent&&!this.editor.isReadOnly&&!this.isCanDrag){var self=this,aClientPoint,oHighlighter,aViewPoint;this.updateCursor(oEvent);aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);oHighlighter=this.getOrCreateSourceExtremityHighlighter();oHighlighter.highlight(aClientPoint[0],aClientPoint[1],function(oSymbol){return oSymbol.isLinkSymbol||!self.canConnectSourceSymbol(oSymbol,aViewPoint)})}},onPointerUp:function(oEvent){if(oEvent&&!this.editor.isReadOnly){if(this.isCanDrag&&!this.isDragging){this.onRelease(oEvent)}}},onDragStart:function(oEvent){if(oEvent&&!this.editor.isReadOnly&&this.isCanDrag){this.isDragging=true;if(!this.dragLineShape){this.dragLineShape=new sap.galilei.ui.common.shape.Line({x1:this.sourcePoint[0],y1:this.sourcePoint[1],x2:this.sourcePoint[0],y2:this.sourcePoint[1],stroke:sap.galilei.ui.common.style.Color.orange,strokeDashArray:"3,3",strokeWidth:2});this.dragLineShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}}},onDrag:function(oEvent){if(oEvent&&!this.editor.isReadOnly&&this.isDragging){var aClientPoint,aViewPoint,oTargetSymbol,oHighlighter,self=this;aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);oHighlighter=this.getOrCreateTargetExtremityHighlighter();if(oHighlighter){oHighlighter.highlight(aClientPoint[0],aClientPoint[1],function(oSymbol){return oSymbol.isLinkSymbol||!self.canConnectTargetSymbol(oSymbol,aViewPoint)});oTargetSymbol=oHighlighter.highlighted;if(oTargetSymbol){this.currentSymbol=this.targetSymbol;this.currentAnchor=this.targetAnchor;this.currentPoint=this.targetPoint;this.targetSymbol=undefined;this.targetAnchor=undefined;this.targetPoint=undefined;this.highlightAnchor(this.currentAnchor)}else{if(this.currentSymbol){this.hideAnchors(this._targetAnchors);this.currentSymbol=undefined;this.currentAnchor=undefined;this.currentPoint=undefined;delete this._targetAnchors}}}this.dragLineShape.x2=Math.abs(aViewPoint[0]-this.dragLineShape.x1)<sap.galilei.ui.common.layout.PointsLayout.ELBOW_DISTANCE?this.dragLineShape.x1:aViewPoint[0];this.dragLineShape.y2=Math.abs(aViewPoint[1]-this.dragLineShape.y1)<sap.galilei.ui.common.layout.PointsLayout.ELBOW_DISTANCE?this.dragLineShape.y1:aViewPoint[1];this.dragLineShape.updateDrawing(this.viewer,undefined,["x2","y2"])}},onDragEnd:function(oEvent){if(oEvent&&!this.editor.isReadOnly&&this.isDragging){var aClientPoint,aViewPoint,oTargetSymbol,oLinkSymbol;aClientPoint=this.viewer.normalizePointerEvent(oEvent,false);aViewPoint=this.viewer.clientPointToViewPoint(aClientPoint);if(this._targetExtremityHighlighter){oTargetSymbol=this._targetExtremityHighlighter.highlighted;if(oTargetSymbol){this.targetSymbol=oTargetSymbol;this.targetPoint=this._targetExtremityHighlighter.highlightedAttachPoint?this._targetExtremityHighlighter.highlightedAttachPoint:((this.dragLineShape&&this.dragLineShape.x2!==undefined&&this.dragLineShape.y2!==undefined)?[this.dragLineShape.x2,this.dragLineShape.y2]:aViewPoint);oLinkSymbol=this.createLinkSymbol()}this._targetExtremityHighlighter.dispose();this._targetExtremityHighlighter=undefined}this.onRelease(oEvent);this.editor.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME,false)}},onRelease:function(oEvent){this.isCanDrag=false;this.isDragging=false;if(this.dragLineShape){this.dragLineShape.dispose();this.dragLineShape=undefined}this.unhighlightAnchor(this.sourceAnchor);this.unhighlightAnchor(this.currentAnchor);this.sourceSymbol=undefined;this.targetSymbol=undefined;this.currentSymbol=undefined;this.sourceAnchor=undefined;this.targetAnchor=undefined;this.currentAnchor=undefined;this.sourcePoint=undefined;this.targetPoint=undefined;this.hideAnchors(this._sourceAnchors);this.hideAnchors(this._targetAnchors);delete this._sourceAnchors;delete this._targetAnchors},createLinkSymbol:function(){var self=this,oLinkSymbolParam=this.linkSymbolParam||{},aPoints=new sap.galilei.ui.common.Points(),oLinkSymbol;aPoints.add(this.sourcePoint);aPoints.add(this.targetPoint);oLinkSymbolParam.points=aPoints;function createLinkSymbolAction(){oLinkSymbol=self.editor.createLinkSymbolAndObject(self.sourceSymbol,self.targetSymbol,self.linkSymbolClass,oLinkSymbolParam,self.linkSymbolParent,self.linkObjectClass,self.linkObjectParam,self.linkObjectParent,self.linkObjectReference);if(oLinkSymbol){oLinkSymbol.updateOwner();oLinkSymbol.updateLinkRouting(true);self.editor.postCreateLinkSymbol(self.sourceSymbol,self.targetSymbol,oLinkSymbol);self.editor.drawSymbol(oLinkSymbol)}}this.resource.applyUndoableAction(createLinkSymbolAction,"Create Link Symbol");if(oLinkSymbol&&oLinkSymbol.parentSymbol&&oLinkSymbol.parentSymbol.symbols.length===1){this.editor.updateSymbolDrawingOrder(this.transitionDefinition)}return oLinkSymbol},addEventHandlers:function(){if(this.overlayPanelShape){this.overlayPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDown,this);this.overlayPanelShape.on(sap.galilei.ui.common.PointerEvents.pointermove,this.onPointerMove,this);this.overlayPanelShape.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUp,this);this.overlayPanelShape.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStart,this);this.overlayPanelShape.on(sap.galilei.ui.common.GestureEvents.drag,this.onDrag,this);this.overlayPanelShape.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEnd,this)}},removeEventHandlers:function(){if(this.overlayPanelShape){this.overlayPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDown,this);this.overlayPanelShape.off(sap.galilei.ui.common.PointerEvents.pointermove,this.onPointerMove,this);this.overlayPanelShape.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUp,this);this.overlayPanelShape.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStart,this);this.overlayPanelShape.off(sap.galilei.ui.common.GestureEvents.drag,this.onDrag,this);this.overlayPanelShape.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEnd,this)}}}});
"use strict";sap.galilei.ui.editor.tool.LassoTool=sap.galilei.ui.editor.tool.defineTool({fullClassName:"sap.galilei.ui.editor.tool.LassoTool",statics:{NAME:sap.galilei.ui.editor.tool.Types.lassoTool},toolName:sap.galilei.ui.editor.tool.Types.lassoTool,toolType:sap.galilei.ui.editor.tool.Types.tool});
"use strict";sap.galilei.ui.editor.tool.PointerTool=sap.galilei.ui.editor.tool.defineTool({fullClassName:"sap.galilei.ui.editor.tool.PointerTool",statics:{NAME:sap.galilei.ui.editor.tool.Types.pointerTool},toolName:sap.galilei.ui.editor.tool.Types.pointerTool,toolType:sap.galilei.ui.editor.tool.Types.tool});
"use strict";sap.galilei.ui.editor.widget.ContextButton=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.editor.widget.ContextButton",parent:sap.galilei.ui.common.widget.Button,widgetName:"ContextButton",properties:{contextButtonPad:undefined,popupContextButtonPad:undefined,editor:{field:"_editor",get:function(){if(this.contextButtonPad){return this.contextButtonPad.editor}else{return this._editor}},set:function(oEditor){this._editor=oEditor}},viewer:{get:function(){if(this.editor){return this.editor.viewer}return undefined}},diagram:{get:function(){if(this.editor){return this.editor.diagram}return undefined}},resource:{get:function(){if(this.diagram){return this.diagram.resource}return undefined}},commandName:undefined,toolName:undefined,isCreateNodeSymbol:false,isCreateLinkSymbol:false,isDragging:false,isDragged:false},methods:{onPointerDown:function(oEvent,oSourceSymbol){this.viewer.gotFocus();if(oEvent&&!this.editor.isReadOnly){if(oEvent){if(oEvent.preventDefault){oEvent.preventDefault()}if(oEvent.stopPropagation){oEvent.stopPropagation()}}var oTool,oCommand,oBBox;if(this.toolName){oTool=sap.galilei.ui.editor.tool.getTool(this.toolName)}else{if(this.commandName){oCommand=sap.galilei.ui.common.command.getCommand(this.commandName)}}if(oCommand&&oCommand.execute){oCommand.executeCommand({source:this,editor:this.editor,diagram:this.diagram,symbol:oSourceSymbol});if(this.contextButtonPad&&!this.popupContextButtonPad){this.contextButtonPad.hideWidget()}}else{if(oTool&&!oSourceSymbol){if(this.contextButtonPad){this.contextButtonPad.hideWidget()}this.editor.selectTool(this.toolName,false)}else{if(oTool&&oSourceSymbol){this.isDragging=true;this.isDragged=false}}}if(this.popupContextButtonPad){if(!this.popupContextButtonPad.isDrawn){this.popupContextButtonPad.createContextButtonPad();oBBox=this.popupContextButtonPad.getBBox();if(oBBox&&oBBox.width!==0&&oBBox.height!==0){oBBox=this.viewer.clientBBoxToViewBBox(oBBox,false,true);this.viewer.zoomToRect(oBBox.x,oBBox.y,oBBox.width,oBBox.height,true,false)}}else{if(this.popupContextButtonPad.isHidden){this.popupContextButtonPad.showWidget()}else{this.popupContextButtonPad.removeContextButtonPad()}}}}},onPointerUp:function(oEvent,oSourceSymbol){if(oEvent&&!this.editor.isReadOnly){var oTool,oSymbolBBox,oClientBBox,aViewPoint,aClientPoint,oHighlighter,oLinks,index,oLinkSymbol,sEventType;if(this.isDragging){if(!this.isDragged&&this.toolName&&this.isCreateNodeSymbol){oTool=sap.galilei.ui.editor.tool.getTool(this.toolName);if(oTool){oTool.onDelayedInitialize();if(!oTool.cursorShape){if(oEvent._clientX!==undefined&&oEvent._clientY!==undefined){oTool.createCursor(oEvent._clientX,oEvent._clientY)}else{oTool.createCursor(oEvent.clientX,oEvent.clientY)}}oLinks=oSourceSymbol.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=0;index<oLinks.length;index++){if(oLinks[index].sourceSymbol===oSourceSymbol){if(oLinkSymbol){oLinkSymbol=undefined;break}oLinkSymbol=oLinks[index]}}}if(oLinkSymbol){aViewPoint=oLinkSymbol.getCenter();oSymbolBBox=new sap.galilei.ui.common.Rect(0,0,oTool.cursorWidth,oTool.cursorHeight);oSymbolBBox.setCenter(aViewPoint[0],aViewPoint[1]);oHighlighter=oTool.getOrCreateParentHighlighter();if(oHighlighter){oHighlighter._highlighted=oLinkSymbol}}else{oSymbolBBox=oSourceSymbol.getBBox().clone();if(this.editor.orientation==="vertical"){oSymbolBBox.moveBy(0,oSymbolBBox.height/2+oTool.cursorHeight/2+50)}else{oSymbolBBox.moveBy(oSymbolBBox.width/2+oTool.cursorWidth/2+50,0)}aViewPoint=oSymbolBBox.getCenter();if(oSourceSymbol.parentSymbol){oHighlighter=oTool.getOrCreateParentHighlighter();if(oHighlighter){oHighlighter._highlighted=oSourceSymbol.isBoundarySymbol?oSourceSymbol.parentSymbol.parentSymbol:oSourceSymbol.parentSymbol}}}oTool.dropBBox=oSymbolBBox;oTool.dropPoint=aViewPoint;oClientBBox=this.viewer.viewBBoxToClientBBox(oSymbolBBox);aClientPoint=oClientBBox.getCenter();sEventType=oEvent._type?oEvent._type:oEvent.type;if(sap.galilei.ui.common.isMouseEvent(sEventType)){aClientPoint=this.viewer.clientPointToPagePoint(aClientPoint,true)}oEvent._clientX=aClientPoint[0];oEvent._clientY=aClientPoint[1];this.onDragStart(oEvent,oSourceSymbol);this.onDrag(oEvent,oSourceSymbol);this.onDragEnd(oEvent,oSourceSymbol)}}this.isDragging=false;this.isDragged=false}}},onDragStart:function(oEvent,oSourceSymbol){if(oEvent&&!this.editor.isReadOnly&&this.isDragging&&this.contextButtonPad&&this.toolName&&oSourceSymbol){this.contextButtonPad.hideWidget();this.editor.selectTool(this.toolName,false);if(this.editor.tool){this.isDragged=true;if(this.isCreateNodeSymbol){this.editor.tool.isContextButton=true}else{if(this.isCreateLinkSymbol&&this.editor.tool.onPointerDown&&this.editor.tool.onDragStart){var aViewPoint=oSourceSymbol.getBBox().getCenter(),aClientPoint;aClientPoint=this.viewer.viewPointToClientPoint(aViewPoint);oEvent.clientViewX=aViewPoint[0];oEvent.clientViewY=aViewPoint[1];oEvent._clientX=aClientPoint[0];oEvent._clientY=aClientPoint[1];oEvent._type="drag";this.editor.tool.isContextButton=true;oEvent.contextButtonSymbol=oSourceSymbol;this.editor.tool.onPointerDown(oEvent);this.editor.tool.onDragStart(oEvent)}}}}},onDrag:function(oEvent,oSourceSymbol){if(oEvent&&!this.editor.isReadOnly&&this.toolName&&this.isDragging&&this.contextButtonPad&&this.editor.tool&&oSourceSymbol){if(this.isCreateNodeSymbol){if(this.editor.tool.onDragOver){this.editor.tool.onDragOver(oEvent)}}else{if(this.isCreateLinkSymbol){if(this.editor.tool.onDrag){this.editor.tool.onDrag(oEvent)}}}}},onDragEnd:function(oEvent,oSourceSymbol){var self=this,oTargetSymbol,oLinkSymbolParams={},oLinkSymbol,oLinks,index,oLink,bCreateLink=true,oLinkTool;function createNodeAndLinkSymbolAction(){var oLinkSymbolOwner;oTargetSymbol=self.editor.tool.onDrop(oEvent);if(oTargetSymbol){oLinks=oTargetSymbol.getLinkSymbols();if(oLinks&&oLinks.length>0){for(index=0;index<oLinks.length;index++){oLink=oLinks[index];if((oLink.sourceSymbol===oSourceSymbol&&oLink.targetSymbol===oTargetSymbol)||(oLink.targetSymbol===oSourceSymbol&&oLink.sourceSymbol===oTargetSymbol)){bCreateLink=false;break}}}if(bCreateLink){oLinkTool=self.editor.selectLinkSymbolDefinition(oSourceSymbol,oTargetSymbol);if(oLinkTool){oLinkSymbolOwner=sap.galilei.ui.diagram.LinkSymbol.getLinkSymbolOwner(oSourceSymbol,oTargetSymbol);oLinkSymbol=self.editor.createLinkSymbolAndObject(oSourceSymbol,oTargetSymbol,oLinkTool.linkSymbolClass,oLinkSymbolParams,oLinkSymbolOwner,oLinkTool.linkObjectClass,oLinkTool.linkObjectParam,self.editor.getParentObjectByParentSymbol(oLinkSymbolOwner),oLinkTool.linkObjectReference);if(oLinkSymbol){oLinkSymbol.updateLinkRouting(false);self.editor.postCreateLinkSymbol(oSourceSymbol,oTargetSymbol,oLinkSymbol);self.editor.drawSymbol(oLinkSymbol)}}}}}if(oEvent&&!this.editor.isReadOnly&&this.toolName&&this.isDragging&&this.contextButtonPad&&this.editor.tool&&oSourceSymbol){if(this.isCreateNodeSymbol){if(this.editor.tool.onDrop){this.resource.applyUndoableAction(createNodeAndLinkSymbolAction,"Create Connected Symbol");this.editor.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME,false);if(oTargetSymbol){this.editor.unselectSymbol(oSourceSymbol);if(this.editor.selectSymbolAfterCreate){this.editor.selectSymbol(oTargetSymbol)}}else{this.contextButtonPad.showWidget()}}}else{if(this.isCreateLinkSymbol){if(this.editor.tool.onDragEnd){this.editor.tool.onDragEnd(oEvent);this.editor.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME,false);this.contextButtonPad.showWidget()}}}}this.isDragging=false}}});
"use strict";sap.galilei.ui.editor.widget.ContextButtonPad=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.editor.widget.ContextButtonPad",widgetName:"ContextButtonPad",parent:sap.galilei.ui.common.widget.ButtonPad,fields:{_popupIndex:-1},properties:{editor:undefined,viewer:{field:"_viewer",get:function(){if(this._viewer){return this._viewer}if(this.editor){return this.editor.viewer}return undefined},set:function(oViewer){this._viewer=oViewer}},diagram:{get:function(){if(this.editor){return this.editor.diagram}return undefined}},symbol:undefined},methods:{getContextButtonPadLocation:function(){var oRect,oCenter;if(this.buttonsDefinition&&(this.symbol||this.attachToBBox)){if(this.symbol&&!this.symbol.isLinkSymbol){oRect=this.symbol.getBBox();oRect=this.viewer.viewBBoxToClientBBox(oRect)}else{if(this.symbol&&this.symbol.isLinkSymbol){oRect=new sap.galilei.ui.common.Rect();oCenter=this.symbol.getCenter();oRect.setCenter(oCenter[0]-8,oCenter[1]);oRect=this.viewer.viewBBoxToClientBBox(oRect)}else{oRect=this.attachToBBox;if(oRect&&this.isBBoxViewCoordinates){oRect=this.viewer.viewBBoxToClientBBox(oRect)}}}if(oRect&&this.offsetX!==undefined&&this.offsetY!==undefined){oRect.moveBy(this.offsetX,this.offsetY)}}return oRect},createContextButtonPad:function(){if(this.buttonsDefinition&&(this.symbol||this.attachToBBox)){var oRect=this.getContextButtonPadLocation();if(oRect&&!this.editor.isReadOnly){if(!this.transitionDefinition){this.transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:200})}this.create(this.viewer,this.transitionDefinition,oRect,this.buttonsDefinition);this.addEventHandlers();if(this.viewer&&this.viewer.zoomScale<0.3){this.hide(this.viewer)}}}},createButton:function(oParam,oButtonParam){if(oParam&&oButtonParam&&(oButtonParam.toolName||oButtonParam.commandName)){var oTool,oCommand,oContextButton;if(oButtonParam.toolName){oTool=oCommand=sap.galilei.ui.editor.tool.getTool(oButtonParam.toolName)}else{if(oButtonParam.commandName){oCommand=sap.galilei.ui.common.command.getCommand(oButtonParam.commandName)}}if(oCommand&&!(this.editor.isReadOnly&&!oCommand.isReadOnly)){if(oCommand.canExecute&&!oCommand.canExecute({editor:this.editor,diagram:this.diagram,symbol:this.symbol})){return false}oParam.toolName=oButtonParam.toolName;oParam.commandName=oButtonParam.commandName;if(oTool){oParam.isCreateNodeSymbol=oTool.isCreateNodeSymbol;oParam.isCreateLinkSymbol=oTool.isCreateLinkSymbol}if(oButtonParam.toolName){oParam.id=oButtonParam.toolName.replace(/\./g,"-")}else{if(oButtonParam.commandName){oParam.id=oButtonParam.commandName.replace(/\./g,"-")}}oParam.outerFill="#D8D8D8";oParam.innerFill="#444444";oParam.isSupportHover=true;if(oParam.image===undefined&&oCommand.smallIcon){oParam.image=oCommand.smallIcon}if(oParam.imageWidth===undefined&&oCommand.smallIconWidth){oParam.imageWidth=oCommand.smallIconWidth}if(oParam.imageHeight===undefined&&oCommand.smallIconHeight){oParam.imageHeight=oCommand.smallIconHeight}if(oCommand.displayName){oParam.text=oCommand.displayName;oParam.textColor="white"}if(oButtonParam.items){oContextButton=new sap.galilei.ui.editor.widget.ContextButton(oParam);oContextButton.popupContextButtonPad=new sap.galilei.ui.editor.widget.ContextButtonPad({editor:this.editor,symbol:this.symbol,buttonsDefinition:oParam.buttonsDefinition})}else{oContextButton=new sap.galilei.ui.editor.widget.ContextButton(oParam)}oContextButton.contextButtonPad=this;oContextButton.on(sap.galilei.ui.common.PointerEvents.pointerdown,oContextButton.onPointerDown,oContextButton,this.symbol);oContextButton.on(sap.galilei.ui.common.PointerEvents.pointerup,oContextButton.onPointerUp,oContextButton,this.symbol);if(oContextButton.isCreateNodeSymbol||oContextButton.isCreateLinkSymbol){oContextButton.on(sap.galilei.ui.common.GestureEvents.dragstart,oContextButton.onDragStart,oContextButton,this.symbol);oContextButton.on(sap.galilei.ui.common.GestureEvents.drag,oContextButton.onDrag,oContextButton,this.symbol);oContextButton.on(sap.galilei.ui.common.GestureEvents.dragend,oContextButton.onDragEnd,oContextButton,this.symbol)}return oContextButton}}return undefined},getButtons:function(){var aButtons=[];if(this.shapes.length>0){aButtons=this.shapes[0].shapes}return aButtons},addEventHandlers:function(){sap.galilei.core.Event.subscribe("symbol.unselected",this.onUnselectSymbol,this);sap.galilei.core.Event.subscribe("symbols.selection.changed",this.onSelectionChanged,this);sap.galilei.core.Event.subscribe("move.symbol.dragstart",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("move.symbol.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("move.symbol.after",this.onAfterMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("delete.symbol",this.onDeleteSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.handle.dragstart",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.before",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.after",this.onAfterMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("resize.symbol.pinch",this.onBeforeMoveResizeSymbol,this);sap.galilei.core.Event.subscribe("viewer.zoompan.before",this.onBeforeZoomPan,this);sap.galilei.core.Event.subscribe("viewer.zoompan.after",this.onAfterZoomPan,this)},removeEventHandlers:function(){sap.galilei.core.Event.unSubscribeScope("symbol.unselected",this);sap.galilei.core.Event.unSubscribeScope("symbols.selection.changed",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.dragstart",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("move.symbol.after",this);sap.galilei.core.Event.unSubscribeScope("delete.symbol",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.handle.dragstart",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.before",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.after",this);sap.galilei.core.Event.unSubscribeScope("resize.symbol.pinch",this);sap.galilei.core.Event.unSubscribeScope("viewer.zoompan.before",this);sap.galilei.core.Event.unSubscribeScope("viewer.zoompan.after",this)},removeContextButtonPad:function(){this.removePopupButtonPad();this.remove(this.viewer);this.removeEventHandlers();this._popupIndex=-1;this.opacity=1;if(this._oldOpacity){delete this._oldOpacity}},removePopupButtonPad:function(){var aButtons=this.getButtons(),index,oButton;for(index=0;index<aButtons.length;index++){oButton=aButtons[index];if(oButton.popupContextButtonPad){oButton.popupContextButtonPad.removeContextButtonPad();oButton.popupContextButtonPad=undefined}}},getPopupButtonPadIndex:function(){var aButtons=this.getButtons(),index,oButton;for(index=0;index<aButtons.length;index++){oButton=aButtons[index];if(oButton.popupContextButtonPad&&oButton.popupContextButtonPad.isDrawn){return index}}return -1},updateContextButtonPad:function(){var nPopupIndex,oButton;nPopupIndex=this._popupIndex;this.removeContextButtonPad();this.createContextButtonPad();if(nPopupIndex!==-1){oButton=this.getPopupContextButtonPad(nPopupIndex);if(oButton&&oButton.onPointerDown){oButton.onPointerDown({},this.symbol);this._popupIndex=nPopupIndex}}},getPopupContextButtonPad:function(nPopupIndex){var aButtons,oButton;if(nPopupIndex===undefined){nPopupIndex=this._popupIndex}if(nPopupIndex!==-1){aButtons=this.getButtons();if(nPopupIndex<aButtons.length){oButton=aButtons[nPopupIndex]}}return oButton},showWidget:function(){this.show(this.viewer,this.transitionDefinition);this.showPopupButtonPad()},hideWidget:function(){this._popupIndex=this.getPopupButtonPadIndex();this.hide(this.viewer,this.transitionDefinition);this.hidePopupButtonPad()},showPopupButtonPad:function(){var aButtons=this.getButtons(),index,oButton;for(index=0;index<aButtons.length;index++){oButton=aButtons[index];if(oButton.popupContextButtonPad){oButton.popupContextButtonPad.show(this.viewer,this.transitionDefinition)}}},hidePopupButtonPad:function(){var aButtons=this.getButtons(),index,oButton;for(index=0;index<aButtons.length;index++){oButton=aButtons[index];if(oButton.popupContextButtonPad){oButton.popupContextButtonPad.hide(this.viewer,this.transitionDefinition)}}},onUnselectSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.removeContextButtonPad();delete this.symbol._contextButtonPad}},onSelectionChanged:function(oEvent){if(oEvent&&this.symbol&&oEvent.selectedSymbols&&oEvent.selectedSymbols.length>1){this.removeContextButtonPad();delete this.symbol._contextButtonPad}},onBeforeMoveResizeSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.hideWidget()}},onAfterMoveResizeSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.updateContextButtonPad()}},onDeleteSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol&&oEvent.sourceSymbol===this.symbol){this.dispose()}},onBeforeZoomPan:function(oEvent){if(oEvent&&this.symbol){this.hideWidget()}},onAfterZoomPan:function(oEvent){if(oEvent&&this.symbol){this.updateContextButtonPad()}},dispose:function(){this.removeContextButtonPad();if(this.symbol){delete this.symbol._contextButtonPad}}}});
"use strict";sap.galilei.ui.editor.widget.InPlaceEditControl=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.editor.widget.InPlaceEditControl",parent:sap.galilei.ui.editor.widget.Widget,widgetName:"InPlaceEditControl",initialize:function(oParam){if(oParam){this.set(oParam)}if(this.editor){this.viewer=this.editor.viewer}this.isHideOnUnselect=true;this.getTextBingings()},properties:{controlAdapterName:"sap.galilei.ui.editor.widget.HtmlInPlaceEditControlAdapter",editor:undefined,viewer:undefined,symbol:undefined,controlAdapter:undefined,bindings:undefined,bindingIndex:0},methods:{getOrCreateControlAdapter:function(){var InPlaceEditControlAdapterClass;if(!this.controlAdapter){if(this.controlAdapterName){InPlaceEditControlAdapterClass=sap.galilei.core.getClass(this.controlAdapterName);if(!InPlaceEditControlAdapterClass){InPlaceEditControlAdapterClass=sap.galilei.core.getClass("sap.galilei.ui.editor.widget.HtmlInPlaceEditControlAdapter")}if(InPlaceEditControlAdapterClass){this.controlAdapter=new InPlaceEditControlAdapterClass({editor:this.editor,viewer:this.viewer,symbol:this.symbol,bindings:this.bindings,bindingIndex:this.bindingIndex})}}}return this.controlAdapter},getTextBingings:function(){var aBindings=[];function getBindings(oShape){var sProperty;if(oShape&&oShape.name==="Text"&&oShape.isDrawn&&oShape.bindings){for(sProperty in oShape.bindings){if(sProperty==="text"){aBindings.push(oShape.bindings[sProperty])}}}oShape.shapes.forEach(function(oSubshape){getBindings(oSubshape)})}if(this.symbol){getBindings(this.symbol.shape)}this.bindings=aBindings},getFieldIndex:function(aClientPoint){var oControlAdapter=this.getOrCreateControlAdapter();if(oControlAdapter){return oControlAdapter.getFieldIndex(aClientPoint)}return -1},moveToField:function(nIndex){var oControlAdapter=this.getOrCreateControlAdapter();if(oControlAdapter){return oControlAdapter.moveToField(nIndex)}},createControl:function(){var oControlAdapter=this.getOrCreateControlAdapter(),bSuccess=false;if(this.bindings&&this.bindings.length>0&&oControlAdapter&&this.viewer&&this.symbol){bSuccess=oControlAdapter.createControl();if(bSuccess){this.removeEventHandlers();this.addEventHandlers()}}return bSuccess},draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){},updateDrawing:function(oViewer,oTransitionDef,aAttibutes){},showWidget:function(){var oControlAdapter=this.getOrCreateControlAdapter(),self=this;if(oControlAdapter&&this.viewer&&this.symbol){oControlAdapter.updatePosition();oControlAdapter.showControl();if(this._idTimer){clearTimeout(this._idTimer);this._idTimer=undefined}this._idTimer=setTimeout(function(){oControlAdapter.updatePosition();self._idTimer=undefined},200)}},hideWidget:function(){var oControlAdapter=this.getOrCreateControlAdapter();if(oControlAdapter){oControlAdapter.hideControl()}},removeWidget:function(){this.removeEventHandlers();this.hideWidget();var oControlAdapter=this.getOrCreateControlAdapter();if(oControlAdapter){oControlAdapter.removeControl()}},dispose:function(){this.removeWidget()}}});
"use strict";sap.galilei.ui.editor.widget.InPlaceEditControlAdapter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.widget.InPlaceEditControlAdapter",properties:{editor:undefined,viewer:undefined,symbol:undefined,bindings:undefined,bindingIndex:0,control:undefined,isMultiLine:false},methods:{createControl:function(){},updateControl:function(){},getBinding:function(){if(this.bindings&&this.bindings.length>0&&this.bindingIndex>=0&&this.bindingIndex<this.bindings.length){return this.bindings[this.bindingIndex]}return undefined},getPropertyMetadata:function(oInfo){if(oInfo&&oInfo.object&&oInfo.object.classDefinition&&oInfo.propertyName){return oInfo.object.classDefinition.getProperty(oInfo.propertyName)}return undefined},getFieldBBox:function(){var oBinding=this.getBinding(),oBBox,oTextBBox,x,y,width,height,aCenter;if(oBinding&&oBinding.shape&&this.viewer){oBBox=oBinding.shape.getBBox().clone();if(this.symbol&&this.symbol.x!==undefined&&this.symbol.y!==undefined){oBBox.moveBy(this.symbol.x,this.symbol.y)}oBBox=this.viewer.viewBBoxToClientBBox(oBBox,false,false,true);x=oBBox.x;y=oBBox.y;if(oBBox.width+10<oBBox.height){width=oBBox.height;height=oBBox.width}else{width=oBBox.width;height=oBBox.height}width-=4;height-=4;if(oBinding.shape.text&&width<oBinding.shape.text.length*8){width=oBinding.shape.text.length*8}if(width>400){width=400}else{if(width<100){width=100}}if(this.isMultiLine){if(height>100){height=100}else{if(height<16){height=16}}}else{height=16}oTextBBox=new sap.galilei.ui.common.Rect(x,y,width,height);aCenter=oBBox.getCenter();oTextBBox.setCenter(aCenter[0]-2,aCenter[1]-2);return oTextBBox}return oBBox},getFieldIndex:function(aClientPoint){if(this.bindings&&this.bindings.length>0){var index,oBinding,oBBox;for(index=0;index<this.bindings.length;index++){oBinding=this.bindings[index];oBBox=oBinding.shape.getBBox().clone();if(this.symbol&&this.symbol.x!==undefined&&this.symbol.y!==undefined){oBBox.moveBy(this.symbol.x,this.symbol.y)}oBBox=this.viewer.viewBBoxToClientBBox(oBBox,false,false);if(oBBox.isPointInRect(aClientPoint)){return index}}}return -1},moveToField:function(nIndex){if(this.bindings&&this.bindings.length>0&&nIndex!==this.bindingIndex){this.setPropertyValue();this.bindingIndex=nIndex;this.updateControl()}},moveToNextField:function(){var nNewIndex;if(this.control&&this.bindings&&this.bindings.length>0){if(this.bindingIndex<this.bindings.length-1){nNewIndex=this.bindingIndex+1}else{nNewIndex=0}this.moveToField(nNewIndex)}},moveToPreviousField:function(){var nNewIndex;if(this.control&&this.bindings&&this.bindings.length>0){if(this.bindingIndex>0){nNewIndex=this.bindingIndex-1}else{nNewIndex=this.bindings.length-1}this.moveToField(nNewIndex)}},updatePosition:function(){},addEventHandlers:function(){if(this.control){this.control.on("keydown",jQuery.proxy(this.onKeyDown,this));this.control.on("focus",jQuery.proxy(this.onFocus,this));this.control.on("focusout",jQuery.proxy(this.onFocusOut,this))}},removeEventHandlers:function(){if(this.control){this.control.off("keydown");this.control.off("focus");this.control.off("focusout")}},onFocus:function(){},onFocusOut:function(oKeyEvent){if(this.control){this.setPropertyValue();this.hideControl()}},onKeyDown:function(oKeyEvent){var bProcessed=false,bClose=false;if(this.control&&oKeyEvent){switch(oKeyEvent.keyCode){case 13:this.setPropertyValue();bClose=true;break;case 27:bProcessed=true;bClose=true;this.control.isCancelled=true;break;case 9:if(oKeyEvent.shiftKey){this.moveToPreviousField()}else{this.moveToNextField()}bProcessed=true;break}if(bProcessed){oKeyEvent.preventDefault();oKeyEvent.stopImmediatePropagation()}if(bClose){this.removeControl()}}},setFocus:function(){if(this.control&&this.control.focus){this.control.focus()}},setPropertyValue:function(){},showControl:function(){},hideControl:function(){},removeControl:function(){}}});sap.galilei.ui.editor.widget.HtmlInPlaceEditControlAdapter=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.widget.HtmlInPlaceEditControlAdapter",parent:sap.galilei.ui.editor.widget.InPlaceEditControlAdapter,methods:{createControl:function(){if(!this.control&&this.viewer&&this.viewer.parentNode){if(this.isMultiLine){$(this.viewer.parentNode).append('<textarea id="'+this.getEditControlId()+'" wrap="soft" spellcheck="true"/>')}else{$(this.viewer.parentNode).append('<input type="text" id="'+this.getEditControlId()+'" spellcheck="true"/>')}this.control=$("#"+this.getEditControlId());this.addEventHandlers()}if(this.control){this.control.isCancelled=false;this.updateControl()}return this.control!==undefined},getEditControlId:function(){if(this.isMultiLine){return"inPlaceEditControlTextArea"}else{return"inPlaceEditControlInput"}},updateControl:function(){var oBinding=this.getBinding(),oInfo,oProperty;if(this.control){this.updatePosition();if(oBinding){oInfo=oBinding.getObjectAndPropertyName();if(oInfo){oProperty=this.getPropertyMetadata(oInfo);this.control.attr("placeholder",oProperty?oProperty.displayName:oInfo.propertyName)}this.control.val(oBinding.getObjectProperty())}this.setFocus()}},onFocus:function(oKeyEvent){if(this.control){this.control.select()}},setPropertyValue:function(){var oBinding=this.getBinding();if(this.control&&oBinding){oBinding.setObjectProperty(this.control.val())}},updatePosition:function(){if(this.control&&this.viewer){var oBBox=this.getFieldBBox();if(oBBox){this.control.css("position","absolute").css("left",Math.ceil(oBBox.x)+"px").css("top",Math.ceil(oBBox.y)+"px").css("width",Math.floor(oBBox.width)+"px").css("height",Math.floor(oBBox.height)+"px").css("overflow","hidden")}}},showControl:function(){if(this.control&&this.viewer){var nScale=this.viewer.zoomScale;if(nScale>=0.5){this.control.fadeIn(200);this.control.focus()}}},hideControl:function(){if(this.control){this.control.fadeOut(100)}},removeControl:function(){if(this.control){this.removeEventHandlers();this.control.remove();this.control=undefined}}}});
"use strict";sap.galilei.ui.editor.util.DiagramComparer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.util.DiagramComparer",parent:sap.galilei.ui.editor.util.twinDiagramEditor,fields:{_matchSymbolsFunction:undefined,_compareSymbolsFunction:undefined,_objectIdGenerator:undefined,_symbolIdGenerator:undefined,_customContext:undefined,_objectActionIndex:undefined,_symbolActionIndex:undefined,_disableSelectionNotification:false,_selectionNotificationTimerId:undefined,_disableUnselectionNotification:false,_unselectionNotificationTimerId:undefined},properties:{compareResults:undefined,zoomPanDuration:500,transitionDuration:1000,createdColor:sap.galilei.ui.common.style.Color.lightgreen,deletedColor:sap.galilei.ui.common.style.Color.red,updatedColor:sap.galilei.ui.common.style.Color.orange,isShowSymbolDifferences:true},methods:{synchronize:function(){var self=this;function onSymbolSelected(oEvent){if(oEvent&&!this._disableSelectionNotification){if(this._selectionNotificationTimerId){clearTimeout(this._selectionNotificationTimerId)}this._disableSelectionNotification=true;this.selectSymbol(oEvent.editor,oEvent.sourceSymbol);this._selectionNotificationTimerId=setTimeout(function(){self._disableSelectionNotification=false;self._selectionNotificationTimerId=undefined},this.zoomPanDuration)}}function onSymbolUnselected(oEvent){if(oEvent&&!this._disableUnselectionNotification){if(this._unselectionNotificationTimerId){clearTimeout(this._unselectionNotificationTimerId)}this._disableUnselectionNotification=true;this.unselectSymbol(oEvent.editor,oEvent.sourceSymbol);setTimeout(function(){self._disableUnselectionNotification=false;self._unselectionNotificationTimerId=undefined},this.zoomPanDuration)}}if(!this._isSynchronized&&this.editor1&&this.editor2){this.defaultSynchronize();this.editor1.viewer.zoomDuration=this.editor2.viewer.zoomDuration=this.zoomPanDuration;this.editor1.viewer.panDuration=this.editor2.viewer.panDuration=this.zoomPanDuration;sap.galilei.core.Event.subscribe("symbol.selected",onSymbolSelected,this,this.editor1);sap.galilei.core.Event.subscribe("symbol.selected",onSymbolSelected,this,this.editor2);sap.galilei.core.Event.subscribe("symbol.unselected",onSymbolUnselected,this,this.editor1);sap.galilei.core.Event.subscribe("symbol.unselected",onSymbolUnselected,this,this.editor2)}},defaultGetObjectId:function(oObject){return oObject&&oObject.objectId},getObjectId:function(oObject){var fnIdGenerator=this._objectIdGenerator||this.defaultGetObjectId;return fnIdGenerator(oObject)},getSymbolId:function(oSymbol){var fnIdGenerator=this._symbolIdGenerator||this.defaultGetObjectId;return fnIdGenerator(oSymbol)},defaultMatchSymbols:function(oSymbol1,oSymbol2){var sId1=this.getSymbolId(oSymbol1),sId2=this.getSymbolId(oSymbol2);return sId1==sId2},defaultCompareSymbols:function(oSymbol1,oSymbol2){if(oSymbol1&&oSymbol2){if(oSymbol1.isLinkSymbol){if(oSymbol1.points){if(!oSymbol1.points.equals(oSymbol2.points)){return true}}if(oSymbol1.lineStyle!=oSymbol2.lineStyle){return true}}else{if(oSymbol1.x!=oSymbol2.x||oSymbol1.y!=oSymbol2.y||oSymbol1.width!=oSymbol2.width||oSymbol1.height!=oSymbol2.height||oSymbol1.displayMode!=oSymbol2.displayMode){return true}}}return false},defaultCompareDiagrams:function(oOptions){var aSymbols1,aSymbols2,i,max,oSymbol,bFound,oAction;this.compareResults=[];oOptions=oOptions||{};this._matchSymbolsFunction=oOptions.matchSymbolsFunction||this.defaultMatchSymbols;this._compareSymbolsFunction=oOptions.compareSymbolsFunction||this.defaultCompareSymbols;this._objectIdGenerator=oOptions.objectIdGenerator||this.defaultGetObjectId;this._symbolIdGenerator=oOptions.symbolIdGenerator||this.defaultGetObjectId;this._customContext=oOptions.context||this;if(this.editor1&&this.editor2){aSymbols1=this.editor1.getAllSymbols();aSymbols2=this.editor2.getAllSymbols();aSymbols1.forEach(function(oSymbol1){bFound=false;for(i=0,max=aSymbols2.length;i<max;i++){oSymbol=aSymbols2[i];if(this._matchSymbolsFunction.call(this._customContext,oSymbol1,oSymbol)){oAction={symbol1:oSymbol1,symbol2:oSymbol,isSymbolDifferences:true};if(this._compareSymbolsFunction.call(this._customContext,oSymbol1,oSymbol)){oAction.actionType="UPDATE"}else{oAction.actionType="NOCHNAGE"}this.compareResults.push(oAction);bFound=true;break}}if(!bFound){oAction={actionType:"DELETE",symbol1:oSymbol1,isSymbolDifferences:true};this.compareResults.push(oAction)}},this);aSymbols2.forEach(function(oSymbol2){bFound=false;for(i=0,max=aSymbols1.length;i<max;i++){oSymbol=aSymbols1[i];if(this._matchSymbolsFunction.call(this._customContext,oSymbol,oSymbol2)){bFound=true;break}}if(!bFound){oAction={actionType:"CREATE",symbol2:oSymbol2,isSymbolDifferences:true};this.compareResults.push(oAction)}},this);this.buildCompareResultIndex()}},compareDiagrams:function(oOptions){this.defaultCompareDiagrams(oOptions)},buildCompareResultIndex:function(){var i,max,oAction,self=this;this._objectActionIndex={};this._symbolActionIndex={};function addObjectIndex(oObject,index){var sId=self.getObjectId(oObject);if(sId){self._objectActionIndex[sId]=index}}function addSymbolIndex(oSymbol,index){var sId=self.getSymbolId(oSymbol);if(sId){self._symbolActionIndex[sId]=index}}if(this.compareResults){for(i=0,max=this.compareResults.length;i<max;i++){oAction=this.compareResults[i];if(oAction.object1){addObjectIndex(oAction.object1,i)}if(oAction.object2){addObjectIndex(oAction.object2,i)}if(oAction.symbol1){addSymbolIndex(oAction.symbol1,i)}if(oAction.symbol2){addSymbolIndex(oAction.symbol2,i)}}}},getObjectIndex:function(oObject){if(oObject&&this._objectActionIndex){var sId=this.getObjectId(oObject),index;if(sId){index=this._objectActionIndex[sId];if(index!==undefined){return index}}}return -1},getSymbolIndex:function(oSymbol){if(oSymbol&&this._symbolActionIndex){var sId=this.getSymbolId(oSymbol),index;if(sId){index=this._symbolActionIndex[sId];if(index!==undefined){return index}}}return -1},getObjectAction:function(oObject){var index=this.getObjectIndex(oObject);if(index!==-1&&this.compareResults){return this.compareResults[index]}return undefined},getSymbolAction:function(oSymbol){var index=this.getSymbolIndex(oSymbol);if(index!==-1&&this.compareResults){return this.compareResults[index]}return undefined},isSymbolDeleted:function(oSymbol){var index=this.getSymbolIndex(oSymbol),oAction,sAction;if(index!==-1){oAction=this.compareResults[index];if(oAction.isSymbolDifferences&&!this.isShowSymbolDifferences){return false}sAction=this.compareResults[index].actionType}return(sAction==="DELETE")},isSymbolCreated:function(oSymbol){var index=this.getSymbolIndex(oSymbol),oAction,sAction;if(index!==-1){oAction=this.compareResults[index];if(oAction.isSymbolDifferences&&!this.isShowSymbolDifferences){return false}sAction=this.compareResults[index].actionType}return(sAction==="CREATE")},isSymbolUpdated:function(oSymbol){var index=this.getSymbolIndex(oSymbol),oAction,sAction;if(index!==-1){oAction=this.compareResults[index];if(oAction.isSymbolDifferences&&!this.isShowSymbolDifferences){return false}sAction=this.compareResults[index].actionType}return(sAction==="UPDATE"||sAction==="INSERT"||sAction==="REMOVE")},highlightAllSymbols:function(){this.highlightSymbols(this.editor1);this.highlightSymbols(this.editor2)},highlightSymbols:function(oEditor){var oTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:2000}),aSymbols;if(oEditor&&this.compareResults){aSymbols=oEditor.getAllSymbols();aSymbols.forEach(function(oSymbol){this.highlightSymbol(oEditor,oSymbol,oTransitionDefinition)},this)}},highlightSymbol:function(oEditor,oSymbol,oTransitionDefinition){var bIsInitialdiagram=oEditor===this.editor1,bFound=false,oParam,oStyleSheet;if(oEditor&&oSymbol){if(!oTransitionDefinition){oTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:this.transitionDuration})}oParam={strokeWidth:5};if(bIsInitialdiagram){if(this.isSymbolDeleted(oSymbol)){oParam.stroke=this.deletedColor;oParam.fill=sap.galilei.ui.common.style.Color.getBrighterColor(this.deletedColor,0.8);bFound=true}else{if(this.isSymbolUpdated(oSymbol)){oParam.stroke=this.updatedColor;oParam.fill=sap.galilei.ui.common.style.Color.getBrighterColor(this.updatedColor,0.8);bFound=true}}}else{if(this.isSymbolCreated(oSymbol)){oParam.stroke=this.createdColor;oParam.fill=sap.galilei.ui.common.style.Color.getBrighterColor(this.createdColor,0.8);bFound=true}else{if(this.isSymbolUpdated(oSymbol)){oParam.stroke=this.updatedColor;oParam.fill=sap.galilei.ui.common.style.Color.getBrighterColor(this.updatedColor,0.8);bFound=true}}}if(bFound){oStyleSheet=new sap.galilei.ui.common.style.StyleSheet(oParam);oSymbol.highlight(oStyleSheet,undefined,oEditor.viewer,oTransitionDefinition)}else{this.grayOutSymbol(oEditor,oSymbol,oTransitionDefinition)}}},addSelectionFrame:function(oEditor,oSymbol){if(oEditor&&oSymbol){var oBoundaryShape=oSymbol.isLinkSymbol?oSymbol.shape:oSymbol.getBoundaryShape(),oTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:this.transitionDuration});if(oBoundaryShape){oBoundaryShape.filter="url(#filterSelectionGlow)";oBoundaryShape.updateDrawing(oEditor.viewer,oTransitionDefinition,["filter"])}}},removeSelectionFrame:function(oEditor,oSymbol){if(oEditor&&oSymbol){var oBoundaryShape=oSymbol.isLinkSymbol?oSymbol.shape:oSymbol.getBoundaryShape(),oTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:this.transitionDuration});if(oBoundaryShape){oBoundaryShape.filter=null;oBoundaryShape.updateDrawing(oEditor.viewer,oTransitionDefinition,["filter"])}}},grayOutSymbols:function(oEditor,aExcludeSymbols){var oTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:2000}),aSymbols;if(oEditor){aSymbols=oEditor.getAllSymbols();aSymbols.forEach(function(oSymbol){if(!aExcludeSymbols||aExcludeSymbols.indexOf(oSymbol)===-1){this.grayOutSymbol(oEditor,oSymbol,oTransitionDefinition)}},this)}},grayOutSymbol:function(oEditor,oSymbol,oTransitionDefinition){if(oEditor&&oSymbol){if(!oTransitionDefinition){oTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:this.transitionDuration})}oSymbol.grayOut(oEditor.viewer,oTransitionDefinition)}},selectSymbol:function(oEditor,oSymbol,bGrayOutOtherSymbols,bPreserveZoomScale,bCenterInView){var oAction=this.getSymbolAction(oSymbol),oOtherEditor,oOtherSymbol,oSymbol1,oSymbol2;if(oEditor&&oSymbol){if(!oSymbol.isSelected){oEditor.unselectAllSymbols(true,undefined);oEditor.selectSymbol(oSymbol)}this.addSelectionFrame(oEditor,oSymbol)}if(oAction){oOtherEditor=(oEditor===this.editor1)?this.editor2:this.editor1;oOtherSymbol=(oSymbol===oAction.symbol1)?oAction.symbol2:oAction.symbol1;if(oOtherEditor){oOtherEditor.unselectAllSymbols(true,undefined,oOtherSymbol);if(oOtherSymbol&&!oOtherSymbol.isSelected){oOtherEditor.selectSymbol(oOtherSymbol)}this.addSelectionFrame(oOtherEditor,oOtherSymbol)}}if(oEditor===this.editor1){oSymbol1=oSymbol;oSymbol2=oOtherSymbol}else{oSymbol1=oOtherSymbol;oSymbol2=oSymbol}if(bGrayOutOtherSymbols){this.grayOutSymbols(this.editor1,oSymbol1?[oSymbol1]:undefined);this.grayOutSymbols(this.editor2,oSymbol2?[oSymbol2]:undefined)}if(oSymbol1){this.highlightSymbol(this.editor1,oSymbol1)}if(oSymbol2){this.highlightSymbol(this.editor2,oSymbol2)}this.bringSymbolsToView(oSymbol1,oSymbol2,bPreserveZoomScale,bCenterInView)},unselectSymbol:function(oEditor,oSymbol){var oAction=this.getSymbolAction(oSymbol),oOtherEditor,oOtherSymbol;this.removeSelectionFrame(oEditor,oSymbol);if(oAction){oOtherEditor=(oEditor===this.editor1)?this.editor2:this.editor1;oOtherSymbol=(oSymbol===oAction.symbol1)?oAction.symbol2:oAction.symbol1;if(oOtherEditor&&oOtherSymbol&&oOtherSymbol.isSelected){this.removeSelectionFrame(oOtherEditor,oOtherSymbol);oOtherEditor.unselectSymbol(oOtherSymbol)}}},selectObject:function(oObject,bGrayOutOtherSymbols,bPreserveZoomScale,bCenterInView){var oAction=this.getObjectAction(oObject);if(oAction){if(oAction.symbol1){this.selectSymbol(this.editor1,oAction.symbol1,bGrayOutOtherSymbols,bPreserveZoomScale,bCenterInView)}else{if(oAction.symbol2){this.selectSymbol(this.editor2,oAction.symbol2,bGrayOutOtherSymbols,bPreserveZoomScale,bCenterInView)}}}},unselectAllObjects:function(){this.highlightAllSymbols()},dispose:function(){sap.galilei.core.Event.unSubscribeAllScope(this);this.compareResults=undefined;this._objectActionIndex=undefined;this._symbolActionIndex=undefined;this.editor1=undefined;this.editor2=undefined;this._isSynchronized=false}}});
"use strict";sap.galilei.ui.editor.DiagramEditor=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.DiagramEditor",initialize:function(oDiagram,sEditorSelector,oParam){if(!sEditorSelector){throw"Error: The parent node CSS selector must be specified."}this.diagram=oDiagram;this.setParentSelector(sEditorSelector);this.setViewerParameters(oParam,false);this.setExtensionParameters(oParam,false);this.preInitialization();if(oParam){this.set(oParam)}this.createViewer();this.createExtension();this.postInitialization();this.updateDiagram()},properties:{resource:{field:"_resource",get:function(){if(this._resource){return this._resource}if(this.model){return this.model.resource}if(this.diagram){return this.diagram.resource}return undefined},set:function(oResource){this._resource=oResource}},model:{field:"_model",get:function(){if(this._model){return this._model}if(this.diagram){return this.diagram.model||this.diagram.container}return undefined},set:function(oModel){this._model=oModel}},diagram:{field:"_diagram",get:function(){return this._diagram},set:function(oNewDiagram){this.changeDiagram(oNewDiagram)}},isReadOnly:{value:false,onChange:function(){var index,aSymbols=[];if(this.viewer&&this.selectedSymbols.length>0){for(index=0;index<this.selectedSymbols.length;index++){aSymbols.push(this.selectedSymbols[index])}this.unselectAllSymbols();this.selectSymbols(aSymbols)}if(this.tool){this.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME,false)}}},extension:undefined,extensionClass:undefined,extensionParam:undefined,parentNodeSelector:undefined,viewer:undefined,viewerClass:undefined,viewerParam:undefined,showGrid:{get:function(){if(this.viewer){return this.viewer.showGrid}return false},set:function(bValue){if(this.viewer){this.viewer.showGrid=bValue}}},gridSize:{get:function(){if(this.viewer){return this.viewer.gridSize}return false},set:function(nValue){if(this.viewer){this.viewer.gridSize=nValue;if(this.snapToGrid){this.unselectAllSymbols()}}}},snapToGrid:{field:"_snapToGrid",value:false,get:function(){return this._snapToGrid},set:function(bValue){this._snapToGrid=bValue;this.unselectAllSymbols()}},snapToShapes:{field:"_snapToShapes",value:true,get:function(){return this._snapToShapes},set:function(bValue){this._snapToShapes=bValue;this.unselectAllSymbols()}},snapToShapesCenter:true,snapToShapesBorder:true,useContextButtonPad:true,orientation:undefined,selectedSymbols:{type:sap.galilei.core.EnumPropertyType.collection,writable:false},tool:undefined,multiSelectionTracker:undefined,transitionDefinition:undefined,undoRedoTransitionDefinition:undefined,isActiveEditor:{get:function(){return sap.galilei.ui.editor.DiagramEditor.getActiveEditor()===this}},profile:{field:"_profile",get:function(){return this._profile},set:function(value){this._profile=value;if(this.extension){this.extension.onSetEditorProfile(value)}}},enablePreserveLinkAfterDelete:true,selectSymbolAfterCreate:true,enableInPlaceEditing:true,enableInPlaceEditingAfterCreate:true,inPlaceEditControlAdapterName:"sap.galilei.ui.editor.widget.HtmlInPlaceEditControlAdapter"},methods:{preInitialization:function(){},postInitialization:function(){var self=this;sap.galilei.core.Event.unSubscribeScope("update.symbol",this);sap.galilei.core.Event.subscribe("update.symbol",this.onUpdateSymbol,this);sap.galilei.core.Event.unSubscribeScope("delete.symbol",this);sap.galilei.core.Event.subscribe("delete.symbol",this.onDeleteSymbol,this);if(!this._symbolPointerTracker){this._symbolPointerTracker=new sap.galilei.ui.editor.tracker.SymbolPointerTracker({editor:this})}if(!this._linkSymbolPointerTracker){this._linkSymbolPointerTracker=new sap.galilei.ui.editor.tracker.LinkSymbolPointerTracker({editor:this})}if(!this._diagramPointerTracker){this._diagramPointerTracker=new sap.galilei.ui.editor.tracker.DiagramPointerTracker({editor:this})}if(!this.transitionDefinition){this.transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:200})}if(!this.undoRedoTransitionDefinition){this.undoRedoTransitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:500})}function onKeyDownCallback(oEvent){self.onKeyDown(oEvent)}if(!this._onKeyDownCallback){this._onKeyDownCallback=onKeyDownCallback;document.addEventListener("keydown",this._onKeyDownCallback,false)}this.registerDiagramEditor()},registerDiagramEditor:function(){var index;if(!sap.galilei.ui.editor.DiagramEditor.diagramEditors){sap.galilei.ui.editor.DiagramEditor.diagramEditors=[]}index=sap.galilei.ui.editor.DiagramEditor.diagramEditors.indexOf(this);if(index===-1){sap.galilei.ui.editor.DiagramEditor.diagramEditors.push(this)}},unregisterDiagramEditor:function(){var index;if(sap.galilei.ui.editor.DiagramEditor.diagramEditors){index=sap.galilei.ui.editor.DiagramEditor.diagramEditors.indexOf(this);if(index!==-1){sap.galilei.ui.editor.DiagramEditor.diagramEditors.splice(index,1)}}},onUpdateSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol){this.drawSymbol(oEvent.sourceSymbol)}},onDeleteSymbol:function(oEvent){if(oEvent&&oEvent.sourceSymbol){this.unselectSymbol(oEvent.sourceSymbol);this.unregisterSymbolEvents(oEvent.sourceSymbol)}},defaultOnKeyDown:function(oEvent){var self=this,bProcessed=false,index,oLayer,dx=0,dy=0,oSymbol,oTracker;if(this.viewer&&!this.viewer.hasFocus){return false}switch(oEvent.keyCode){case 90:if(oEvent.ctrlKey){this.undo();bProcessed=true}break;case 89:if(oEvent.ctrlKey){this.redo();bProcessed=true}break;case 46:this.deleteSelectedSymbols(true,this.enablePreserveLinkAfterDelete,true);bProcessed=true;break;case 65:if(oEvent.ctrlKey){this.selectAllSymbols(true);bProcessed=true}break;case 27:if(this.tool&&this.tool.name!==sap.galilei.ui.editor.tool.PointerTool.NAME){this.tool.onUnselected();this.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME,false);bProcessed=true}else{if(this.selectedSymbols.length>0){if(this.selectedSymbols.length===1){oSymbol=this.selectedSymbols[0];oTracker=oSymbol._tracker}else{oTracker=this.multiSelectionTracker}if(oTracker){oTracker.cancel()}}}break;case 37:case 39:case 38:case 40:if(this.selectedSymbols.length>0){if(!this._isDisableMoveSymbolByArrow){if(this.selectedSymbols.length===1){oSymbol=this.selectedSymbols[0];oTracker=oSymbol._tracker}else{oTracker=this.multiSelectionTracker}switch(oEvent.keyCode){case 37:dx=-10;break;case 39:dx=10;break;case 38:dy=-10;break;case 40:dy=10;break}if(oTracker&&oTracker.initialBBox){if(oTracker.getOrCreateParentHighlighter){oTracker.getOrCreateParentHighlighter()}oTracker.movedBBox=oTracker.initialBBox.clone();oTracker.movedBBox.moveBy(dx,dy);if(this.selectedSymbols.length===1){oTracker.moveShape()}else{oTracker.moveSymbols()}this._isDisableMoveSymbolByArrow=true;setTimeout(function(){delete self._isDisableMoveSymbolByArrow},100)}}bProcessed=true}break;case 113:if(this.selectedSymbols.length===1){oSymbol=this.selectedSymbols[0];this.enterInPlaceEditing(oSymbol)}break}if(!bProcessed){for(index=0;index<this.viewer.layers.length;++index){oLayer=this.viewer.layers[index];if(oLayer.isVisible&&oLayer.defaultOnKeyDown){if(oLayer.defaultOnKeyDown(oEvent)){bProcessed=true;break}}}}return bProcessed},onKeyDown:function(oEvent){if(this.viewer&&!this.viewer.hasFocus){return false}var bProcessed=this.extension.onKeyDown(oEvent);if(bProcessed){oEvent.preventDefault();oEvent.stopImmediatePropagation()}return bProcessed},setParentSelector:function(sEditorSelector,bRecreate){var oOldDiagram,nOldScale,nOldTranslate,index,aSymbols=[];this.parentNodeSelector=sEditorSelector;if(bRecreate){this.resetEditor(true,true)}},resetEditor:function(bPreserveZoomScale,bPreserveSelection){var oOldDiagram,nOldScale,nOldTranslate,index,aSymbols=[];oOldDiagram=this.diagram;if(bPreserveSelection&&this.selectedSymbols.length>0){for(index=0;index<this.selectedSymbols.length;index++){aSymbols.push(this.selectedSymbols[index])}}if(this.viewer){nOldScale=this.viewer.zoomScale;nOldTranslate=this.viewer.zoomTranslate;this.viewer.dispose();this.viewer.setParentNode(this.parentNodeSelector);this.viewer.createSvg();this.viewer.layers.forEach(function(oLayer){oLayer.isDisableKeyboardEvents=true})}if(this.extension){this.extension.onInitialize()}this.diagram=undefined;if(bPreserveZoomScale&&nOldScale!==undefined&&nOldTranslate){this.viewer.zoomTo(nOldScale,nOldTranslate,false)}this.diagram=oOldDiagram;if(aSymbols.length>0){this.selectSymbols(aSymbols)}},setExtensionParameters:function(oParam,bCreate){var sProp;this.extensionParam={};if(oParam&&oParam.extension){if(oParam.extension.extensionClass){this.extensionClass=oParam.extension.extensionClass}for(sProp in oParam.extension){if(oParam.extension.hasOwnProperty(sProp)){this.extensionParam[sProp]=oParam.extension[sProp]}}delete oParam.extension}if(bCreate||bCreate===undefined){this.createExtension()}},setViewerParameters:function(oParam,bCreate){var sProp;this.viewerParam={};if(oParam&&oParam.viewer){if(oParam.viewer.viewerClass){this.viewerClass=oParam.viewer.viewerClass}for(sProp in oParam.viewer){if(oParam.viewer.hasOwnProperty(sProp)){this.viewerParam[sProp]=oParam.viewer[sProp]}}delete oParam.viewer;if(bCreate||bCreate===undefined){this.createViewer()}}},createExtension:function(){var ExtensionClass=this.extensionClass||sap.galilei.ui.editor.DiagramEditorExtension,oExtensionParam=this.extensionParam||{};if(this.extension){this.extension.dispose()}this.extension=new ExtensionClass(this,oExtensionParam);if(!this.extension){throw"Error: Cannot create the diagram editor extension."}this.updateExtension();return this.extension},createViewer:function(){var ViewerClass=this.viewerClass||sap.galilei.ui.common.svg.Viewer,oViewerParam=this.viewerParam||{};this.viewer=new ViewerClass(this.parentNodeSelector,oViewerParam);if(!this.viewer){throw"Error: Cannot create the viewer."}this.viewer.onPreZoomPan=this.onPreZoomPan;this.viewer.onPostZoomPan=this.onPostZoomPan;this.viewer.layers.forEach(function(oLayer){oLayer.isDisableKeyboardEvents=true});return this.viewer},updateExtension:function(){this.registerStandardTools();this.registerDiagramTools();this.registerDiagramCommands()},dispose:function(){if(this._diagram){this.unselectAllSymbols();this.unregisterAllSymbolEvents();if(this._diagram.dispose){this._diagram.dispose()}}if(this._diagramPointerTracker){this._diagramPointerTracker.dispose();this._diagramPointerTracker=undefined}if(this._linkSymbolPointerTracker){this._linkSymbolPointerTracker.dispose();this._linkSymbolPointerTracker=undefined}if(this._symbolPointerTracker){this._symbolPointerTracker.dispose();this._symbolPointerTracker=undefined}if(this._onKeyDownCallback){document.removeEventListener("keydown",this._onKeyDownCallback,false);this._onKeyDownCallback=undefined}sap.galilei.core.Event.unSubscribeScope("update.symbol",this);sap.galilei.core.Event.unSubscribeScope("delete.symbol",this);this.tool=undefined;this.multiSelectionTracker=undefined;this._diagram=undefined;this._model=undefined;this._resource=undefined;this.unregisterDiagramEditor()},changeDiagram:function(oNewDiagram,bForceChange){var oldDiagram=this.diagram;if(oldDiagram!==oNewDiagram||bForceChange){if(oldDiagram!==undefined){this.dispose()}this._diagram=oNewDiagram;this.clearUndoRedo();if(this.viewer&&this._diagram){this.postInitialization();this.updateDiagram()}}return oldDiagram},updateDiagram:function(oTransitionDef,aAttributes){if(this.diagram){if(this._linkSymbolPointerTracker){this._linkSymbolPointerTracker.removeEventHandlers();this._linkSymbolPointerTracker.addEventHandlers()}if(this._diagramPointerTracker){this._diagramPointerTracker.removeEventHandlers();this._diagramPointerTracker.addEventHandlers()}this.registerAllSymbolEvents();this.drawAllSymbols(oTransitionDef,aAttributes)}},changeResource:function(oResource,bClearOldResource){if(oResource){var oOledResource=this.resource,oNewDiagram,index;for(index=0;index<oResource.objects.length;index++){oNewDiagram=oResource.objects.get(index);if(sap.galilei.model.isInstanceOf(oNewDiagram,"sap.galilei.ui.diagram.Diagram")){this.changeDiagram(oNewDiagram,true);break}}if(oOledResource&&bClearOldResource){oOledResource.clear()}}},getQualifiedObjectClassName:function(sObjectClassName){if(sObjectClassName){if(this.extension.modelPackageName&&sObjectClassName.indexOf(".")===-1){sObjectClassName=this.extension.modelPackageName+"."+sObjectClassName}}return sObjectClassName},getQualifiedSymbolClassName:function(sSymbolClassName){if(sSymbolClassName){if(this.extension.diagramPackageName&&sSymbolClassName.indexOf(".")===-1){sSymbolClassName=this.extension.diagramPackageName+"."+sSymbolClassName}}return sSymbolClassName},getObjectClass:function(sObjectClassName){if(sObjectClassName){sObjectClassName=this.getQualifiedObjectClassName(sObjectClassName);return sap.galilei.model.getClass(sObjectClassName)}return undefined},getSymbolClass:function(sSymbolClassName){if(sSymbolClassName){sSymbolClassName=this.getQualifiedSymbolClassName(sSymbolClassName);return sap.galilei.model.getClass(sSymbolClassName)}return undefined},getObjectClassOfSymbolClass:function(sSymbolClassName){var oSymbolClass;if(sSymbolClassName){oSymbolClass=this.getSymbolClass(sSymbolClassName);if(oSymbolClass&&oSymbolClass.runtimeClass){return oSymbolClass.runtimeClass.objectClass}}return undefined},defaultSetDefaultObjectName:function(oObject){if(oObject){var count;if(!oObject.name||!oObject.displayName){count=oObject.classDefinition.objectCount;if(count===undefined){count=0}count++;oObject.classDefinition.objectCount=count}if(oObject.displayName===undefined){oObject.displayName=oObject.classDefinition.displayName+" "+count}if(!oObject.name){oObject.name=oObject.classDefinition.name+count}}},setDefaultObjectName:function(oObject){this.extension.setDefaultObjectName(oObject)},defaultCanCreateSymbol:function(sSymbolClass,oCreateParam){if(oCreateParam&&oCreateParam.parentSymbol){if(!sap.galilei.model.isInstanceOf(oCreateParam.parentSymbol,"sap.galilei.ui.diagram.Diagram")){if(!oCreateParam.parentSymbol.isComposite){return false}}}return true},canCreateSymbol:function(sSymbolClass,oCreateParam){return this.extension.canCreateSymbol(sSymbolClass,oCreateParam)},defaultCanCreateObject:function(sObjectClass,oParent,oProperties){return true},canCreateObject:function(sObjectClass,oParent,oProperties){return this.extension.canCreateObject(sObjectClass,oParent,oProperties)},defaultCanSetObjectProperties:function(oObject,oProperties){return true},canSetObjectProperties:function(oObject,oProperties){return this.extension.canSetObjectProperties(oObject,oProperties)},defaultCanCreateLinkSymbol:function(oSourceSymbol,oTargetSymbol,oLinkTool){return true},canCreateLinkSymbol:function(oSourceSymbol,oTargetSymbol,oLinkTool){return this.extension.canCreateLinkSymbol(oSourceSymbol,oTargetSymbol,oLinkTool)},defaultCanInsertSymbolOnLinkSymbol:function(sSymbolClass,oCreateParam){return true},canInsertSymbolOnLinkSymbol:function(sSymbolClass,oCreateParam){return this.extension.canInsertSymbolOnLinkSymbol(sSymbolClass,oCreateParam)},selectLinkSymbolDefinition:function(oSourceSymbol,oTargetSymbol){return this.extension.selectLinkSymbolDefinition(oSourceSymbol,oTargetSymbol)},defaultPostCreateSymbol:function(oSymbol){if(oSymbol.isSwimlaneSymbol&&oSymbol.parentSymbol&&oSymbol.parentSymbol.isSwimlaneSymbol){var oBBox=oSymbol.parentSymbol.getContentAreaBBox();oSymbol.moveTo(oSymbol.isVertical?oSymbol.x:oBBox.x,oSymbol.isVertical?oBBox.y:oSymbol.y,undefined,this.viewer)}},postCreateSymbol:function(oSymbol){return this.extension.postCreateSymbol(oSymbol)},postCreateLinkSymbol:function(oSourceSymbol,oTargetSymbol,oLinkSymbol){return this.extension.postCreateLinkSymbol(oSourceSymbol,oTargetSymbol,oLinkSymbol)},defaultCreateObject:function(sObjectClassName,oParam){var oObjectClass,oObject,sProp;if(sObjectClassName){oObjectClass=this.getObjectClass(sObjectClassName);if(oObjectClass){oParam=oParam||{};oObject=oObjectClass.create(this.resource,oParam);if(oObject){for(sProp in oParam){oObject.set(sProp,oParam[sProp])}this.setDefaultObjectName(oObject)}}}return oObject},createObject:function(sObjectClassName,oParam){return this.extension.createObject(sObjectClassName,oParam)},defaultCreateSymbol:function(sSymbolClassName,oParam){var oSymbolClass,oSymbol,sProp;if(sSymbolClassName){oSymbolClass=this.getSymbolClass(sSymbolClassName);if(oSymbolClass){oParam=oParam||{};oSymbol=oSymbolClass.create(this.resource,oParam);if(oSymbol){for(sProp in oParam){oSymbol.set(sProp,oParam[sProp])}}}}return oSymbol},createSymbol:function(sSymbolClassName,oParam){return this.extension.createSymbol(sSymbolClassName,oParam)},createSymbolAndObject:function(sSymbolClass,oSymbolParams,oSymbolParent,nSymbolIndex,sObjectClass,oObjectParams,oObjectParent,sObjectReference,nObjectIndex){var oSymbol,oObject,oEvent={};if(!sObjectClass&&sSymbolClass){sObjectClass=this.getObjectClassOfSymbolClass(sSymbolClass)}if(sObjectClass){oObject=this.createObject(sObjectClass,oObjectParams);if(oObject){this.insertObject(oObject,nObjectIndex,oObjectParent,sObjectReference)}}if(sSymbolClass){oSymbolParams=oSymbolParams||{};oSymbolParams.object=oObject;oSymbol=this.createSymbol(sSymbolClass,oSymbolParams);if(oSymbol){this.addSymbol(oSymbol,oSymbolParent,nSymbolIndex);this.addEventProperties(oEvent,oSymbol);sap.galilei.core.Event.publish("create.symbol",this,this,oEvent)}}return oSymbol},defaultGetParentObjectByParentSymbol:function(oParentSymbol,sObjectClass){if(oParentSymbol&&oParentSymbol.object){return oParentSymbol.object}return this.diagram.container},getParentObjectByParentSymbol:function(oParentSymbol,sObjectClass){return this.extension.getParentObjectByParentSymbol(oParentSymbol,sObjectClass)},getLinkObjectSourceReferenceName:function(sLinkObjectClass){return this.extension.getLinkObjectSourceReferenceName(sLinkObjectClass)},getLinkObjectTargetReferenceName:function(sLinkObjectClass){return this.extension.getLinkObjectTargetReferenceName(sLinkObjectClass)},createLinkSymbolAndObject:function(oSourceSymbol,oTargetSymbol,sLinkSymbolClass,oLinkSymbolParams,oLinkSymbolParent,sLinkObjectClass,oLinkObjectParams,oLinkObjectParent,sLinkObjectReference){var oSourceObject,oTargetObject,oLinkObject,oLinkSymbol,oParam={},oEvent={};if(oSourceSymbol&&oTargetSymbol){oSourceObject=oSourceSymbol.object;oTargetObject=oTargetSymbol.object;if(!sLinkObjectClass&&sLinkSymbolClass){sLinkObjectClass=this.getObjectClassOfSymbolClass(sLinkSymbolClass)}if(sLinkObjectClass&&oSourceObject&&oTargetObject){if(oLinkObjectParams){sap.galilei.core.copyProperties(oParam,oLinkObjectParams)}oParam[this.getLinkObjectSourceReferenceName(sLinkObjectClass)]=oSourceObject;oParam[this.getLinkObjectTargetReferenceName(sLinkObjectClass)]=oTargetObject;oLinkObject=this.createObject(sLinkObjectClass,oParam);if(oLinkObject){this.addObject(oLinkObject,oLinkObjectParent,sLinkObjectReference)}}if(sLinkSymbolClass){oLinkSymbolParams=oLinkSymbolParams||{};oLinkSymbolParams.sourceSymbol=oSourceSymbol;oLinkSymbolParams.targetSymbol=oTargetSymbol;if(oLinkObject){oLinkSymbolParams.object=oLinkObject}oLinkSymbol=this.createSymbol(sLinkSymbolClass,oLinkSymbolParams);if(oLinkSymbol){this.addSymbol(oLinkSymbol,oLinkSymbolParent);this.addEventProperties(oEvent,oLinkSymbol);sap.galilei.core.Event.publish("create.linksymbol",this,this,oEvent)}}}return oLinkSymbol},ReplaceObjectAndSymbol:function(oSymbol,sObjectClass,oObjectParams,sSymbolClass,oSymbolParams){var oOldSymbol=oSymbol,oOldObject,oNewSymbol,oNewObject,oObjectParent,sObjectReference,oSymbolParent,bChangeSymbol,bSelected;if(oSymbol&&sObjectClass){oOldSymbol=oSymbol;oOldObject=oOldSymbol.object;if(oOldObject){oObjectParent=oOldObject.container}if(oOldSymbol){oSymbolParent=oOldSymbol.owner}bChangeSymbol=(sSymbolClass!==undefined);oNewObject=this.createObject(sObjectClass,oObjectParams);if(oNewObject){if(bChangeSymbol){oNewSymbol=this.createSymbol(sSymbolClass,oSymbolParams);if(!oNewSymbol){console.log("Cannot create symbol "+sSymbolClass);oNewObject.deleteObject();return undefined}}if(oObjectParams){sap.galilei.core.copyProperties(oNewObject,oObjectParams)}this.addObject(oNewObject,oObjectParent,sObjectReference);this.ReplaceObjectForLinkObjects(oOldObject,oNewObject);if(bChangeSymbol){if(oOldSymbol){oNewSymbol.x=oOldSymbol.x;oNewSymbol.y=oOldSymbol.y;oNewSymbol.width=oOldSymbol.width;oNewSymbol.height=oOldSymbol.height;if(oSymbolParams){sap.galilei.core.copyProperties(oNewSymbol,oSymbolParams)}this.ReplaceSymbolForLinkSymbols(oOldSymbol,oNewSymbol)}oNewSymbol.object=oNewObject;this.addSymbol(oNewSymbol,oSymbolParent);bSelected=oOldSymbol.isSelected;this.deleteSymbol(oOldSymbol,true,false);this.drawSymbol(oNewSymbol);if(bSelected){this.selectSymbol(oNewSymbol)}}else{oSymbol.object=oNewObject;if(oOldObject){oOldObject.deleteObject()}this.drawSymbol(oSymbol)}}else{console.log("Cannot create object "+sObjectClass)}}return oNewSymbol},ReplaceObjectForLinkObjects:function(oOldObject,oNewObject){var oLinks,oLinkObject,index,sSourceReference,sTargetReference;if(oOldObject&&oNewObject&&oOldObject.getLinkObjects){oLinks=oOldObject.getLinkObjects();if(oLinks!==undefined&&oLinks.length>0){for(index=0;index<oLinks.length;index++){oLinkObject=oLinks[index];sSourceReference=this.getLinkObjectSourceReferenceName(oLinkObject.classDefinition.qualifiedName),sTargetReference=this.getLinkObjectTargetReferenceName(oLinkObject.classDefinition.qualifiedName);if(oLinkObject[sSourceReference]===oOldObject){oLinkObject[sSourceReference]=oNewObject}if(oLinkObject[sTargetReference]===oOldObject){oLinkObject[sTargetReference]=oNewObject}}}}},ReplaceSymbolForLinkSymbols:function(oOldSymbol,oNewSymbol){var oLinks,oLinkSymbol,index;if(oOldSymbol&&oNewSymbol&&oOldSymbol.getLinkSymbols){oLinks=oOldSymbol.getLinkSymbols();if(oLinks!==undefined&&oLinks.length>0){for(index=0;index<oLinks.length;index++){oLinkSymbol=oLinks[index];if(oLinkSymbol.sourceSymbol===oOldSymbol){oLinkSymbol.sourceSymbol=oNewSymbol}if(oLinkSymbol.targetSymbol===oOldSymbol){oLinkSymbol.targetSymbol=oNewSymbol}}}}},defaultRegisterSymbolEvents:function(oSymbol){if(oSymbol){if(this._linkSymbolPointerTracker&&!oSymbol.isLinkSymbol){this._linkSymbolPointerTracker.addEventHandlers(oSymbol)}if(this._symbolPointerTracker){this._symbolPointerTracker.addEventHandlers(oSymbol)}}},registerSymbolEvents:function(oSymbol){if(oSymbol){this.unregisterSymbolEvents(oSymbol);if(this.extension){this.extension.registerSymbolEvents(oSymbol)}if(oSymbol.isComposite){this.registerSymbolsEvents(oSymbol.symbols)}}},registerSymbolsEvents:function(vSymbols){var index,oSymbol;if(vSymbols){for(index=0;index<vSymbols.length;++index){if(vSymbols instanceof Array){oSymbol=vSymbols[index]}else{oSymbol=vSymbols.get(index)}this.registerSymbolEvents(oSymbol)}}},registerAllSymbolEvents:function(){if(this.diagram){this.registerSymbolsEvents(this.diagram.symbols)}},defaultUnregisterSymbolEvents:function(oSymbol){if(oSymbol){if(this._symbolPointerTracker){this._symbolPointerTracker.removeEventHandlers(oSymbol)}if(this._linkSymbolPointerTracker&&!oSymbol.isLinkSymbol){this._linkSymbolPointerTracker.removeEventHandlers(oSymbol)}}},unregisterSymbolEvents:function(oSymbol){if(oSymbol){if(this.extension){this.extension.unregisterSymbolEvents(oSymbol)}if(oSymbol.isComposite){this.unregisterSymbolsEvents(oSymbol.symbols)}}},unregisterSymbolsEvents:function(oSymbols){var index,oSymbol;if(oSymbols){for(index=0;index<oSymbols.length;++index){oSymbol=oSymbols.get(index);this.unregisterSymbolEvents(oSymbol)}}},unregisterAllSymbolEvents:function(){if(this.diagram){this.unregisterSymbolsEvents(this.diagram.symbols)}},getAllSymbols:function(){if(this.diagram){return this.diagram.getAllSymbols()}return[]},getDisplayedObjects:function(){if(this.diagram){return this.diagram.getDisplayedObjects()}return[]},getAllObjects:function(){var aObjects=[],index,max,oObject;if(this.resource){for(index=0,max=this.resource.objects.length;index<max;index++){oObject=this.resource.objects.get(index);if(!oObject.isModel&&!oObject.isDiagram&&!oObject.isSymbol){aObjects.push(oObject)}}}return aObjects},isSymbolInView:function(oSymbol){if(oSymbol&&!oSymbol.isHidden){return this.viewer.isRectInView(oSymbol.getBBox())}return false},isSymbolVisible:function(oSymbol){if(oSymbol&&!oSymbol.isHidden){return this.viewer.isRectVisible(oSymbol.getBBox())}return false},bringSymbolToView:function(oSymbol,bPreserveZoomScale,bCenterInView){if(oSymbol){this.bringSymbolsToView([oSymbol],bPreserveZoomScale,bCenterInView)}return this},bringSymbolsToView:function(aSymbols,bPreserveZoomScale,bCenterInView){var self=this,oRect,oBBox;function computeBBox(oSymbol){var oButton,oPopup;oBBox=oSymbol.getBBox();if(oRect){oRect.unionRect(oBBox)}else{oRect=oBBox}oButton=oSymbol._contextButtonPad;if(oButton&&!oButton.isHidden){oBBox=oButton.getBBox();if(oBBox&&oBBox.width!==0&&oBBox.height!==0){oBBox=self.viewer.clientBBoxToViewBBox(oBBox,false,true);oRect.unionRect(oBBox)}if(oButton.getPopupContextButtonPad){oPopup=oButton.getPopupContextButtonPad();if(oPopup&&!oPopup.isHidden){oBBox=oPopup.getBBox();if(oBBox&&oBBox.width!==0&&oBBox.height!==0){oBBox=self.viewer.clientBBoxToViewBBox(oBBox,false,true);oRect.unionRect(oBBox)}}}}}if(aSymbols){aSymbols.forEach(computeBBox)}if(oRect){this.viewer.zoomToRect(oRect.x,oRect.y,oRect.width,oRect.height,bPreserveZoomScale,bCenterInView)}return this},bringSelectedSymbolsToView:function(bPreserveZoomScale,bCenterInView){this.bringSymbolsToView(this.selectedSymbols,bPreserveZoomScale,bCenterInView)},zoomIn:function(){this.viewer.zoomIn();return this},zoomOut:function(){this.viewer.zoomOut();return this},showInitialView:function(){this.viewer.showInitialView();return this},showGlobalView:function(){this.viewer.showGlobalView();return this},addObject:function(oObject,oParentObject,sObjectReference){var oDiagram=this.diagram,oModel=(oDiagram&&oDiagram.container)||this.model;if(oObject){if(!oParentObject){oParentObject=oModel}if(oParentObject){while(!sObjectReference){sObjectReference=oParentObject.classDefinition.getContainingReference(oObject.classDefinition.qualifiedName);if(!sObjectReference&&oParentObject.parent){oParentObject=oParentObject.parent}else{break}}if(sObjectReference&&oParentObject[sObjectReference]){oParentObject[sObjectReference].push(oObject)}else{throw"Cannot find the reference for "+oObject.classDefinition.qualifiedName+" in "+oParentObject.classDefinition.qualifiedName}}}},insertObject:function(oObject,nIndex,oParentObject,sObjectReference){if(oObject){var oReference;if(nIndex===undefined||nIndex<0){return this.addObject(oObject,oParentObject,sObjectReference)}if(!oParentObject){oParentObject=this.model}if(oParentObject){while(!sObjectReference){sObjectReference=oParentObject.classDefinition.getContainingReference(oObject.classDefinition.qualifiedName);if(!sObjectReference&&oParentObject.parent){oParentObject=oParentObject.parent}else{break}}if(sObjectReference){oReference=oParentObject[sObjectReference];if(nIndex<oReference.length){oReference.insert(nIndex,oObject)}else{oReference.push(nIndex,oObject)}}else{throw"Cannot find the reference for "+oObject.classDefinition.qualifiedName+" in "+oParentObject.classDefinition.qualifiedName}}}},addSymbol:function(oSymbol,oParentSymbol,nIndex){if(oSymbol){if(oParentSymbol&&oParentSymbol.isComposite){if(nIndex>=0&&nIndex<oParentSymbol.symbols.length){oParentSymbol.symbols.insert(nIndex,oSymbol)}else{oParentSymbol.symbols.push(oSymbol)}}else{if(this.diagram){if(nIndex>=0&&nIndex<this.diagram.symbols.length){this.diagram.symbols.insert(nIndex,oSymbol)}else{this.diagram.symbols.push(oSymbol)}}}this.registerSymbolEvents(oSymbol)}return oSymbol},insertSymbol:function(oSymbol,nIndex,oParentSymbol){if(oSymbol){var nMax;if(oParentSymbol){nMax=oParentSymbol.symbols.length}else{if(this.diagram){nMax=this.diagram.symbols.length}}if(nIndex===undefined||nIndex<0||nIndex>=nMax){this.addSymbol(oSymbol,oParentSymbol)}else{if(oParentSymbol){oParentSymbol.symbols.insert(nIndex,oSymbol)}else{if(this.diagram){this.diagram.symbols.insert(nIndex,oSymbol)}}this.registerSymbolEvents(oSymbol)}}return oSymbol},canDeleteSymbol:function(oSymbol){if(oSymbol){if(this.extension){return this.extension.canDeleteSymbol(oSymbol)}}return true},canDeleteSymbols:function(aSymbols){if(aSymbols){if(this.extension){return this.extension.canDeleteSymbols(aSymbols)}}return true},detachSymbol:function(oSymbol,bUseAnimation){if(oSymbol){this.unselectSymbol(oSymbol);if(bUseAnimation===undefined){bUseAnimation=true}oSymbol.hide(this.viewer,bUseAnimation?this.transitionDefinition:undefined);this.unregisterSymbolEvents(oSymbol);oSymbol.dispose()}},detachSymbols:function(vSymbols,bUseAnimation){var index,oSymbol;if(vSymbols){for(index=0;index<vSymbols.length;index++){if(vSymbols instanceof Array){oSymbol=vSymbols[index]}else{oSymbol=vSymbols.get(index)}this.detachSymbol(oSymbol,bUseAnimation)}}},deleteSymbol:function(oSymbol,bDeleteObject,bPreserveLink,bUseUndoAction,bTriggerPostDelete,bCheckCanDelete){var self=this;bDeleteObject=bDeleteObject===undefined?true:bDeleteObject;bPreserveLink=bPreserveLink===undefined?this.enablePreserveLinkAfterDelete:bPreserveLink;bUseUndoAction=bUseUndoAction===undefined?true:bUseUndoAction;bTriggerPostDelete=bTriggerPostDelete===undefined?true:bTriggerPostDelete;bCheckCanDelete=bCheckCanDelete===undefined?true:bCheckCanDelete;function deleteSymbolAction(){var oRootSwimlane,oLinks,oLink,index,oLinkSymbol1,oLinkSymbol2,oContainer;oContainer=oSymbol.container;if(oSymbol.isSwimlaneSymbol&&oSymbol.parentSymbol){oRootSwimlane=sap.galilei.ui.diagram.SwimlaneSymbol.getRootSwimlaneSymbol(oSymbol.parentSymbol)}if(bPreserveLink){oLinks=oSymbol.getLinkSymbols();if(oLinks&&oLinks.length===2){for(index=0;index<oLinks.length;index++){oLink=oLinks[index];if(oLink.targetSymbol===oSymbol&&oLink.sourceSymbol!==oSymbol){oLinkSymbol1=oLink}else{if(oLink.sourceSymbol===oSymbol&&oLink.targetSymbol!==oSymbol){oLinkSymbol2=oLink}}}}if(oLinkSymbol1&&oLinkSymbol2&&oLinkSymbol1.classDefinition===oLinkSymbol2.classDefinition){if(oLinkSymbol1.object&&oLinkSymbol2.object){oLinkSymbol1.object[self.getLinkObjectTargetReferenceName(oLinkSymbol1.object.classDefinition.qualifiedName)]=oLinkSymbol2.targetSymbol.object}oLinkSymbol1.targetSymbol=oLinkSymbol2.targetSymbol;oLinkSymbol1.isAutomaticRouting=true;oLinkSymbol1.updateLinkRouting(false);oLinkSymbol1.drawSymbol(self.viewer,self.transitionDefinition)}}self.detachSymbol(oSymbol);oSymbol.deleteSymbol(bDeleteObject);if(oRootSwimlane){oRootSwimlane.layoutSwimlanes(sap.galilei.ui.symbol.LayoutSwimlaneDirection.DEFAULT,self.viewer,self.transitionDefinition)}if(bTriggerPostDelete){self.postDeleteSymbol(oContainer,oSymbol)}}if(!this.isReadOnly&&oSymbol){if(!bCheckCanDelete||this.canDeleteSymbol(oSymbol)){if(bUseUndoAction){this.resource.applyUndoableAction(deleteSymbolAction,"Delete a Symbol")}else{deleteSymbolAction()}}}},postDeleteSymbol:function(oContainer,oDeletedSymbol,bDeleteObject,bPreserveLink,bUseUndoAction){if(this.extension.postDeleteSymbol){this.extension.postDeleteSymbol(oContainer,oDeletedSymbol,bDeleteObject,bPreserveLink,bUseUndoAction)}},deleteSymbols:function(vSymbols,bDeleteObject,bPreserveLink,bUseUndoAction,bTriggerPostDelete,bCheckCanDelete){var self=this,aDeleteSymbols=[];bDeleteObject=bDeleteObject===undefined?true:bDeleteObject;bPreserveLink=bPreserveLink===undefined?this.enablePreserveLinkAfterDelete:bPreserveLink;bUseUndoAction=bUseUndoAction===undefined?true:bUseUndoAction;bTriggerPostDelete=bTriggerPostDelete===undefined?true:bTriggerPostDelete;bCheckCanDelete=bCheckCanDelete===undefined?true:bCheckCanDelete;function deleteSymbolsAction(){var nLoop,index,oSymbol,aContainers=[],aSymbols=[];for(nLoop=0;nLoop<2;nLoop++){for(index=0;index<aDeleteSymbols.length;index++){oSymbol=aDeleteSymbols[index];if((nLoop===0&&oSymbol.isLinkSymbol)||(nLoop===1&&!oSymbol.isLinkSymbol)){if(oSymbol.container){aContainers.push(oSymbol.container);aSymbols.push(oSymbol)}self.deleteSymbol(oSymbol,bDeleteObject,bPreserveLink,false,false,bCheckCanDelete)}}}if(bTriggerPostDelete){self.postDeleteSymbols(aContainers,aSymbols,bDeleteObject,bPreserveLink,bUseUndoAction)}}function isParentSymbolSelected(oSymbol){var bSelected;if(oSymbol){while(oSymbol.parentSymbol){if(vSymbols instanceof Array){bSelected=vSymbols.indexOf(oSymbol.parentSymbol)!==-1}else{bSelected=vSymbols.contains(oSymbol.parentSymbol)}if(bSelected){return true}oSymbol=oSymbol.parentSymbol}}return false}function filterSubsymbols(){var index,oSymbol;for(index=0;index<vSymbols.length;index++){if(vSymbols instanceof Array){oSymbol=vSymbols[index]}else{oSymbol=vSymbols.get(index)}if(!isParentSymbolSelected(oSymbol)){aDeleteSymbols.push(oSymbol)}}}filterSubsymbols();if(!this.isReadOnly&&vSymbols){if(!bCheckCanDelete||this.canDeleteSymbols(aDeleteSymbols)){if(bUseUndoAction){this.resource.applyUndoableAction(deleteSymbolsAction,"Delete Symbols")}else{deleteSymbolsAction()}}}},postDeleteSymbols:function(aContainers,aDeletedSymbols,bDeleteObject,bPreserveLink,bUseUndoAction){if(this.extension.postDeleteSymbols){this.extension.postDeleteSymbols(aContainers,aDeletedSymbols,bDeleteObject,bPreserveLink,bUseUndoAction)}},deleteSelectedSymbols:function(bDeleteObject,bPreserveLink,bUseUndoAction){var index,aSymbols=[],oSymbol;for(index=0;index<this.selectedSymbols.length;index++){oSymbol=this.selectedSymbols[index];aSymbols.push(oSymbol)}this.deleteSymbols(aSymbols,bDeleteObject,bPreserveLink,bUseUndoAction)},drawSymbol:function(oSymbol,oTransitionDef,aAttributes){if(oSymbol){oSymbol.drawSymbol(this.viewer,oTransitionDef,aAttributes)}},drawSymbols:function(vSelection,oTransitionDef,aAttributes){if(vSelection){var index,oSymbol,aLinkSymbols=[];for(index=0;index<vSelection.length;++index){if(vSelection instanceof Array){oSymbol=vSelection[index]}else{oSymbol=vSelection.get(index)}if(oSymbol.isLinkSymbol){aLinkSymbols.push(oSymbol)}else{this.drawSymbol(oSymbol,oTransitionDef,aAttributes)}}for(index=0;index<aLinkSymbols.length;index++){this.drawSymbol(aLinkSymbols[index],oTransitionDef,aAttributes)}this.updateSymbolDrawingOrder(oTransitionDef)}},drawAllSymbols:function(oTransitionDef,aAttributes){if(this.diagram){this.drawSymbols(this.diagram.symbols,oTransitionDef,aAttributes)}},getOrCreateSymbolTracker:function(oSymbol){if(oSymbol){if(!oSymbol._tracker){if(oSymbol.isSwimlaneSymbol){oSymbol._tracker=new sap.galilei.ui.editor.tracker.SwimlaneSymbolTracker({editor:this,symbol:oSymbol,endTransitionDefinition:new sap.galilei.ui.common.TransitionDefinition({duration:200}),isKeepSize:oSymbol.isKeepSize,isKeepAspectRatio:oSymbol.isKeepAspectRatio,isKeepCenter:oSymbol.isKeepCenter,frameColor:sap.galilei.ui.common.style.Color.orange})}else{if(oSymbol.isLinkSymbol){oSymbol._tracker=new sap.galilei.ui.editor.tracker.LinkSymbolTracker({editor:this,symbol:oSymbol,endTransitionDefinition:new sap.galilei.ui.common.TransitionDefinition({duration:200})})}else{oSymbol._tracker=new sap.galilei.ui.editor.tracker.RectangularSymbolTracker({editor:this,symbol:oSymbol,endTransitionDefinition:new sap.galilei.ui.common.TransitionDefinition({duration:200}),isKeepSize:oSymbol.isKeepSize,isKeepAspectRatio:oSymbol.isKeepAspectRatio,isKeepCenter:oSymbol.isKeepCenter,frameColor:sap.galilei.ui.common.style.Color.orange})}}}return oSymbol._tracker}return undefined},removeSymbolTracker:function(oSymbol){if(oSymbol){if(oSymbol._tracker){oSymbol._tracker.dispose();oSymbol._tracker=undefined}this.removeSymbolInPlaceEditControl(oSymbol)}},canSupportInPlaceEditing:function(oSymbol,aClientPoint){var bSupported=false;if(!this.isReadOnly&&this.enableInPlaceEditing&&oSymbol){if(this.extension.canSupportInPlaceEditing){bSupported=this.extension.canSupportInPlaceEditing(oSymbol,aClientPoint)}else{bSupported=true}}return bSupported},enterInPlaceEditing:function(oSymbol,aClientPoint){if(this.canSupportInPlaceEditing(oSymbol,aClientPoint)){var nField=-1;if(!oSymbol._inPlaceEditControl){oSymbol._inPlaceEditControl=new sap.galilei.ui.editor.widget.InPlaceEditControl({controlAdapterName:this.inPlaceEditControlAdapterName,editor:this,symbol:oSymbol})}if(aClientPoint){nField=oSymbol._inPlaceEditControl.getFieldIndex(aClientPoint);if(nField!==-1){oSymbol._inPlaceEditControl.createControl();oSymbol._inPlaceEditControl.moveToField(nField);oSymbol._inPlaceEditControl.showWidget()}}else{oSymbol._inPlaceEditControl.createControl();oSymbol._inPlaceEditControl.showWidget()}return oSymbol._inPlaceEditControl}return undefined},removeSymbolInPlaceEditControl:function(oSymbol){if(oSymbol&&oSymbol._inPlaceEditControl){oSymbol._inPlaceEditControl.dispose();oSymbol._inPlaceEditControl=undefined}},getOrCreateMultiSelectionTracker:function(){if(!this.multiSelectionTracker){var oSymbol,i,bContainsSwimlane=false;for(i=0;i<this.selectedSymbols.length;i++){oSymbol=this.selectedSymbols[i];if(oSymbol&&oSymbol.isSwimlaneSymbol){bContainsSwimlane=true;break}}if(bContainsSwimlane){this.multiSelectionTracker=new sap.galilei.ui.editor.tracker.SwimlaneMultiSelectionTracker({editor:this,transitionDefinition:new sap.galilei.ui.common.TransitionDefinition({duration:200}),endTransitionDefinition:new sap.galilei.ui.common.TransitionDefinition({duration:200})})}else{this.multiSelectionTracker=new sap.galilei.ui.editor.tracker.MultiSelectionTracker({editor:this,transitionDefinition:new sap.galilei.ui.common.TransitionDefinition({duration:200}),endTransitionDefinition:new sap.galilei.ui.common.TransitionDefinition({duration:200})})}}return this.multiSelectionTracker},removeMultiSelectionTracker:function(){if(this.multiSelectionTracker){this.multiSelectionTracker.dispose();this.multiSelectionTracker=undefined}},defaultGetOrCreateContextButtonPad:function(oSymbol){if(!this.isReadOnly&&oSymbol){if(!oSymbol._contextButtonPad){var aButtons=this.getContextButtonPad(oSymbol),oContextButtonPad;if(aButtons){oContextButtonPad=new sap.galilei.ui.editor.widget.ContextButtonPad({editor:this,symbol:oSymbol,buttonsDefinition:aButtons});oContextButtonPad.createContextButtonPad();oSymbol._contextButtonPad=oContextButtonPad}}return oSymbol._contextButtonPad}return undefined},getOrCreateContextButtonPad:function(oSymbol){if(this.extension){return this.extension.getOrCreateContextButtonPad(oSymbol)}return undefined},defaultGetContextButtonPad:function(oSymbol){return undefined},getContextButtonPad:function(oSymbol){if(this.extension){return this.extension.getContextButtonPad(oSymbol)}return undefined},removeContextButtonPad:function(oSymbol){if(oSymbol&&oSymbol._contextButtonPad){oSymbol._contextButtonPad.dispose();oSymbol._contextButtonPad=undefined}},selectSymbol:function(oSymbol,bDraw,oTransitionDef,bNotify,bBringToView){if(oSymbol&&!this.selectedSymbols.contains(oSymbol)){var nOldSelected=this.selectedSymbols.length,oMultiSelectionTracker,bSelected=false,oEvent={};if(!oSymbol.isSelected){oSymbol.isSelected=true;bSelected=true}if(!this.selectedSymbols.contains(oSymbol)){this.selectedSymbols.add(oSymbol);bSelected=true}if(bSelected&&(bDraw===undefined||bDraw)){if(this.selectedSymbols.length===1){this.getOrCreateSymbolTracker(oSymbol);if(this.useContextButtonPad){this.getOrCreateContextButtonPad(oSymbol)}}else{if(nOldSelected===1){this.getOrCreateMultiSelectionTracker().showAllSelection()}else{oMultiSelectionTracker=this.getOrCreateMultiSelectionTracker();oMultiSelectionTracker.showSelection(oSymbol);oMultiSelectionTracker.updateSelectionFrame()}}if((bBringToView||bBringToView===undefined)&&!oSymbol.isLinkSymbol&&oSymbol.width<=200&&oSymbol.height<=200){if(this.selectedSymbols.length===1){this.bringSymbolToView(oSymbol,true,false)}else{this.bringSymbolsToView(this.selectedSymbols,true,false)}}if(bNotify||bNotify===undefined){this.addEventProperties(oEvent,oSymbol);sap.galilei.core.Event.publish("symbol.selected",this,this,oEvent);oEvent.selectedSymbols=this.selectedSymbols;sap.galilei.core.Event.publish("symbols.selection.changed",this,this,oEvent)}}}},selectSymbols:function(vSelection,bSelectSubSymbols,bDraw,oTransitionDef){if(vSelection){var index,oSymbol,oEvent={};for(index=0;index<vSelection.length;++index){if(vSelection instanceof Array){oSymbol=vSelection[index]}else{oSymbol=vSelection.get(index)}this.selectSymbol(oSymbol,bDraw,oTransitionDef,false,false);if(bSelectSubSymbols&&oSymbol.isComposite){this.selectSymbols(oSymbol.symbols,bSelectSubSymbols,bDraw,oTransitionDef)}}this.addEventProperties(oEvent,oSymbol);if(oSymbol){sap.galilei.core.Event.publish("symbol.selected",this,this,oEvent)}if(vSelection.length>0){oEvent.selectedSymbols=this.selectedSymbols;sap.galilei.core.Event.publish("symbols.selection.changed",this,this,oEvent)}}},selectAllSymbols:function(bDraw,oTransitionDef){if(this.diagram){this.selectSymbols(this.diagram.symbols,true,bDraw,oTransitionDef)}},unselectSymbol:function(oSymbol,bDraw,oTransitionDef,bNotify){if(oSymbol&&this.selectedSymbols.contains(oSymbol)){var nOldSelected=this.selectedSymbols.length,bUnselected=false,oEvent={};if(oSymbol.isSelected){oSymbol.isSelected=false;bUnselected=true}if(this.selectedSymbols.contains(oSymbol)){this.selectedSymbols.remove(oSymbol);bUnselected=true}if(bUnselected&&(bDraw===undefined||bDraw)){this.removeSymbolTracker(oSymbol);this.removeContextButtonPad(oSymbol);if(nOldSelected>1){if(this.multiSelectionTracker){this.multiSelectionTracker.hideSelection(oSymbol)}}if(this.selectedSymbols.length===1){this.removeMultiSelectionTracker();this.getOrCreateSymbolTracker(this.selectedSymbols[0])}else{if(this.selectedSymbols.length>1){this.getOrCreateMultiSelectionTracker().updateSelectionFrame()}}if(bNotify||bNotify===undefined){this.addEventProperties(oEvent,oSymbol);sap.galilei.core.Event.publish("symbol.unselected",this,this,oEvent);oEvent.selectedSymbols=this.selectedSymbols;sap.galilei.core.Event.publish("symbols.selection.changed",this,this,oEvent)}}}},unselectSymbols:function(vSelection,bDraw,oTransitionDef,oExcludeSybmol){if(vSelection){var index,oSymbol,nUnselected=0,oEvent={};for(index=vSelection.length-1;index>=0;--index){if(vSelection instanceof Array){oSymbol=vSelection[index]}else{oSymbol=vSelection.get(index)}if(oExcludeSybmol&&oSymbol===oExcludeSybmol){oSymbol=undefined;continue}this.unselectSymbol(oSymbol,bDraw,oTransitionDef,false);nUnselected++}this.addEventProperties(oEvent,oSymbol);if(oSymbol){sap.galilei.core.Event.publish("symbol.unselected",this,this,oEvent)}if(nUnselected>0){oEvent.selectedSymbols=this.selectedSymbols;sap.galilei.core.Event.publish("symbols.selection.changed",this,this,oEvent)}}},unselectAllSymbols:function(bDraw,oTransitionDef,oExcludeSybmol){if(this.diagram){this.unselectSymbols(this.selectedSymbols,bDraw,oTransitionDef,oExcludeSybmol)}},defaultCanSelectSymbolByPoint:function(oSymbol,aViewPoint){var oBBox,oHeaderBBox,oExcludeBBox,nDelta;if(oSymbol&&aViewPoint&&oSymbol.isSwimlaneSymbol){oBBox=oSymbol.getBBox();oHeaderBBox=oSymbol.getHeaderAreaBBox();nDelta=oSymbol.isVertical?oHeaderBBox.height:oHeaderBBox.width;if(nDelta*2<Math.min(oBBox.width,oBBox.height)){oExcludeBBox=oBBox.inflate(-nDelta,-nDelta,-nDelta,-nDelta,true)}if(!oBBox.isPointInRect(aViewPoint)||(oExcludeBBox&&oExcludeBBox.isPointInRect(aViewPoint))){return false}}return true},canSelectSymbolByPoint:function(oSymbol,aViewPoint){if(this.extension){return this.extension.canSelectSymbolByPoint(oSymbol,aViewPoint)}return true},addEventProperties:function(oEvent,oSymbol){if(oEvent){this.viewer.normalizePointerEvent(oEvent);oEvent.editor=this;oEvent.viewer=this.viewer;oEvent.diagram=this.diagram;oEvent.model=this.model;if(oSymbol){oEvent.sourceSymbol=oSymbol;if(oSymbol.object){oEvent.object=oSymbol.object}oEvent.symbolBBox=oSymbol.getBBox();oEvent.symbolClientBBox=this.viewer.viewBBoxToClientBBox(oEvent.symbolBBox,true);oEvent.symbolPageBBox=this.viewer.viewBBoxToPageBBox(oEvent.symbolBBox,true)}}return oEvent},defaultRegisterStandardTools:function(){var aTools=[sap.galilei.ui.editor.tool.PointerTool,sap.galilei.ui.editor.tool.LassoTool],index,oTool;for(index=0;index<aTools.length;index++){oTool=new aTools[index]({editor:this});if(oTool){sap.galilei.ui.editor.tool.addTool(oTool.name,oTool)}}this.selectTool(sap.galilei.ui.editor.tool.PointerTool.NAME)},registerStandardTools:function(){this.extension.registerStandardTools()},defaultRegisterDiagramTools:function(){var oToolsDef,oToolDef,sToolClassName,oToolClass,oTool,index;oToolsDef=this.getToolsDefinition();if(oToolsDef){for(index=0;index<oToolsDef.length;index++){oToolDef=oToolsDef[index];oToolDef.editor=this;sToolClassName=oToolDef.className;if(!sToolClassName){switch(oToolDef.type){case sap.galilei.ui.editor.tool.Types.createNodeSymbolTool:sToolClassName="sap.galilei.ui.editor.tool.CreateNodeSymbolTool";break;case sap.galilei.ui.editor.tool.Types.createLinkSymbolTool:sToolClassName="sap.galilei.ui.editor.tool.CreateLinkSymbolTool";break;case sap.galilei.ui.editor.tool.Types.compoundCreateNodeSymbolTool:sToolClassName="sap.galilei.ui.editor.tool.CompoundCreateNodeSymbolTool";break;default:sToolClassName="sap.galilei.ui.editor.tool.Tool";break}}oToolClass=sap.galilei.core.getClass(sToolClassName);if(oToolClass){oTool=oToolClass.create(oToolDef)}if(oTool){sap.galilei.ui.editor.tool.addTool(oTool.name,oTool)}}}},registerDiagramTools:function(){this.extension.registerDiagramTools()},getToolsDefinition:function(){return this.extension.getToolsDefinition()},getTopLevelTools:function(){return this.extension.getTopLevelTools()},defaultRegisterDiagramCommands:function(){var oCommandsDef,oCommandDef,sCommandClassName,oCommandClass,oCommand,index;oCommandsDef=this.getCommandsDefinition();if(oCommandsDef){for(index=0;index<oCommandsDef.length;index++){oCommandDef=oCommandsDef[index];sCommandClassName=oCommandDef.className;if(!sCommandClassName){sCommandClassName="sap.galilei.ui.editor.command.Command"}oCommandDef.editor=this;oCommandClass=sap.galilei.core.getClass(sCommandClassName);if(oCommandClass){oCommand=oCommandClass.create(oCommandDef)}if(oCommand){sap.galilei.ui.common.command.addCommand(oCommand.name,oCommand)}}}},registerDiagramCommands:function(){this.extension.registerDiagramCommands()},getCommandsDefinition:function(){return this.extension.getCommandsDefinition()},selectTool:function(sToolName,bUnselectSymbols){var oTool;if(this.tool){this.tool.isSelected=false;this.tool.onUnselected();this.tool=undefined}if(bUnselectSymbols!==false){this.unselectAllSymbols(true)}if(sToolName){oTool=sap.galilei.ui.editor.tool.getTool(sToolName);if(oTool&&oTool.isEnabled){oTool.editor=this;oTool.isSelected=true;oTool.onSelected();this.tool=oTool}}},findSymbolElement:function(oElement){if(oElement){if(oElement.nodeName==="g"&&(sap.galilei.ui.common.svg.Svg.hasClass(oElement,"nodeGroup")||sap.galilei.ui.common.svg.Svg.hasClass(oElement,"linkGroup"))){return oElement}if(sap.galilei.ui.common.svg.Svg.hasClass(oElement,"diagram-object")||sap.galilei.ui.common.svg.Svg.hasClass(oElement,"diagram-link")){return oElement}if(oElement.parentNode&&oElement.parentNode.nodeName==="g"){return this.findSymbolElement(oElement.parentNode)}}return undefined},findSymbolById:function(oSymbols,sId,bIncludeSubSymbols){if(oSymbols){var index,oSymbol,oSubSymbol;if(oSymbols){for(index=0;index<oSymbols.length;index++){if(oSymbols.get){oSymbol=oSymbols.get(index)}else{oSymbol=oSymbols[index]}if(oSymbol.objectId===sId){return oSymbol}}if(bIncludeSubSymbols){for(index=0;index<oSymbols.length;index++){if(oSymbols.get){oSymbol=oSymbols.get(index)}else{oSymbol=oSymbols[index]}if(oSymbol.isComposite){oSubSymbol=this.findSymbolById(oSymbol.symbols,sId,bIncludeSubSymbols);if(oSubSymbol){return oSubSymbol}}}}}}return undefined},checkIsPointInSymbol:function(oSymbol,x,y){if(oSymbol){var oShape,aPoint,oRect,i,length,oSeg;if(oSymbol.isLinkSymbol){oShape=oSymbol.getLinkShape();if(oShape){aPoint=this.viewer.clientPointToViewPoint([x,y]);if(oShape.isPointOnBorder(aPoint,undefined,5)){return true}}return false}else{oShape=oSymbol.getBoundaryShape();if(oShape&&oShape.filter){aPoint=this.viewer.clientPointToViewPoint([x,y]);return oShape.isPointInShape(aPoint,oSymbol.getBBox())}}}return true},getSymbolByPoint:function(x,y,d3RootShape,bIncludeSubSymbols,radius,fnSkip){var aNodeList,index,oSymbolNode,oSymbol;d3RootShape=d3RootShape||(this.viewer&&this.viewer.d3MainShapeLayer);if(d3RootShape&&d3RootShape.node()&&this.viewer){aNodeList=this.viewer.getElementsByPoint(x,y,d3RootShape.node(),radius);if(aNodeList){for(index=aNodeList.length-1;index>=0;index--){oSymbolNode=this.findSymbolElement(aNodeList[index]);if(oSymbolNode){oSymbol=this.findSymbolById(this.diagram.symbols,oSymbolNode.getAttribute("id"),bIncludeSubSymbols);if(oSymbol&&this.checkIsPointInSymbol(oSymbol,x,y)){if(fnSkip&&fnSkip.call(this,oSymbol)){continue}return oSymbol}}}}}return undefined},getSymbolsByPoint:function(x,y,d3RootShape,bIncludeSubSymbols,radius,fnSkip){var aNodeList,index,oSymbolNode,oSymbol,aSymbols;d3RootShape=d3RootShape||(this.viewer&&this.viewer.d3MainShapeLayer);if(d3RootShape&&d3RootShape.node()&&this.viewer){aNodeList=this.viewer.getElementsByPoint(x,y,d3RootShape.node(),radius);if(aNodeList){for(index=0;index<aNodeList.length;index++){oSymbolNode=this.findSymbolElement(aNodeList[index]);if(oSymbolNode){oSymbol=this.findSymbolById(this.diagram.symbols,oSymbolNode.getAttribute("id"),bIncludeSubSymbols);if(oSymbol&&this.checkIsPointInSymbol(oSymbol,x,y)){if(fnSkip&&fnSkip.call(this,oSymbol)){continue}if(!aSymbols){aSymbols=[];aSymbols.push(oSymbol)}else{if(aSymbols.indexOf(oSymbol)===-1){aSymbols.push(oSymbol)}}}}}}}return aSymbols},getNodeSymbolByPoint:function(x,y,d3RootShape,bIncludeSubSymbols,radius){return this.getSymbolByPoint(x,y,d3RootShape,bIncludeSubSymbols,radius,function(oSymbol){return oSymbol.isLinkSymbol})},getLinkSymbolByPoint:function(x,y,d3RootShape,bIncludeSubSymbols,radius){return this.getSymbolByPoint(x,y,d3RootShape,bIncludeSubSymbols,radius,function(oSymbol){return !oSymbol.isLinkSymbol})},defaultCanAttachSymbol:function(oParent,oSymbol,oAttachParam){if(oParent&&oSymbol){var oCreateParam={},bCanCreate;if(oParent===oSymbol||(oSymbol.parentSymbol===oParent&&(!oParent.isSwimlaneSymbol||!oSymbol.isSwimlaneSymbol))){return false}if(oParent.object&&oSymbol.object===oParent.object){return false}if(!sap.galilei.model.isInstanceOf(oParent,"sap.galilei.ui.diagram.Diagram")){if(!oParent.isComposite){return false}}if(oParent.isSwimlaneSymbol){if(!oSymbol.isSwimlaneSymbol&&!oParent.isLeafSwimlaneSymbol){return false}}if(oAttachParam){oCreateParam.point=oAttachParam.point}if(!sap.galilei.model.isInstanceOf(oParent,"sap.galilei.ui.diagram.Diagram")){oCreateParam.parentSymbol=oParent}bCanCreate=this.canCreateSymbol(oSymbol.classDefinition.qualifiedName,oCreateParam);if(bCanCreate&&oAttachParam){oAttachParam.point=oCreateParam.point}return bCanCreate}return false},canAttachSymbol:function(oParent,oSymbol,oAttachParam){return this.extension.canAttachSymbol(oParent,oSymbol,oAttachParam)},getObjectSymbol:function(oObject){var index,max,oSymbol;if(oObject){for(index=0,max=oObject.relatedSymbols.length;index<max;index++){oSymbol=oObject.relatedSymbols.get(index);if(oSymbol.diagram===this.diagram){return oSymbol}}}return undefined},getObjectSymbols:function(oObject){var aSymbols=[],index,max,oSymbol;if(oObject){for(index=0,max=oObject.relatedSymbols.length;index<max;index++){oSymbol=oObject.relatedSymbols.get(index);if(oSymbol.diagram===this.diagram){aSymbols.push(oSymbol)}}}return aSymbols},getUndoRedoSymbols:function(aActions){var self=this,oUndoRedoSymbols={deleted:[],created:[],updated:[],parentChanged:[]},objectsMap={},index,oAction,oObject,objectSymbolsMap={},aSymbols,indexSymbol,oSymbol,oSubSymbol;function getObjectFromId(sId){oObject=objectsMap[sId];if(!oObject){oObject=self.resource.getObject(sId);objectsMap[sId]=oObject}return oObject}function getSymbolsOfObject(oObject){aSymbols=objectSymbolsMap[oObject.objectId];if(!aSymbols){aSymbols=self.getObjectSymbols(oObject);objectSymbolsMap[oObject.objectId]=aSymbols}return aSymbols}if(aActions){for(index=0;index<aActions.length;index++){oAction=aActions[index];oObject=getObjectFromId(oAction.objectId);if(oObject){if(sap.galilei.model.isInstanceOf(oObject,"sap.galilei.ui.diagram.Symbol")){oSymbol=oObject;switch(oAction.type){case sap.galilei.model.ActionTypes.deleteObject:oUndoRedoSymbols.deleted.push(oSymbol);break;case sap.galilei.model.ActionTypes.createObject:oUndoRedoSymbols.created.push(oSymbol);break;default:if(oUndoRedoSymbols.deleted.indexOf(oSymbol)===-1&&oUndoRedoSymbols.created.indexOf(oSymbol)===-1&&oUndoRedoSymbols.updated.indexOf(oSymbol)===-1){oUndoRedoSymbols.updated.push(oSymbol)}if(oAction.type===sap.galilei.model.ActionTypes.addReferenceObject&&oAction.actionParameters&&oAction.actionParameters.referenceName==="symbols"){oSubSymbol=getObjectFromId(oAction.actionParameters.objectId);if(oSubSymbol){if(oUndoRedoSymbols.deleted.indexOf(oSubSymbol)===-1&&oUndoRedoSymbols.created.indexOf(oSubSymbol)===-1&&oUndoRedoSymbols.updated.indexOf(oSubSymbol)===-1){oUndoRedoSymbols.updated.push(oSubSymbol)}oUndoRedoSymbols.parentChanged.push(oSubSymbol)}}break}}else{switch(oAction.type){case sap.galilei.model.ActionTypes.deleteObject:case sap.galilei.model.ActionTypes.createObject:break;default:aSymbols=getSymbolsOfObject(oObject);for(indexSymbol=0;indexSymbol<aSymbols.length;indexSymbol++){oSymbol=aSymbols[indexSymbol];if(oUndoRedoSymbols.deleted.indexOf(oSymbol)===-1&&oUndoRedoSymbols.created.indexOf(oSymbol)===-1&&oUndoRedoSymbols.updated.indexOf(oSymbol)===-1){oUndoRedoSymbols.updated.push(oSymbol)}}break}}}}}return oUndoRedoSymbols},updateUndoRedoSymbols:function(oUndoRedoSymbols,bUseAnimation){if(oUndoRedoSymbols){if(bUseAnimation===undefined){bUseAnimation=true}if(oUndoRedoSymbols.deleted.length>0){this.detachSymbols(oUndoRedoSymbols.deleted,bUseAnimation)}if(oUndoRedoSymbols.created.length>0){this.registerSymbolsEvents(oUndoRedoSymbols.created);this.drawSymbols(oUndoRedoSymbols.created,bUseAnimation?this.undoRedoTransitionDefinition:undefined)}if(oUndoRedoSymbols.updated.length>0){this.drawSymbols(oUndoRedoSymbols.updated,bUseAnimation?this.undoRedoTransitionDefinition:undefined)}}},canUndo:function(){if(!this.isReadOnly&&this.resource){return this.resource.canUndo()}return false},canRedo:function(){if(!this.isReadOnly&&this.resource){return this.resource.canRedo()}return false},undo:function(){if(!this.isReadOnly&&this.canUndo()&&this.resource){var aActions=this.resource.undo();this.updateUndoRedoSymbols(this.getUndoRedoSymbols(aActions))}},redo:function(){if(!this.isReadOnly&&this.canRedo()&&this.resource){var aActions=this.resource.redo();this.updateUndoRedoSymbols(this.getUndoRedoSymbols(aActions))}},undoAll:function(){var aAllActions=[],aActions;if(!this.isReadOnly&&this.canUndo()&&this.resource){while(this.canUndo()){aActions=this.resource.undo();if(aActions){aAllActions=aAllActions.concat(aActions)}}this.updateUndoRedoSymbols(this.getUndoRedoSymbols(aAllActions),false)}},clearUndoRedo:function(bClearListActions){if(this.resource){this.resource.clearUndoStack();if(bClearListActions===undefined||bClearListActions){this.resource.clearListOfActions()}}},onPreZoomPan:function(viewer,scale,translate){if(scale!==viewer.oldZoomScale||translate[0]!==viewer.oldZoomTranslate[0]||translate[1]!==viewer.oldZoomTranslate[1]){}},onPostZoomPan:function(viewer,scale,translate){if(scale!==viewer.oldZoomScale||translate[0]!==viewer.oldZoomTranslate[0]||translate[1]!==viewer.oldZoomTranslate[1]){}},moveSymbolsBy:function(vSymbols,dx,dy,oViewer,oTransitionDef){if(dx!==undefined&&dy!==undefined&&!isNaN(dx)&&!isNaN(dy)&&(dx!==0||dy!==0)&&vSymbols){var oSymbol,aSymbols=vSymbols,oLinkSymbol,oSource,oTarget,aNodeSymbols=[],oLinkSymbolMap={},oNodeSymbolMap={},aCollection,i,j,k,length,aStack,sId,bSourceMoved,bTargetMoved,aPoints;if(sap.galilei.model.isInstanceOf(vSymbols,"sap.galilei.ui.diagram.Symbol")){aSymbols=[vSymbols]}for(i=0,length=aSymbols.length;i<length;i++){aStack=[aSymbols[i]];while(aStack.length>0){oSymbol=aStack.pop();if(oSymbol.isLinkSymbol){if(oSymbol&&!oLinkSymbolMap[oSymbol.objectId]){oLinkSymbolMap[oSymbol.objectId]=oSymbol}}else{aNodeSymbols.push(oSymbol);oNodeSymbolMap[oSymbol.objectId]=oSymbol;aCollection=oSymbol.getLinkSymbols();if(aCollection){for(k=0;k<aCollection.length;k++){oLinkSymbol=aCollection[k];if(oLinkSymbol&&!oLinkSymbolMap[oLinkSymbol.objectId]){oLinkSymbolMap[oLinkSymbol.objectId]=oLinkSymbol}}}}if(oSymbol.isComposite){for(j=oSymbol.symbols.length-1;j>=0;j--){aStack.push(oSymbol.symbols.get(j))}}}}for(i=0,length=aNodeSymbols.length;i<length;i++){oSymbol=aNodeSymbols[i];oSymbol.moveBy(dx,dy,{moveSubSymbols:false,moveLinkSymbols:false},oViewer,oTransitionDef)}for(sId in oLinkSymbolMap){oLinkSymbol=oLinkSymbolMap[sId];oSource=oLinkSymbol.sourceSymbol;oTarget=oLinkSymbol.targetSymbol;if(oSource&&oTarget){bSourceMoved=oNodeSymbolMap[oSource.objectId];bTargetMoved=oNodeSymbolMap[oTarget.objectId];if(bSourceMoved&&bTargetMoved){oLinkSymbol.moveBy(dx,dy,undefined,oViewer,oTransitionDef)}else{if(bSourceMoved||bTargetMoved){aPoints=oLinkSymbol.points.clone();if(bSourceMoved){aPoints[0][0]+=dx;aPoints[0][1]+=dy}else{if(bTargetMoved){aPoints[aPoints.length-1][0]+=dx;aPoints[aPoints.length-1][1]+=dy}}oLinkSymbol.points=aPoints;oLinkSymbol.isAutomaticRouting=true;oLinkSymbol.updateLinkRouting(true,oViewer,oTransitionDef)}}}}}},postMoveSymbols:function(vSymbols,oSymbolContainers){if(this.extension.postMoveSymbols){this.extension.postMoveSymbols(vSymbols,oSymbolContainers)}},updateSymbolDrawingOrder:function(oTransitionDef){var oParentNode=this.viewer&&this.viewer.svgMainShapeLayer;if(oParentNode){setTimeout(function(){var i,j,length,oNode,oRefNode,zindex,refZindex;for(i=1,length=oParentNode.childNodes.length;i<length;i++){oNode=oParentNode.childNodes[i];if(!oNode.getAttributeNS){continue}zindex=parseInt(oNode.getAttributeNS(sap.galilei.ui.common.NAMESPACE_GALILEI,"data-zindex"));if(isNaN(zindex)){continue}for(j=i-1;j>=0;j--){oRefNode=oParentNode.childNodes[j];if(!oRefNode.getAttributeNS){continue}refZindex=parseInt(oRefNode.getAttributeNS(sap.galilei.ui.common.NAMESPACE_GALILEI,"data-zindex"));if(isNaN(refZindex)){continue}if(refZindex<=zindex){oParentNode.insertBefore(oNode,oRefNode.nextSibling);break}}if(j===-1){oParentNode.insertBefore(oNode,oParentNode.firstChild)}}},oTransitionDef?oTransitionDef.duration:0)}},cloneLinkObjectParams:function(oSourceLink){return this.extension.cloneLinkObjectParams(oSourceLink)}},statics:{diagramEditors:undefined,getActiveEditor:function(){var index,oDiagramEditor;for(index=0;index<sap.galilei.ui.editor.DiagramEditor.diagramEditors.length;index++){oDiagramEditor=sap.galilei.ui.editor.DiagramEditor.diagramEditors[index];if(oDiagramEditor.viewer.hasFocus){return oDiagramEditor}}for(index=0;index<sap.galilei.ui.editor.DiagramEditor.diagramEditors.length;index++){oDiagramEditor=sap.galilei.ui.editor.DiagramEditor.diagramEditors[index];if(oDiagramEditor.viewer===sap.galilei.ui.common.svg.Viewer.currentViewer){return oDiagramEditor}}return undefined}}});sap.galilei.ui.editor.defineDiagramEditor=function(oDiagramEditorDef){oDiagramEditorDef=sap.galilei.ui.editor.transformDiagramEditorDef(oDiagramEditorDef);return sap.galilei.core.defineClass(oDiagramEditorDef)};sap.galilei.ui.editor.transformDiagramEditorDef=function(oDiagramEditorDef){oDiagramEditorDef=oDiagramEditorDef||{};var parent=oDiagramEditorDef.parent||sap.galilei.ui.editor.DiagramEditor,oExtensionParam=oDiagramEditorDef.extension||{},oExtensionClass,oViewerParam=oDiagramEditorDef.viewer||{},oViewerClass,properties=oDiagramEditorDef.properties||{};oExtensionClass=oExtensionParam.extensionClass;if(!oExtensionClass){oExtensionClass=sap.galilei.ui.editor.DiagramEditorExtension}else{delete oExtensionParam.extensionClass}if(oExtensionClass){properties.extensionClass={value:oExtensionClass,writable:false,configurable:false}}if(oExtensionParam){properties.extensionParam={value:oExtensionParam,writable:false,configurable:false}}delete oDiagramEditorDef.extension;oViewerClass=oViewerParam.viewerClass;if(!oViewerClass){oViewerClass=sap.galilei.ui.common.svg.Viewer}else{delete oViewerParam.viewerClass}if(oViewerClass){properties.viewerClass={value:oViewerClass,writable:false,configurable:false}}if(oViewerParam){properties.viewerParam={value:oViewerParam,writable:false,configurable:false}}delete oDiagramEditorDef.viewer;oDiagramEditorDef.parent=parent;oDiagramEditorDef.properties=properties;return oDiagramEditorDef};
"use strict";sap.galilei.ui.editor.DiagramEditorExtension=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.editor.DiagramEditorExtension",initialize:function(oEditor,oParam){if(!oEditor){throw"Error: The diagram editor must be specified."}this.editor=oEditor;if(oParam){this.set(oParam)}this.defaultOnInitialize();if(this.onInitialize){this.onInitialize()}},properties:{editor:undefined,resource:{get:function(){if(this.editor){return this.editor.resource}return undefined}},model:{get:function(){if(this.editor){return this.editor.model}return undefined}},diagram:{get:function(){if(this.editor){return this.editor.diagram}return undefined}},viewer:{get:function(){if(this.editor){return this.editor.viewer}return undefined}},modelPackageName:undefined,diagramPackageName:undefined,LINK_OBJECT_SOURCE:"source",LINK_OBJECT_TARGET:"target",imagesFolder:"images"},methods:{defaultOnInitialize:function(){var glowFilter=new sap.galilei.ui.common.style.Glow({id:"filterSelectionGlow",color:"#7CAAC6",size:3});glowFilter.createGlow(this.viewer)},onInitialize:function(){},dispose:function(){},createObject:function(sObjectClassName,oParam){return this.editor.defaultCreateObject(sObjectClassName,oParam)},setDefaultObjectName:function(oObject){return this.editor.defaultSetDefaultObjectName(oObject)},canCreateSymbol:function(sSymbolClass,oCreateParam){return this.editor.defaultCanCreateSymbol(sSymbolClass,oCreateParam)},canCreateObject:function(sObjectClass,oParent,oProperties){return this.editor.defaultCanCreateObject(sObjectClass,oParent,oProperties)},canSetObjectProperties:function(oObject,oProperties){return this.editor.defaultCanSetObjectProperties(oObject,oProperties)},canCreateInstance:function(sClass,oParams){return true},getParentObjectByParentSymbol:function(oParentSymbol,sObjectClass){return this.editor.defaultGetParentObjectByParentSymbol(oParentSymbol,sObjectClass)},canAttachSymbol:function(oParent,oSymbol,oAttachParam){return this.editor.defaultCanAttachSymbol(oParent,oSymbol,oAttachParam)},createSymbol:function(sSymbolClassName,oParam){return this.editor.defaultCreateSymbol(sSymbolClassName,oParam)},postCreateSymbol:function(oSymbol){return this.editor.defaultPostCreateSymbol(oSymbol)},canCreateLinkSymbol:function(oSourceSymbol,oTargetSymbol,oLinkTool){return this.editor.defaultCanCreateLinkSymbol(oSourceSymbol,oTargetSymbol,oLinkTool)},canInsertSymbolOnLinkSymbol:function(sSymbolClass,oCreateParam){return this.editor.defaultCanInsertSymbolOnLinkSymbol(sSymbolClass,oCreateParam)},canDeleteSymbol:function(oSymbol){var oEvent={};oEvent.cancel=false;this.editor.addEventProperties(oEvent,oSymbol);sap.galilei.core.Event.publish("can.delete.symbol",this.editor,this.editor,oEvent);return !oEvent.cancel},canDeleteSymbols:function(aSymbols){var oEvent={};oEvent.cancel=false;this.editor.addEventProperties(oEvent);oEvent.selectedSymbols=aSymbols;sap.galilei.core.Event.publish("can.delete.symbols",this.editor,this.editor,oEvent);if(oEvent.cancel){return false}return true},postDeleteSymbol:function(oContainer,oDeletedSymbol,bDeleteObject,bPreserveLink,bUseUndoAction){},selectLinkSymbolDefinition:function(oSourceSymbol,oTargetSymbol){return undefined},getLinkObjectSourceReferenceName:function(sLinkObjectClass){return this.LINK_OBJECT_SOURCE},getLinkObjectTargetReferenceName:function(sLinkObjectClass){return this.LINK_OBJECT_TARGET},cloneLinkObjectParams:function(oSourceLink){return{}},postCreateLinkSymbol:function(oSourceSymbol,oTargetSymbol,oLinkSymbol){},registerSymbolEvents:function(oSymbol){return this.editor.defaultRegisterSymbolEvents(oSymbol)},unregisterSymbolEvents:function(oSymbol){return this.editor.defaultUnregisterSymbolEvents(oSymbol)},onKeyDown:function(oEvent){return this.editor.defaultOnKeyDown(oEvent)},canSupportInPlaceEditing:function(oSymbol,aClientPoint){return true},registerStandardTools:function(){return this.editor.defaultRegisterStandardTools()},registerDiagramTools:function(){this.editor.defaultRegisterDiagramTools()},getToolsDefinition:function(){return undefined},getTopLevelTools:function(){return undefined},registerDiagramCommands:function(){this.editor.defaultRegisterDiagramCommands()},getCommandsDefinition:function(){return undefined},getOrCreateContextButtonPad:function(oSymbol){return this.editor.defaultGetOrCreateContextButtonPad(oSymbol)},getContextButtonPad:function(oSymbol){return this.editor.defaultGetContextButtonPad(oSymbol)},canSelectSymbolByPoint:function(oSymbol,aViewPoint){return this.editor.defaultCanSelectSymbolByPoint(oSymbol,aViewPoint)},addImagesFolder:function(oToolsDef){if(oToolsDef&&this.imagesFolder){var index,oTool;for(index=0;index<oToolsDef.length;index++){oTool=oToolsDef[index];if(oTool){if(oTool.smallIcon&&oTool.smallIcon[0]!=="#"){oTool.smallIcon=this.imagesFolder+"/"+oTool.smallIcon}if(oTool.largeIcon&&oTool.largeIcon[0]!=="#"){oTool.largeIcon=this.imagesFolder+"/"+oTool.largeIcon}if(oTool.cursor&&oTool.cursor[0]!=="#"){oTool.cursor=this.imagesFolder+"/"+oTool.cursor}}}}},onSetEditorProfile:function(sProfileName){}}});sap.galilei.ui.editor.defineDiagramEditorExtension=function(oDiagramEditorExtDef){oDiagramEditorExtDef=sap.galilei.ui.editor.transformDiagramEditorExtensionDef(oDiagramEditorExtDef);return sap.galilei.core.defineClass(oDiagramEditorExtDef)};sap.galilei.ui.editor.transformDiagramEditorExtensionDef=function(oDiagramEditorExtDef){var parent=oDiagramEditorExtDef.parent||sap.galilei.ui.editor.DiagramEditorExtension;oDiagramEditorExtDef.parent=parent;return oDiagramEditorExtDef};
