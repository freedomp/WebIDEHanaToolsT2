(function(){"use strict";jQuery.sap.require('sap.m.Input');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchHelper');var s=sap.ushell.renderers.fiori2.search.SearchHelper;jQuery.sap.require('sap.ushell.renderers.fiori2.search.suggestions.SuggestionTypes');var S=sap.ushell.renderers.fiori2.search.suggestions.SuggestionTypes;sap.m.Input.extend('sap.ushell.renderers.fiori2.search.controls.SearchInput',{constructor:function(i,o){var t=this;o=jQuery.extend({},{showValueStateMessage:false,showTableSuggestionValueHelp:false,showSuggestion:true,filterSuggests:false,suggestionColumns:[new sap.m.Column({})],placeholder:{path:'/searchTermPlaceholder',mode:sap.ui.model.BindingMode.OneWay}},o);sap.m.Input.prototype.constructor.apply(this,[i,o]);this.addEventDelegate({onsapenter:function(e){if(t.getValue()!==''){t.triggerSearch(e);}}});this.bindAggregation("suggestionRows","/suggestions",function(i,c){return t.suggestionItemFactory(i,c);});this.addStyleClass('searchInput');this._bUseDialog=false;this._bFullScreen=false;},renderer:'sap.m.InputRenderer',fireChange:function(e){sap.m.Input.prototype.fireChange.apply(this,arguments);if(sap.ui.Device.system.phone){this.triggerSearch(e);}},triggerSearch:function(e){var t=this;this.changeTimer=window.setTimeout(function(){t.changeTimer=null;s.subscribeOnlyOnce('triggerSearch','allSearchFinished',function(){t.getModel().autoStartApp();},t);t.getModel().setSearchBoxTerm(t.getValue(),false);t.navigateToSearchApp();t.destroySuggestionRows();t.getModel().abortSuggestions();},100);},fireLiveChange:function(){sap.m.Input.prototype.fireLiveChange.apply(this,arguments);var a=this.getValue();var m=this.getModel();m.setSearchBoxTerm(a,false);if(m.getSearchBoxTerm().length>0&&!sap.ui.Device.system.phone){m.doSuggestion();}else{this.destroySuggestionRows();m.abortSuggestions();}},fireSuggestionItemSelected:function(e){sap.m.Input.prototype.fireSuggestionItemSelected.apply(this,arguments);if(this.changeTimer){window.clearTimeout(this.changeTimer);this.changeTimer=null;}this.doHandleSuggestionItemSelected(e);},doHandleSuggestionItemSelected:function(e){var m=this.getModel();var a=m.getSearchBoxTerm();var b=e.selectedRow.getBindingContext().getObject();var c=b.labelRaw;var d=b.dataSource;var t=b.url;var f=b.type;switch(f){case S.SUGGESTION_TYPE_APPS:m.analytics.logCustomEvent('FLP: Search','Suggestion Select App',[b.title,t,a]);m.analytics.logCustomEvent('FLP: Application Launch point','Search Suggestions',[b.title,t,a]);if(t[0]==='#'){window.location.href=t;}else{window.open(t,'_blank');}break;case S.SUGGESTION_TYPE_DATASOURCE:m.analytics.logCustomEvent('FLP: Search','Suggestion Select Datasource',[d.key,a]);m.setDataSource(d,false);m.setSearchBoxTerm('',false);this.focus();break;case S.SUGGESTION_TYPE_OBJECT_DATA:m.analytics.logCustomEvent('FLP: Search','Suggestion Select Object Data',[c,d.key,a]);m.setDataSource(d,false);m.setSearchBoxTerm(c,false);this.navigateToSearchApp();this.setValue(c);break;case S.SUGGESTION_TYPE_HISTORY:m.analytics.logCustomEvent('FLP: Search','Suggestion Select History',[c,d.key,a]);m.setDataSource(d,false);m.setSearchBoxTerm(c,false);this.navigateToSearchApp();this.setValue(c);break;default:break;}},suggestionItemFactory:function(i,c){var a=new sap.m.Label({text:{path:"icon",formatter:function(v){if(v){return"<i>"+sap.ushell.resources.i18n.getText("label_app")+"</i>";}return"";}}}).addStyleClass('suggestText').addStyleClass('suggestNavItem');a.addEventDelegate({onAfterRendering:function(){s.boldTagUnescaper(this.getDomRef());}},a);var b=new sap.ui.core.Icon({src:"{icon}"}).addStyleClass('suggestIcon').addStyleClass('sapUshellSearchSuggestAppIcon');var l=new sap.m.Label({text:"{label}"}).addStyleClass('suggestText').addStyleClass('suggestNavItem');l.addEventDelegate({onAfterRendering:function(){s.boldTagUnescaper(this.getDomRef());}},l);var d=new sap.m.CustomListItem({type:sap.m.ListType.Active,content:[a,b,l]});var e=c.oModel.getProperty(c.sPath);d.getText=function(){return e.labelRaw?e.labelRaw:'';};var f=new sap.m.ColumnListItem({cells:[d],type:"Active"});if(e.type===S.SUGGESTION_TYPE_APPS){f.addStyleClass('searchAppSuggestion');}if(e.type===S.SUGGESTION_TYPE_DATASOURCE){f.addStyleClass('searchDataSourceSuggestion');}if(e.type===S.SUGGESTION_TYPE_OBJECT_DATA){f.addStyleClass('searchBOSuggestion');}if(e.type===S.SUGGESTION_TYPE_HISTORY){f.addStyleClass('searchHistorySuggestion');}f.addStyleClass('searchSuggestion');return f;},navigateToSearchApp:function(){if(this.getModel().getProperty('/searchBoxTerm')===""){return;}if(window.location.hash.indexOf('#Action-search')===0){this.getModel()._searchFireQuery();}else{var h=this.getModel().createSearchURL();window.location.hash=h;}}});})();
