/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.require("sap.apf.modeler.ui.utils.textPoolHelper");sap.ui.controller("sap.apf.modeler.ui.controller.category",{onInit:function(){this.getView().addStyleClass("sapUiSizeCompact");this.oViewData=this.getView().getViewData();this.oConfigurationHandler=this.oViewData.oConfigurationHandler;this.oConfigurationEditor=this.oViewData.oConfigurationEditor;this.oTextPool=this.oConfigurationHandler.getTextPool();this.getText=this.oViewData.getText;this.params=this.oViewData.oParams;var s=this;if(!this.oConfigurationEditor){this.oConfigurationHandler.loadConfiguration(this.params.arguments.configId,function(c){s.oConfigurationEditor=c;});}this._setDisplayText();this.setDetailData();var m=[];m.push(this.byId("idCategoryTitle"));this._setMandatoryFields(m);},_setDisplayText:function(){this.byId("idCategoryBasicData").setTitle(this.getText("categoryData"));this.byId("idCategoryTitleLabel").setText(this.getText("categoryTitle"));this.byId("idCategoryTitleLabel").setRequired(true);this.byId("idCategoryTitle").setPlaceholder(this.getText("newCategory"));this.byId("idTotalStepsLabel").setText(this.getText("totalSteps"));},_addAutoCompleteFeatureOnInputs:function(){if(this.oConfigurationHandler){var i=this.byId("idCategoryTitle");var t=new sap.apf.modeler.ui.utils.TextPoolHelper(this.oTextPool);var T=sap.apf.modeler.ui.utils.TranslationFormatMap.CATEGORY_TITLE;var d={oTranslationFormat:T,type:"text"};t.setAutoCompleteOn(i,d);}},setDetailData:function(){var s=this;if(this.params&&this.params.arguments&&this.params.arguments.categoryId){this.oCategory=this.oConfigurationEditor.getCategory(this.params.arguments.categoryId);}if(this.oCategory){var n=this.oConfigurationEditor.getCategoryStepAssignments(this.oCategory.getId()).length;if(this.oTextPool.get(this.oCategory.labelKey)!==undefined){this.byId("idCategoryTitle").setValue(this.oTextPool.get(this.oCategory.labelKey).TextElementDescription);}else{this.byId("idCategoryTitle").setValue(this.oCategory.labelKey);}this.byId("idTotalSteps").setValue(n);}else{var a=this.oConfigurationEditor.setCategory();this.oCategory=this.oConfigurationEditor.getCategory(a);var c={id:a,icon:"sap-icon://open-folder"};this.oViewData.updateSelectedNode(c);}this._addAutoCompleteFeatureOnInputs();},handleChangeDetailValue:function(e){this.oConfigurationEditor.setIsUnsaved();var c=this.byId("idCategoryTitle").getValue().trim();var t=sap.apf.modeler.ui.utils.TranslationFormatMap.CATEGORY_TITLE;var C=this.oTextPool.setText(c,t);this.categoryObj={labelKey:C};var o={};if(c){this.oConfigurationEditor.setCategory(this.categoryObj,this.oCategory.getId());o.name=c;if(c){this.oViewData.updateSelectedNode(o);var T=this.getText("category")+": "+c;this.oViewData.updateTitleAndBreadCrumb(T);}}},_setMandatoryFields:function(f){this.mandatoryFields=this.mandatoryFields||[];for(var i=0;i<f.length;i++){f[i].isMandatory=true;this.mandatoryFields.push(f[i]);}},_getMandatoryFields:function(){return this.mandatoryFields;},_setValidationState:function(){var m=this._getMandatoryFields();for(var i=0;i<m.length;i++){if(m[i].isMandatory===true){this.isValidState=(m[i].getValue().trim()!=="")?true:false;if(this.isValidState===false){break;}}}},getValidationState:function(){this._setValidationState();var i=(this.isValidState!==undefined)?this.isValidState:true;return i;}});
