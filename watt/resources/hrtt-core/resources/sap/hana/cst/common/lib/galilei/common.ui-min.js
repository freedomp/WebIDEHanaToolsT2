"use strict";namespace("sap.galilei.ui.common");
"use strict";sap.galilei.ui.common.HorizontalAlignment={left:"left",center:"center",right:"right",width:"width",DEFAULT:"left"};sap.galilei.ui.common.VerticalAlignment={top:"top",middle:"middle",bottom:"bottom",height:"height",DEFAULT:"top"};sap.galilei.ui.common.DockPosition={topLeft:"topLeft",top:"top",topRight:"topRight",right:"right",bottomRight:"bottomRight",bottom:"bottom",bottomLeft:"bottomLeft",left:"left",center:"center",width:"width",height:"height",maximize:"maximize",DEFAULT:"topLeft"};sap.galilei.ui.common.Orientation={horizontal:"horizontal",vertical:"vertical",DEFAULT:"horizontal"};sap.galilei.ui.common.LineCap={butt:"butt",round:"round",square:"square",DEFAULT:undefined};sap.galilei.ui.common.LineJoin={miter:"miter",round:"round",bevel:"bevel",DEFAULT:undefined};sap.galilei.ui.common.DashStyle={solid:undefined,dash:"8,4",dot:"2,2",dashDot:"8,4,2,4",dashDotDot:"8,4,2,4,2,4",DEFAULT:undefined};sap.galilei.ui.common.LineStyle={normal:0,orthogonal:1,rounded:2,quadraticBezier:3,cubicBezier:4,DEFAULT:0};sap.galilei.ui.common.LayoutStyle={normal:0,vertical:1,horizontal:2,DEFAULT:0};sap.galilei.ui.common.ShapeLayoutModes={detail:"detail",icon:"icon",composite:"composite",DEFAULT:"detail"};sap.galilei.ui.common.LinkDirection={south:0,west:1,north:2,east:3,DEFAULT:undefined,opposite:function(direction){return(direction+2)%4},perpendiculars:function(direction){return[(direction+1)%4,(direction+3)%4]},rotate:function(direction,degree){return(Math.floor(degree/90)+direction)%4},degree:function(direction1,direction2){return(direction2-direction1)*90},verify:function(direction){if(direction===sap.galilei.ui.common.LinkDirection.south||direction===sap.galilei.ui.common.LinkDirection.west||direction===sap.galilei.ui.common.LinkDirection.north||direction===sap.galilei.ui.common.LinkDirection.east){return true}return false},convertDockPosition:function(sDockPosition){switch(sDockPosition){case sap.galilei.ui.common.DockPosition.right:return sap.galilei.ui.common.LinkDirection.east;case sap.galilei.ui.common.DockPosition.left:return sap.galilei.ui.common.LinkDirection.west;case sap.galilei.ui.common.DockPosition.top:return sap.galilei.ui.common.LinkDirection.north;case sap.galilei.ui.common.DockPosition.bottom:return sap.galilei.ui.common.LinkDirection.south}return undefined},toDockPosition:function(nLinkDirection){switch(nLinkDirection){case sap.galilei.ui.common.LinkDirection.east:return sap.galilei.ui.common.DockPosition.right;case sap.galilei.ui.common.LinkDirection.west:return sap.galilei.ui.common.DockPosition.left;case sap.galilei.ui.common.LinkDirection.north:return sap.galilei.ui.common.DockPosition.top;case sap.galilei.ui.common.LinkDirection.south:return sap.galilei.ui.common.DockPosition.bottom}return undefined}};sap.galilei.ui.common.MouseEvents={click:"click",dblclick:"dblclick",mousedown:"mousedown",mouseup:"mouseup",mouseenter:"mouseenter",mouseleave:"mouseleave",mouseover:"mouseover",mouseout:"mouseout",mousemove:"mousemove",mousewheel:"mousewheel"};sap.galilei.ui.common.isMouseEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.MouseEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.TouchEvents={touchstart:"touchstart",touchmove:"touchmove",touchend:"touchend",touchcancel:"touchcancel"};sap.galilei.ui.common.isTouchEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.TouchEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.PointerEvents={pointerdown:"pointerdown",pointerup:"pointerup",pointercancel:"pointercancel",pointermove:"pointermove",pointerover:"pointerover",pointerout:"pointerout",pointerenter:"pointerenter",pointerleave:"pointerleave"};sap.galilei.ui.common.PointerEventsMap={pointerdown:[sap.galilei.ui.common.MouseEvents.mousedown,sap.galilei.ui.common.TouchEvents.touchstart],pointerup:[sap.galilei.ui.common.MouseEvents.mouseup,sap.galilei.ui.common.TouchEvents.touchend],pointercancel:[sap.galilei.ui.common.TouchEvents.touchcancel],pointermove:[sap.galilei.ui.common.MouseEvents.mousemove,sap.galilei.ui.common.TouchEvents.touchmove],pointerover:[sap.galilei.ui.common.MouseEvents.mouseover],pointerout:[sap.galilei.ui.common.MouseEvents.mouseout],pointerenter:[sap.galilei.ui.common.MouseEvents.mouseenter],pointerleave:[sap.galilei.ui.common.MouseEvents.mouseleave]};sap.galilei.ui.common.isPointerEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.PointerEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.GestureEvents={hold:"hold",tap:"tap",doubletap:"doubletap",drag:"drag",dragstart:"dragstart",dragend:"dragend",dragup:"dragup",dragdown:"dragdown",dragleft:"dragleft",dragright:"dragright",swipe:"swipe",swipeup:"swipeup",swipedown:"swipedown",swipeleft:"swipeleft",swiperight:"swiperight",transform:"transform",transformstart:"transformstart",transformend:"transformend",rotate:"rotate",pinch:"pinch",pinchin:"pinchin",pinchout:"pinchout",touch:"touch",release:"release"};sap.galilei.ui.common.isGestureEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.GestureEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.KeyEvents={keydown:"keydown",keypress:"keypress",keyup:"keyup",textinput:"textinput"};sap.galilei.ui.common.isKeyEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.KeyEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX="dragdrop.";sap.galilei.ui.common.DragDropEvents={dragstart:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"dragstart",drag:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"drag",dragenter:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"dragenter",dragover:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"dragover",dragleave:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"dragleave",dragend:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"dragend",drop:sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX+"drop"};sap.galilei.ui.common.isDragDropEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.DragDropEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.DOMEvents={contextmenu:"contextmenu"};sap.galilei.ui.common.isDOMEvent=function(sEvent){return(sap.galilei.core.validateEnum(sap.galilei.ui.common.DOMEvents,sEvent,"unknown")===sEvent)};sap.galilei.ui.common.LinearGradientOrientations={leftToRight:"leftToRight",topToBottom:"topToBottom",leftTopToRightBottom:"leftTopToRightBottom",rightTopToLeftBottom:"rightTopToLeftBottom"};sap.galilei.ui.common.ZINDEX_STEP=10;sap.galilei.ui.common.ZINDEX_STEP_MINOR=1;sap.galilei.ui.common.NAMESPACE_GALILEI="http://www.sap.com/2014/galilei";
"use strict";sap.galilei.ui.common.Point=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Point",initialize:function(x,y){this.set.apply(this,arguments)},fields:{x:0,y:0},methods:{set:function(aPoint){if(arguments.length===2){this.x=arguments[0];this.y=arguments[1]}else{if(arguments.length===1&&aPoint!==undefined){if((aPoint instanceof Array)&&aPoint.length===2){this.x=aPoint[0];this.y=aPoint[1]}else{this.x=aPoint.x;this.y=aPoint.y}}}return this},matrixTransform:function(oMatrix,bRound,bCreateNew){var pt;if(oMatrix){pt=sap.galilei.ui.common.Point.matrixTransform(this.x,this.y,oMatrix,bRound);if(pt&&pt.length===2){if(bCreateNew===true){return new sap.galilei.ui.common.Point(pt[0],pt[1])}else{return this.set(pt[0],pt[1])}}}return this},toArray:function(){return[this.x,this.y]},getDistance:function(pt){return sap.galilei.ui.common.Point.getDistance(this,pt)},moveBy:function(dx,dy){if(dx!==undefined&&!isNaN(dx)&&dx!==0){this.x+=dx}if(dy!==undefined&&!isNaN(dy)&&dy!==0){this.y+=dy}},equals:function(vPoint){if(vPoint){var x,y;if((vPoint instanceof Array)&&vPoint.length===2){x=+vPoint[0];y=+vPoint[1]}else{if(typeof vPoint==="object"&&vPoint.x!==undefined&&!isNaN(vPoint.x)&&vPoint.y!==undefined&&!isNaN(vPoint.y)){x=+vPoint.x;y=+vPoint.y}}return(x===this.x&&y===this.y)}return false},snapToGrid:function(nGridSize,bCreateNew){var aPt=sap.galilei.ui.common.Point.snapToGrid(this,nGridSize);if(bCreateNew){return aPt}else{this.x=aPt[0];this.y=aPt[1];return[this.x,this.y]}}},statics:{_svgPoint:undefined,_svgPoint2:undefined,svgPoint:{get:function(){if(this._svgPoint===undefined){this._svgPoint=sap.galilei.ui.common.svg.Svg.hiddenSvg.createSVGPoint()}else{this._svgPoint.x=this._svgPoint.y=0}return this._svgPoint}},svgPoint2:{get:function(){if(this._svgPoint2===undefined){this._svgPoint2=sap.galilei.ui.common.svg.Svg.hiddenSvg.createSVGPoint()}else{this._svgPoint2.x=this._svgPoint2.y=0}return this._svgPoint2}},getDistance:function(pt1,pt2){var x1,y1,x2,y2,d=0;if(pt1 instanceof Array){x1=+pt1[0];y1=+pt1[1]}else{if(pt1){x1=+pt1.x;y1=+pt1.y}}if(pt2 instanceof Array){x2=+pt2[0];y2=+pt2[1]}else{if(pt2){x2=+pt2.x;y2=+pt2.y}}if(x1!==undefined&&y1!==undefined&&x2!==undefined&&y2!==undefined){d=Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1))}return d},parse:function(sPoint){if(sPoint){var aPoint=sPoint.split(",");if(aPoint&&aPoint.length===2){return[+aPoint[0].trim(),+aPoint[1].trim()]}}return undefined},getPointArray:function(vPoint){if(vPoint){if((vPoint instanceof Array)&&vPoint.length===2){return[+vPoint[0],+vPoint[1]]}else{if(typeof vPoint==="object"&&vPoint.x!==undefined&&!isNaN(vPoint.x)&&vPoint.y!==undefined&&!isNaN(vPoint.y)){return[+vPoint.x,+vPoint.y]}}}return undefined},snapToGrid:function(vPoint,nGridSize){if(vPoint){var x,y;if((vPoint instanceof Array)&&vPoint.length===2){x=+vPoint[0];y=+vPoint[1]}else{if(typeof vPoint==="object"&&vPoint.x!==undefined&&!isNaN(vPoint.x)&&vPoint.y!==undefined&&!isNaN(vPoint.y)){x=+vPoint.x;y=+vPoint.y}}x=sap.galilei.ui.common.geometry.snapToGrid(x,nGridSize);y=sap.galilei.ui.common.geometry.snapToGrid(y,nGridSize);return[x,y]}return vPoint},matrixTransform:function(x,y,oMatrix,bRound){if(x!==undefined&&!isNaN(x)&&y!==undefined&&!isNaN(y)&&oMatrix){var svgPoint=sap.galilei.ui.common.Point.svgPoint,svgMatrix=sap.galilei.ui.common.Matrix.svgMatrix,newSvgPoint;svgPoint.x=x;svgPoint.y=y;sap.galilei.ui.common.Matrix.setSvgMatrixProperties(svgMatrix,oMatrix);newSvgPoint=svgPoint.matrixTransform(svgMatrix);if(bRound!==false){newSvgPoint.x=Math.round(newSvgPoint.x);newSvgPoint.y=Math.round(newSvgPoint.y)}return[newSvgPoint.x,newSvgPoint.y]}}}});
"use strict";sap.galilei.ui.common.Rect=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Rect",initialize:function(x,y,width,height){this.set.apply(this,arguments)},fields:{x:0,y:0,width:0,height:0,left:{get:function(){return this.x},set:function(value){this.x=value}},top:{get:function(){return this.y},set:function(value){this.y=value}},right:{get:function(){return this.x+this.width},set:function(value){this.width=value-this.x;if(this.width<0){this.normalize()}}},bottom:{get:function(){return this.y+this.height},set:function(value){this.height=value-this.y;if(this.height<0){this.normalize()}}}},methods:{set:function(x,y,width,height){var pt1,pt2,oRect;if(arguments.length===4){this.x=x;this.y=y;this.width=width;this.height=height}else{if(arguments.length===2){pt1=arguments[0];pt2=arguments[1];if((pt1 instanceof Array)&&(pt2 instanceof Array)){this.x=Math.min(pt1[0],pt2[0]);this.y=Math.min(pt1[1],pt2[1]);this.width=Math.abs(pt2[0]-pt1[0]);this.height=Math.abs(pt2[1]-pt1[1])}else{if((typeof pt1)==="object"&&(typeof pt2)==="object"){this.x=Math.min(pt1.x,pt2.x);this.y=Math.min(pt1.y,pt2.y);this.width=Math.abs(pt2.x-pt1.x);this.height=Math.abs(pt2.y-pt1.y)}}}else{if(arguments.length===1&&(typeof arguments)==="object"){oRect=arguments[0];if(oRect){if(oRect.x!==undefined){this.x=oRect.x}else{if(oRect.left!==undefined){this.x=oRect.left}}if(oRect.y!==undefined){this.y=oRect.y}else{if(oRect.top!==undefined){this.y=oRect.top}}if(oRect.width!==undefined){this.width=oRect.width}if(oRect.height!==undefined){this.height=oRect.height}}}}}return this},clone:function(){return new sap.galilei.ui.common.Rect(this)},matrixTransform:function(oMatrix,bRound,bCreateNew){var svgPoint1=sap.galilei.ui.common.Point.svgPoint,svgPoint2=sap.galilei.ui.common.Point.svgPoint2,pt1,pt2,svgMatrix=sap.galilei.ui.common.Matrix.svgMatrix;if(oMatrix){svgPoint1.x=this.x;svgPoint1.y=this.y;svgPoint2.x=this.x+this.width;svgPoint2.y=this.y+this.height;sap.galilei.ui.common.Matrix.setSvgMatrixProperties(svgMatrix,oMatrix);pt1=svgPoint1.matrixTransform(svgMatrix);pt2=svgPoint2.matrixTransform(svgMatrix);if(bRound!==false){pt1.x=Math.round(pt1.x);pt1.y=Math.round(pt1.y);pt2.x=Math.round(pt2.x);pt2.y=Math.round(pt2.y)}if(bCreateNew===true){return new sap.galilei.ui.common.Rect(pt1,pt2)}else{return this.set(pt1,pt2)}}else{return this}},normalize:function(bCreateNew){var oRect;if(bCreateNew){oRect=this.clone()}else{oRect=this}if(oRect.width<0){oRect.width=-oRect.width;oRect.x-=oRect.width}if(oRect.height<0){oRect.height=-oRect.height;oRect.y-=oRect.height}return oRect},unionRect:function(rect){var xMin,yMin,xMax,yMax;if(rect){this.normalize();rect.normalize();xMin=this.x;yMin=this.y;xMax=this.x+this.width;yMax=this.y+this.height;xMin=Math.min(xMin,rect.x);yMin=Math.min(yMin,rect.y);xMax=Math.max(xMax,rect.x+rect.width);yMax=Math.max(yMax,rect.y+rect.height);this.set(xMin,yMin,xMax-xMin,yMax-yMin)}return this},unionPoint:function(point){var xMin,yMin,xMax,yMax,x,y;if(point){if(point instanceof Array){x=+point[0];y=+point[1]}else{x=+point.x;y=+point.y}if(x!==undefined&&y!==undefined){this.normalize();xMin=this.x;yMin=this.y;xMax=this.x+this.width;yMax=this.y+this.height;xMin=Math.min(xMin,x);yMin=Math.min(yMin,y);xMax=Math.max(xMax,x);yMax=Math.max(yMax,y);this.set(xMin,yMin,xMax-xMin,yMax-yMin)}}return this},inflate:function(left,top,right,bottom,bCreateNew){var nLeft=0,nTop=0,nRight=0,nBottom=0;if(arguments.length===1||(arguments.length===2&&(arguments[1]===true||arguments[1]===false))){nLeft=nTop=nRight=nBottom=arguments[0];if(arguments.length===2){bCreateNew=arguments[1]}else{bCreateNew=false}}else{if(arguments.length===2||arguments.length===3){nLeft=nRight=arguments[0];nTop=nBottom=arguments[1];if(arguments.length===3){bCreateNew=arguments[2]}}else{if(arguments.length===4||arguments.length===5){nLeft=left;nTop=top;nRight=right;nBottom=bottom}}}if(nLeft!==undefined){nLeft+=0}else{nLeft=0}if(nTop!==undefined){nTop+=0}else{nTop=0}if(nRight!==undefined){nRight+=0}else{nRight=0}if(nBottom!==undefined){nBottom+=0}else{nBottom=0}if(bCreateNew){return new sap.galilei.ui.common.Rect(this.x-nLeft,this.y-nTop,this.width+nLeft+nRight,this.height+nTop+nBottom)}else{this.x-=nLeft;this.y-=nTop;this.width+=nLeft+nRight;this.height+=nTop+nBottom;return this}},resize:function(nNewWidth,nNewHeight,bCreateNew,bKeepAspectRatio,bKeepCenter,bRounded){var oRect=new sap.galilei.ui.common.Rect(this),fRatio,oOldCenter,oNewCenter;if(bKeepAspectRatio){if(this.width!==undefined&&!isNaN(this.width)&&this.width!==0&&this.height!==undefined&&!isNaN(this.height)&&this.height!==0){if(nNewWidth!==undefined&&!isNaN(nNewWidth)&&nNewWidth!==0&&nNewHeight!==undefined&&!isNaN(nNewHeight)&&nNewHeight!==0){fRatio=this.width/this.height;if(nNewWidth/this.width<nNewHeight/this.height){nNewHeight=nNewWidth/fRatio}else{nNewWidth=nNewHeight*fRatio}if(bRounded){nNewWidth=Math.round(nNewWidth);nNewHeight=Math.round(nNewHeight)}}}}oRect.width=nNewWidth;oRect.height=nNewHeight;if(bKeepCenter){oOldCenter=this.getCenter(bRounded);oNewCenter=oRect.getCenter(bRounded);oRect.moveBy(oOldCenter[0]-oNewCenter[0],oOldCenter[1]-oNewCenter[1])}if(bCreateNew){return oRect}else{this.set(oRect);return this}},resizeByHandle:function(x,y,ePosition,bCreateNew,bKeepAspectRatio,bKeepCenter,bRounded){var refPoint,refX,refY,horzPosition,vertPosition,dx,dy,dx2,dy2,dx3,dy3,dx4,dy4,dx5,dy5,nNewLeft,nNewTop,nNewWidth,nNewHeight,fRatio,oRect=new sap.galilei.ui.common.Rect();refPoint=this.getPoint(ePosition,bRounded);refX=refPoint[0];refY=refPoint[1];nNewLeft=this.left;nNewTop=this.top;nNewWidth=this.width;nNewHeight=this.height;switch(ePosition){case sap.galilei.ui.common.DockPosition.topLeft:horzPosition=sap.galilei.ui.common.HorizontalAlignment.left;vertPosition=sap.galilei.ui.common.VerticalAlignment.top;break;case sap.galilei.ui.common.DockPosition.top:horzPosition=sap.galilei.ui.common.HorizontalAlignment.center;vertPosition=sap.galilei.ui.common.VerticalAlignment.top;x=refX;break;case sap.galilei.ui.common.DockPosition.topRight:horzPosition=sap.galilei.ui.common.HorizontalAlignment.right;vertPosition=sap.galilei.ui.common.VerticalAlignment.top;break;case sap.galilei.ui.common.DockPosition.right:horzPosition=sap.galilei.ui.common.HorizontalAlignment.right;vertPosition=sap.galilei.ui.common.VerticalAlignment.middle;y=refY;break;case sap.galilei.ui.common.DockPosition.bottomRight:horzPosition=sap.galilei.ui.common.HorizontalAlignment.right;vertPosition=sap.galilei.ui.common.VerticalAlignment.bottom;break;case sap.galilei.ui.common.DockPosition.bottom:horzPosition=sap.galilei.ui.common.HorizontalAlignment.center;vertPosition=sap.galilei.ui.common.VerticalAlignment.bottom;x=refX;break;case sap.galilei.ui.common.DockPosition.bottomLeft:horzPosition=sap.galilei.ui.common.HorizontalAlignment.left;vertPosition=sap.galilei.ui.common.VerticalAlignment.bottom;break;case sap.galilei.ui.common.DockPosition.left:horzPosition=sap.galilei.ui.common.HorizontalAlignment.left;vertPosition=sap.galilei.ui.common.VerticalAlignment.middle;y=refY;break}dx=x-refX;dy=y-refY;if(bKeepCenter){dx2=dx+dx;dy2=dy+dy}else{dx2=dx;dy2=dy}switch(horzPosition){case sap.galilei.ui.common.HorizontalAlignment.left:nNewWidth+=-dx2;break;case sap.galilei.ui.common.HorizontalAlignment.right:nNewWidth+=dx2;break}switch(vertPosition){case sap.galilei.ui.common.VerticalAlignment.top:nNewHeight+=-dy2;break;case sap.galilei.ui.common.VerticalAlignment.bottom:nNewHeight+=dy2;break}if(bKeepAspectRatio){if(this.width!==undefined&&!isNaN(this.width)&&this.width!==0&&this.height!==undefined&&!isNaN(this.height)&&this.height!==0){if(nNewWidth!==undefined&&!isNaN(nNewWidth)&&nNewWidth!==0&&nNewHeight!==undefined&&!isNaN(nNewHeight)&&nNewHeight!==0){fRatio=this.width/this.height;if(horzPosition===sap.galilei.ui.common.HorizontalAlignment.left||horzPosition===sap.galilei.ui.common.HorizontalAlignment.right){nNewHeight=nNewWidth/fRatio}else{if(vertPosition===sap.galilei.ui.common.VerticalAlignment.top||vertPosition===sap.galilei.ui.common.VerticalAlignment.bottom){nNewWidth=nNewHeight*fRatio}else{if(nNewWidth/this.width>=nNewHeight/this.height){nNewHeight=nNewWidth/fRatio}else{nNewWidth=nNewHeight*fRatio}}}if(bRounded){nNewWidth=Math.round(nNewWidth);nNewHeight=Math.round(nNewHeight)}}}}switch(horzPosition){case sap.galilei.ui.common.HorizontalAlignment.left:nNewLeft=x;break;case sap.galilei.ui.common.HorizontalAlignment.right:nNewLeft=x-nNewWidth;break}switch(vertPosition){case sap.galilei.ui.common.VerticalAlignment.top:nNewTop=y;break;case sap.galilei.ui.common.VerticalAlignment.bottom:nNewTop=y-nNewHeight;break}if(bKeepAspectRatio){dx3=nNewWidth-this.width;dy3=nNewHeight-this.height;dx4=dx3/2;dy4=dy3/2;if(bRounded){dx4=Math.round(dx4);dy4=Math.round(dy4)}if(bKeepCenter){dx5=dx4;dy5=dy4}else{dx5=0;dy5=0}switch(ePosition){case sap.galilei.ui.common.DockPosition.topLeft:nNewLeft=this.right+dx5-nNewWidth;nNewTop=this.bottom+dy5-nNewHeight;break;case sap.galilei.ui.common.DockPosition.top:nNewLeft-=dx4;break;case sap.galilei.ui.common.DockPosition.topRight:nNewLeft=this.left-dx5;nNewTop=this.bottom+dy5-nNewHeight;break;case sap.galilei.ui.common.DockPosition.right:nNewTop-=dy4;break;case sap.galilei.ui.common.DockPosition.bottomRight:nNewLeft=this.left-dx5;nNewTop=this.top-dy5;break;case sap.galilei.ui.common.DockPosition.bottom:nNewLeft-=dx4;break;case sap.galilei.ui.common.DockPosition.bottomLeft:nNewLeft=this.right+dx5-nNewWidth;nNewTop=this.top-dy5;break;case sap.galilei.ui.common.DockPosition.left:nNewTop-=dy4;break}}oRect.set(nNewLeft,nNewTop,nNewWidth,nNewHeight);if(bCreateNew){return oRect}else{this.set(oRect);return this}},getPoint:function(ePosition,bRounded){var rect=(new sap.galilei.ui.common.Rect(this)).normalize(),cx=rect.x+rect.width/2,cy=rect.y+rect.height/2,left=rect.x,top=rect.y,right=rect.x+rect.width,bottom=rect.y+rect.height,x,y;if(bRounded){cx=Math.round(cx);cy=Math.round(cy)}ePosition=sap.galilei.core.validateEnum(sap.galilei.ui.common.DockPosition,ePosition,sap.galilei.ui.common.DockPosition.center);x=cx;y=cy;switch(ePosition){case sap.galilei.ui.common.DockPosition.topLeft:x=left;y=top;break;case sap.galilei.ui.common.DockPosition.top:x=cx;y=top;break;case sap.galilei.ui.common.DockPosition.topRight:x=right;y=top;break;case sap.galilei.ui.common.DockPosition.right:x=right;y=cy;break;case sap.galilei.ui.common.DockPosition.bottomRight:x=right;y=bottom;break;case sap.galilei.ui.common.DockPosition.bottom:x=cx;y=bottom;break;case sap.galilei.ui.common.DockPosition.bottomLeft:x=left;y=bottom;break;case sap.galilei.ui.common.DockPosition.left:x=left;y=cy;break;case sap.galilei.ui.common.DockPosition.center:x=cx;y=cy;break}return[x,y]},getCenter:function(bRounded){return this.getPoint(sap.galilei.ui.common.DockPosition.center,bRounded)},setCenter:function(x,y,bRounded){if(x!==undefined&&!isNaN(x)&&y!==undefined&&!isNaN(y)){var aCenter=this.getCenter(bRounded);this.moveBy(x-aCenter[0],y-aCenter[1])}},moveBy:function(dx,dy){if(dx!==undefined&&!isNaN(dx)&&dx!==0){this.x+=dx}if(dy!==undefined&&!isNaN(dy)&&dy!==0){this.y+=dy}},snapToGrid:function(nGridSize,bCreateNew){var oRect;if(bCreateNew){oRect=this.clone()}else{oRect=this}oRect.normalize(false);oRect.x=sap.galilei.ui.common.geometry.snapToGrid(oRect.x,nGridSize);oRect.y=sap.galilei.ui.common.geometry.snapToGrid(oRect.y,nGridSize);oRect.right=sap.galilei.ui.common.geometry.snapToGrid(oRect.right,nGridSize);oRect.bottom=sap.galilei.ui.common.geometry.snapToGrid(oRect.bottom,nGridSize);return oRect},equals:function(oRect){if(oRect){return(this.x===oRect.x&&this.y===oRect.y&&this.width===oRect.width&&this.height===oRect.height)}return false},isPointInRect:function(vPoint){if(vPoint){var x,y,left=Math.min(this.left,this.right),top=Math.min(this.top,this.bottom),right=Math.max(this.left,this.right),bottom=Math.max(this.top,this.bottom),aPoint;aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint);if(aPoint){x=aPoint[0];y=aPoint[1];if(x!==undefined&&y!==undefined&&x>=left&&x<=right&&y>=top&&y<=bottom){return true}}}return false},isRectInRect:function(oRect){if(oRect){var left=oRect.left,top=oRect.top,right=oRect.right,bottom=oRect.bottom;if(left>=this.left&&left<=this.right&&right>=this.left&&right<=this.right&&top>=this.top&&top<=this.bottom&&bottom>=this.top&&bottom<=this.bottom){return true}}return false},isRectIntersectRect:function(oRect){if(oRect){var left=Math.max(this.left,oRect.left),top=Math.max(this.top,oRect.top),right=Math.min(this.right,oRect.right),bottom=Math.min(this.bottom,oRect.bottom);if(right>left&&bottom>top){return true}}return false},intersectRect:function(oRect){if(oRect){var left=Math.max(this.left,oRect.left),top=Math.max(this.top,oRect.top),right=Math.min(this.right,oRect.right),bottom=Math.min(this.bottom,oRect.bottom);if(right>left&&bottom>top){return new sap.galilei.ui.common.Rect(left,top,right-left,bottom-top)}}return undefined},isIntersectSegment:function(oSegment){if(oSegment){var aPoint1=oSegment.point1,aPoint2=oSegment.point2,a,b,c;if(aPoint1&&aPoint2){a=aPoint1[1]-aPoint2[1];b=aPoint2[0]-aPoint1[0];c=aPoint1[0]*aPoint2[1]-aPoint2[0]*aPoint1[1];if((a*this.left+b*this.top+c>=0&&a*this.right+b*this.bottom+c<=0)||(a*this.left+b*this.top+c<=0&&a*this.right+b*this.bottom+c>=0)||(a*this.left+b*this.bottom+c>=0&&a*this.right+b*this.top+c<=0)||(a*this.left+b*this.bottom+c<=0&&a*this.right+b*this.top+c>=0)){if((aPoint1[0]<this.left&&aPoint2[0]<this.left)||(aPoint1[0]>this.right&&aPoint2[0]>this.right)||(aPoint1[1]<this.top&&aPoint2[1]<this.top)||(aPoint1[1]>this.bottom&&aPoint2[1]>this.bottom)){return false}else{return true}}else{return false}}}return false},intersectSegment:function(oSegment,bRounded){if(oSegment&&oSegment.x1!==undefined&&oSegment.y1!==undefined&&oSegment.x2!==undefined&&oSegment.y2!==undefined&&this.x!==undefined&&this.y!==undefined&&this.width!==undefined&&this.height!==undefined&&this.isPointInRect(oSegment.point1)&&!this.isPointInRect(oSegment.point2)){var x1=oSegment.x1,y1=oSegment.y1,x2=oSegment.x2,y2=oSegment.y2,slopeAngle=Math.atan2((y1-y2),(x1-x2)),absSlopeAngle=Math.abs(slopeAngle),cornerAngle=Math.atan2(this.height,this.width),x0,y0;if(absSlopeAngle>=0&&absSlopeAngle<=cornerAngle){x0=x1-(this.width/2);y0=y1-(this.width/2)*Math.tan(slopeAngle)}else{if(absSlopeAngle>=(Math.PI-cornerAngle)&&absSlopeAngle<=Math.PI){x0=x1+(this.width/2);y0=y1+(this.width/2)*Math.tan(slopeAngle)}else{if(slopeAngle>=cornerAngle&&slopeAngle<=(Math.PI-cornerAngle)){x0=x1-(this.height/2)/Math.tan(slopeAngle);y0=y1-(this.height/2)}else{if(slopeAngle<=-cornerAngle&&slopeAngle>=-(Math.PI-cornerAngle)){x0=x1+(this.height/2)/Math.tan(slopeAngle);y0=y1+(this.height/2)}else{x0=x1;y0=y1}}}}if(x0!==undefined&&y0!==undefined){if(bRounded){x0=Math.round(x0);y0=Math.round(y0)}return[x0,y0]}}return undefined},getPointDirection:function(aPoint){if(aPoint){var dToleft,dToRight,dToTop,dToBottom,x=aPoint[0],y=aPoint[1],cx=(this.left+this.right)/2,cy=(this.top+this.bottom)/2,dMin;if(this.isPointInRect(aPoint)){dToleft=Math.abs(x-this.left);dToRight=Math.abs(this.right-x);dToTop=Math.abs(y-this.top);dToBottom=Math.abs(this.bottom-y)}else{dToleft=Math.sqrt(Math.pow((x-this.left),2)+Math.pow((y-cy),2));dToRight=Math.sqrt(Math.pow((this.right-x),2)+Math.pow((cy-y),2));dToTop=Math.sqrt(Math.pow((x-cx),2)+Math.pow((y-this.top),2));dToBottom=Math.sqrt(Math.pow((cx-x),2)+Math.pow((this.bottom-y),2))}dMin=Math.min(dToleft,dToRight,dToTop,dToBottom);switch(dMin){case dToleft:return sap.galilei.ui.common.LinkDirection.west;case dToRight:return sap.galilei.ui.common.LinkDirection.east;case dToTop:return sap.galilei.ui.common.LinkDirection.north;case dToBottom:return sap.galilei.ui.common.LinkDirection.south}}return sap.galilei.ui.common.LinkDirection.DEFAULT},getClosestPointOnBorder:function(aPoint){var nDirection,x,y;if(aPoint){nDirection=this.getPointDirection(aPoint);switch(nDirection){case sap.galilei.ui.common.LinkDirection.west:x=this.x;y=aPoint[1];if(y<this.y){y=this.y}else{if(y>this.bottom){y=this.bottom}}break;case sap.galilei.ui.common.LinkDirection.east:x=this.right;y=aPoint[1];if(y<this.y){y=this.y}else{if(y>this.bottom){y=this.bottom}}break;case sap.galilei.ui.common.LinkDirection.north:x=aPoint[0];if(x<this.x){x=this.x}else{if(x>this.right){x=this.right}}y=this.y;break;case sap.galilei.ui.common.LinkDirection.south:x=aPoint[0];if(x<this.x){x=this.x}else{if(x>this.right){x=this.right}}y=this.bottom;break;default:break}}if(x!==undefined&&y!==undefined){return[x,y]}return undefined}},statics:{unionRect:function(rect1,rect2){var rect=new sap.galilei.ui.common.Rect();if(rect1&&rect2){rect.set(rect1);rect.unionRect(rect2)}return rect},unionPoint:function(rect,point){var newRect=new sap.galilei.ui.common.Rect();if(rect&&point){newRect.set(rect);newRect.unionPoint(point)}return newRect}}});
"use strict";sap.galilei.ui.common.Points=sap.galilei.core.defineCollectionClass({fullClassName:"sap.galilei.ui.common.Points",initialize:function(vPoints){this.set.apply(this,arguments)},properties:{points:{get:function(){return this},set:function(value){this.clear();if(value instanceof Array){this.addArray(value)}else{if(typeof value==="string"){this.addArray(sap.galilei.ui.common.Points.parse(value))}}}}},methods:{set:function(vPoints){this.points=vPoints},toString:function(){return this.join(" ")},clone:function(){var oPoints=new sap.galilei.ui.common.Points(),aPoints=[];this.forEach(function(aPoint){aPoints.push([aPoint[0],aPoint[1]])});oPoints.points=aPoints;return oPoints},isHorizontal:function(nDelta){var i,y;if(nDelta===undefined){nDelta=0}if(this.length>=2){y=this[0][1];for(i=1;i<this.length;i++){if(Math.abs(this[i][1]-y)>nDelta){return false}}return true}return false},isVertical:function(nDelta){var i,x;if(nDelta===undefined){nDelta=0}if(this.length>=2){x=this[0][0];for(i=1;i<this.length;i++){if(Math.abs(this[i][0]-x)>nDelta){return false}}return true}return false},flipHorizontal:function(){var oRect=this.getBBox(),x1=oRect.x,x2=oRect.x+oRect.width;this.forEach(function(aPoint){aPoint[0]=(x1+x2)-aPoint[0]})},flipVertical:function(){var oRect=this.getBBox(),y1=oRect.y,y2=oRect.y+oRect.height;this.forEach(function(aPoint){aPoint[1]=(y1+y2)-aPoint[1]})},matrixTransform:function(oMatrix,bRound,bCreateNew){var svgPoint=sap.galilei.ui.common.Point.svgPoint,newSvgPoint,svgMatrix=sap.galilei.ui.common.Matrix.svgMatrix,oPoints=(bCreateNew===true)?new sap.galilei.ui.common.Points():this,index,x,y;if(oMatrix){sap.galilei.ui.common.Matrix.setSvgMatrixProperties(svgMatrix,oMatrix);for(index=0;index<this.length;++index){svgPoint.x=this[index][0];svgPoint.y=this[index][1];newSvgPoint=svgPoint.matrixTransform(svgMatrix);if(bRound!==false){x=Math.round(newSvgPoint.x);y=Math.round(newSvgPoint.y)}else{x=newSvgPoint.x;y=newSvgPoint.y}if(bCreateNew===true){oPoints.add([x,y])}else{oPoints[index][0]=x;oPoints[index][1]=y}}}return oPoints},getBBox:function(){var oRect;this.forEach(function(aPoint){if(!oRect){oRect=new sap.galilei.ui.common.Rect();oRect.set(aPoint[0],aPoint[1],0,0)}else{oRect.unionPoint(aPoint)}},this);return oRect},moveBy:function(dx,dy){if(this.length&&dx!==undefined&&!isNaN(dx)&&dy!==undefined&&!isNaN(dy)&&(dx!==0||dy!==0)){this.forEach(function(aPoint){if(dx!==0){aPoint[0]+=dx}if(dy!==0){aPoint[1]+=dy}})}},snapToGrid:function(nGridSize,bCreateNew){var oPoints,index;if(bCreateNew){oPoints=this.clone()}else{oPoints=this}for(index=0;index<oPoints.length;++index){oPoints[index][0]=sap.galilei.ui.common.geometry.snapToGrid(oPoints[index][0],nGridSize);oPoints[index][1]=sap.galilei.ui.common.geometry.snapToGrid(oPoints[index][1],nGridSize)}return oPoints},equals:function(oPoints){if(oPoints){var index;if(oPoints.length!==this.length){return false}for(index=0;index<this.length;++index){if(this[index][0]!==oPoints[index][0]||this[index][1]!==oPoints[index][1]){return false}}return true}return false}},statics:{parse:function(sPoints){if(sPoints){var aPoints=sPoints.split(" "),index,aPt,aPointsArray=[];if(aPoints&&aPoints.length>=1){for(index=0;index<aPoints.length;index++){aPt=sap.galilei.ui.common.Point.parse(aPoints[index]);if(aPt){aPointsArray.push(aPt)}}}return aPointsArray}return undefined},toString:function(aPoints){return aPoints.join(" ")}}});
"use strict";sap.galilei.ui.common.Segment=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Segment",initialize:function(options){this.set.apply(this,arguments)},properties:{x1:undefined,y1:undefined,x2:undefined,y2:undefined,point1:{get:function(){return[this.x1,this.y1]}},point2:{get:function(){return[this.x2,this.y2]}},length:{get:function(){return sap.galilei.ui.common.Point.getDistance(this.point1,this.point2)}}},methods:{set:function(x1,y1,x2,y2){if(arguments.length===4){this.x1=x1;this.y1=y1;this.x2=x2;this.y2=y2}else{if(arguments.length===2){var pt1=arguments[0],pt2=arguments[1];if((pt1 instanceof Array)&&pt1.length===2&&(pt2 instanceof Array)&&pt2.length===2){this.x1=pt1[0];this.y1=pt1[1];this.x2=pt2[0];this.y2=pt2[1]}else{if((typeof pt1)==="object"&&(typeof pt2)==="object"){this.x1=pt1.x;this.y1=pt1.y;this.x2=pt2.x;this.y2=pt2.y}}}else{if(arguments.length===1&&(typeof arguments)==="object"){var oSegment=arguments[0];if(oSegment.x1!==undefined){this.x1=oSegment.x1}if(oSegment.y1!==undefined){this.y1=oSegment.y1}if(oSegment.x2!==undefined){this.x2=oSegment.x2}if(oSegment.y2!==undefined){this.y2=oSegment.y2}}}}return this},clone:function(){return new sap.galilei.ui.common.Segment(this)},matrixTransform:function(oMatrix,bRound,bCreateNew){var svgPoint1=sap.galilei.ui.common.Point.svgPoint,svgPoint2=sap.galilei.ui.common.Point.svgPoint2,pt1,pt2,svgMatrix=sap.galilei.ui.common.Matrix.svgMatrix;if(oMatrix){svgPoint1.x=this.x1;svgPoint1.y=this.y1;svgPoint2.x=this.x2;svgPoint2.y=this.y2;sap.galilei.ui.common.Matrix.setSvgMatrixProperties(svgMatrix,oMatrix);pt1=svgPoint1.matrixTransform(svgMatrix);pt2=svgPoint2.matrixTransform(svgMatrix);if(bRound!==false){pt1.x=Math.round(pt1.x);pt1.y=Math.round(pt1.y);pt2.x=Math.round(pt2.x);pt2.y=Math.round(pt2.y)}if(bCreateNew===true){return new sap.galilei.ui.common.Segment(pt1,pt2)}else{return this.set(pt1,pt2)}}else{return this}},getCenter:function(bRounded){return sap.galilei.ui.common.Segment.getCenter(this.point1,this.point2,bRounded)},moveBy:function(dx,dy){if(dx!==undefined&&!isNaN(dx)&&dx!==0){this.x1+=dx;this.x2+=dx}if(dy!==undefined&&!isNaN(dy)&&dy!==0){this.y1+=dy;this.y2+=dy}},parallelMoveTo:function(x,y,bCreateNew){var x1=this.x1,y1=this.y1,x2=this.x2,y2=this.y2,k,b,k1,c,px1,py1,dx,dy,oSeg=this;if(x1!==undefined&&y1!==undefined&&x2!==undefined&&y2!==undefined&&!isNaN(x1)&&!isNaN(y1)&&!isNaN(x2)&&!isNaN(y2)&&x!==undefined&&y!==undefined&&!isNaN(x)&&!isNaN(y)){if(bCreateNew){oSeg=new sap.galilei.ui.common.Segment(this)}if(x1===x2||y1===y2){if(x1===x2){oSeg.x1=oSeg.x2=x}if(y1===y2){oSeg.y1=oSeg.y2=y}}else{k=(y2-y1)/(x2-x1);b=y-k*x;k1=-(x2-x1)/(y2-y1);c=y1-k1*x1;px1=(c-b)/(k-k1);py1=k1*px1+c;dx=px1-x1;dy=py1-y1;oSeg.x1=px1;oSeg.y1=py1;oSeg.x2+=dx;oSeg.y2+=dy}return oSeg}},snapToGrid:function(nGridSize,bCreateNew){var oSegment;if(bCreateNew){oSegment=this.clone()}else{oSegment=this}oSegment.x1=sap.galilei.ui.common.geometry.snapToGrid(oSegment.x1,nGridSize);oSegment.y1=sap.galilei.ui.common.geometry.snapToGrid(oSegment.y1,nGridSize);oSegment.x2=sap.galilei.ui.common.geometry.snapToGrid(oSegment.x2,nGridSize);oSegment.y2=sap.galilei.ui.common.geometry.snapToGrid(oSegment.y2,nGridSize);return oSegment},equals:function(oSegment){if(oSegment){return(this.x1===oSegment.x1&&this.y1===oSegment.y1&&this.x2===oSegment.x2&&this.y2===oSegment.y2)}return false},intersectSegment:function(oSegment,bRounded){if(oSegment&&oSegment.x1!==undefined&&oSegment.y1!==undefined&&oSegment.x2!==undefined&&oSegment.y2!==undefined&&this.x1!==undefined&&this.y1!==undefined&&this.x2!==undefined&&this.y2!==undefined){var x0,y0,x1,y1,x2,y2,x3,y3,x4,y4,a,b,c,d;x1=this.x1;y1=this.y1;x2=this.x2;y2=this.y2;x3=oSegment.x1;y3=oSegment.y1;x4=oSegment.x2;y4=oSegment.y2;a=b=0;if(x1!==x2){a=(y1-y2)/(x1-x2);b=(y1-a*x1)}c=d=0;if(x3!==x4){c=(y3-y4)/(x3-x4);d=(y3-c*x3)}if(x1===x2){if(x3===x4){return undefined}x0=x1;y0=c*x0+d}else{if(x3===x4){x0=x3;y0=a*x0+b}else{if(a===c){return undefined}x0=(d-b)/(a-c);if(a===0){y0=y1}else{if(c===0){y0=y3}else{y0=a*x0+b}}}}if(x0!==undefined&&y0!==undefined){if(x0>=Math.min(x1-0.000001,x2-0.000001)&&x0<=Math.max(x1+0.000001,x2+0.000001)&&x0>=Math.min(x3-0.000001,x4-0.000001)&&x0<=Math.max(x3+0.000001,x4+0.000001)&&y0>=Math.min(y1-0.000001,y2-0.000001)&&y0<=Math.max(y1+0.000001,y2+0.000001)&&y0>=Math.min(y3-0.000001,y4-0.000001)&&y0<=Math.max(y3+0.000001,y4+0.000001)){if(bRounded){x0=Math.round(x0);y0=Math.round(y0)}return[x0,y0]}}}return undefined},isPointOnSegment:function(vPoint,nRadius){var aPoint,x,y,x1=this.x1,y1=this.y1,x2=this.x2,y2=this.y2,dPrecision=1e-9,oRect;aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint);if(aPoint){x=aPoint[0];y=aPoint[1]}nRadius=(nRadius===undefined)?0:nRadius;if(x!==undefined&&y!==undefined&&x1!==undefined&&y1!==undefined&&x2!==undefined&&y2!==undefined&&!isNaN(x)&&!isNaN(y)&&!isNaN(x1)&&!isNaN(y1)&&!isNaN(x2)&&!isNaN(y2)){if(nRadius>0){oRect=new sap.galilei.ui.common.Rect({x:x-nRadius,y:y-nRadius,width:nRadius+nRadius,height:nRadius+nRadius});return oRect.isIntersectSegment(this)}if(x>=Math.min(x1,x2)&&x<=Math.max(x1,x2)&&y>=Math.min(y1,y2)&&y<=Math.max(y1,y2)){if((y===y1&&y1===y2)||(x===x1&&x1===x2)){return true}if(Math.abs(((y1-y2)*x+(x2-x1)*y)-(y1*x2-x1*y2))<dPrecision){return true}}}return false}},statics:{getCenter:function(pt1,pt2,bRounded){var x1,y1,x2,y2,cx,cy;if((pt1 instanceof Array)&&(pt2 instanceof Array)){x1=+pt1[0];y1=+pt1[1];x2=+pt2[0];y2=+pt2[1]}else{if(pt1&&pt2){x1=+pt1.x;y1=+pt1.y;x2=+pt2.x;y2=+pt2.y}}if(x1!==undefined&&y1!==undefined&&x2!==undefined&&y2!==undefined){cx=(x1+x2)/2;cy=(y1+y2)/2;if(bRounded){cx=Math.round(cx);cy=Math.round(cy)}}return[cx,cy]},getPointAt:function(pt1,pt2,nDistance,nMaxRatio,bRounded){var x1,y1,x2,y2,x,y,nLength,nMaxDistance;if((pt1 instanceof Array)&&(pt2 instanceof Array)){x1=+pt1[0];y1=+pt1[1];x2=+pt2[0];y2=+pt2[1]}else{if(pt1&&pt2){x1=+pt1.x;y1=+pt1.y;x2=+pt2.x;y2=+pt2.y}}nLength=sap.galilei.ui.common.Point.getDistance(pt1,pt2);if(nLength===0){x=x1;y=y1}else{if(nLength!==undefined){nMaxDistance=nLength;if(nMaxRatio!==undefined){nMaxDistance*=nMaxRatio}if(nDistance!==undefined){if(nDistance>nMaxDistance){nDistance=nMaxDistance}x=(x2-x1)*nDistance/nLength+x1;y=(y2-y1)*nDistance/nLength+y1}}}if(bRounded&&x!==undefined&&y!==undefined){x=Math.round(x);y=Math.round(y)}return[x,y]}}});
"use strict";sap.galilei.ui.common.Path=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Path",statics:{ROUNDED_CORNER_SIZE:10,PATH_OPERATORS:{M:[2],m:[2],L:[2],l:[2],H:[1],h:[1],V:[1],v:[1],C:[2,2,2],c:[2,2,2],S:[2,2],s:[2,2],Q:[2,2],q:[2,2],T:[2],t:[2],A:[2,1,1,1,2],a:[2,1,1,1,2],Z:[0],z:[0]},generatePoint:function(aPoint){if(aPoint){return aPoint[0]+","+aPoint[1]}else{return""}},generatePolyline:function(aPoints,bClosed){var sPath,index;if(aPoints&&aPoints.length>1){sPath="M"+sap.galilei.ui.common.Path.generatePoint(aPoints[0]);for(index=1;index<aPoints.length;++index){sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(aPoints[index])}if(bClosed){sPath+=" Z"}}if(sPath===""){sPath=undefined}return sPath},generateQuadraticBezier:function(aPoints,bClosed){var sPath="",index,aFirst,aLast,aCenter,bAddLastPoint=false;if(aPoints&&aPoints.length===2){return this.generatePolyline(aPoints,bClosed)}if(aPoints&&aPoints.length>2){aFirst=aPoints[0];aLast=aPoints[aPoints.length-1];if(bClosed){if(aFirst[0]!==aLast[0]||aFirst[1]!==aLast[1]){aPoints.push([aFirst[0],aFirst[1]]);aLast=aPoints[aPoints.length-1];bAddLastPoint=true}aFirst=sap.galilei.ui.common.Segment.getCenter(aPoints[0],aPoints[1])}sPath="M"+sap.galilei.ui.common.Path.generatePoint(aFirst);for(index=1;index<aPoints.length-2;index++){aCenter=sap.galilei.ui.common.Segment.getCenter(aPoints[index],aPoints[index+1]);sPath+=" Q"+sap.galilei.ui.common.Path.generatePoint(aPoints[index])+" "+sap.galilei.ui.common.Path.generatePoint(aCenter)}if(!bClosed){sPath+=" Q"+sap.galilei.ui.common.Path.generatePoint(aPoints[aPoints.length-2])+" "+sap.galilei.ui.common.Path.generatePoint(aLast)}else{aCenter=sap.galilei.ui.common.Segment.getCenter(aPoints[aPoints.length-2],aLast);sPath+=" Q"+sap.galilei.ui.common.Path.generatePoint(aPoints[aPoints.length-2])+" "+sap.galilei.ui.common.Path.generatePoint(aCenter);sPath+=" T"+sap.galilei.ui.common.Path.generatePoint(aFirst);sPath+=" Z"}if(bAddLastPoint){aPoints.splice(aPoints.length-1,1)}}if(sPath===""){sPath=undefined}return sPath},generateCubicBezier:function(aPoints,bClosed){var aNewPoints,sPath="",index;if(aPoints&&aPoints.length===2){return this.generatePolyline(aPoints,bClosed)}if(aPoints&&aPoints.length>1){aNewPoints=new sap.galilei.ui.common.Points();if(!bClosed){aNewPoints.add(aPoints[0])}else{aNewPoints.add(sap.galilei.ui.common.Segment.getCenter(aPoints[0],aPoints[1]))}for(index=1;index<aPoints.length-1;++index){aNewPoints.add(aPoints[index]);aNewPoints.add(aPoints[index]);if(bClosed||index<aPoints.length-2){aNewPoints.add(sap.galilei.ui.common.Segment.getCenter(aPoints[index],aPoints[index+1]))}}aNewPoints.add(aPoints[aPoints.length-1]);if(bClosed){aNewPoints.add(sap.galilei.ui.common.Segment.getCenter(aPoints[0],aPoints[aPoints.length-1]));aNewPoints.add(aPoints[0]);aNewPoints.add(sap.galilei.ui.common.Segment.getCenter(aPoints[0],aPoints[1]))}sPath="M"+sap.galilei.ui.common.Path.generatePoint(aNewPoints[0]);for(index=0;index<aNewPoints.length-3;index+=3){sPath+="C"+sap.galilei.ui.common.Path.generatePoint(aNewPoints[index+1])+" "+sap.galilei.ui.common.Path.generatePoint(aNewPoints[index+2])+" "+sap.galilei.ui.common.Path.generatePoint(aNewPoints[index+3])+" "}if(bClosed){sPath+=" Z"}}if(sPath===""){sPath=undefined}return sPath},generateRoundedPath:function(aPoints,nCornerSize,bClosed){var aNewPoints,sPath="",index,pt;if(aPoints&&aPoints.length===2){return this.generatePolyline(aPoints,bClosed)}if(aPoints&&aPoints.length>1){if(nCornerSize===undefined){nCornerSize=sap.galilei.ui.common.Path.ROUNDED_CORNER_SIZE}aNewPoints=new sap.galilei.ui.common.Points();if(!bClosed){aNewPoints.add(aPoints[0])}else{pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[0],aPoints[1],nCornerSize,0.5);aNewPoints.add(pt)}for(index=1;index<aPoints.length-1;++index){pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[index],aPoints[index-1],nCornerSize,0.5);aNewPoints.add(pt);aNewPoints.add(aPoints[index]);pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[index],aPoints[index+1],nCornerSize,0.5);aNewPoints.add(pt)}if(bClosed){pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[aPoints.length-1],aPoints[aPoints.length-2],nCornerSize,0.5);aNewPoints.add(pt);aNewPoints.add(aPoints[aPoints.length-1]);pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[aPoints.length-1],aPoints[0],nCornerSize,0.5);aNewPoints.add(pt);pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[0],aPoints[aPoints.length-1],nCornerSize,0.5);aNewPoints.add(pt);aNewPoints.add(aPoints[0]);pt=sap.galilei.ui.common.Segment.getPointAt(aPoints[0],aPoints[1],nCornerSize,0.5);aNewPoints.add(pt)}else{aNewPoints.add(aPoints[aPoints.length-1])}sPath="M"+sap.galilei.ui.common.Path.generatePoint(aNewPoints[0]);for(index=1;index<aNewPoints.length;index+=3){sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(aNewPoints[index]);if(index<aNewPoints.length-2){sPath+=" Q"+sap.galilei.ui.common.Path.generatePoint(aNewPoints[index+1])+" "+sap.galilei.ui.common.Path.generatePoint(aNewPoints[index+2])}}if(bClosed){sPath+=" Z"}}if(sPath===""){sPath=undefined}return sPath},parse:function(sPath){var aTokens,index,sToken,sOper,aArgSets,aOperators=[],oOperator,nArguments=0;function getArgumentsNumber(aArgSets){var nArgs=0;if(aArgSets){aArgSets.forEach(function(nNumber){nArgs+=+nNumber})}return nArgs}if(sPath){aTokens=sPath.split(new RegExp("[ ,]+","g"));for(index=0;index<aTokens.length;index++){sToken=aTokens[index];if(nArguments){if(oOperator){oOperator.args.push(+sToken)}nArguments--;if(nArguments===0&&oOperator){aOperators.push(oOperator);oOperator=undefined}}else{sOper=sToken.slice(0,1);aArgSets=sap.galilei.ui.common.Path.PATH_OPERATORS[sOper];if(aArgSets){sToken=sToken.substring(1);nArguments=getArgumentsNumber(aArgSets);oOperator={};oOperator.operator=sOper;oOperator.args=[];if(nArguments&&sToken!==""){oOperator.args.push(+sToken);nArguments--}if(nArguments===0){aOperators.push(oOperator);oOperator=undefined}}}}}return aOperators},serializePathOperators:function(aOperators){var sPath;function serializeArguments(aArgs,aArgSets){var index=0,sArguments="";if(aArgs&&aArgSets){aArgSets.forEach(function(nSet){var sArg;if(nSet>0){sArg=aArgs.slice(index,index+nSet).join(",");if(sArg){if(sArguments!==""){sArguments+=" "}sArguments+=sArg}index+=nSet}})}return sArguments}if(aOperators){aOperators.forEach(function(oOperator){var sOper=oOperator.operator,aArgs=oOperator.args,aArgSets=sap.galilei.ui.common.Path.PATH_OPERATORS[sOper];if(!sPath){sPath=""}else{sPath+=" "}sPath+=sOper+serializeArguments(aArgs,aArgSets)})}return sPath},getPolylineFromPath:function(sPath){var aOperators,aPoints=[],nStyle=sap.galilei.ui.common.LineStyle.normal,x0=0,y0=0,oLastOperator,bLastHorizontal=false,bLastVertical=false,bIsClosed=false,dx,dy,lastQX,lastQY,lastQX2,lastQY2,lastSX,lastSY,oPolyline;function addLastPoint(){if(lastQX!==undefined&&lastQY!==undefined){aPoints.push([lastQX,lastQY]);lastQX=undefined;lastQY=undefined}if(lastSX!==undefined&&lastSY!==undefined){aPoints.push([lastSX,lastSY]);lastSX=undefined;lastSY=undefined}}function getPointsFromOperator(oOperator){var sOper=oOperator.operator,aArgs=oOperator.args,nLastIndex,x,y,rx,ry,bProcessed=false;switch(sOper){case"M":case"m":addLastPoint();x=aArgs[0];y=aArgs[1];if(sOper==="m"){x+=x0;y+=y0}x0=x;y0=y;aPoints.push([x0,y0]);bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break;case"L":case"l":addLastPoint();x=aArgs[0];y=aArgs[1];if(sOper==="l"){x+=x0;y+=y0}if(x===x0){bLastVertical=true;dy=y-y0}else{bLastVertical=false}if(y===y0){bLastHorizontal=true;dx=x-x0}else{bLastHorizontal=false}x0=x;y0=y;aPoints.push([x0,y0]);oLastOperator=oOperator;break;case"H":case"h":addLastPoint();x=aArgs[0];if(sOper==="h"){x+=x0}dx=x-x0;x0=x;aPoints.push([x0,y0]);bLastHorizontal=true;bLastVertical=false;oLastOperator=oOperator;break;case"V":case"v":addLastPoint();y=aArgs[0];if(sOper==="v"){y+=y0}dy=y-y0;y0=y;aPoints.push([x0,y0]);bLastHorizontal=false;bLastVertical=true;oLastOperator=oOperator;break;case"A":case"a":addLastPoint();if(oLastOperator&&(oLastOperator.operator==="L"||oLastOperator.operator==="l")){rx=aArgs[0];ry=aArgs[1];nLastIndex=aPoints.length-1;if(bLastHorizontal){aPoints[nLastIndex][0]+=dx>=0?rx:-rx;x0=aPoints[nLastIndex][0];nStyle=sap.galilei.ui.common.LineStyle.rounded;bProcessed=true}else{if(bLastVertical){aPoints[nLastIndex][1]+=dy>=0?ry:-ry;y0=aPoints[nLastIndex][1];nStyle=sap.galilei.ui.common.LineStyle.rounded;bProcessed=true}}}if(!bProcessed){x=aArgs[5];y=aArgs[6];if(sOper==="a"){x+=x0;y+=y0}x0=x;y0=y;aPoints.push([x0,y0])}bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break;case"C":case"c":addLastPoint();x0=aArgs[0];y0=aArgs[1];aPoints.push([x0,y0]);x0=aArgs[2];y0=aArgs[3];aPoints.push([x0,y0]);x=aArgs[4];y=aArgs[5];if(sOper==="c"){x+=x0;y+=y0}x0=x;y0=y;aPoints.push([x0,y0]);lastSX=aArgs[2]+(x0-aArgs[2])*2;lastSY=aArgs[3]+(y0-aArgs[3])*2;bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break;case"S":case"s":addLastPoint();x0=aArgs[0];y0=aArgs[1];aPoints.push([x0,y0]);x=aArgs[2];y=aArgs[3];if(sOper==="s"){x+=x0;y+=y0}x0=x;y0=y;aPoints.push([x0,y0]);lastSX=aArgs[0]+(x0-aArgs[0])*2;lastSY=aArgs[1]+(y0-aArgs[1])*2;bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break;case"Q":case"qs":x0=aArgs[0];y0=aArgs[1];aPoints.push([x0,y0]);x=aArgs[2];y=aArgs[3];if(sOper==="q"){x+=x0;y+=y0}x0=x;y0=y;lastQX=x0;lastQY=y0;lastQX2=aArgs[0]+(x0-aArgs[0])*2;lastQY2=aArgs[1]+(y0-aArgs[1])*2;nStyle=sap.galilei.ui.common.LineStyle.quadraticBezier;bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break;case"T":case"t":x=aArgs[0];y=aArgs[1];if(sOper==="t"){x+=x0;y+=y0}x0=x;y0=y;if(lastQX2!==undefined&&lastQY2!==undefined){aPoints.push([lastQX2,lastQY2]);lastQX2=undefined;lastQY2=undefined}lastQX=undefined;lastQY=undefined;aPoints.push([x0,y0]);nStyle=sap.galilei.ui.common.LineStyle.quadraticBezier;bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break;case"Z":case"z":addLastPoint();bIsClosed=true;bLastHorizontal=false;bLastVertical=false;oLastOperator=oOperator;break}}if(sPath){aOperators=sap.galilei.ui.common.Path.parse(sPath);if(aOperators){aOperators.forEach(getPointsFromOperator);addLastPoint()}}if(aPoints.length>0){oPolyline={points:aPoints,lineStyle:nStyle,isClosed:bIsClosed}}return oPolyline}}});
"use strict";namespace("sap.galilei.ui.common.geometry");sap.galilei.ui.common.geometry.isPointInEllipse=function(vPoint,oRect){if(vPoint&&oRect){var aPoint,rx,ry,h,k,oCenter,sum,x,y;rx=oRect.width/2;ry=oRect.height/2;oCenter=oRect.getCenter(false);h=oCenter[0];k=oCenter[1];aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint);if(aPoint){x=aPoint[0];y=aPoint[1]}if(x!==undefined&&y!==undefined){sum=((x-h)*(x-h))/(rx*rx)+((y-k)*(y-k))/(ry*ry);if(sum>1.000000000001){return false}else{return true}}}return false};sap.galilei.ui.common.geometry.intersectSegmentEllipse=function(oSegment,oRect){if(oSegment&&oRect){var oCenter,x,y,h,k,x1,y1,x2,y2,xMin,yMin,xMax,yMax,a,b,c,delta,bInside1,bInside2,a2,b2,c2,delta2,d,A,B,C;oCenter=oRect.getCenter(false);h=oCenter[0];k=oCenter[1];x1=oSegment.x1;y1=oSegment.y1;x2=oSegment.x2;y2=oSegment.y2;xMin=Math.min(x1,x2);xMax=Math.max(x1,x2);yMin=Math.min(y1,y2);yMax=Math.max(y1,y2);a=oRect.width/2;b=oRect.height/2;bInside1=sap.galilei.ui.common.geometry.isPointInEllipse(oSegment.point1,oRect);bInside2=sap.galilei.ui.common.geometry.isPointInEllipse(oSegment.point2,oRect);if(bInside1===bInside2){return undefined}a2=a*a;if(x1!==x2){c=(y2-y1)/(x2-x1);d=-c*(x1-h)+y1-k;b2=b*b;c2=c*c;A=b2+a2*c2;B=a2*c*d*2;C=a2*(d*d-b2);delta2=B*B-4*A*C;if(delta2<0){return undefined}delta=Math.sqrt(delta2);x=(-B+delta)/A/2+h;if(x<xMin||x>xMax){x=(-B-delta)/A/2+h}y=c*(x-h)+d+k}else{x=x1;delta=Math.sqrt(a2-(x1-h)*(x1-h));y=k+delta*b/a;if(y<yMin||y>yMax){y=k-delta*b/a}}if(x>=xMin&&x<=xMax&&y>=yMin&&y<=yMax){return[x,y]}return undefined}return undefined};sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRx=function(width,bRounded){if(width!==undefined&&!isNaN(width)){var rx;rx=width/6;if(bRounded){rx=Math.round(rx)}return rx}return undefined};sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRy=function(height,bRounded){if(height!==undefined&&!isNaN(height)){var ry;ry=height/6;if(bRounded){ry=Math.round(ry)}return ry}return undefined};sap.galilei.ui.common.geometry.getDefaultRoundedRectangleR=function(width,height,bRounded){var rx=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRx(width,bRounded),ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRy(height,bRounded);if(rx!==undefined&&ry!==undefined){return Math.min(rx,ry)}return undefined};sap.galilei.ui.common.geometry.isPointInRoundedRectangle=function(vPoint,oRect,rx,ry){if(vPoint&&oRect&&oRect.width!==undefined&&oRect.height!==undefined){if(rx===undefined&&ry===undefined){rx=ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleR(oRect.width,oRect.height)}else{if(rx===undefined){rx=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRx(oRect.width)}else{if(ry===undefined){ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRy(oRect.height)}}}if(oRect.isPointInRect(vPoint)){var oRectH,oRectV,oRectCorner,rx2,ry2;oRectH=oRect.inflate(0,-ry,0,-ry,true);if(oRectH.isPointInRect(vPoint)){return true}oRectV=oRect.inflate(-rx,0,-rx,0,true);if(oRectV.isPointInRect(vPoint)){return true}oRectCorner=new sap.galilei.ui.common.Rect();rx2=rx+rx;ry2=ry+ry;oRectCorner.set(oRect.left,oRect.top,rx2,ry2);if(sap.galilei.ui.common.geometry.isPointInEllipse(vPoint,oRectCorner)){return true}oRectCorner.set(oRect.right-rx2,oRect.top,rx2,ry2);if(sap.galilei.ui.common.geometry.isPointInEllipse(vPoint,oRectCorner)){return true}oRectCorner.set(oRect.right-rx2,oRect.bottom-ry2,rx2,ry2);if(sap.galilei.ui.common.geometry.isPointInEllipse(vPoint,oRectCorner)){return true}oRectCorner.set(oRect.left,oRect.bottom-ry2,rx2,ry2);if(sap.galilei.ui.common.geometry.isPointInEllipse(vPoint,oRectCorner)){return true}}}return false};sap.galilei.ui.common.geometry.intersectSegmentRoundedRectangle=function(oSegment,oRect,rx,ry){if(oSegment&&oRect&&oRect.width!==undefined&&oRect.height!==undefined){if(rx===undefined&&ry===undefined){rx=ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleR(oRect.width,oRect.height)}else{if(rx===undefined){rx=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRx(oRect.width)}else{if(ry===undefined){ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRy(oRect.height)}}}var oRectH,oRectV,aPoint,aCornerPoint,oRectCorner,oSeg,oSegEllipse,rx2,ry2;oSeg=oSegment;if(sap.galilei.ui.common.geometry.isPointInRoundedRectangle(oSegment.point1,oRect,rx,ry)){oSeg=new sap.galilei.ui.common.Segment(oSegment.point2,oSegment.point1)}oRectH=oRect.inflate(0,-ry,0,-ry,true);aPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectH.left,oRectH.top,oRectH.left,oRectH.bottom),false);if(aPoint!==undefined){return aPoint}aPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectH.right,oRectH.top,oRectH.right,oRectH.bottom),false);if(aPoint!==undefined){return aPoint}oRectV=oRect.inflate(-rx,0,-rx,0,true);aPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectV.left,oRectV.top,oRectV.right,oRectV.top),false);if(aPoint!==undefined){return aPoint}aPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectV.left,oRectV.bottom,oRectV.right,oRectV.bottom),false);if(aPoint!==undefined){return aPoint}oRectCorner=new sap.galilei.ui.common.Rect();rx2=rx+rx;ry2=ry+ry;oRectCorner.set(oRect.left,oRect.top,rx2,ry2);oSegEllipse=oSeg;if(!sap.galilei.ui.common.geometry.isPointInEllipse(oSeg.point2,oRectCorner)){aCornerPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectCorner.left,oRectCorner.top+ry,oRectCorner.right-rx,oRectCorner.top),false);if(aCornerPoint!==undefined){oSegEllipse=new sap.galilei.ui.common.Segment(oSeg.point1,aCornerPoint)}}aPoint=sap.galilei.ui.common.geometry.intersectSegmentEllipse(oSegEllipse,oRectCorner);if(aPoint!==undefined&&aPoint[0]>=oRectCorner.left&&aPoint[0]<=oRectCorner.left+rx&&aPoint[1]>=oRectCorner.top&&aPoint[1]<=oRectCorner.top+ry){return aPoint}oRectCorner.set(oRect.right-rx2,oRect.top,rx2,ry2);oSegEllipse=oSeg;if(!sap.galilei.ui.common.geometry.isPointInEllipse(oSeg.point2,oRectCorner)){aCornerPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectCorner.right,oRectCorner.top+ry,oRectCorner.left+rx,oRectCorner.top),false);if(aCornerPoint!==undefined){oSegEllipse=new sap.galilei.ui.common.Segment(oSeg.point1,aCornerPoint)}}aPoint=sap.galilei.ui.common.geometry.intersectSegmentEllipse(oSegEllipse,oRectCorner);if(aPoint!==undefined&&aPoint[0]>=oRectCorner.left+rx&&aPoint[0]<=oRectCorner.right&&aPoint[1]>=oRectCorner.top&&aPoint[1]<=oRectCorner.top+ry){return aPoint}oRectCorner.set(oRect.right-rx2,oRect.bottom-ry2,rx2,ry2);oSegEllipse=oSeg;if(!sap.galilei.ui.common.geometry.isPointInEllipse(oSeg.point2,oRectCorner)){aCornerPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectCorner.right,oRectCorner.bottom-ry,oRectCorner.left+rx,oRectCorner.bottom),false);if(aCornerPoint!==undefined){oSegEllipse=new sap.galilei.ui.common.Segment(oSeg.point1,aCornerPoint)}}aPoint=sap.galilei.ui.common.geometry.intersectSegmentEllipse(oSegEllipse,oRectCorner);if(aPoint!==undefined&&aPoint[0]>=oRectCorner.left+rx&&aPoint[0]<=oRectCorner.right&&aPoint[1]>=oRectCorner.bottom-ry&&aPoint[1]<=oRectCorner.bottom){return aPoint}oRectCorner.set(oRect.left,oRect.bottom-ry2,rx2,ry2);oSegEllipse=oSeg;if(!sap.galilei.ui.common.geometry.isPointInEllipse(oSeg.point2,oRectCorner)){aCornerPoint=oSeg.intersectSegment(new sap.galilei.ui.common.Segment(oRectCorner.left,oRectCorner.bottom-ry,oRectCorner.left+rx,oRectCorner.bottom),false);if(aCornerPoint!==undefined){oSegEllipse=new sap.galilei.ui.common.Segment(oSeg.point1,aCornerPoint)}}aPoint=sap.galilei.ui.common.geometry.intersectSegmentEllipse(oSegEllipse,oRectCorner);if(aPoint!==undefined&&aPoint[0]>=oRectCorner.left&&aPoint[0]<=oRectCorner.left+rx&&aPoint[1]>=oRectCorner.bottom-ry&&aPoint[1]<=oRectCorner.bottom){return aPoint}}return undefined};sap.galilei.ui.common.geometry.isPointOnPolyline=function(vPoint,aPoints,nRadius){var i,bResult=false,oSegment;if(vPoint&&aPoints){for(i=0;i<aPoints.length-1;i++){oSegment=new sap.galilei.ui.common.Segment(aPoints[i],aPoints[i+1]);if(oSegment.isPointOnSegment(vPoint,nRadius)){bResult=true;break}}}return bResult};sap.galilei.ui.common.geometry.isPointInPolygon=function(vPoint,aPoints){if(vPoint&&aPoints){var aPoint,i,j,x,y,bResult,aPoint1,aPoint2;if(aPoints.length<3){return false}aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint);if(aPoint){x=aPoint[0];y=aPoint[1]}if(x!==undefined&&y!==undefined){j=aPoints.length-1;bResult=false;for(i=0;i<aPoints.length;i++){aPoint1=aPoints[i];aPoint2=aPoints[j];if(((aPoint1[1]>y)!==(aPoint2[1]>y))&&(x<(aPoint2[0]-aPoint1[0])*(y-aPoint1[1])/(aPoint2[1]-aPoint1[1])+aPoint1[0])){bResult=!bResult}j=i}if(!bResult){bResult=sap.galilei.ui.common.geometry.isPointOnPolyline(vPoint,aPoints)}return bResult}}return false};sap.galilei.ui.common.geometry.intersectSegmentPolygon=function(oSegment,aPoints){var aIntersectPt,aPt1,aPt2,index,oSegInit,oSegPart;if(oSegment&&aPoints){if(aPoints.length<3){return aIntersectPt}oSegInit=new sap.galilei.ui.common.Segment(oSegment);aPt1=aPoints[aPoints.length-1];for(index=0;index<aPoints.length;index++){aPt2=aPoints[index];oSegPart=new sap.galilei.ui.common.Segment(aPt1,aPt2);aPt1=oSegInit.intersectSegment(oSegPart);if(aPt1){aIntersectPt=aPt1;oSegInit.x2=aPt1[0];oSegInit.y2=aPt1[1]}aPt1=aPt2}}return aIntersectPt};sap.galilei.ui.common.geometry._isPointOnBezierCursve=function(aPoint,aPoint0,aPoint1,aPoint2,bCubic,nRadius){var t,t0,t1,nStep=0.01,dx,dy,d,x,y,aPointBegin=[],aPointEnd=[],oPointRect=new sap.galilei.ui.common.Rect(),oSegment=new sap.galilei.ui.common.Segment();if(aPoint&&aPoint0&&aPoint1&&aPoint2){x=aPoint[0];y=aPoint[1];dx=Math.max(aPoint0[0],aPoint1[0],aPoint2[0])-Math.min(aPoint0[0],aPoint1[0],aPoint2[0]);dy=Math.max(aPoint0[1],aPoint1[1],aPoint2[1])-Math.min(aPoint0[1],aPoint1[1],aPoint2[1]);d=Math.max(dx,dy);if(d>0){nStep=1/(d/(nRadius>0?nRadius:5))}aPointBegin[0]=aPoint0[0];aPointBegin[1]=aPoint0[1];for(t=0;t<1.01;t+=nStep){if(bCubic){t0=1-t;t1=3*t*t0;aPointEnd[0]=Math.round(Math.pow(t0,3)*aPoint0[0]+t1*aPoint1[0]+Math.pow(t,3)*aPoint2[0]);aPointEnd[1]=Math.round(Math.pow(t0,3)*aPoint0[1]+t1*aPoint1[1]+Math.pow(t,3)*aPoint2[1])}else{t0=1-t;t1=2*t*t0;aPointEnd[0]=Math.round(Math.pow(t0,2)*aPoint0[0]+t1*aPoint1[0]+Math.pow(t,2)*aPoint2[0]);aPointEnd[1]=Math.round(Math.pow(t0,2)*aPoint0[1]+t1*aPoint1[1]+Math.pow(t,2)*aPoint2[1])}oSegment.set(aPointEnd,aPointBegin);oPointRect.set(x-nRadius,y-nRadius,nRadius+nRadius,nRadius+nRadius);if(oPointRect&&oPointRect.intersectSegment(oSegment)!==undefined){return true}aPointBegin[0]=aPointEnd[0];aPointBegin[1]=aPointEnd[1]}}return false};sap.galilei.ui.common.geometry._intersectSegmentBezierCurve=function(oSegment,aPoint0,aPoint1,aPoint2,bCubic){var t,t0,t1,nStep=0.01,dx,dy,d,aPointBegin=[],aPointEnd=[],aPoint,oSegmentPart=new sap.galilei.ui.common.Segment();if(oSegment&&aPoint0&&aPoint1&&aPoint2){dx=Math.max(aPoint0[0],aPoint1[0],aPoint2[0])-Math.min(aPoint0[0],aPoint1[0],aPoint2[0]);dy=Math.max(aPoint0[1],aPoint1[1],aPoint2[1])-Math.min(aPoint0[1],aPoint1[1],aPoint2[1]);d=Math.max(dx,dy);if(d>0){nStep=1/(d/5)}aPointBegin[0]=aPoint0[0];aPointBegin[1]=aPoint0[1];for(t=0;t<1.01;t+=nStep){if(bCubic){t0=1-t;t1=3*t*t0;aPointEnd[0]=Math.round(Math.pow(t0,3)*aPoint0[0]+t1*aPoint1[0]+Math.pow(t,3)*aPoint2[0]);aPointEnd[1]=Math.round(Math.pow(t0,3)*aPoint0[1]+t1*aPoint1[1]+Math.pow(t,3)*aPoint2[1])}else{t0=1-t;t1=2*t*t0;aPointEnd[0]=Math.round(Math.pow(t0,2)*aPoint0[0]+t1*aPoint1[0]+Math.pow(t,2)*aPoint2[0]);aPointEnd[1]=Math.round(Math.pow(t0,2)*aPoint0[1]+t1*aPoint1[1]+Math.pow(t,2)*aPoint2[1])}oSegmentPart.set(aPointEnd,aPointBegin);aPoint=oSegmentPart.intersectSegment(oSegment,false);if(aPoint){return aPoint}aPointBegin[0]=aPointEnd[0];aPointBegin[1]=aPointEnd[1]}}return undefined};sap.galilei.ui.common.geometry.isPointOnBezier=function(vPoint,aPoints,bCubic,nRadius){if(vPoint&&aPoints){var aPoint,length=aPoints.length,index,x,y,aPoint0,aPoint1,aPoint2;bCubic=(bCubic===undefined)?false:bCubic;nRadius=(nRadius===undefined)?1:nRadius;if(length>=3){aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint);if(aPoint){x=aPoint[0];y=aPoint[1]}if(x!==undefined&&y!==undefined){for(index=0;index<length-2;index++){aPoint1=aPoints[index+1];aPoint0=(index===0)?aPoints[index]:[(aPoints[index][0]+aPoint1[0])/2,(aPoints[index][1]+aPoint1[1])/2];aPoint2=(index===length-3)?aPoints[index+2]:[(aPoints[index+2][0]+aPoint1[0])/2,(aPoints[index+2][1]+aPoint1[1])/2];if(x<Math.min(aPoint0[0],aPoint1[0],aPoint2[0])||x>Math.max(aPoint0[0],aPoint1[0],aPoint2[0])){continue}if(y<Math.min(aPoint0[1],aPoint1[1],aPoint2[1])||y>Math.max(aPoint0[1],aPoint1[1],aPoint2[1])){continue}if(sap.galilei.ui.common.geometry._isPointOnBezierCursve(aPoint,aPoint0,aPoint1,aPoint2,bCubic,nRadius)){return true}}}}}return false};sap.galilei.ui.common.geometry.intersectSegmentBezier=function(oSegment,aPoints,bCubic){if(oSegment&&aPoints){var aPoint,length=aPoints.length,index,x,y,aPoint0,aPoint1,aPoint2;bCubic=(bCubic===undefined)?false:bCubic;if(length>=3){for(index=0;index<length-2;index++){aPoint1=aPoints[index+1];aPoint0=(index===0)?aPoints[index]:[(aPoints[index][0]+aPoint1[0])/2,(aPoints[index][1]+aPoint1[1])/2];aPoint2=(index===length-3)?aPoints[index+2]:[(aPoints[index+2][0]+aPoint1[0])/2,(aPoints[index+2][1]+aPoint1[1])/2];if(x<Math.min(aPoint0[0],aPoint1[0],aPoint2[0])||x>Math.max(aPoint0[0],aPoint1[0],aPoint2[0])){continue}if(y<Math.min(aPoint0[1],aPoint1[1],aPoint2[1])||y>Math.max(aPoint0[1],aPoint1[1],aPoint2[1])){continue}aPoint=sap.galilei.ui.common.geometry._intersectSegmentBezierCurve(oSegment,aPoint0,aPoint1,aPoint2,bCubic);if(aPoint){return aPoint}}}}return undefined};sap.galilei.ui.common.geometry.snapToGrid=function(nPosition,nGridSize){if(nPosition!==undefined&&!isNaN(nPosition)&&nGridSize!==undefined&&nGridSize!==0&&!isNaN(nGridSize)){var nMultiplier=(nPosition-0.001)/nGridSize;nMultiplier=Math.round(nMultiplier);nPosition=nMultiplier*nGridSize}return nPosition};
"use strict";namespace("sap.galilei.ui.common.canvas");sap.galilei.ui.common.canvas.Canvas=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.canvas.Canvas",statics:{HIDDEN_CANVAS_ID:"__canvas__",HIDDEN_CANVAS_CLASS:"hiddenCanvas",NEWLINE_SEPARATOR:"\r\n",DEFAULT_FONT:"12px Arial, Helvetica, sans-serif",_defaultCanvas:undefined,_defaultContext:undefined,fontProperties:undefined,fontHeight:undefined,defaultCanvas:{get:function(){if(!this._defaultCanvas){this._defaultCanvas=document.createElement("canvas");this._defaultCanvas.setAttribute("id",this.HIDDEN_CANVAS_ID);this._defaultCanvas.setAttribute("class",this.HIDDEN_CANVAS_CLASS);this._defaultCanvas.setAttribute("width","0");this._defaultCanvas.setAttribute("height","0");this._defaultCanvas.setAttribute("visibility","hidden")}return this._defaultCanvas}},defaultContext:{get:function(){if(!this._defaultContext){var canvas=this.defaultCanvas;if(canvas&&canvas.getContext){this._defaultContext=canvas.getContext("2d");if(this._defaultContext){if(!this.fontProperties){this.fontProperties=this._defaultContext.font}else{this._defaultContext.font=this.fontProperties}if(!this.fontHeight){this.fontHeight=this.computeFontHeight(this.fontProperties)}}}}return this._defaultContext}},font:function(sFontProps){var oContext;if(!sFontProps||sFontProps.length===0){if(this.fontProperties){return this.fontProperties}else{return this.DEFAULT_FONT}}else{if(this.fontProperties!==sFontProps||!this._defaultContext){oContext=this.defaultContext;if(oContext){oContext.font=sFontProps}this.fontProperties=sFontProps;this.fontHeight=this.computeFontHeight(sFontProps)}return sFontProps}},computeFontHeight:function(sFontProps){var iSize=10,aNumbers;if(sFontProps&&sFontProps.length>0){aNumbers=sFontProps.match(/\d+/g);if(aNumbers&&aNumbers.length>0){iSize=+aNumbers[0]}}return iSize},getFontHeight:function(sFontProps){if((!sFontProps||sFontProps.length===0)&&this.fontHeight){return this.fontHeight}var sCurrentFont=this.font();if(sCurrentFont===sFontProps&&this.fontHeight){return this.fontHeight}this.fontHeight=this.computeFontHeight(sFontProps||sCurrentFont);return this.fontHeight},measureTextLineWidth:function(text,sFontProps){if(text&&text.length>0){var oContext=this.defaultContext;if(oContext){if(sFontProps){this.font(sFontProps)}return oContext.measureText(text).width}}return 0},measureTextSize:function(text,sFontProps){var iWidth=0,iHeight=0;if(text){var aLines=text.split(this.NEWLINE_SEPARATOR);if(aLines&&aLines.length>0){this.font(sFontProps);var i,sLine,iLineWidth,iLineHeight=this.getFontHeight();for(i=0;i<aLines.length;++i){sLine=aLines[i];iLineWidth=this.measureTextLineWidth(sLine);iWidth=Math.max(iWidth,iLineWidth);iHeight+=iLineHeight}}}return{width:iWidth,height:iHeight}},convertImageToDataUrl:function(oImage,sImageFormat,width,height,bAdjustSize,backColor){if(oImage){try{var oCanvas=this.defaultCanvas,oContext=this.defaultContext,oRect,x=0,y=0,nCanvasWidth,nCanvasHeight,sURL;if(!sImageFormat||(sImageFormat!=="image/png"&&sImageFormat!=="image/jpeg")){sImageFormat="image/png"}if(width===undefined||height===undefined){nCanvasWidth=width=oImage.width;nCanvasHeight=height=oImage.height}else{oRect=new sap.galilei.ui.common.Rect({x:0,y:0,width:oImage.width,height:oImage.height});oRect.resize(width,height,false,true,false,true);if(bAdjustSize||bAdjustSize===undefined){nCanvasWidth=width=oRect.width;nCanvasHeight=height=oRect.height}else{nCanvasWidth=width;nCanvasHeight=height;x=Math.floor((width-oRect.width)/2);y=Math.floor((height-oRect.height)/2);width=oRect.width;height=oRect.height}}oCanvas.setAttribute("width",nCanvasWidth);oCanvas.setAttribute("height",nCanvasHeight);if(backColor){oContext.fillStyle=backColor;oContext.fillRect(0,0,nCanvasWidth,nCanvasHeight)}oContext.drawImage(oImage,x,y,width,height);sURL=oCanvas.toDataURL(sImageFormat,0.95);this._defaultContext=undefined;return sURL}catch(e){throw"Cannot convert a HTML image to data URL. Usually, it is caused by cross-origine security issue. ("+e.message+")"}}return undefined}}});
"use strict";namespace("sap.galilei.ui.common.svg");sap.galilei.ui.common.svg.Svg=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.svg.Svg",statics:{HIDDEN_SVG_ID:"__hiddenSvg__",HIDDEN_SVG_CLASS:"hiddenSvg",_svgHiddenNode:undefined,hiddenSvg:{get:function(){if(!this._svgHiddenNode){this._svgHiddenNode=document.createElementNS("http://www.w3.org/2000/svg","svg");this._svgHiddenNode.setAttribute("id",this.HIDDEN_SVG_ID);this._svgHiddenNode.setAttribute("class",this.HIDDEN_SVG_CLASS);this._svgHiddenNode.setAttribute("width",0);this._svgHiddenNode.setAttribute("height",0);this._svgHiddenNode.setAttribute("visibility","hidden")}return this._svgHiddenNode}},_idsMap:undefined,serializeToXML:function(svgElement){var oSerializer,sSVG='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r\n';if(svgElement){if(window.XMLSerializer){try{oSerializer=new window.XMLSerializer();sSVG+=oSerializer.serializeToString(svgElement);sSVG=this.removeEmptyNamepaces(sSVG);return sSVG}catch(e){console.log("XML Serialization error "+e)}}else{if(svgElement.xml){sSVG+=svgElement.xml;return sSVG}else{console.log("The browser does not support XMLSerializer.")}}}return undefined},removeEmptyNamepaces:function(sSVG){var oExpr,aMatches,sMatch,sNs,i;if(!sSVG){return sSVG}if(navigator.appVersion.indexOf("MSIE")!==-1){oExpr=new RegExp('transform="" requiredFeatures="" requiredExtensions="" systemLanguage=""',"g");sSVG=sSVG.replace(oExpr,"");oExpr=new RegExp('xmlns:([A-Z]|[a-z]|[0-9])+=\\"\\"',"g");aMatches=sSVG.match(oExpr);if(aMatches&&aMatches.length>0){for(i=0;i<aMatches.length;i++){sMatch=aMatches[i];oExpr=new RegExp(sMatch,"g");sSVG=sSVG.replace(oExpr,"");sNs=sMatch.substring(6,sMatch.length-3).trim();sMatch=" "+sNs+":";oExpr=new RegExp(sMatch,"g");sSVG=sSVG.replace(oExpr,"")}}}return sSVG},parseSVGContent:function(sSVG){var oParser;if(sSVG&&window.DOMParser){try{oParser=new DOMParser();return oParser.parseFromString(sSVG,"image/svg+xml")}catch(e){}}else{console.log("The browser does not support DOMParser.")}return undefined},convertSvgToDataUrl:function(sSVG){var sDataURL;if(sSVG&&window.btoa){sDataURL="data:image/svg+xml;base64,"+btoa(sSVG)}return sDataURL},resizeSVG:function(sSVG,width,height){var oRootNode,index,oNode,svgWidth,svgHeight;if(sSVG&&width!==undefined&&height!==undefined){oRootNode=sap.galilei.ui.common.svg.Svg.parseSVGContent(sSVG);if(oRootNode){for(index=0;index<oRootNode.childNodes.length;index++){oNode=oRootNode.childNodes[index];if(oNode.nodeName==="svg"){svgWidth=oNode.getAttribute("width");svgHeight=oNode.getAttribute("height");oNode.setAttribute("width",width);oNode.setAttribute("height",height);oNode.setAttribute("viewBox","0 0 "+svgWidth+" "+svgHeight);break}}return sap.galilei.ui.common.svg.Svg.serializeToXML(oRootNode)}}return sSVG},getCurrentScale:function(){var oSvg=sap.galilei.ui.common.svg.Svg.hiddenSvg,nScale;document.body.appendChild(oSvg);nScale=sap.galilei.ui.common.svg.Svg.hiddenSvg.currentScale;document.body.removeChild(oSvg);return nScale},_hideEmptyElements:function(oSvgParent,aNodes){if(oSvgParent&&aNodes){var index,oNode,bHide;for(index=0;index<oSvgParent.childNodes.length;index++){oNode=oSvgParent.childNodes[index];bHide=false;if(oNode.nodeName==="text"&&!oNode.textContent&&oNode.getAttribute("display")!=="none"){bHide=true}else{if((oNode.nodeName==="rect"||oNode.nodeName==="ellipse"||oNode.nodeName==="circle")&&oNode.getAttribute("width")==0&&oNode.getAttribute("height")==0&&oNode.getAttribute("display")!=="none"){bHide=true}}if(bHide){oNode.setAttribute("display","none");aNodes.push(oNode)}sap.galilei.ui.common.svg.Svg._hideEmptyElements(oNode,aNodes)}}return aNodes},_showEmptyElements:function(aNodes){if(aNodes){var index,oNode;for(index=0;index<aNodes.length;index++){oNode=aNodes[index];oNode.setAttribute("display","inline")}}},getChildNodesBBox:function(oSvgParentElement,bIncludeTransform,bExcludeEmptyText){var oViewBox,bFirst=true,i,oNode,oBbox,aEmptyNodes=[];bIncludeTransform=(bIncludeTransform===undefined)?true:bIncludeTransform;bExcludeEmptyText=(bExcludeEmptyText===undefined)?true:bExcludeEmptyText;if(oSvgParentElement){if(bExcludeEmptyText){aEmptyNodes=sap.galilei.ui.common.svg.Svg._hideEmptyElements(oSvgParentElement,aEmptyNodes)}for(i=0;i<oSvgParentElement.childNodes.length;i++){oNode=oSvgParentElement.childNodes[i];oBbox=sap.galilei.ui.common.svg.Svg.getBBox(oNode,bIncludeTransform,oSvgParentElement);if(oBbox){if(bFirst){oViewBox=new sap.galilei.ui.common.Rect(oBbox);bFirst=false}else{oViewBox.unionRect(oBbox)}}}if(bExcludeEmptyText&&aEmptyNodes&&aEmptyNodes.length>0){sap.galilei.ui.common.svg.Svg._showEmptyElements(aEmptyNodes)}}return oViewBox},getBBox:function(oSvgElement,bIncludeTransform,oNearestViewport,bExcludeEmptyText){if(oSvgElement){var oBBoxElement,oBBox,aEmptyNodes=[],matrix,x,y,width,height;bIncludeTransform=(bIncludeTransform===undefined)?true:bIncludeTransform;bExcludeEmptyText=(bExcludeEmptyText===undefined)?true:bExcludeEmptyText;if(bExcludeEmptyText){aEmptyNodes=sap.galilei.ui.common.svg.Svg._hideEmptyElements(oSvgElement,aEmptyNodes)}if(oSvgElement.nodeName[0]!=="#"){try{oBBox=oSvgElement.getBBox()}catch(e){}}if(oBBox){oBBoxElement=new sap.galilei.ui.common.Rect(oBBox);if(oBBoxElement.width===0){oBBoxElement.width=1}if(oBBoxElement.height===0){oBBoxElement.height=1}}if(bExcludeEmptyText&&aEmptyNodes&&aEmptyNodes.length>0){sap.galilei.ui.common.svg.Svg._showEmptyElements(aEmptyNodes)}if(oBBoxElement&&oSvgElement.nodeName==="text"){width=oSvgElement.getAttribute("g:width");if(width!=undefined){height=oSvgElement.getAttribute("g:height");x=oSvgElement.getAttribute("x");y=oSvgElement.getAttribute("y");if(x!=undefined&&y!=undefined&&height!=undefined){oBBoxElement.x=+x;oBBoxElement.y=+y;oBBoxElement.width=+width;oBBoxElement.height=+height}}}if(oBBoxElement&&bIncludeTransform){if(oNearestViewport){matrix=oSvgElement.getTransformToElement(oNearestViewport)}else{try{matrix=oSvgElement.getCTM()}catch(e){console.log("Failed to retrieve transformation matrix for SVG element "+oSvgElement.className+oSvgElement.id+": "+e)}}if(matrix){oBBoxElement=oBBoxElement.matrixTransform(matrix)}}return oBBoxElement}return undefined},getIntersectionList:function(oRect,oSvgRootElement){var aNodeList=[];if(oRect&&oSvgRootElement){sap.galilei.ui.common.svg.Svg._getOneLevelIntersectionList(aNodeList,oRect,oSvgRootElement)}return aNodeList},appendText:function(d3SvgParent,text,x,y,width,height,sFontProps,eHorzAlignment,eVertAlignment,bWordWrap,bEllipsis,nAngle,cx,cy,oAttributes){var d3SvgText;if(d3SvgParent&&text&&text.length>0){d3SvgText=d3SvgParent.append("svg:text");return sap.galilei.ui.common.svg.Svg.updateText(d3SvgText,text,x,y,width,height,sFontProps,eHorzAlignment,eVertAlignment,bWordWrap,bEllipsis,nAngle,cx,cy,oAttributes)}return d3SvgText},updateText:function(d3SvgText,text,x,y,width,height,sFontProps,eHorzAlignment,eVertAlignment,bWordWrap,bEllipsis,nAngle,cx,cy,oAttributes){if(d3SvgText){var svgText,d3SvgTextSelection,d3SvgTextSelectionAppend,oLayout,n,attr,tspan,x0,y0,totalWidth=0,totalHeight=0,node;if(d3SvgText.node){svgText=d3SvgText.node();d3SvgTextSelection=d3SvgText}else{if(d3SvgText.tween){svgText=d3SvgText[0][0].node;d3SvgTextSelection=d3.select(svgText)}}d3SvgTextSelectionAppend=d3SvgTextSelection;if(!d3SvgTextSelectionAppend.append&&d3SvgTextSelectionAppend.tween){svgText=d3SvgTextSelectionAppend[0][0];d3SvgTextSelectionAppend=d3.select(svgText)}if(svgText){text=text||"";if(x===undefined){x=0}x=+x;if(y===undefined){y=0}y=+y;if(width===undefined||width<=0){width=-1}width=+width;if(height===undefined||height<=0){height=-1}height=+height;if(nAngle===undefined){nAngle=0}nAngle=+nAngle;if(cx!==undefined){cx=+cx}if(cy!==undefined){cy=+cy}oAttributes=oAttributes||{};x0=x;y0=y;if(nAngle!==0&&(cx===undefined||cy===undefined)&&width!==-1&&height!==-1){cx=x+width/2;cy=y+height/2}oLayout=sap.galilei.ui.common.Text.layoutText(text,width,height,eHorzAlignment,eVertAlignment,bWordWrap,bEllipsis,sFontProps);if(oLayout&&oLayout.lines.length>0){x0=x+oLayout.left;y0=y+oLayout.top;totalWidth=oLayout.totalWidth;totalHeight=oLayout.totalHeight;if(oLayout.lines.length===1){if(svgText.hasChildNodes()){for(n=svgText.childNodes.length-1;n>=0;--n){node=svgText.childNodes[n];if(node.nodeName==="tspan"){svgText.removeChild(node)}}}d3SvgText.attr("x",x+oLayout.x[0]).attr("y",y+oLayout.y[0]).text(oLayout.lines[0])}else{svgText.removeAttribute("text");svgText.setAttribute("x",x0);svgText.setAttribute("y",y0);var nTotalNodes=oLayout.lines.length,nExistingNodes=svgText.childNodes.length,nUpdateNodes;if(svgText.hasChildNodes()){node=svgText.childNodes[0];if(node.nodeName==="#text"){svgText.removeChild(node);nExistingNodes=0}}nUpdateNodes=Math.min(nTotalNodes,nExistingNodes);for(n=0;n<nUpdateNodes;n++){node=svgText.childNodes[n];d3.select(node).attr("x",x+oLayout.x[n]).attr("y",y+oLayout.y[n]).text(oLayout.lines[n])}for(n=nUpdateNodes;n<nTotalNodes;n++){d3SvgTextSelectionAppend.append("svg:tspan").attr("x",x+oLayout.x[n]).attr("y",y+oLayout.y[n]).text(oLayout.lines[n])}for(n=nExistingNodes-1;n>=nTotalNodes;n--){svgText.removeChild(svgText.childNodes[n])}}if(sFontProps&&!oAttributes.style){oAttributes.style="font:"+sFontProps+";"}for(attr in oAttributes){d3SvgText.attr(attr,oAttributes[attr])}if(nAngle!==0){d3SvgText.attr("transform","rotate("+nAngle+","+cx+","+cy+")")}}else{svgText.removeAttribute("text");svgText.setAttribute("x",x0);svgText.setAttribute("y",y0);if(svgText.hasChildNodes()){for(node=svgText.firstChild;node;node=svgText.firstChild){svgText.removeChild(node)}}}svgText.setAttribute("g:width",totalWidth);svgText.setAttribute("g:height",totalHeight)}}return d3SvgText},getUniqueId:function(sPrefix){if(sPrefix){var nId;if(!sap.galilei.ui.common._idsMap){sap.galilei.ui.common._idsMap={}}nId=sap.galilei.ui.common._idsMap[sPrefix];if(nId===undefined){nId=1}else{nId+=1}sap.galilei.ui.common._idsMap[sPrefix]=nId;return sPrefix+nId}return undefined},_getOneLevelIntersectionList:function(aNodeList,oRect,oSvgParentElement){var aSubNodeList=[],i,oNode,oBbox,oNodeRect=new sap.galilei.ui.common.Rect();for(i=0;i<oSvgParentElement.childNodes.length;i++){oNode=oSvgParentElement.childNodes[i];oBbox=sap.galilei.ui.common.svg.Svg.getBBox(oNode,true);if(oBbox){oNodeRect.set(oBbox);if(oNodeRect.isRectIntersectRect(oRect)){aNodeList.push(oNode);aSubNodeList.push(oNode)}}}if(aSubNodeList.length>0){for(i=0;i<aSubNodeList.length;i++){oNode=aSubNodeList[i];sap.galilei.ui.common.svg.Svg._getOneLevelIntersectionList(aNodeList,oRect,oNode)}}},hasClass:function(oElement,sClass){if(oElement&&oElement.getAttribute){var aClassList,index,sOldClass;sOldClass=oElement.getAttribute("class");if(sOldClass){aClassList=sOldClass.split(/\s+/);if(aClassList&&aClassList.length>0&&sClass){for(index=0;index<aClassList.length;index++){if(aClassList[index]===sClass){return true}}}}}return false},addClass:function(oElement,sClass){if(oElement&&oElement.getAttribute){var sOldClass=oElement.getAttribute("class"),sNewClass;if(!sOldClass||!sap.galilei.ui.common.svg.Svg.hasClass(oElement,sClass)){if(!sOldClass){sNewClass=sClass}else{sNewClass=sOldClass+" "+sClass}oElement.setAttribute("class",sNewClass);return sNewClass}}},removeClass:function(oElement,sClass){if(oElement&&oElement.getAttribute){var aClassList,index,sOldClass=oElement.getAttribute("class"),sNewClass;if(sOldClass){aClassList=sOldClass.split(/\s+/);if(aClassList&&aClassList.length>0&&sClass){for(index=0;index<aClassList.length;index++){if(aClassList[index]===sClass){aClassList.splice(index,1);if(aClassList.length>0){sNewClass=aClassList.join(" ");oElement.setAttribute("class",sNewClass)}else{if(sOldClass){oElement.removeAttribute("class")}}return sNewClass}}}}}}}});
"use strict";sap.galilei.ui.common.svg.Viewer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.svg.Viewer",initialize:function(parentSelector,options){if(parentSelector){this.setParentNode(parentSelector);if(options){this.set(options)}this.createSvg(options);if(options){this.set(options)}}else{throw"Error: The parent node CSS selector is not specified."}},statics:{VIEW_BORDER_WIDTH:1,VIEW_BORDER_COLOR:"#6283A7",VIEW_BORDER_STYLE:"solid",VIEW_BACKGROUND_COLOR:"#BFBFBF",VIEW_ZOOM_DURATION:500,VIEW_PAN_DURATION:200,VIEW_ZOOM_FACTOR:1.2,VIEW_PAN_OFFSET:40,PAGE_WIDTH:960,PAGE_HEIGHT:1320,PAGE_HORZ_NUMBER:21,PAGE_VERT_NUMBER:15,viewerNumber:0,focusedElement:undefined,currentViewer:undefined,onElementFocus:function(oEvent){sap.galilei.ui.common.svg.Viewer.focusedElement=oEvent.target},onElementBlur:function(oEvent){if(navigator.appVersion.indexOf("MSIE")!==-1){oEvent.stopImmediatePropagation();oEvent.preventDefault()}sap.galilei.ui.common.svg.Viewer.focusedElement=undefined},addEventHandlers:function(){if(sap.galilei.ui.common.svg.Viewer.viewerNumber===0){document.addEventListener("focus",sap.galilei.ui.common.svg.Viewer.onElementFocus,true);document.addEventListener("blur",sap.galilei.ui.common.svg.Viewer.onElementBlur,true);++sap.galilei.ui.common.svg.Viewer.viewerNumber}},removeEventHandlers:function(){if(sap.galilei.ui.common.svg.Viewer.viewerNumber>0){--sap.galilei.ui.common.svg.Viewer.viewerNumber;if(sap.galilei.ui.common.svg.Viewer.viewerNumber===0){document.removeEventListener("focus",sap.galilei.ui.common.svg.Viewer.onElementFocus,true);document.removeEventListener("blur",sap.galilei.ui.common.svg.Viewer.onElementBlur,true)}}}},fields:{_parentSelector:undefined,_d3ParentNode:undefined,_d3SvgRoot:undefined,_d3SvgDefs:undefined,_d3ZoomPanel:undefined,_d3MousePanel:undefined,_d3DrawingSurface:undefined,_d3BackgroundPointerPanel:undefined,_zoomBehavior:undefined,_libraries:undefined,_lastZoomPan:undefined,_browserCurrentScale:1},properties:{d3ParentNode:{get:function(){return this._d3ParentNode}},parentNode:{get:function(){return(this.d3ParentNode)?this.d3ParentNode.node():undefined}},marginLeft:{get:function(){var oParentNode=this.parentNode,nMargin=0,style;while(oParentNode){style=window.getComputedStyle(oParentNode,null);if(style&&style.marginLeft){nMargin+=parseInt(style.marginLeft,10)}oParentNode=oParentNode.offsetParent}return nMargin}},marginTop:{get:function(){var oParentNode=this.parentNode,nMargin=0,style;while(oParentNode){style=window.getComputedStyle(oParentNode,null);if(style&&style.marginTop){nMargin+=parseInt(style.marginTop,10)}oParentNode=oParentNode.offsetParent}return nMargin}},parentOffsetLeft:{get:function(){var nOffset=0,oParentNode=this.parentNode;while(oParentNode){if(oParentNode.offsetLeft){nOffset+=oParentNode.offsetLeft}oParentNode=oParentNode.offsetParent}return nOffset}},parentOffsetTop:{get:function(){var nOffset=0,oParentNode=this.parentNode;while(oParentNode){if(oParentNode.offsetTop){nOffset+=oParentNode.offsetTop}oParentNode=oParentNode.offsetParent}return nOffset}},parentScrollLeft:{get:function(){var nOffset=0,oParentNode=this.parentNode;while(oParentNode){if(oParentNode.scrollLeft){nOffset+=oParentNode.scrollLeft}else{if(oParentNode.tagName==="BODY"){if(oParentNode.ownerDocument&&oParentNode.ownerDocument.documentElement&&oParentNode.ownerDocument.documentElement.scrollLeft){nOffset+=oParentNode.ownerDocument.documentElement.scrollLeft}}}oParentNode=oParentNode.offsetParent}return nOffset}},parentScrollTop:{get:function(){var nOffset=0,oParentNode=this.parentNode;while(oParentNode){if(oParentNode.scrollTop){nOffset+=oParentNode.scrollTop}else{if(oParentNode.tagName==="BODY"){if(oParentNode.ownerDocument&&oParentNode.ownerDocument.documentElement&&oParentNode.ownerDocument.documentElement.scrollTop){nOffset+=oParentNode.ownerDocument.documentElement.scrollTop}}}oParentNode=oParentNode.offsetParent}return nOffset}},d3SvgRoot:{get:function(){return this._d3SvgRoot}},d3SvgDefs:{get:function(){return this._d3SvgDefs}},d3DrawingSurface:{get:function(){return this._d3DrawingSurface}},svgRoot:{get:function(){return(this.d3SvgRoot)?this.d3SvgRoot.node():undefined}},mainShapeLayer:undefined,d3MainShapeLayer:{get:function(){return(this.mainShapeLayer)?this.mainShapeLayer.d3Layer:undefined}},svgMainShapeLayer:{get:function(){return(this.mainShapeLayer)?this.d3MainShapeLayer.node():undefined}},shapeDecoratorLayer:undefined,d3ShapeDecoratorLayer:{get:function(){return(this.shapeDecoratorLayer)?this.shapeDecoratorLayer.d3Layer:undefined}},svgShapeDecoratorLayer:{get:function(){return(this.shapeDecoratorLayer)?this.shapeDecoratorLayer.node():undefined}},backgroundPointerPanelShape:undefined,layers:{type:"collection",objectClass:sap.galilei.ui.common.svg.Layer,writable:false,configurable:false},viewWidth:0,viewHeight:0,showViewBorder:{value:true,onChange:function(){this.updateViewBorder()}},viewBorderColor:{expression:"sap.galilei.ui.common.svg.Viewer.VIEW_BORDER_COLOR",onChange:function(){this.updateViewBorder()}},viewBorderStyle:{expression:"sap.galilei.ui.common.svg.Viewer.VIEW_BORDER_STYLE",onChange:function(){this.updateViewBorder()}},viewBorderWidth:{expression:"sap.galilei.ui.common.svg.Viewer.VIEW_BORDER_WIDTH",onChange:function(){this.updateViewBorder()}},viewBackgroundFill:{expression:"sap.galilei.ui.common.svg.Viewer.VIEW_BACKGROUND_COLOR",onChange:function(){this.updateViewBackground()}},zoomDuration:{expression:"sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_DURATION"},panDuration:{expression:"sap.galilei.ui.common.svg.Viewer.VIEW_PAN_DURATION"},zoomScale:{get:function(){return this._zoomBehavior?this._zoomBehavior.scale():this.oldZoomScale},set:function(value){if(this._zoomBehavior&&value!==undefined){this._zoomBehavior.scale(value)}}},zoomTranslate:{get:function(){return this._zoomBehavior?this._zoomBehavior.translate():this.oldZoomTranslate},set:function(value){if(this._zoomBehavior&&value!==undefined){this._zoomBehavior.translate(value)}}},oldZoomScale:1,oldZoomTranslate:[0,0],matrixClientToZoomView:{expression:"new sap.galilei.ui.common.Matrix()",writable:false,configurable:false},matrixZoomViewToClient:{expression:"new sap.galilei.ui.common.Matrix()",writable:false,configurable:false},pageWidth:{expression:"sap.galilei.ui.common.svg.Viewer.PAGE_WIDTH",onChange:function(){this.updatePageSize()}},pageHeight:{expression:"sap.galilei.ui.common.svg.Viewer.PAGE_HEIGHT",onChange:function(){this.updatePageSize()}},pageHorzNumber:{expression:"sap.galilei.ui.common.svg.Viewer.PAGE_HORZ_NUMBER",onChange:function(){this.updatePageSize()}},pageVertNumber:{expression:"sap.galilei.ui.common.svg.Viewer.PAGE_VERT_NUMBER",onChange:function(){this.updatePageSize()}},allPagesLeft:0,allPagesTop:0,allPagesWidth:0,allPagesHeight:0,libraries:{get:function(){if(!this._libraries){this._libraries=new sap.galilei.ui.common.library.LibraryManager(this)}return this._libraries}},enableZoomPan:true,hasFocus:{get:function(){var sTagName,sType;if(document.activeElement){sTagName=document.activeElement.tagName;sType=document.activeElement.type;if(sTagName==="TEXTAREA"||(sTagName==="INPUT"&&sType==="text")){return false}sap.galilei.ui.common.svg.Viewer.focusedElement=undefined}return !sap.galilei.ui.common.svg.Viewer.focusedElement&&sap.galilei.ui.common.svg.Viewer.currentViewer===this}}},methods:{setParentNode:function(parentSelector){if(parentSelector){this._d3ParentNode=d3.select(parentSelector);if(!this._d3ParentNode){throw"Error: The parent node "+parentSelector+" cannot be found."}this._parentSelector=parentSelector;this.updateViewSize();this.updateViewBorder()}return this.parentNode},updateViewSize:function(){if(this.parentNode){this.viewWidth=this.parentNode.clientWidth;this.viewHeight=this.parentNode.clientHeight}this.matrixZoomViewToClient.setIdentity();this.matrixZoomViewToClient.translate(this.zoomTranslate[0],this.zoomTranslate[1]).scale(this.zoomScale);this.matrixClientToZoomView.set(this.matrixZoomViewToClient);this.matrixClientToZoomView.inverse();this._browserCurrentScale=sap.galilei.ui.common.svg.Svg.getCurrentScale()},updateViewBorder:function(){if(this.parentNode){if(this.showViewBorder){var sStyle=this.viewBorderWidth+"px "+this.viewBorderStyle+" "+this.viewBorderColor;this.parentNode.style.border=sStyle}else{this.parentNode.style.border="none"}}},updatePageSize:function(){var left=Math.floor(this.pageHorzNumber/2),top=Math.floor(this.pageVertNumber/2);this.allPagesLeft=-this.pageWidth*left;this.allPagesTop=-this.pageHeight*top;this.allPagesWidth=this.pageWidth*this.pageHorzNumber;this.allPagesHeight=this.pageHeight*this.pageVertNumber;this.notifyLayers("onUpdatePageSize")},createSvg:function(options){var self=this,oParentNode;function onResizeParent(){self.onResize()}if(this._d3ParentNode&&!this.d3SvgRoot){this.updatePageSize();this.addSvgRoot();this.addZoomPanNodes();this.addDrawingSurface();this.addDrawingLayers();this.onResize();if(this.parentNode){oParentNode=this.parentNode;while(oParentNode){if(oParentNode.hasOwnProperty("onresize")){oParentNode.removeEventListener("resize",onResizeParent);oParentNode.addEventListener("resize",onResizeParent);break}oParentNode=oParentNode.parentNode}}window.removeEventListener("resize",onResizeParent);window.addEventListener("resize",onResizeParent);sap.galilei.ui.common.svg.Viewer.addEventHandlers();this.gotFocus()}return this.svgRoot},addSvgRoot:function(){if(!this.d3SvgRoot){this._d3SvgRoot=this._d3ParentNode.append("svg:svg").attr("id","svgRoot").attr("class","svgRoot").attr("xmlns","http://www.w3.org/2000/svg").attr("width","100%").attr("height","100%");this.svgRoot.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");this.svgRoot.setAttribute("xmlns:g",sap.galilei.ui.common.NAMESPACE_GALILEI);if(d3.ns.prefix.g===undefined){d3.ns.prefix.g=sap.galilei.ui.common.NAMESPACE_GALILEI}this._d3SvgDefs=this.d3SvgRoot.append("svg:defs")}return this.d3SvgRoot},addZoomPanNodes:function(){var self=this;function onZoomBehavior(){self._onZoomBehaviorHandler()}this._zoomBehavior=d3.behavior.zoom().scaleExtent([0.1,10]).scale(1).on("zoom",onZoomBehavior);this._d3ZoomPanel=this.d3SvgRoot.append("svg:g").attr("class","svgZoomPanel").attr("id","svgZoomPanel").call(this._zoomBehavior,this).on("dblclick.zoom",null);this._d3MousePanel=this._d3ZoomPanel.append("svg:rect").attr("class","svgMousePanel").attr("id","svgMousePanel").attr("width","100%").attr("height","100%").attr("fill",this.viewBackgroundFill).attr("stroke","none")},addDrawingSurface:function(){if(!this._d3DrawingSurface){this._d3DrawingSurface=this._d3ZoomPanel.append("svg:g").attr("class","svgDrawingSurface")}},addDrawingLayers:function(){var self=this,index,options,oLayerClass,oLayer;for(index=0;index<sap.galilei.ui.common.svg.defaultLayers.length;++index){options=sap.galilei.ui.common.svg.defaultLayers[index];if(options){oLayerClass=options.layerClass;oLayer=new oLayerClass(this,options);if(oLayer){this.layers.add(oLayer);if(oLayer.isMainShapeLayer||(!this.mainShapeLayer&&oLayer.isShapeLayer&&oLayer.isVisible)){this.mainShapeLayer=oLayer}if(!this.shapeDecoratorLayer&&oLayer.isShapeLayer&&oLayer.isShapeDecoratorLayer&&oLayer.isVisible){this.shapeDecoratorLayer=oLayer}}}}oLayer=this.getLayerByName(sap.galilei.ui.common.svg.Layer.BACKGROUND_POINTER_LAYER);if(oLayer){this._d3BackgroundPointerPanel=oLayer.d3Layer.append("svg:rect").attr("class","svgPointerPanel").attr("id","svgPointerPanel").attr("width","100%").attr("height","100%").attr("fill","white").attr("opacity","0").attr("stroke","none");this.backgroundPointerPanelShape=new sap.galilei.ui.common.shape.Rectangle();this.backgroundPointerPanelShape.d3Node=this._d3BackgroundPointerPanel;this.backgroundPointerPanelShape.retrieveDrawing(this);this.backgroundPointerPanelShape.on("pointerdown",function(oEvent){self.gotFocus(oEvent)});this.backgroundPointerPanelShape.on("pointerup",function(oEvent){})}else{console.log("Error: Cannot find background pointer capture panel")}},gotFocus:function(oEvent){if(sap.galilei.ui.common.svg.Viewer.focusedElement&&sap.galilei.ui.common.svg.Viewer.focusedElement.nodeName!=="BODY"&&sap.galilei.ui.common.svg.Viewer.focusedElement.blur){sap.galilei.ui.common.svg.Viewer.focusedElement.blur()}if(document.activeElement&&document.activeElement.nodeName!=="BODY"&&document.activeElement.blur){document.activeElement.blur()}sap.galilei.ui.common.svg.Viewer.focusedElement=undefined;sap.galilei.ui.common.svg.Viewer.currentViewer=this},dispose:function(){var oParentNode;if(sap.galilei.ui.common.svg.Viewer.currentViewer===this){sap.galilei.ui.common.svg.Viewer.currentViewer=undefined}if(this.d3SvgRoot){this.d3SvgRoot.remove()}this._parentSelector=undefined;this._d3ParentNode=undefined;this._d3SvgRoot=undefined;this._d3SvgDefs=undefined;this._zoomBehavior=undefined;this._d3ZoomPanel=undefined;this._d3MousePanel=undefined;this._d3DrawingSurface=undefined;this.layers.clear();this.mainShapeLayer=undefined;this.shapeDecoratorLayer=undefined;this._d3BackgroundPointerPanel=undefined;if(this.backgroundPointerPanelShape){this.backgroundPointerPanelShape.dispose();this.backgroundPointerPanelShape=undefined}if(this.libraries){this.libraries.clearCache()}this.oldZoomScale=1;this.oldZoomTranslate=[0,0];sap.galilei.ui.common.svg.Viewer.removeEventHandlers()},getLayerByName:function(name){var index,layer;for(index=0;index<this.layers.length;++index){layer=this.layers[index];if(layer.name===name){return layer}}return undefined},getLayerByClass:function(sClassName){var index,layer;for(index=0;index<this.layers.length;++index){layer=this.layers[index];if(sap.galilei.core.isInstanceOf(layer,sClassName)){return layer}}return undefined},getShapeLayers:function(bIncludeHiddenLayers,bIncludeDecorators){var index,oLayer,aLayers=[];for(index=0;index<this.layers.length;++index){oLayer=this.layers[index];if(oLayer.isShapeLayer){if((bIncludeHiddenLayers||oLayer.isVisible)&&(bIncludeDecorators||!oLayer.isShapeDecoratorLayer)){aLayers.push(oLayer)}}}return aLayers},setMainShapeLayer:function(layer){if(layer){if((typeof layer)==="string"){layer=this.getLayerByName(layer)}if(layer&&sap.galilei.core.isInstanceOf(layer,"sap.galilei.ui.common.svg.Layer")&&layer.isShapeLayer){this.mainShapeLayer=layer}}return layer},showLayer:function(name,bUseAnimation){var layer=this.getLayerByName(name);if(layer){layer.show(bUseAnimation)}return layer},hideLayer:function(name,bUseAnimation){var layer=this.getLayerByName(name);if(layer){layer.hide(bUseAnimation)}return layer},notifyLayers:function(sEventHandlerName,options){var index,layer;for(index=0;index<this.layers.length;++index){layer=this.layers[index];if(layer[sEventHandlerName]&&(typeof layer[sEventHandlerName])==="function"){layer[sEventHandlerName].apply(layer,arguments)}}return this},findNodeById:function(id,d3Parent){if(id){var d3ParentNode=this.d3SvgRoot;if(d3Parent){d3ParentNode=d3Parent}if(d3ParentNode){return d3ParentNode.select("#"+id)}}return undefined},updateViewBackground:function(){if(this._d3MousePanel){this._d3MousePanel.attr("fill",this.viewBackgroundFill)}return this},pagePointToClientPoint:function(aPoint,bIncludeScroll){var nOffsetX,nOffsetY;if(aPoint){nOffsetX=this.parentOffsetLeft;nOffsetY=this.parentOffsetTop;if(bIncludeScroll){nOffsetX-=this.parentScrollLeft;nOffsetY-=this.parentScrollTop}return[aPoint[0]-nOffsetX,aPoint[1]-nOffsetY]}return undefined},clientPointToPagePoint:function(aPoint,bIncludeScroll){var nOffsetX,nOffsetY;if(aPoint){nOffsetX=this.parentOffsetLeft;nOffsetY=this.parentOffsetTop;if(bIncludeScroll){nOffsetX-=this.parentScrollLeft;nOffsetY-=this.parentScrollTop}return[aPoint[0]+nOffsetX,aPoint[1]+nOffsetY]}return undefined},pagePointToViewPoint:function(aPoint,bIncludeScroll){if(aPoint){var oPt=new sap.galilei.ui.common.Point();oPt.set(this.pagePointToClientPoint(aPoint,bIncludeScroll));oPt.matrixTransform(this.matrixClientToZoomView);return[oPt.x,oPt.y]}return undefined},viewPointToPagePoint:function(aPoint,bIncludeScroll){if(aPoint){var oPt=new sap.galilei.ui.common.Point();oPt.set(aPoint[0],aPoint[1]);oPt.matrixTransform(this.matrixZoomViewToClient);return this.clientPointToPagePoint([oPt.x,oPt.y],bIncludeScroll)}return undefined},pageDeltaToViewDelta:function(aDelta){if(aDelta){var oPt1=new sap.galilei.ui.common.Point(),oPt2=new sap.galilei.ui.common.Point();oPt1.set(0,0);oPt1.matrixTransform(this.matrixClientToZoomView);oPt2.set(aDelta[0],aDelta[1]);oPt2.matrixTransform(this.matrixClientToZoomView);return[oPt2.x-oPt1.x,oPt2.y-oPt1.y]}return undefined},viewDeltaToPageDelta:function(aDelta){if(aDelta){var oPt1=new sap.galilei.ui.common.Point(),oPt2=new sap.galilei.ui.common.Point();oPt1.set(0,0);oPt1.matrixTransform(this.matrixZoomViewToClient);oPt2.set(aDelta[0],aDelta[1]);oPt2.matrixTransform(this.matrixZoomViewToClient);return[oPt2.x-oPt1.x,oPt2.y-oPt1.y]}return undefined},clientPointToViewPoint:function(aPoint,bIncludeScroll){if(aPoint){var oPt=new sap.galilei.ui.common.Point();oPt.set(aPoint[0],aPoint[1]);if(bIncludeScroll){oPt.x+=this.parentScrollLeft;oPt.y+=this.parentScrollTop}oPt.matrixTransform(this.matrixClientToZoomView);return[oPt.x,oPt.y]}return undefined},viewPointToClientPoint:function(aPoint,bIncludeScroll){if(aPoint){var oPt=new sap.galilei.ui.common.Point();oPt.set(aPoint[0],aPoint[1]);oPt.matrixTransform(this.matrixZoomViewToClient);if(bIncludeScroll){oPt.x-=this.parentScrollLeft;oPt.y-=this.parentScrollTop}return[oPt.x,oPt.y]}return undefined},viewBBoxToClientBBox:function(oRect,bRounded,bIncludeScroll,bIncludeMargin){var oNewRect;if(oRect){oNewRect=oRect.matrixTransform(this.matrixZoomViewToClient,bRounded,true);if(bIncludeScroll){oNewRect.moveBy(-this.parentScrollLeft,-this.parentScrollTop)}if(bIncludeMargin){oNewRect.moveBy(this.marginLeft,this.marginTop)}}return oNewRect},clientBBoxToViewBBox:function(oRect,bRounded,bIncludeScroll){var oNewRect;if(oRect){oNewRect=oRect.clone();if(bIncludeScroll){oNewRect.moveBy(this.parentScrollLeft,this.parentScrollTop)}oNewRect=oNewRect.matrixTransform(this.matrixClientToZoomView,bRounded,true)}return oNewRect},viewBBoxToPageBBox:function(oRect,bRounded,bIncludeScroll){if(oRect){var oNewRect=this.viewBBoxToClientBBox(oRect,bRounded,bIncludeScroll);oNewRect.x+=this.parentOffsetLeft;oNewRect.y+=this.parentOffsetTop;return oNewRect}return undefined},pageBBoxToViewBBox:function(oRect,bRounded,bIncludeScroll){if(oRect){var oNewRect=oRect.clone();oNewRect.x-=this.parentOffsetLeft;oNewRect.y-=this.parentOffsetTop;oNewRect=this.viewBBoxToClientBBox(oNewRect,bRounded,bIncludeScroll);return oNewRect}return undefined},normalizePointerEvent:function(oEvent,bConvertToView){var aPoint,aStartPoint,aDelta,aPt,sEventType;if(oEvent){sEventType=oEvent._type?oEvent._type:oEvent.type;if(bConvertToView&&oEvent.clientViewX!==undefined&&oEvent.clientViewY!==undefined){aPoint=[oEvent.clientViewX,oEvent.clientViewY];bConvertToView=false}else{if((oEvent._clientX!==undefined&&oEvent._clientY!==undefined)||(oEvent.clientX!==undefined&&oEvent.clientY!==undefined)){if(oEvent._clientX!==undefined&&oEvent._clientY!==undefined){aPt=[oEvent._clientX,oEvent._clientY]}else{aPt=[oEvent.clientX,oEvent.clientY]}if(sap.galilei.ui.common.isMouseEvent(sEventType)){aPoint=this.pagePointToClientPoint(aPt,true)}else{aPoint=aPt}}else{if(sap.galilei.ui.common.isTouchEvent(sEventType)&&oEvent.touches&&oEvent.touches.length>0&&oEvent.touches[0].clientX!==undefined&&oEvent.touches[0].clientY!==undefined){oEvent.clientX=oEvent.touches[0].clientX;oEvent.clientY=oEvent.touches[0].clientY;aPoint=[oEvent.clientX,oEvent.clientY]}else{if(oEvent.gesture){if(oEvent.gesture.center){aPt=[oEvent.gesture.center.pageX,oEvent.gesture.center.pageY];aPoint=this.pagePointToClientPoint(aPt,false);oEvent.clientX=aPoint[0];oEvent.clientY=aPoint[1]}else{if(oEvent.gesture.startEvent&&oEvent.gesture.startEvent.center){aPt=[oEvent.gesture.startEvent.center.pageX,oEvent.gesture.startEvent.center.pageY];aPoint=this.pagePointToClientPoint(aPt,false);oEvent.clientX=aPoint[0];oEvent.clientY=aPoint[1]}}}}}}if(oEvent.gesture){if(oEvent.gesture.startEvent&&oEvent.gesture.startEvent.center){aPt=[oEvent.gesture.startEvent.center.pageX,oEvent.gesture.startEvent.center.pageY];aStartPoint=this.pagePointToClientPoint(aPt,false)}if(oEvent.gesture.deltaX!==undefined&&oEvent.gesture.deltaY!==undefined){aDelta=[oEvent.gesture.deltaX,oEvent.gesture.deltaY]}}if(aPoint){if(bConvertToView||bConvertToView===undefined){aPoint=this.clientPointToViewPoint(aPoint,false)}oEvent.clientViewX=aPoint[0];oEvent.clientViewY=aPoint[1]}if(aStartPoint){if(bConvertToView||bConvertToView===undefined){aStartPoint=this.clientPointToViewPoint(aStartPoint,false)}oEvent.startClientViewX=aStartPoint[0];oEvent.startClientViewY=aStartPoint[1]}if(aDelta){if(bConvertToView||bConvertToView===undefined){aDelta=this.pageDeltaToViewDelta(aDelta)}oEvent.deltaClientViewX=aDelta[0];oEvent.deltaClientViewY=aDelta[1]}}return aPoint},getFontProperties:function(svgElement){var svgDrawingSurface=this._d3DrawingSurface?this._d3DrawingSurface.node():undefined;svgElement=svgElement||svgDrawingSurface;return sap.galilei.ui.common.Font.getFontProperties(svgElement)},zoomIn:function(){this.zoomToCenter(this.zoomScale*sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR);return this},zoomOut:function(){this.zoomToCenter(this.zoomScale/sap.galilei.ui.common.svg.Viewer.VIEW_ZOOM_FACTOR);return this},showActualSize:function(){this.zoomToCenter(1);return this},showInitialView:function(){this.zoomTo(1,[0,0]);return this},centerView:function(){var oRect=this.getGlobalViewRect(),ptCenter;if(oRect){ptCenter=oRect.getCenter();this.zoomToCenter(1,ptCenter[0],ptCenter[1])}return this},showGlobalView:function(){var oRect=this.getGlobalViewRect();if(oRect){this.zoomToRect(oRect.x,oRect.y,oRect.width,oRect.height)}return this},showInView:function(svgElement){if(svgElement){var rect=svgElement.getBBox();this.zoomToRect(rect.x,rect.y,rect.width,rect.height)}return this},showAllPages:function(){var layer=this.getLayerByName(sap.galilei.ui.common.svg.PageLimitLayer.NAME),rect;if(layer){rect=layer.svgLayer.getBBox();this.zoomToRect(rect.x,rect.y,rect.width,rect.height)}return this},showUsedPages:function(){var rect=this.getUsedPagesRect();if(rect){this.zoomToRect(rect.x,rect.y,rect.width,rect.height)}return this},zoomToCenter:function(scale,x,y){var oldScale,translate,x0=this.viewWidth/2,y0=this.viewHeight/2,cx,cy,dx=0,dy=0;if(scale==undefined){scale=this.zoomScale}oldScale=this.zoomScale;translate=[this.zoomTranslate[0],this.zoomTranslate[1]];if(x==undefined){x=(x0-translate[0])/oldScale}if(y==undefined){y=(y0-translate[1])/oldScale}cx=x*oldScale+translate[0];cy=y*oldScale+translate[1];dx=scale*x;dy=scale*y;translate[0]=cx-dx+(x0-cx);translate[1]=cy-dy+(y0-cy);this.zoomScale=scale;this.zoomTranslate=[translate[0],translate[1]];return this.zoomTo(scale,translate)},zoomToRect:function(x,y,width,height,bPreserveZoomScale,bCenterInView){var scale=this.zoomScale,oldScale=this.zoomScale,scale2,oViewRect,cx,cy,oldCx,oldCy,aCenter,cx0,cy0,nViewWidth,nViewHeight,margin=10;if(x==undefined||y==undefined||width==undefined||height==undefined){return}if(width===0){width=1}if(height===0){height=1}if(bPreserveZoomScale===undefined){bPreserveZoomScale=false}if(bCenterInView===undefined){bCenterInView=true}oldScale=scale;if(!bPreserveZoomScale){scale=1;bCenterInView=true;if(width>this.viewWidth-margin-margin){scale=(this.viewWidth-margin-margin)/width}if(height>this.viewHeight-margin-margin){scale2=(this.viewHeight-margin-margin)/height;if(scale2<scale){scale=scale2}}}oViewRect=this.getViewRect();aCenter=oViewRect.getCenter();cx0=oldCx=aCenter[0];cy0=oldCy=aCenter[1];cx=x+width/2;cy=y+height/2;if(!bCenterInView){nViewWidth=oViewRect.width;nViewHeight=oViewRect.height;margin/=scale;if(bPreserveZoomScale&&width>this.viewWidth-margin){cx=cx0}else{if(cx-width/2-margin<cx0-nViewWidth/2){cx=cx0-(cx0-nViewWidth/2-cx+width/2+margin)}else{if(cx+width/2+margin>cx0+nViewWidth/2){cx=cx0+(cx+width/2-cx0-nViewWidth/2+margin)}else{cx=cx0}}}if(bPreserveZoomScale&&height>this.viewHeight-margin){cy=cy0}else{if(cy-height/2-margin<cy0-nViewHeight/2){cy=cy0-(cy0-nViewHeight/2-cy+height/2+margin)}else{if(cy+height/2+margin>cy0+nViewHeight/2){cy=cy0+(cy+height/2-cy0-nViewHeight/2+margin)}else{cy=cy0}}}}if(scale!==oldScale||cx!==oldCx||cy!==oldCy){return this.zoomToCenter(scale,cx,cy)}else{return this}},zoomTo:function(scale,translate,bUseAnimation){var self=this,oEvent={},nDuration=0;if(scale===undefined){scale=this.zoomScale}if(translate===undefined){translate=[this.zoomTranslate[0],this.zoomTranslate[1]]}if(scale===this.oldZoomScale&&translate[0]===this.oldZoomTranslate[0]&&translate[1]===this.oldZoomTranslate[1]){return this}if(bUseAnimation===undefined){bUseAnimation=true}if(bUseAnimation){nDuration=this.getZoomPanDuration(scale,translate);if(nDuration>0){nDuration+=50}}this.zoomScale=scale;this.zoomTranslate=[translate[0],translate[1]];oEvent.scale=scale;oEvent.translate=[translate[0],translate[1]];oEvent.oldScale=this.oldZoomScale;oEvent.oldTranslate=[this.oldZoomTranslate[0],this.oldZoomTranslate[1]];oEvent.useAnimation=bUseAnimation;oEvent.animationDuration=nDuration;sap.galilei.core.Event.publish("viewer.zoompan.before",this,undefined,oEvent);this.matrixZoomViewToClient.setIdentity();this.matrixZoomViewToClient.translate(translate[0],translate[1]).scale(scale);this.matrixClientToZoomView.set(this.matrixZoomViewToClient);this.matrixClientToZoomView.inverse();this.notifyLayers("onZoomPan",scale,translate,bUseAnimation);this._lastZoomPan=this._lastZoomPan||{};if(this._lastZoomPan._idTimeOutAfter){clearTimeout(this._lastZoomPan._idTimeOutAfter);this._lastZoomPan._idTimeOutAfter=undefined}this._lastZoomPan._event=oEvent;if(!this._fnNotifyAfterZoomPan){this._fnNotifyAfterZoomPan=jQuery.proxy(this._notifyAfterZoomPan,this)}if(bUseAnimation){this._lastZoomPan._idTimeOutAfter=setTimeout(this._fnNotifyAfterZoomPan,nDuration+33)}else{this._fnNotifyAfterZoomPan()}this.notifyLayers("onPostZoomPan",scale,translate,true);if(this.onPostZoomPan){this.onPostZoomPan(this,scale,translate)}this.oldZoomScale=scale;this.oldZoomTranslate=[translate[0],translate[1]];return this},panView:function(dx,dy){if(dx!=undefined&&dy!=undefined){var translate=[this.zoomTranslate[0],this.zoomTranslate[1]];translate[0]+=dx;translate[1]+=dy;this.zoomTo(this.zoomScale,translate)}return this},panLeft:function(){return this.panView(sap.galilei.ui.common.svg.Viewer.VIEW_PAN_OFFSET,0)},panRight:function(){return this.panView(-sap.galilei.ui.common.svg.Viewer.VIEW_PAN_OFFSET,0)},panUp:function(){return this.panView(0,sap.galilei.ui.common.svg.Viewer.VIEW_PAN_OFFSET)},panDown:function(){return this.panView(0,-sap.galilei.ui.common.svg.Viewer.VIEW_PAN_OFFSET)},panPageLeft:function(){return this.panView(-this.viewWidth/2,0)},panPageRight:function(){return this.panView(this.viewWidth/2,0)},panPageUp:function(){return this.panView(0,-this.viewHeight/2)},panPageDown:function(){return this.panView(0,this.viewHeight/2)},getGlobalViewRect:function(){var oViewBox,oBbox,index,oLayer;for(index=0;index<this.layers.length;++index){oLayer=this.layers[index];if(oLayer.isShapeLayer&&oLayer.isVisible){oBbox=oLayer.getGlobalViewRect();if(oBbox){if(!oViewBox){oViewBox=new sap.galilei.ui.common.Rect();oViewBox.set(oBbox)}else{oViewBox.unionRect(oBbox)}}}}return oViewBox},getUsedPagesRect:function(){var oRect=this.getGlobalViewRect(),x2,y2;if(!oRect){oRect=new sap.galilei.ui.common.Rect()}oRect.x=Math.floor(oRect.x/this.pageWidth)*this.pageWidth;oRect.y=Math.floor(oRect.y/this.pageHeight)*this.pageHeight;x2=Math.floor((oRect.x+oRect.width)/this.pageWidth)*this.pageWidth+this.pageWidth;y2=Math.floor((oRect.y+oRect.height)/this.pageHeight)*this.pageHeight+this.pageHeight;oRect.width=x2-oRect.x;oRect.height=y2-oRect.y;return oRect},getViewRect:function(){var oRect=new sap.galilei.ui.common.Rect(0,0,this.viewWidth,this.viewHeight);return this.clientBBoxToViewBBox(oRect)},isRectInView:function(oRect){var oViewRect;if(oRect){oViewRect=this.getViewRect();return oViewRect.isRectInRect(oRect)}return false},isRectVisible:function(oRect){var oViewRect;if(oRect){oViewRect=this.getViewRect();return oViewRect.isRectIntersectRect(oRect)}return false},onResize:function(){this.updateViewSize();if(this.d3SvgRoot){this.d3SvgRoot.attr("width",this.viewWidth).attr("height",this.viewHeight)}if(this._d3MousePanel){this._d3MousePanel.attr("width",this.viewWidth).attr("height",this.viewHeight)}if(this._d3BackgroundPointerPanel){this._d3BackgroundPointerPanel.attr("width",this.viewWidth).attr("height",this.viewHeight)}if(this.backgroundPointerPanelShape){this.backgroundPointerPanelShape.width=this.viewWidth;this.backgroundPointerPanelShape.height=this.viewHeight}this.notifyLayers("onResize");return this},onPreZoomPan:undefined,onPostZoomPan:undefined,getZoomPanDuration:function(scale,translate){var duration=0;if(scale!==undefined&&!isNaN(scale)&&translate){if(this.oldZoomScale!==scale){duration=this.zoomDuration}else{if(this.oldZoomTranslate[0]!==translate[0]||this.oldZoomTranslate[1]!==translate[1]){duration=this.panDuration}}}return duration},getElementsByPoint:function(x,y,oRootElement,radius){var oRect,svgRoot=this.svgRoot,aNodeList,bSupportGetIntersectionList;if(svgRoot){oRootElement=oRootElement||svgRoot;if(navigator.appVersion.indexOf("MSIE 9")===-1&&(navigator.appVersion.indexOf("Safari")===-1||navigator.appVersion.indexOf("Chrome")>=0)&&svgRoot.getIntersectionList){bSupportGetIntersectionList=true;oRect=svgRoot.createSVGRect()}else{bSupportGetIntersectionList=false;oRect=new sap.galilei.ui.common.Rect()}if(oRect){if(radius===undefined||radius===0){radius=1}oRect.x=x-radius;oRect.y=y-radius;oRect.width=oRect.height=radius+radius;if(bSupportGetIntersectionList){aNodeList=svgRoot.getIntersectionList(oRect,oRootElement)}else{aNodeList=sap.galilei.ui.common.svg.Svg.getIntersectionList(oRect,oRootElement)}}return aNodeList}},_removeSVGNodes:function(oSvgNode){var index;if(oSvgNode&&oSvgNode.getAttribute&&oSvgNode.removeAttribute){if(oSvgNode.getAttribute("g:width")){oSvgNode.removeAttribute("g:width")}if(oSvgNode.getAttribute("g:height")){oSvgNode.removeAttribute("g:height")}if(oSvgNode.getAttributeNS(sap.galilei.ui.common.NAMESPACE_GALILEI,"data-zindex")){oSvgNode.removeAttributeNS(sap.galilei.ui.common.NAMESPACE_GALILEI,"data-zindex")}}for(index=0;index<oSvgNode.childNodes.length;index++){this._removeSVGNodes(oSvgNode.childNodes[index])}},generateSVG:function(oOptions){var self=this,bIncludeDecoratorLayers,oRect,viewX,viewY,viewWidth,viewHeight,offsetX,offsetY,oSvgRootClone,oSvgDefsClone,oSvgShapeLayerClone,aLayers,sTransform,sSVG;if(this.svgRoot&&this.svgRoot.cloneNode&&XMLSerializer){oOptions=oOptions||{};bIncludeDecoratorLayers=oOptions.includeDecoratorLayers;oRect=this.getGlobalViewRect();if(!oRect){oRect=new sap.galilei.ui.common.Rect()}oRect.inflate(1,1);oSvgRootClone=this.svgRoot.cloneNode(false);oSvgRootClone.setAttribute("width",oRect.width);oSvgRootClone.setAttribute("height",oRect.height);viewX=0;viewY=0;viewWidth=oRect.width;viewHeight=oRect.height;oSvgRootClone.setAttribute("viewBox",viewX+" "+viewY+" "+viewWidth+" "+viewHeight);if(oRect.x!==0||oRect.y!==0){offsetX=-oRect.x;offsetY=-oRect.y;sTransform="translate("+offsetX+","+offsetY+")"}oSvgDefsClone=this.d3SvgDefs.node().cloneNode(true);oSvgRootClone.appendChild(oSvgDefsClone);aLayers=this.getShapeLayers(false,bIncludeDecoratorLayers);if(aLayers){aLayers.forEach(function(oLayer){oSvgShapeLayerClone=oLayer.d3Layer.node().cloneNode(true);if(sTransform){oSvgShapeLayerClone.setAttributeNS(null,"transform",sTransform)}else{oSvgShapeLayerClone.removeAttribute("transform");if(oSvgShapeLayerClone.getAttribute("transform")){oSvgShapeLayerClone.setAttributeNS(null,"transform",null)}}self._removeSVGNodes(oSvgShapeLayerClone);oSvgRootClone.appendChild(oSvgShapeLayerClone)})}sSVG=sap.galilei.ui.common.svg.Svg.serializeToXML(oSvgRootClone)}return sSVG},generateSVGBlob:function(oOptions){var sSVG=this.generateSVG(oOptions),oBlob;if(sSVG&&Blob){oBlob=new Blob([sSVG],{type:"text/xml"});sSVG=undefined}return oBlob},generateImage:function(fnImageReady,sImageFormat,width,height,bAdjustSize,bIncludeDecoratorLayers){var sSVG=this.generateSVG({includeDecoratorLayers:bIncludeDecoratorLayers});if(sSVG){sap.galilei.ui.common.Image.convertSVGToImage(sSVG,fnImageReady,sImageFormat,width,height,bAdjustSize)}},generateImageBlob:function(fnImageReady,sImageFormat,width,height,bAdjustSize,bIncludeDecoratorLayers){var sSVG=this.generateSVG({includeDecoratorLayers:bIncludeDecoratorLayers});if(sSVG){sap.galilei.ui.common.Image.convertSVGToImageBlob(sSVG,fnImageReady,sImageFormat,width,height,bAdjustSize);sSVG=undefined}},_zoomPanView:function(){this._lastZoomPan.idTimeOut=undefined;if(this.enableZoomPan&&!isNaN(this._lastZoomPan.scale)&&this._lastZoomPan.translate){this._onZoomPanHandler(this._lastZoomPan.scale,this._lastZoomPan.translate)}if(this._lastZoomPan.bNeedUpdate){this._lastZoomPan.bNeedUpdate=false;this._lastZoomPan.idTimeOut=setTimeout(this._fnZoomPanView,33)}},_onZoomBehaviorHandler:function(){var self=this;this._lastZoomPan=this._lastZoomPan||{};if(d3.event&&!isNaN(d3.event.scale)&&d3.event.translate&&(this._lastZoomPan.scale!==d3.event.scale||this._lastZoomPan.translate!=d3.event.translate)){this._lastZoomPan.scale=d3.event.scale;this._lastZoomPan.translate=d3.event.translate;if(this._lastZoomPan.idTimeOut){this._lastZoomPan.bNeedUpdate=true}else{if(!this._fnZoomPanView){this._fnZoomPanView=jQuery.proxy(this._zoomPanView,this)}this._lastZoomPan.idTimeOut=setTimeout(this._fnZoomPanView,33)}}},_notifyAfterZoomPan:function(){this._lastZoomPan._idTimeOutAfter=undefined;sap.galilei.core.Event.publish("viewer.zoompan.after",this,undefined,this._lastZoomPan._event)},_onZoomPanHandler:function(scale,translate){var self=this,oEvent={},nDuration;if(scale===undefined){scale=this.zoomScale}if(translate===undefined){translate=[this.zoomTranslate[0],this.zoomTranslate[1]]}if(scale===this.oldZoomScale&&translate[0]===this.oldZoomTranslate[0]&&translate[1]===this.oldZoomTranslate[1]){return}nDuration=this.getZoomPanDuration(scale,translate);if(nDuration>0){nDuration+=50}oEvent.scale=scale;oEvent.translate=[translate[0],translate[1]];oEvent.oldScale=this.oldZoomScale;oEvent.oldTranslate=[this.oldZoomTranslate[0],this.oldZoomTranslate[1]];oEvent.useAnimation=false;oEvent.animationDuration=nDuration;sap.galilei.core.Event.publish("viewer.zoompan.before",this,undefined,oEvent);this.notifyLayers("onPreZoomPan",scale,translate,false);if(this.onPreZoomPan){this.onPreZoomPan(this,scale,translate)}this.matrixZoomViewToClient.setIdentity();this.matrixZoomViewToClient.translate(translate[0],translate[1]).scale(scale);this.matrixClientToZoomView.set(this.matrixZoomViewToClient);this.matrixClientToZoomView.inverse();this.notifyLayers("onZoomPan",scale,translate,false);this._lastZoomPan=this._lastZoomPan||{};if(this._lastZoomPan._idTimeOutAfter){clearTimeout(this._lastZoomPan._idTimeOutAfter);this._lastZoomPan._idTimeOutAfter=undefined}this._lastZoomPan._event=oEvent;if(!this._fnNotifyAfterZoomPan){this._fnNotifyAfterZoomPan=jQuery.proxy(this._notifyAfterZoomPan,this)}this._lastZoomPan._idTimeOutAfter=setTimeout(this._fnNotifyAfterZoomPan,nDuration+33);this.notifyLayers("onPostZoomPan",scale,translate,false);if(this.onPostZoomPan){this.onPostZoomPan(this,scale,translate)}this.oldZoomScale=scale;this.oldZoomTranslate=[translate[0],translate[1]]}}});
"use strict";sap.galilei.ui.common.svg.Layer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.svg.Layer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}this.add()},properties:{viewer:undefined,name:undefined,d3DrawingSurface:{get:function(){return this.viewer?this.viewer.d3DrawingSurface:undefined}},d3Layer:undefined,svgLayer:{get:function(){if(this.d3Layer){return this.d3Layer.node()}}},animationDuration:500,isVisible:true,isDisableKeyboardEvents:false},methods:{add:undefined,remove:function(bUseAnimation){if(this.d3Layer&&this.d3DrawingSurface){this.d3Layer.hide(bUseAnimation);this.d3Layer.remove()}},show:function(bUseAnimation){if(this.d3Layer){this.isVisible=true;var selection;if(bUseAnimation===false){selection=this.d3Layer}else{selection=this.d3Layer.transition().duration(this.animationDuration)}selection.attr("opacity",1)}return this.d3Layer},hide:function(bUseAnimation){if(this.d3Layer){this.isVisible=false;var selection;if(bUseAnimation===false){selection=this.d3Layer}else{selection=this.d3Layer.transition().duration(this.animationDuration)}selection.attr("opacity",0)}return this.d3Layer},onResize:undefined,onUpdatePageSize:undefined,onZoomPan:undefined,onZoomPanUpdate:undefined},statics:{BACKGROUND_POINTER_LAYER:"svgBackgroundPointerPanelLayer",FIXED_LAYER:"svgFixedLayer",GEOMETRIC_ZOOM_LAYER:"svgGeometricZoomLayer",GRID_LAYER:"svgGridLayer",PAGE_BACKGROUND_LAYER:"svgPageBackgroundLayer",PAGE_LIMIT_LAYER:"svgPageLimitLayer",SEMANTIC_ZOOM_LAYER:"svgSemanticZoomLayer",SHAPE_LAYER:"svgShapeLayer",MAIN_SHAPE_LAYER:"svgMainShapeLayer",SHAPE_DECORATOR_LAYER:"svgShapeDecoratorLayer",ZOOM_TOOL_LAYER:"svgZoomToolLayer",FOREGROUND_POINTER_LAYER:"svgForegroundPointerPanelLayer"}});(function(){var oProps={defaultLayers:{field:"_defaultLayers",get:function(){if(!this._defaultLayers){this._defaultLayers=[{layerClass:sap.galilei.ui.common.svg.PageBackgroundLayer},{layerClass:sap.galilei.ui.common.svg.PageLimitLayer},{layerClass:sap.galilei.ui.common.svg.GridLayer},{layerClass:sap.galilei.ui.common.svg.FixedLayer,id:sap.galilei.ui.common.svg.Layer.BACKGROUND_POINTER_LAYER,name:sap.galilei.ui.common.svg.Layer.BACKGROUND_POINTER_LAYER},{layerClass:sap.galilei.ui.common.svg.ShapeLayer,id:sap.galilei.ui.common.svg.Layer.MAIN_SHAPE_LAYER,name:sap.galilei.ui.common.svg.Layer.MAIN_SHAPE_LAYER,isMainShapeLayer:true},{layerClass:sap.galilei.ui.common.svg.ShapeLayer,id:sap.galilei.ui.common.svg.Layer.SHAPE_DECORATOR_LAYER,name:sap.galilei.ui.common.svg.Layer.SHAPE_DECORATOR_LAYER,isShapeDecoratorLayer:true},{layerClass:sap.galilei.ui.common.svg.SemanticZoomLayer},{layerClass:sap.galilei.ui.common.svg.ZoomToolLayer,id:sap.galilei.ui.common.svg.Layer.ZOOM_TOOL_LAYER,name:sap.galilei.ui.common.svg.Layer.ZOOM_TOOL_LAYER},{layerClass:sap.galilei.ui.common.svg.FixedLayer,id:sap.galilei.ui.common.svg.Layer.FOREGROUND_POINTER_LAYER,name:sap.galilei.ui.common.svg.Layer.FOREGROUND_POINTER_LAYER}]}return this._defaultLayers},set:function(value){if(value){this._defaultLayers=value}},configurable:true}};sap.galilei.core.extend(sap.galilei.ui.common.svg,sap.galilei.core.ClassDefinitionBuilder.transformValueProperties({},oProps))})();
"use strict";sap.galilei.ui.common.svg.GeometricZoomLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.Layer,fullClassName:"sap.galilei.ui.common.svg.GeometricZoomLayer",properties:{name:sap.galilei.ui.common.svg.Layer.GEOMETRIC_ZOOM_LAYER,id:sap.galilei.ui.common.svg.Layer.GEOMETRIC_ZOOM_LAYER,domClass:sap.galilei.ui.common.svg.Layer.GEOMETRIC_ZOOM_LAYER},methods:{add:function(){if(!this.d3Layer&&this.viewer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:rect").attr("id",this.id).attr("class",this.domClass)}return this.d3Layer},onZoomPan:function(eventName,scale,translate,bUseAnimation){var selection=this.d3Layer,duration=0;if(bUseAnimation){if(this.viewer.oldZoomScale!==scale){duration=this.viewer.zoomDuration}else{if(this.viewer.oldZoomTranslate[0]!==translate[0]||this.viewer.oldZoomTranslate[1]!==translate[1]){duration=this.viewer.panDuration}}if(duration!==0){selection=this.d3Layer.transition().duration(duration).ease("linear")}}selection.attr("transform","translate("+translate+") scale("+scale+")")}},statics:{ID:sap.galilei.ui.common.svg.Layer.GEOMETRIC_ZOOM_LAYER,NAME:sap.galilei.ui.common.svg.Layer.GEOMETRIC_ZOOM_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.GEOMETRIC_ZOOM_LAYER}});
"use strict";sap.galilei.ui.common.svg.FixedLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.Layer,fullClassName:"sap.galilei.ui.common.svg.FixedLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}this.add()},properties:{name:sap.galilei.ui.common.svg.Layer.FIXED_LAYER,id:sap.galilei.ui.common.svg.Layer.FIXED_LAYER,domClass:sap.galilei.ui.common.svg.Layer.FIXED_LAYER},methods:{add:function(){if(!this.d3Layer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:g").attr("id",this.id).attr("class",this.domClass)}return this.d3Layer},onResize:function(sEventHandlerName){this.d3Layer.attr("width",this.viewer.viewWidth).attr("height",this.viewer.viewHeight)}},statics:{ID:sap.galilei.ui.common.svg.Layer.FIXED_LAYER,NAME:sap.galilei.ui.common.svg.Layer.FIXED_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.FIXED_LAYER}});
namespace("sap.galilei.ui.common.style");
"use strict";sap.galilei.ui.common.style.Color=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.Color",initialize:function(){this.set.apply(this,arguments)},properties:{r:0,g:0,b:0},methods:{set:function(){var nValue,oColor;if(arguments.length===3){nValue=+arguments[0];if(nValue>255){nValue=255}if(nValue<0){nValue=0}this.r=nValue;nValue=+arguments[1];if(nValue>255){nValue=255}if(nValue<0){nValue=0}this.g=nValue;nValue=+arguments[2];if(nValue>255){nValue=255}if(nValue<0){nValue=0}this.b=nValue}else{if(arguments.length===1){oColor=d3.rgb(arguments[0]);this.r=oColor.r;this.g=oColor.g;this.b=oColor.b}}return this},getHSL:function(){var oHsl=d3.hsl(this.toString());return{h:oHsl.h,s:oHsl.s,l:oHsl.l}},setHSL:function(h,s,l){var oHsl=d3.hsl(h,s,l),oColor=d3.rgb(oHsl.toString());this.r=oColor.r;this.g=oColor.g;this.b=oColor.b;return this},grayScale:function(){var oHsl=this.getHSL();return this.setHSL(oHsl.h,0,oHsl.l)},brighter:function(nPercent){var oHsl=this.getHSL(),nRange;if(nPercent===undefined){nPercent=0.1}if(nPercent<0){nPercent=0}if(nPercent>1){nPercent=1}nRange=1-oHsl.l;if(nRange!==0){oHsl.l+=nRange*nPercent;this.setHSL(oHsl.h,oHsl.s,oHsl.l)}return this},darker:function(nPercent){var oHsl=this.getHSL(),nRange;if(nPercent===undefined){nPercent=0.1}if(nPercent<0){nPercent=0}if(nPercent>1){nPercent=1}nRange=oHsl.l;if(nRange!==0){oHsl.l-=nRange*nPercent;this.setHSL(oHsl.h,oHsl.s,oHsl.l)}return this},toString:function(){var oColor=d3.rgb(this.r,this.g,this.b);return oColor.toString()}},statics:{navy:"#001F3F",blue:"#0074D9",aqua:"#7FDBFF",teal:"#39CCCC",olive:"#3D9970",lightgreen:"#2ECC40",green:"#23992E",darkgreen:"#17661F",lime:"#01FF70",yellow:"#FFDC00",orange:"#FF9900",red:"#FF4136",maroon:"#85144B",fuchsia:"#F012BE",purple:"#B10DC9",white:"#FFFFFF",silver:"#DDDDDD",gray:"#AAAAAA",black:"#111111",getGrayScale:function(sColor){var oColor=new sap.galilei.ui.common.style.Color(sColor);return oColor.grayScale().toString()},getBrighterColor:function(sColor,nPercent){var oColor=new sap.galilei.ui.common.style.Color(sColor);return oColor.brighter(nPercent).toString()},getDarkerColor:function(sColor,nPercent){var oColor=new sap.galilei.ui.common.style.Color(sColor);return oColor.darker(nPercent).toString()}}});
"use strict";sap.galilei.ui.common.style.DropShadow=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.DropShadow",properties:{id:undefined,d3Node:undefined,x:-0.2,y:-0.2,width:2,height:2,color:"black",opacity:0.4,size:2,dx:2,dy:2},methods:{createDropShadow:function(oViewer){this.d3Node=undefined;if(oViewer&&oViewer.d3SvgDefs&&this.id){var d3DropShadowFilter;d3DropShadowFilter=this.findDropShadow(oViewer);if(d3DropShadowFilter){d3DropShadowFilter.remove();this.d3Node=undefined}this.d3Node=oViewer.d3SvgDefs.append("svg:filter").attr("id",this.id);this.updateDropShadow(oViewer)}return this.d3Node},updateDropShadow:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.findDropShadow(oViewer)}if(this.d3Node){var d3Color=d3.rgb(this.color),sColorMatrixValues="0 0 0 "+d3Color.r/256+" 0 0 0 0 "+d3Color.g/256+" 0 0 0 0 "+d3Color.b/256+" 0 0 0 0 "+this.opacity+" 0",sOffsetOut=sap.galilei.ui.common.svg.Svg.getUniqueId("offsetOut"),sColorMatrixOut=sap.galilei.ui.common.svg.Svg.getUniqueId("colorMatrixOut"),sGaussianBlurOut=sap.galilei.ui.common.svg.Svg.getUniqueId("gaussianBlurOut");this.d3Node.attr("x",this.x).attr("y",this.y).attr("width",this.width).attr("height",this.height);this.d3Node.append("svg:feOffset").attr("result",sOffsetOut).attr("in","SourceAlpha").attr("dx",this.dx).attr("dy",this.dy);this.d3Node.append("svg:feColorMatrix").attr("result",sColorMatrixOut).attr("in",sOffsetOut).attr("type","matrix").attr("values",sColorMatrixValues);this.d3Node.append("svg:feGaussianBlur").attr("result",sGaussianBlurOut).attr("in",sColorMatrixOut).attr("stdDeviation",this.size);this.d3Node.append("svg:feBlend").attr("in","SourceGraphic").attr("in2",sGaussianBlurOut).attr("mode","normal")}}return this.d3Node},findDropShadow:function(oViewer){if(oViewer){var d3DropShadow=oViewer.findNodeById(this.id,oViewer.d3SvgDefs);if(d3DropShadow){this.d3Node=d3DropShadow}}return this.d3Node},removeDropShadow:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.findDropShadow(oViewer)}if(this.d3Node){this.d3Node.remove()}this.d3Node=undefined}}}});
"use strict";sap.galilei.ui.common.style.Glow=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.Glow",properties:{id:undefined,d3Node:undefined,x:-0.3,y:-0.3,width:1.6,height:1.6,color:"black",opacity:1,size:2},methods:{createGlow:function(oViewer){this.d3Node=undefined;if(oViewer&&oViewer.d3SvgDefs&&this.id){var d3GlowFilter;d3GlowFilter=this.findGlow(oViewer);if(d3GlowFilter){d3GlowFilter.remove();this.d3Node=undefined}this.d3Node=oViewer.d3SvgDefs.append("svg:filter").attr("id",this.id);this.updateGlow(oViewer)}return this.d3Node},updateGlow:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.findGlow(oViewer)}if(this.d3Node){var sFloodColor=sap.galilei.ui.common.svg.Svg.getUniqueId("floodColorOut"),sMorphologyOut=sap.galilei.ui.common.svg.Svg.getUniqueId("morphologyOut"),sColorMatrixOut=sap.galilei.ui.common.svg.Svg.getUniqueId("colorMatrixOut"),sCompositeOut=sap.galilei.ui.common.svg.Svg.getUniqueId("compositeOut"),sGaussianBlurOut=sap.galilei.ui.common.svg.Svg.getUniqueId("gaussianBlurOut"),sColorMatrixValues;this.d3Node.attr("x",this.x).attr("y",this.y).attr("width",this.width).attr("height",this.height);this.d3Node.append("svg:feFlood").attr("flood-color",this.color).attr("result",sFloodColor);this.d3Node.append("svg:feMorphology").attr("result",sMorphologyOut).attr("in","SourceGraphic").attr("operator","dilate").attr("radius",this.size);sColorMatrixValues="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 "+this.opacity+" 0";this.d3Node.append("svg:feColorMatrix").attr("result",sColorMatrixOut).attr("in",sMorphologyOut).attr("type","matrix").attr("values",sColorMatrixValues);this.d3Node.append("svg:feComposite").attr("result",sCompositeOut).attr("in",sFloodColor).attr("in2",sColorMatrixOut).attr("operator","in");this.d3Node.append("svg:feGaussianBlur").attr("result",sGaussianBlurOut).attr("in",sCompositeOut).attr("stdDeviation",this.size);this.d3Node.append("svg:feBlend").attr("in","SourceGraphic").attr("in2",sGaussianBlurOut).attr("mode","normal")}}return this.d3Node},findGlow:function(oViewer){if(oViewer){var d3Glow=oViewer.findNodeById(this.id,oViewer.d3SvgDefs);if(d3Glow){this.d3Node=d3Glow}}return this.d3Node},removeGlow:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.findGlow(oViewer)}if(this.d3Node){this.d3Node.remove()}this.d3Node=undefined}}}});
"use strict";sap.galilei.ui.common.style.Gradient=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.Gradient",properties:{id:undefined,d3Node:undefined,stops:[{offset:"0%",color:"white",opacity:1},{offset:"100%",color:"black",opacity:1}]},methods:{findGradient:function(oViewer){if(oViewer){var d3Gradient=oViewer.findNodeById(this.id,oViewer.d3SvgDefs);if(d3Gradient){this.d3Node=d3Gradient}}return this.d3Node},removeGradient:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.findGradient(oViewer)}if(this.d3Node){this.d3Node.remove()}this.d3Node=undefined}}}});sap.galilei.ui.common.style.LinearGradient=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.LinearGradient",parent:sap.galilei.ui.common.style.Gradient,properties:{x1:"0%",y1:"0%",x2:"0%",y2:"100%",orientation:{get:function(){if(this.x1==="0%"&&this.y1==="0%"&&this.x2==="100%"&&this.y2==="0%"){return sap.galilei.ui.common.LinearGradientOrientations.leftToRight}else{if(this.x1==="0%"&&this.y1==="0%"&&this.x2==="0%"&&this.y2==="100%"){return sap.galilei.ui.common.LinearGradientOrientations.topToBottom}else{if(this.x1==="0%"&&this.y1==="0%"&&this.x2==="100%"&&this.y2==="100%"){return sap.galilei.ui.common.LinearGradientOrientations.leftTopToRightBottom}else{if(this.x1==="100%"&&this.y1==="0%"&&this.x2==="0%"&&this.y2==="100%"){return sap.galilei.ui.common.LinearGradientOrientations.rightTopToLeftBottom}}}}return undefined},set:function(value){switch(value){case sap.galilei.ui.common.LinearGradientOrientations.leftToRight:this.x1="0%";this.y1="0%";this.x2="100%";this.y2="0%";break;case sap.galilei.ui.common.LinearGradientOrientations.topToBottom:this.x1="0%";this.y1="0%";this.x2="0%";this.y2="100%";break;case sap.galilei.ui.common.LinearGradientOrientations.leftTopToRightBottom:this.x1="0%";this.y1="0%";this.x2="100%";this.y2="100%";break;case sap.galilei.ui.common.LinearGradientOrientations.rightTopToLeftBottom:this.x1="100%";this.y1="0%";this.x2="0%";this.y2="100%";break}}}},methods:{createGradient:function(oViewer){this.d3Node=undefined;if(oViewer&&oViewer.d3SvgDefs&&this.id&&this.stops&&this.stops.length>0){var d3Gradient;d3Gradient=this.findGradient(oViewer);if(d3Gradient){d3Gradient.remove();this.d3Node=undefined}this.d3Node=oViewer.d3SvgDefs.append("svg:linearGradient").attr("id",this.id);this.updateGradient(oViewer)}return this.d3Node},updateGradient:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.findGradient(oViewer)}if(this.d3Node){this.d3Node.attr("x1",this.x1).attr("y1",this.y1).attr("x2",this.x2).attr("y2",this.y2).attr("gradientUnits","objectBoundingBox");var svgGradient=this.d3Node.node(),index,svgNode,oStop;for(index=svgGradient.childNodes.length-1;index>=0;index--){svgNode=svgGradient.childNodes[index];svgGradient.removeChild(svgNode)}for(index=0;index<this.stops.length;index++){oStop=this.stops[index];this.d3Node.append("svg:stop").attr("offset",oStop.offset).attr("stop-color",oStop.color).attr("stop-opacity",oStop.opacity)}}}return this.d3Node}}});sap.galilei.ui.common.style.RadialGradient=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.RadialGradient",parent:sap.galilei.ui.common.style.Gradient,properties:{cx:"50%",cy:"50%",r:"50%",fx:{field:"_fx",get:function(){return(this._fx!==undefined)?this._fx:this.cx},set:function(value){this._fx=value}},fy:{field:"_fy",get:function(){return(this._fy!==undefined)?this._fy:this.cy},set:function(value){this._fy=value}}},methods:{createGradient:function(oViewer){this.d3Node=undefined;if(oViewer&&oViewer.d3SvgDefs&&this.id&&this.stops&&this.stops.length>0){var d3Gradient;d3Gradient=this.findGradient(oViewer);if(d3Gradient){d3Gradient.remove();this.d3Node=undefined}this.d3Node=oViewer.d3SvgDefs.append("svg:radialGradient").attr("id",this.id);this.updateGradient(oViewer)}return this.d3Node},updateGradient:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.findGradient(oViewer)}if(this.d3Node){this.d3Node.attr("cx",this.cx).attr("cy",this.cy).attr("r",this.r).attr("fx",this.fx).attr("fy",this.fy).attr("gradientUnits","objectBoundingBox");var svgGradient=this.d3Node.node(),index,svgNode,oStop;for(index=svgGradient.childNodes.length-1;index>=0;index--){svgNode=svgGradient.childNodes[index];svgGradient.removeChild(svgNode)}for(index=0;index<this.stops.length;index++){oStop=this.stops[index];this.d3Node.append("svg:stop").attr("offset",oStop.offset).attr("stop-color",oStop.color).attr("stop-opacity",oStop.opacity)}}}return this.d3Node}}});
"use strict";sap.galilei.ui.common.style.GrayScale=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.GrayScale",properties:{id:undefined,d3Node:undefined,grayScale:0.3333,opacity:1},methods:{create:function(oViewer){this.d3Node=undefined;if(oViewer&&oViewer.d3SvgDefs&&this.id){var d3GrayScaleFilter;d3GrayScaleFilter=this.find(oViewer);if(d3GrayScaleFilter){d3GrayScaleFilter.remove();this.d3Node=undefined}this.d3Node=oViewer.d3SvgDefs.append("svg:filter").attr("id",this.id);this.update(oViewer)}return this.d3Node},update:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.find(oViewer)}if(this.d3Node){var sColorMatrixValues=this.grayScale+" "+this.grayScale+" "+this.grayScale+" 0 0 "+this.grayScale+" "+this.grayScale+" "+this.grayScale+" 0 0 "+this.grayScale+" "+this.grayScale+" "+this.grayScale+" 0 0 0 0 0 "+this.opacity+" 0";this.d3Node.append("svg:feColorMatrix").attr("type","matrix").attr("values",sColorMatrixValues)}}return this.d3Node},find:function(oViewer){if(oViewer){var d3GrayScale=oViewer.findNodeById(this.id,oViewer.d3SvgDefs);if(d3GrayScale){this.d3Node=d3GrayScale}}return this.d3Node},remove:function(oViewer){if(oViewer){if(!this.d3Node&&this.id){this.find(oViewer)}if(this.d3Node){this.d3Node.remove()}this.d3Node=undefined}}}});
"use strict";sap.galilei.ui.common.style.StyleSheet=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.style.StyleSheet",properties:{name:undefined,parentName:undefined,isShared:false,stroke:undefined,strokeWidth:undefined,strokeDashArray:undefined,strokeOpacity:undefined,fill:undefined,fillOpacity:undefined,opacity:undefined,filter:undefined,customCSS:undefined},methods:{generateCssStyleString:function(){var sStyle="";if(this.stroke!==undefined){sStyle+="stroke:"+this.stroke+";"}if(this.strokeWidth!==undefined){sStyle+="stroke-width:"+this.strokeWidth+";"}if(this.strokeDashArray!==undefined){sStyle+="stroke-dasharray:"+this.strokeDashArray+";"}if(this.strokeOpacity!==undefined){sStyle+="stroke-opacity:"+this.strokeOpacity+";"}if(this.fill!==undefined){sStyle+="fill:"+this.fill+";"}if(this.fillOpacity!==undefined){sStyle+="fill-opacity:"+this.fillOpacity+";"}if(this.opacity!==undefined){sStyle+="opacity:"+this.opacity+";"}if(this.filter!==undefined){sStyle+="filter:"+this.filter+";"}if(this.customCSS!==undefined){sStyle+=this.customCSS}if(sStyle.length>0){return sStyle}return undefined},clone:function(){var oNewStyleSheet;oNewStyleSheet=new sap.galilei.ui.common.style.StyleSheet();sap.galilei.core.copyProperties(oNewStyleSheet,this);return oNewStyleSheet}},statics:{isSupportedProperty:function(sName){switch(sName){case"stroke":case"stroke-width":case"strokeWidth":case"stroke-dasharray":case"strokeDashArray":case"stroke-opacity":case"strokeOpacity":case"fill":case"fill-opacity":case"fillOpacity":case"opacity":case"filter":return true}return false},parse:function(sStyle){var aStyleEntries,i,aStyleEntry,sName,sValue,sStyleName,oStyleProperties={};if(sStyle){aStyleEntries=sStyle.split(";");if(aStyleEntries&&aStyleEntries.length>0){for(i=0;i<aStyleEntries.length;i++){aStyleEntry=aStyleEntries[i].split(":");if(aStyleEntry&&aStyleEntry.length===2){sName=aStyleEntry[0].trim();sValue=aStyleEntry[1].trim();if(sName&&sValue){oStyleProperties[sName]=sValue}}}}}return{name:sStyleName,properties:oStyleProperties}}}});
"use strict";namespace("sap.galilei.ui.common.binding");sap.galilei.ui.common.binding.Binding=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.binding.Binding",properties:{objectContext:undefined,propertyName:undefined,path:undefined,formatter:undefined,type:undefined,shape:undefined},methods:{setShapeProperty:function(vValue){if(this.shape&&this.propertyName&&sap.galilei.core.hasProperty(this.shape,this.propertyName)){this.shape[this.propertyName]=vValue}},removeBinding:function(){if(this.shape&&this.propertyName){this.shape.unbindProperty(this.propertyName)}},dispose:function(){this.removeBinding()}},statics:{isPropertyBinding:function(vValue){var sProperty;if(vValue){switch(typeof vValue){case"string":vValue=vValue.trim();if(vValue.length>2&&vValue[0]==="{"&&vValue[vValue.length-1]==="}"){return true}break;case"object":for(sProperty in vValue){switch(sProperty){case"path":case"formatter":case"type":break;default:return false}}return true}}return false},isAggregationBinding:function(vValue){var sProperty,bAggregation=false;if(vValue){if(typeof vValue==="object"){for(sProperty in vValue){switch(sProperty){case"path":case"formatter":case"type":case"template":if(sProperty==="template"){bAggregation=true}break;default:return false}}return bAggregation}}return false},isBindingExpression:function(vValue){return this.isPropertyBinding(vValue)||this.isAggregationBinding(vValue)},parseBinding:function(vValue){var sBindingPath,sFormatter,aPart,oBinding={},sProperty,bAggregation=false;if(vValue){switch(typeof vValue){case"string":vValue=vValue.trim();if(vValue.length>2&&vValue[0]==="{"&&vValue[vValue.length-1]==="}"){sBindingPath=vValue.slice(1,vValue.length-1);aPart=sBindingPath.split(":");if(aPart.length>1){sBindingPath=aPart[0].trim();sFormatter=aPart[1].trim()}}return new sap.galilei.ui.common.binding.PropertyBinding({path:sBindingPath,formatter:sFormatter});case"object":for(sProperty in vValue){switch(sProperty){case"path":case"formatter":case"type":case"template":oBinding[sProperty]=vValue[sProperty];if(sProperty==="template"){bAggregation=true}break}}if(bAggregation){return new sap.galilei.ui.common.binding.AggregationBinding(vValue)}else{return new sap.galilei.ui.common.binding.PropertyBinding(vValue)}}}return undefined}}});
"use strict";sap.galilei.ui.common.binding.AggregationBinding=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.binding.Binding,fullClassName:"sap.galilei.ui.common.binding.AggregationBinding",properties:{template:undefined}});
"use strict";sap.galilei.ui.common.binding.PropertyBinding=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.binding.Binding,fullClassName:"sap.galilei.ui.common.binding.PropertyBinding",methods:{getObjectAndPropertyName:function(){var aParts,oObject,index,sPath,sBindingPath,bRelative=true;if(this.objectContext&&this.path){oObject=this.objectContext;sBindingPath=this.path;if(sBindingPath&&sBindingPath.length>0&&sBindingPath[0]==="/"){bRelative=false;sBindingPath=sBindingPath.slice(1,sBindingPath.length)}aParts=sBindingPath.split("/");if(aParts.length>1){for(index=0;index<aParts.length-1;index++){sPath=aParts[index];if(oObject){oObject=oObject[sPath]}sBindingPath=aParts[aParts.length-1]}}return{object:oObject,propertyName:sBindingPath}}},getObjectProperty:function(){var oInfo,oObject,sBindingPath,oFormatterContext,formatter,vValue,sValue;if(this.objectContext&&(this.path||this.formatter)){oInfo=this.getObjectAndPropertyName();if(oInfo){oObject=oInfo.object;sBindingPath=oInfo.propertyName}else{return undefined}formatter=this.formatter;if(!formatter&&this.type&&this.type.formatValue){formatter=this.type.formatValue}if(formatter){if(typeof formatter==="function"){oFormatterContext=this.objectContext;if(!sBindingPath||sBindingPath.length===0){return formatter.call(oFormatterContext,undefined,oObject)}else{return formatter.call(oFormatterContext,oObject[sBindingPath],oObject)}}else{if((typeof formatter==="object")&&sBindingPath){vValue=oObject[sBindingPath];if(vValue){sValue=vValue.toString();if(formatter.hasOwnProperty(sValue)){return formatter[sValue]}}if(formatter.hasOwnProperty("DEFAULT")){return formatter.DEFAULT}return undefined}}}return oObject[sBindingPath]}return undefined},setObjectProperty:function(vValue){var oInfo=this.getObjectAndPropertyName(),oObject,sPropertyName;if(oInfo){oObject=oInfo.object;sPropertyName=oInfo.propertyName;oObject[sPropertyName]=vValue}}}});
"use strict";namespace("sap.galilei.ui.common.shape");sap.galilei.ui.common.shape.ShapeStates={NORMAL:0,RESIZABLE:1,ROTABLE:2,PRESERVEASPECT:4,ADJUSTTOCONTENT:8,MODIFIABLE:16,COMPOSITE:32,GROUP:64,TRANSPARENT:128,DISABLED:256,DEFAULT:0};sap.galilei.ui.common.shape.Shape=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.shape.Shape",statics:{propertiesMap:{id:"id",domClass:"class",stroke:"stroke",strokeWidth:"stroke-width",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeDashArray:"stroke-dasharray",strokeOpacity:"stroke-opacity",fill:"fill",fillOpacity:"fill-opacity",opacity:"opacity",filter:"filter",cssStyle:"style",cursor:"cursor",transform:"transform",isVisible:"display",zindex:"g:data-zindex"},DEFAULT_CONTENT_PADDING:4,nextId:0,getNextId:function(){return ++sap.galilei.ui.common.shape.Shape.nextId},convertToNode:function(oViewer,oShape,sShapeProp,sNodeProp,vValue){if(oViewer&&oShape&&sShapeProp&&sNodeProp){switch(sShapeProp){case"isVisible":if(vValue===true){vValue="inline"}else{if(vValue===false){vValue="none"}else{vValue=undefined}}break;case"fill":case"fillOpacity":if(oShape.isTransparent===true){vValue=undefined}break}}return vValue},convertFromNode:function(oViewer,oShape,sNodeProp,sShapeProp,vValue){if(oViewer&&oShape&&sShapeProp&&sNodeProp){switch(sNodeProp){case"visibility":vValue=(vValue==="visible");break;case"fill":if(vValue==="none"){oShape.isTransparent=true}break}}return vValue},updateDrawing:function(oViewer,oShape,oTransition,oPropertyMap,fnConvertToNode,aAttributes){var d3Node,d3NodeOrTransition,sProp,sNodeProp,vValue,sOldStyle;if(oShape&&oShape.isDrawn&&!oShape.isDisableDrawing&&oPropertyMap){d3Node=d3NodeOrTransition=oShape.d3Node;if(oTransition){d3NodeOrTransition=oTransition}for(sProp in oPropertyMap){if(!sap.galilei.ui.common.shape.Shape.isPropertySupported(aAttributes,sProp)){continue}vValue=oShape[sProp];sNodeProp=oPropertyMap[sProp];if(fnConvertToNode){vValue=fnConvertToNode(oViewer,oShape,sProp,sNodeProp,vValue)}if(vValue!=undefined){if(sNodeProp==="xlink:href"||sNodeProp==="href"){d3Node.attr(sNodeProp,vValue)}else{if(sNodeProp==="style"&&oTransition){sap.galilei.ui.common.shape.Shape.updateStyle(oViewer,oShape,oTransition,vValue)}else{d3NodeOrTransition.attr(sNodeProp,vValue)}}}else{if(sNodeProp==="style"){sOldStyle=d3Node.attr(sNodeProp);if(sOldStyle!=undefined){sap.galilei.ui.common.shape.Shape.removeStyle(oViewer,oShape,oTransition,sOldStyle)}}else{if(sNodeProp!=="transform"&&sNodeProp!=="d"){if(d3Node.attr(sNodeProp)!=undefined){d3NodeOrTransition.attr(sNodeProp,vValue)}}}}}}return d3Node},updateStyle:function(oViewer,oShape,oTransition,sStyle){var d3Node,d3NodeOrTransition,oStyle,sProperty;if(oShape&&oShape.isDrawn&&sStyle){d3Node=d3NodeOrTransition=oShape.d3Node;if(oTransition){d3NodeOrTransition=oTransition}oStyle=sap.galilei.ui.common.style.StyleSheet.parse(sStyle);if(oStyle&&oStyle.properties){for(sProperty in oStyle.properties){if(oStyle.properties.hasOwnProperty(sProperty)){d3NodeOrTransition.style(sProperty,oStyle.properties[sProperty])}}}}},removeStyle:function(oViewer,oShape,oTransition,sOldStyle){var d3Node,d3NodeOrTransition,oStyle,sProperty;if(oShape&&oShape.isDrawn&&sOldStyle){d3Node=d3NodeOrTransition=oShape.d3Node;if(oTransition){d3NodeOrTransition=oTransition}oStyle=sap.galilei.ui.common.style.StyleSheet.parse(sOldStyle);if(oStyle&&oStyle.properties){for(sProperty in oStyle.properties){if(oStyle.properties.hasOwnProperty(sProperty)&&sap.galilei.ui.common.style.StyleSheet.isSupportedProperty(sProperty)){d3NodeOrTransition.style(sProperty,null)}}}}},retrieveDrawing:function(oViewer,oShape,d3Node,oPropertyMap,fnConvertFromNode,aAttributes){var sProp,sNodeProp,vValue;if(oShape&&oPropertyMap){d3Node=d3Node||oShape.d3Node;if(d3Node){for(sProp in oPropertyMap){sNodeProp=oPropertyMap[sProp];if(!sap.galilei.ui.common.shape.Shape.isPropertySupported(aAttributes,sNodeProp)){continue}vValue=d3Node.attr(sNodeProp);if(vValue!==undefined){if(fnConvertFromNode){vValue=fnConvertFromNode(oViewer,oShape,sNodeProp,sProp,vValue)}if(vValue!==undefined){oShape[sProp]=vValue}}}}}return d3Node},isPropertySupported:function(aAttributes,sPropName){if(sPropName){if(aAttributes===undefined||aAttributes.length===0){return true}var index,sAttr;for(index=0;index<aAttributes.length;index++){sAttr=aAttributes[index];if(sAttr===sPropName){return true}}}return false},grayOutHighlightFilter:function(oShape,oStyleSheet){var oNewStyleSheet=new sap.galilei.ui.common.style.StyleSheet(),bEmpty=true;if(oShape.isSupportFill){if(oShape.fill&&oShape.fill!=="none"){oNewStyleSheet.fill=sap.galilei.ui.common.style.Color.getGrayScale(oShape.fill);bEmpty=false}}if(oShape.isSupportStroke){if(oShape.stroke&&oShape.stroke!=="none"){oNewStyleSheet.stroke=sap.galilei.ui.common.style.Color.getGrayScale(oShape.stroke);oNewStyleSheet.strokeWidth=oShape.strokeWidth;bEmpty=false}}if(!bEmpty){return oNewStyleSheet}return undefined}},properties:{name:{value:"Shape",writable:false,configurable:false},category:{value:"Internal",writable:false,configurable:false},d3Node:undefined,svgNode:{get:function(){return this.d3Node?this.d3Node.node():undefined},set:function(svgNodeSelector){if(svgNodeSelector){this.d3Node=d3.select(svgNodeSelector)}else{this.d3Node=undefined}}},id:undefined,domClass:undefined,x:{field:"_x",get:function(){return this._x},set:function(nValue){this._x=sap.galilei.core.validateNumeric(nValue,this._x,true)}},y:{field:"_y",get:function(){return this._y},set:function(nValue){this._y=sap.galilei.core.validateNumeric(nValue,this._y,true)}},width:{field:"_width",get:function(){return this._width},set:function(nValue){this._width=sap.galilei.core.validateNumeric(nValue,this._width,true)}},height:{field:"_height",get:function(){return this._height},set:function(nValue){this._height=sap.galilei.core.validateNumeric(nValue,this._height,true)}},angle:{field:"_angle",get:function(){return this._angle},set:function(nValue){this._angle=sap.galilei.core.validateNumeric(nValue,this._angle,true)}},stroke:undefined,strokeWidth:{field:"_strokeWidth",get:function(){return this._strokeWidth},set:function(nValue){this._strokeWidth=sap.galilei.core.validateNumeric(nValue,this._strokeWidth,true)}},strokeLineCap:sap.galilei.ui.common.LineCap.DEFAULT,strokeLineJoin:sap.galilei.ui.common.LineJoin.DEFAULT,strokeDashArray:{field:"_strokeDashArray",value:sap.galilei.ui.common.DashStyle.DEFAULT,get:function(){return this._strokeDashArray},set:function(sValue){if(sValue===undefined&&this._strokeDashArray!==undefined&&this.isDrawn){this._strokeDashArray=null}else{this._strokeDashArray=sValue}}},strokeOpacity:{field:"_strokeOpacity",get:function(){return this._strokeOpacity},set:function(nValue){this._strokeOpacity=sap.galilei.core.validateNumeric(nValue,this._strokeOpacity,true)}},fill:undefined,fillOpacity:{field:"_fillOpacity",get:function(){return this._fillOpacity},set:function(nValue){this._fillOpacity=sap.galilei.core.validateNumeric(nValue,this._fillOpacity,true)}},opacity:{field:"_opacity",get:function(){return this._opacity},set:function(nValue){this._opacity=sap.galilei.core.validateNumeric(nValue,this._opacity,true)}},filter:undefined,styleSheet:undefined,highlighterStyleSheet:undefined,cssStyle:{field:"_cssStyle",get:function(){var sStyle=this.generateCssStyleString();if(sStyle){return sStyle}else{return this._cssStyle}},set:function(sCssString){this._cssStyle=sCssString}},cursor:undefined,minWidth:{field:"_minWidth",get:function(){return this._minWidth},set:function(nValue){this._minWidth=sap.galilei.core.validateNumeric(nValue,this._minWidth,true)}},minHeight:{field:"_minHeight",get:function(){return this._minHeight},set:function(nValue){this._minHeight=sap.galilei.core.validateNumeric(nValue,this._minHeight,true)}},maxWidth:{field:"_maxWidth",get:function(){return this._maxWidth},set:function(nValue){this._maxWidth=sap.galilei.core.validateNumeric(nValue,this._maxWidth,true)}},maxHeight:{field:"_maxHeight",get:function(){return this._maxHeight},set:function(nValue){this._maxHeight=sap.galilei.core.validateNumeric(nValue,this._maxHeight,true)}},defaultWidth:{field:"_defaultWidth",get:function(){return this._defaultWidth},set:function(nValue){this._defaultWidth=sap.galilei.core.validateNumeric(nValue,this._defaultWidth,true)}},defaultHeight:{field:"_defaultHeight",get:function(){return this._defaultHeight},set:function(nValue){this._defaultHeight=sap.galilei.core.validateNumeric(nValue,this._defaultHeight,true)}},marginLeft:{field:"_marginLeft",value:0,get:function(){return this._marginLeft},set:function(nValue){this._marginLeft=sap.galilei.core.validateNumeric(nValue,this._marginLeft)}},marginTop:{field:"_marginTop",value:0,get:function(){return this._marginTop},set:function(nValue){this._marginTop=sap.galilei.core.validateNumeric(nValue,this._marginTop)}},marginRight:{field:"_marginRight",value:0,get:function(){return this._marginRight},set:function(nValue){this._marginRight=sap.galilei.core.validateNumeric(nValue,this._marginRight)}},marginBottom:{field:"_marginBottom",value:0,get:function(){return this._marginBottom},set:function(nValue){this._marginBottom=sap.galilei.core.validateNumeric(nValue,this._marginBottom)}},margin:{get:function(){return this.marginLeft+","+this.marginTop+","+this.marginRight+","+this.marginBottom},set:function(value){var aParams=arguments,index;if(arguments.length===1&&(typeof value)==="string"){aParams=value.split(",")}if(aParams){for(index=0;index<aParams.length;index++){if(typeof aParams[index]==="string"){aParams[index]=+aParams[index].trimLeft().trimRight()}}if(aParams.length===1){this.marginLeft=this.marginTop=this.marginRight=this.marginBottom=+aParams[0]}else{if(aParams.length===2){this.marginLeft=this.marginRight=+aParams[0];this.marginTop=this.marginBottom=+aParams[1]}else{if(aParams.length===4){this.marginLeft=+aParams[0];this.marginRight=+aParams[1];this.marginTop=+aParams[2];this.marginBottom=+aParams[3]}}}}}},paddingLeft:{field:"_paddingLeft",value:0,get:function(){return this._paddingLeft},set:function(nValue){this._paddingLeft=sap.galilei.core.validateNumeric(nValue,this._paddingLeft)}},paddingTop:{field:"_paddingTop",value:0,get:function(){return this._paddingTop},set:function(nValue){this._paddingTop=sap.galilei.core.validateNumeric(nValue,this._paddingTop)}},paddingRight:{field:"_paddingRight",value:0,get:function(){return this._paddingRight},set:function(nValue){this._paddingRight=sap.galilei.core.validateNumeric(nValue,this._paddingRight)}},paddingBottom:{field:"_paddingBottom",value:0,get:function(){return this._paddingBottom},set:function(nValue){this._paddingBottom=sap.galilei.core.validateNumeric(nValue,this._paddingBottom)}},padding:{get:function(){return this.paddingLeft+","+this.paddingTop+","+this.paddingRight+","+this.paddingBottom},set:function(value){var aParams=arguments,index;if(arguments.length===1&&(typeof value)==="string"){aParams=value.split(",")}if(aParams){for(index=0;index<aParams.length;index++){if(typeof aParams[index]==="string"){aParams[index]=+aParams[index].trimLeft().trimRight()}}if(aParams.length===1){this.paddingLeft=this.paddingTop=this.paddingRight=this.paddingBottom=+aParams[0]}else{if(aParams.length===2){this.paddingLeft=this.paddingRight=+aParams[0];this.paddingTop=this.paddingBottom=+aParams[1]}else{if(aParams.length===4){this.paddingLeft=+aParams[0];this.paddingRight=+aParams[1];this.paddingTop=+aParams[2];this.paddingBottom=+aParams[3]}}}}}},horizontalAlignment:undefined,verticalAlignment:undefined,dockPosition:undefined,transform:undefined,isResizable:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.RESIZABLE,value:sap.galilei.ui.common.shape.ShapeStates.RESIZABLE},isRotable:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.ROTABLE,value:sap.galilei.ui.common.shape.ShapeStates.ROTABLE},isPreserveAspect:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.PRESERVEASPECT,value:sap.galilei.ui.common.shape.ShapeStates.NORMAL},isAdjustToContent:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.ADJUSTTOCONTENT,value:sap.galilei.ui.common.shape.ShapeStates.NORMAL},isModifiable:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.MODIFIABLE,value:sap.galilei.ui.common.shape.ShapeStates.MODIFIABLE},isComposite:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.COMPOSITE,value:sap.galilei.ui.common.shape.ShapeStates.NORMAL},isGroup:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.GROUP,value:sap.galilei.ui.common.shape.ShapeStates.NORMAL},isTransparent:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.TRANSPARENT,value:sap.galilei.ui.common.shape.ShapeStates.NORMAL},isDisableDrawing:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.DISABLED,value:sap.galilei.ui.common.shape.ShapeStates.NORMAL},isSupportStroke:true,isSupportFill:true,isVisible:undefined,isDrawn:{get:function(){return this.d3Node!==undefined}},isHidden:{get:function(){return this.d3Node&&(this.d3Node.attr("display")==="none"||this.d3Node.attr("opacity")===0)}},shapes:{type:sap.galilei.core.EnumPropertyType.collection,objectClass:"sap.galilei.ui.common.shape.Shape",writable:false},bindings:undefined,eventHandlers:undefined,zindex:undefined},methods:{createNode:function(sNode,oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){var d3Parent;if(sNode&&oViewer){if(!d3ParentNode){d3Parent=oViewer.d3MainShapeLayer}else{d3Parent=d3ParentNode}if(!this.d3Node){if(insertBeforeSelector){this.d3Node=d3Parent.insert(sNode,insertBeforeSelector)}else{this.d3Node=d3Parent.append(sNode)}if(oTransitionDef){this.d3Node.attr("opacity",0);if(this.opacity===undefined){this.opacity=1}}this.registerEventHandlers()}this.updateDrawing(oViewer,oTransitionDef)}return this.d3Node},findNode:function(oViewer,nodeSelector){if(oViewer&&nodeSelector){this.d3Node=d3.select(nodeSelector,oViewer.d3MainShapeLayer)}return this.d3Node},removeNode:function(oViewer,oTransitionDef){function removeOneNode(oShape){if(oShape.isComposite){var index,oSubShape;for(index=0;index<oShape.shapes.length;++index){oSubShape=oShape.shapes[index];removeOneNode(oSubShape)}}oShape.unregisterEventHandlers();oShape.highlighterStyleSheet=undefined;if(oShape.d3Node){oShape.d3Node.remove();oShape.d3Node=undefined}}var self=this;if(oViewer&&oTransitionDef){this.hide(oViewer,oTransitionDef);setTimeout(function(){removeOneNode(self)},oTransitionDef.duration)}else{removeOneNode(this)}},remove:function(oViewer,oTransitionDef){this.removeNode(oViewer,oTransitionDef);this.unbindAll();if(this.isComposite){this.shapes.clear()}},draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);return this.d3Node},show:function(oViewer,oTransitionDef){if(this.isDrawn&&oViewer&&((this._oldOpacity!==undefined&&this.opacity!==this._oldOpacity)||(this._oldOpacity===undefined&&this.opacity!==1)||this.d3Node.attr("display")=="none")){this.opacity=(this._oldOpacity!==undefined&&this._oldOpacity>0)?this._oldOpacity:1;delete this._oldOpacity;this.updateDrawing(oViewer,oTransitionDef,["opacity"]);var self=this;if(oTransitionDef){setTimeout(function(){if(self.isDrawn){self.d3Node.attr("display","inline")}},oTransitionDef.duration)}else{if(this.isDrawn){this.d3Node.attr("display","inline")}}}},hide:function(oViewer,oTransitionDef){if(this.isDrawn&&oViewer&&(this.opacity===undefined||this.opacity>0||this.d3Node.attr("display")=="inline")){this._oldOpacity=this.opacity;this.opacity=0;this.updateDrawing(oViewer,oTransitionDef,["opacity"]);var self=this,oSubShape,index;if(oTransitionDef){setTimeout(function(){if(self.d3Node){self.d3Node.attr("display","none")}},oTransitionDef.duration)}else{if(this.d3Node){this.d3Node.attr("display","none")}}}},retrieveDrawing:function(viewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(viewer,nodeSelector)}sap.galilei.ui.common.shape.Shape.retrieveDrawing(viewer,this,this.d3Node,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertFromNode,aAttributes);return this.d3Node},setAllProperties:function(oProperties){if(oProperties){this.set(oProperties);if(this.isComposite){var index,shape;for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];shape.setAllProperties(oProperties)}}}},generateCssStyleString:function(){if(this.highlighterStyleSheet){return this.highlighterStyleSheet.generateCssStyleString()}else{if(this.styleSheet){return this.styleSheet.generateCssStyleString()}}return undefined},highlight:function(oStyleSheet,fnStyleSheetFilter,bCascade,oViewer,oTransitionDefinition){var oNewStyleSheet,bChanged=false,i,sFilter;if(!oStyleSheet){return false}if(sap.galilei.core.isInstanceOf(this,"sap.galilei.ui.common.shape.Group")){if(oStyleSheet.filter){sFilter=oStyleSheet.filter;oNewStyleSheet=new sap.galilei.ui.common.style.StyleSheet({filter:sFilter});oStyleSheet.filter=undefined;bChanged=(this.highlighterStyleSheet||oNewStyleSheet)!==undefined;this.highlighterStyleSheet=oNewStyleSheet}}else{if(!sap.galilei.core.isInstanceOf(this,"sap.galilei.ui.common.shape.Image")&&!sap.galilei.core.isInstanceOf(this,"sap.galilei.ui.common.shape.Text")){if(fnStyleSheetFilter){oNewStyleSheet=fnStyleSheetFilter(this,oStyleSheet)}else{oNewStyleSheet=oStyleSheet.clone();if(!this.isSupportStroke){oNewStyleSheet.stroke=undefined;oNewStyleSheet.strokeWidth=undefined;oNewStyleSheet.strokeDashArray=undefined;oNewStyleSheet.strokeOpacity=undefined}if(!this.isSupportFill){oNewStyleSheet.fill=undefined;oNewStyleSheet.fillOpacity=undefined}}bChanged=(this.highlighterStyleSheet||oNewStyleSheet)!==undefined;this.highlighterStyleSheet=oNewStyleSheet}}if(this.isComposite&&bCascade){for(i=0;i<this.shapes.length;i++){bChanged|=this.shapes[i].highlight(oStyleSheet,fnStyleSheetFilter,bCascade,oViewer,oTransitionDefinition)}}if(oViewer&&bChanged){this.updateDrawing(oViewer,oTransitionDefinition,["cssStyle"])}if(sFilter){oStyleSheet.filter=sFilter}return bChanged},unhighlight:function(bCascade,oViewer,oTransitionDefinition){var bChanged=false,i;bChanged=this.highlighterStyleSheet!==undefined;this.highlighterStyleSheet=undefined;if(this.isComposite&&bCascade){for(i=0;i<this.shapes.length;i++){bChanged|=this.shapes[i].unhighlight(bCascade,oViewer,oTransitionDefinition)}}if(oViewer&&bChanged){this.updateDrawing(oViewer,oTransitionDefinition,["cssStyle"])}return bChanged},grayOut:function(bCascade,oViewer,oTransitionDefinition){var oStyleSheet=new sap.galilei.ui.common.style.StyleSheet();return this.highlight(oStyleSheet,sap.galilei.ui.common.shape.Shape.grayOutHighlightFilter,bCascade,oViewer,oTransitionDefinition)},getTransition:function(oTransitionDef){if(oTransitionDef){return oTransitionDef.getTransition(this)}return undefined},getBBox:function(){var rect,childrenRect=this.getChildrenBBox();if(this.x!==undefined&&this.y!==undefined&&this.width!==undefined&&this.height!==undefined){rect=new sap.galilei.ui.common.Rect(this.x,this.y,this.width,this.height);if(childrenRect){rect.unionRect(childrenRect)}}else{if(childrenRect){rect=childrenRect}else{rect=new sap.galilei.ui.common.Rect(undefined,undefined,0,0)}}return rect},setBBox:function(x,y,width,height){var oRect;if(arguments.length===1){oRect=arguments[0];this.x=oRect.x;this.y=oRect.y;this.width=oRect.width;this.height=oRect.height}else{if(arguments.length===4){this.x=x;this.y=y;this.width=width;this.height=height}}},getChildrenBBox:function(){if(this.isComposite){var index,shape,rect,totalRect=new sap.galilei.ui.common.Rect();for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];rect=shape.getBBox();if(index===0){totalRect.set(rect)}else{totalRect.unionRect(rect)}}return totalRect}else{return undefined}},getSvgBBox:function(bIncludeTransform,oNearestViewport){if(this.d3Node){var svgNearestViewport;if(oNearestViewport&&oNearestViewport.d3Node){svgNearestViewport=oNearestViewport.d3Node.node()}return sap.galilei.ui.common.svg.Svg.getBBox(this.d3Node.node(),bIncludeTransform,svgNearestViewport)}return this.getBBox()},getContentBox:function(mode,bRelative){var oRect=this.getBBox(),paddingLeft=this.paddingLeft,paddingTop=this.paddingTop,paddingRight=this.paddingRight,paddingBottom=this.paddingBottom;if(mode===sap.galilei.ui.common.ShapeLayoutModes.icon){oRect.moveBy(0,oRect.height+sap.galilei.ui.common.shape.Shape.DEFAULT_CONTENT_PADDING);oRect.inflate(oRect.width,0,oRect.width,0)}if(bRelative){oRect.x=oRect.y=0}if(paddingLeft===undefined||isNaN(paddingLeft)){paddingLeft=0}if(paddingTop===undefined||isNaN(paddingTop)){paddingTop=0}if(paddingRight===undefined||isNaN(paddingRight)){paddingRight=0}if(paddingBottom===undefined||isNaN(paddingBottom)){paddingBottom=0}oRect.inflate(-paddingLeft,-paddingTop,-paddingRight,-paddingBottom);return oRect},getMainShapeBox:function(oContentRect,bRelative){var oRect=new sap.galilei.ui.common.Rect(),paddingLeft=this.paddingLeft,paddingTop=this.paddingTop,paddingRight=this.paddingRight,paddingBottom=this.paddingBottom;if(oContentRect){oRect.set(oContentRect);if(paddingLeft===undefined||isNaN(paddingLeft)){paddingLeft=0}if(paddingTop===undefined||isNaN(paddingTop)){paddingTop=0}if(paddingRight===undefined||isNaN(paddingRight)){paddingRight=0}if(paddingBottom===undefined||isNaN(paddingBottom)){paddingBottom=0}if(paddingLeft===0&&paddingTop===0&&paddingRight===0&&paddingBottom===0){paddingLeft=paddingTop=paddingRight=paddingBottom=sap.galilei.ui.common.shape.Shape.DEFAULT_CONTENT_PADDING}oRect.inflate(paddingLeft,paddingTop,paddingRight,paddingBottom);if(bRelative){oRect.x=oRect.y=0}}return oRect},getCenter:function(){var oRect=this.getBBox();if(oRect){return oRect.getCenter()}return[undefined,undefined]},setCenter:function(x,y,bRounded){var aCenter=this.getCenter();if(aCenter){this.moveBy(x-aCenter[0],y-aCenter[1])}},layout:function(layoutRect,bUpdateShape){var bFixedImage,outputLayoutRect=new sap.galilei.ui.common.Rect();outputLayoutRect.set(this.getBBox());if(layoutRect&&layoutRect.x!==undefined&&layoutRect.y!==undefined&&!isNaN(layoutRect.x)&&!isNaN(layoutRect.y)){outputLayoutRect.x=layoutRect.x;outputLayoutRect.y=layoutRect.y;outputLayoutRect.width=this.width;outputLayoutRect.height=this.height;bFixedImage=(this.name==="Image")&&this.useReference;if(layoutRect.width!==undefined&&layoutRect.height!==undefined){if(this.x+this.width>layoutRect.x+layoutRect.width){outputLayoutRect.width=layoutRect.x+layoutRect.width-this.x;if(bUpdateShape){if(this.width!==outputLayoutRect.width&&!bFixedImage){this.width=outputLayoutRect.width}}}if(this.y+this.height>layoutRect.y+layoutRect.height){outputLayoutRect.height=layoutRect.y+layoutRect.height-this.y;if(bUpdateShape){if(this.height!==outputLayoutRect.height&&!bFixedImage){this.height=outputLayoutRect.height}}}}}this.layoutRect=new sap.galilei.ui.common.Rect(outputLayoutRect);return outputLayoutRect},checkLayoutRect:function(layoutRect){if(layoutRect){var width=layoutRect.width,height=layoutRect.height,i;if(this.minWidth!==undefined&&!isNaN(this.minWidth)&&this.minWidth!==0){width=Math.max(width,this.minWidth)}if(this.minHeight!==undefined&&!isNaN(this.minHeight)&&this.minHeight!==0){height=Math.max(height,this.minHeight)}if(this.maxWidth!==undefined&&!isNaN(this.maxWidth)&&this.maxWidth!==0){width=Math.min(width,this.maxWidth)}if(this.maxHeight!==undefined&&!isNaN(this.maxHeight)&&this.maxHeight!==0){height=Math.min(height,this.maxHeight)}layoutRect.width=width;layoutRect.height=height;if(this.isComposite){for(i=0;i<this.shapes.length;i++){layoutRect=this.shapes[i].checkLayoutRect(layoutRect)}}}return layoutRect},getIntersection:function(oSegment,oParentBBox){if(oSegment){var index,shape,aPoint,oRect;if(this.isComposite){for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];aPoint=shape.getIntersection(oSegment,oParentBBox);if(aPoint){return aPoint}}}else{oRect=this.getBBox();if(oParentBBox){oRect=oRect.clone();oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}oRect=this.inflateStrokeWidth(oRect);return sap.galilei.ui.common.geometry.intersectSegmentRoundedRectangle(oSegment,oRect,0,0)}}return undefined},inflateStrokeWidth:function(oBBox){if(oBBox){var nStrokeWidth=+this.strokeWidth;if(nStrokeWidth===undefined||isNaN(nStrokeWidth)){nStrokeWidth=0}nStrokeWidth/=2;return oBBox.inflate(nStrokeWidth,nStrokeWidth,true)}return oBBox},isPointInShape:function(vPoint,oParentBBox){if(vPoint){var index,oShape,oRect;if(this.isComposite){for(index=0;index<this.shapes.length;++index){oShape=this.shapes[index];if(oShape.isPointInShape(vPoint,oParentBBox)){return true}}}else{oRect=this.getBBox();if(oParentBBox){oRect=oRect.clone();oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}oRect=this.inflateStrokeWidth(oRect);return oRect.isPointInRect(vPoint)}}return false},isPointOnBorder:function(vPoint,oParentBBox,nRadius){if(vPoint){var index,oShape,oInnerRect,oOuterRect;if(nRadius===undefined){nRadius=1}if(this.isComposite){for(index=0;index<this.shapes.length;++index){oShape=this.shapes[index];if(oShape.isPointOnBorder(vPoint,oParentBBox,nRadius)){return true}}}else{oInnerRect=this.getBBox();oOuterRect=this.getBBox();if(oParentBBox){oInnerRect=oInnerRect.clone();oOuterRect=oOuterRect.clone();oInnerRect.moveBy(oParentBBox.x-oInnerRect.x,oParentBBox.y-oInnerRect.y);oOuterRect.moveBy(oParentBBox.x-oOuterRect.x,oParentBBox.y-oOuterRect.y)}oInnerRect.inflate(-nRadius,-nRadius);oOuterRect.inflate(nRadius,nRadius);return oOuterRect.isPointInRect(vPoint)&&!oInnerRect.isPointInRect(vPoint)}}return false},getClosestPointOnBorder:function(vPoint,oBoundaryRect,oParentBBox){var aPoint,aClosestPoint,index,oShape,oRect;if(vPoint){aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint);if(this.isComposite){for(index=0;index<this.shapes.length;++index){oShape=this.shapes[index];aClosestPoint=oShape.getClosestPointOnBorder(aPoint,oBoundaryRect,oParentBBox);if(aClosestPoint){break}}}else{if(oBoundaryRect){oRect=oBoundaryRect}else{oRect=this.getBBox()}if(oParentBBox){oRect=oRect.clone();oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}aClosestPoint=oRect.getClosestPointOnBorder(aPoint)}}return aClosestPoint},moveTo:function(x,y){var dx=0,dy=0;if(x!==undefined&&this.x!==undefined){dx=x-this.x}if(y!==undefined&&this.y!==undefined){dy=y-this.y}if(dx!==0||dy!==0){this.moveBy(dx,dy)}else{if(this.x===undefined){this.x=x}if(this.y===undefined){this.y=y}}},moveBy:function(dx,dy){if(dx===undefined||isNaN(dx)){dx=0}if(dy===undefined||isNaN(dy)){dy=0}if(dx!==0&&this.x!==undefined){this.x+=dx}if(dy!==0&&this.y!==undefined){this.y+=dy}if(this.isComposite){this.moveChildrenBy(dx,dy)}},moveChildrenBy:function(dx,dy){if(this.isComposite){var index,shape;if(dx===undefined){dx=0}if(dy===undefined){dy=0}if(dx!==0||dy!==0){for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];shape.moveBy(dx,dy)}}}},bindProperty:function(sProperty,sBindingExpression){var oBindings,sPropertyName,oBinding;if(arguments.length===1&&(typeof arguments)==="object"){oBindings=arguments[0];for(sPropertyName in oBindings){this.bindProperty(sPropertyName,oBindings[sPropertyName])}}else{if(sProperty&&sBindingExpression&&sap.galilei.ui.common.binding.Binding.isPropertyBinding(sBindingExpression)){oBinding=sap.galilei.ui.common.binding.Binding.parseBinding(sBindingExpression);if(oBinding){oBinding.propertyName=sProperty;oBinding.shape=this;if(!this.bindings){this.bindings={}}this.bindings[sProperty]=oBinding}}}},getPropertyBinding:function(sProperty){if(sProperty&&this.bindings){return this.bindings[sProperty]}return undefined},unbindProperty:function(sProperty){var oBinding;if(sProperty){if(this.bindings){oBinding=this.bindings[sProperty];if(oBinding){delete this.bindings[sProperty];oBinding.shape=undefined}if(oBinding.dispose){oBinding.dispose()}if(!sap.galilei.core.hasObjects(this.bindings)){this.bindings=undefined}}}},unbindAll:function(){var sProperty,oBinding;if(this.bindings){for(sProperty in this.bindings){oBinding=this.bindings[sProperty];if(oBinding.dispose){oBinding.dispose()}}this.bindings=undefined}},on:function(sEventName,fnEventHandler,oScope){if(sEventName){var oEventHandler,aEventArgs=Array.prototype.slice.call(arguments,3),aEventHandlers,oExistingEventHandler;this.eventHandlers=this.eventHandlers||{};aEventHandlers=this.eventHandlers[sEventName]||[];if(fnEventHandler){if(typeof fnEventHandler==="function"){oEventHandler={callback:fnEventHandler};if(oScope){oEventHandler.scope=oScope}if(aEventArgs&&aEventArgs.length>0){oEventHandler["arguments"]=aEventArgs}}}if(oEventHandler){if(this.eventHandlers[sEventName]){oExistingEventHandler=this.findEventHandler(sEventName,fnEventHandler,oScope);if(oExistingEventHandler){oEventHandler["arguments"]=aEventArgs}else{aEventHandlers.push(oEventHandler)}}else{this.eventHandlers[sEventName]=[oEventHandler]}this.registerEventHandler(sEventName,oEventHandler)}}return this},off:function(sEventName,fnEventHandler,oScope){if(this.eventHandlers&&sEventName&&this.eventHandlers[sEventName]){var aEventHandlers=this.eventHandlers[sEventName],index,oEventHandler;for(index=aEventHandlers.length-1;index>=0;index--){oEventHandler=aEventHandlers[index];if((oEventHandler.callback===fnEventHandler||fnEventHandler===undefined)&&(oEventHandler.scope===oScope||oScope===undefined)){this.unregisterEventHandler(sEventName,oEventHandler);this.eventHandlers[sEventName].splice(index,1);if(this.eventHandlers[sEventName].length===0){delete this.eventHandlers[sEventName];if(!sap.galilei.core.hasObjects(this.eventHandlers)){this.eventHandlers=undefined;if(this._hammer){delete this._hammer}}}}}}},findEventHandler:function(sEventName,fnEventHandler,oScope){if(this.eventHandlers&&sEventName&&fnEventHandler){var aEventHandlers=this.eventHandlers[sEventName],oEventHandler,index;if(aEventHandlers){for(index=0;index<aEventHandlers.length;index++){oEventHandler=aEventHandlers[index];if(oEventHandler.callback===fnEventHandler&&oEventHandler.scope===oScope){return oEventHandler}}}}return undefined},enableEventHandler:function(sEventName,fnEventHandler,oScope,bEnable){if(this.eventHandlers&&sEventName&&this.eventHandlers[sEventName]){var aEventHandlers=this.eventHandlers[sEventName],index,oEventHandler;for(index=0;index<aEventHandlers.length;index++){oEventHandler=aEventHandlers[index];if((oEventHandler.callback===fnEventHandler||fnEventHandler===undefined)&&(oEventHandler.scope===oScope||oScope===undefined)){if(!bEnable){oEventHandler.disabled=true}else{if(oEventHandler.disabled){delete oEventHandler.disabled}}}}}return this},registerEventHandler:function(sEventName,oEventHandler){if(sEventName&&oEventHandler){var self=this,oScope=oEventHandler.scope,fnEventHandler=oEventHandler.callback,aEventArgs=oEventHandler["arguments"],aCustomEventArgs,aDeviceEvents,fnInternalEventHandler,index;if(!oScope){oScope=self}fnInternalEventHandler=oEventHandler.registeredEventHandler;if(!fnInternalEventHandler){fnInternalEventHandler=function internalEventHandler(oEvent){var aArgs=[],bDisabled=oEventHandler.disabled;if(!bDisabled&&fnEventHandler&&oEvent&&oEvent.type){oEvent.sourceShape=self;aArgs.push(oEvent);if(aEventArgs&&aEventArgs.length>0){aArgs=aArgs.concat(aEventArgs)}fnEventHandler.apply(oScope,aArgs)}}}if(fnEventHandler&&this.isDrawn){if(sap.galilei.ui.common.isMouseEvent(sEventName)||sap.galilei.ui.common.isTouchEvent(sEventName)||sap.galilei.ui.common.isKeyEvent(sEventName)||sap.galilei.ui.common.isDragDropEvent(sEventName)||sap.galilei.ui.common.isDOMEvent(sEventName)){if(sap.galilei.ui.common.isDragDropEvent(sEventName)){sEventName=sEventName.slice(sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX.length)}this.d3Node.node().addEventListener(sEventName,fnInternalEventHandler,false);if(!oEventHandler.registeredEventHandler){oEventHandler.registeredEventHandler=fnInternalEventHandler}}else{if(sap.galilei.ui.common.isPointerEvent(sEventName)){aDeviceEvents=sap.galilei.ui.common.PointerEventsMap[sEventName];if(!oEventHandler.registeredEventHandler){oEventHandler.registeredEventHandler=fnInternalEventHandler}for(index=0;index<aDeviceEvents.length;index++){this.registerEventHandler(aDeviceEvents[index],oEventHandler)}}else{if(sap.galilei.ui.common.isGestureEvent(sEventName)){if(!this._hammer){this._hammer=Hammer(this.d3Node.node())}this._hammer.on(sEventName,fnInternalEventHandler);if(!oEventHandler.registeredEventHandler){oEventHandler.registeredEventHandler=fnInternalEventHandler}}else{aCustomEventArgs=[sEventName,fnInternalEventHandler];if(aEventArgs&&aEventArgs.length>0){aCustomEventArgs.push(undefined);aCustomEventArgs=aCustomEventArgs.concat(aEventArgs)}sap.galilei.core.Event.subscribe.apply(undefined,aCustomEventArgs);if(!oEventHandler.registeredEventHandler){oEventHandler.registeredEventHandler=fnInternalEventHandler}}}}}}return this},unregisterEventHandler:function(sEventName,oEventHandler){if(sEventName&&oEventHandler){if(this.isDrawn){var fnEventHandler,aDeviceEvents,index;if(oEventHandler.registeredEventHandler){fnEventHandler=oEventHandler.registeredEventHandler}else{fnEventHandler=oEventHandler.callback}if(sap.galilei.ui.common.isMouseEvent(sEventName)||sap.galilei.ui.common.isTouchEvent(sEventName)||sap.galilei.ui.common.isKeyEvent(sEventName)||sap.galilei.ui.common.isDragDropEvent(sEventName)||sap.galilei.ui.common.isDOMEvent(sEventName)){if(sap.galilei.ui.common.isDragDropEvent(sEventName)){sEventName=sEventName.slice(sap.galilei.ui.common.DRAGDROP_EVENT_PREFIX.length)}this.d3Node.node().removeEventListener(sEventName,fnEventHandler,false)}else{if(sap.galilei.ui.common.isPointerEvent(sEventName)){aDeviceEvents=sap.galilei.ui.common.PointerEventsMap[sEventName];for(index=0;index<aDeviceEvents.length;index++){this.unregisterEventHandler(aDeviceEvents[index],oEventHandler)}}else{if(sap.galilei.ui.common.isGestureEvent(sEventName)&&this._hammer){this._hammer.off(sEventName,fnEventHandler)}else{sap.galilei.core.Event.unSubscribeCallback(sEventName,fnEventHandler,oEventHandler.scope)}}}}}return this},registerEventHandlers:function(){if(this.eventHandlers){var sEventName,aEventHandlers,index;for(sEventName in this.eventHandlers){aEventHandlers=this.eventHandlers[sEventName];for(index=0;index<aEventHandlers.length;index++){this.registerEventHandler(sEventName,aEventHandlers[index])}}}return this},unregisterEventHandlers:function(){if(this.eventHandlers){var sEventName,aEventHandlers,index;for(sEventName in this.eventHandlers){aEventHandlers=this.eventHandlers[sEventName];for(index=0;index<aEventHandlers.length;index++){this.unregisterEventHandler(sEventName,aEventHandlers[index])}}delete this.eventHandlers}return this},insertBefore:function(oShape){if(this.d3Node&&oShape&&oShape.d3Node){var oThisNode=this.d3Node.node(),oNode=oShape.d3Node.node(),oParentNode=oThisNode.parentNode;if(oThisNode&&oNode&&oThisNode!==oNode){if(!oParentNode||oParentNode!==oNode.parentNode){throw"We basically adjust shape order within same parent."}oParentNode.insertBefore(oNode,oThisNode.nextSibling)}}},insertAfter:function(oShape){if(this.d3Node&&oShape&&oShape.d3Node){var oThisNode=this.d3Node.node(),oNode=oShape.d3Node.node(),oParentNode=oThisNode.parentNode;if(oThisNode&&oNode&&oThisNode!==oNode){if(!oParentNode||oParentNode!==oNode.parentNode){throw"We basically adjust shape order within same parent."}oParentNode.insertBefore(oThisNode,oNode.nextSibling)}}},isPrecedingTo:function(oShape){var oThisNode,oNode,oParentNode,i;if(this.d3Node&&oShape&&oShape.d3Node){oThisNode=this.d3Node.node();oNode=oShape.d3Node.node();oParentNode=oThisNode.parentNode;if(oThisNode&&oNode&&oThisNode!==oNode){if(!oParentNode||oParentNode!==oNode.parentNode){throw"We basically adjust shape order within same parent."}for(i=0;i<oParentNode.childNodes.length;i++){if(oThisNode===oParentNode.childNodes[i]){return true}if(oNode===oParentNode.childNodes[i]){return false}}return false}}},dispose:function(){this.remove()}}});sap.galilei.ui.common.shape.defineShape=function(oShapeDef){var ShapeClass,sShapeName;if(oShapeDef){sShapeName=oShapeDef.shapeName;oShapeDef=sap.galilei.ui.common.shape.transformShapeDef(oShapeDef);ShapeClass=sap.galilei.core.defineClass(oShapeDef);if(sShapeName){sap.galilei.ui.common.shape.ShapeRegistry.registerShape(sShapeName,ShapeClass)}}return ShapeClass};sap.galilei.ui.common.shape.transformShapeDef=function(oShapeDef){oShapeDef=oShapeDef||{};var parent=oShapeDef.parent,sShapeName=oShapeDef.shapeName,sShapeCategory=oShapeDef.shapeCategory,properties=oShapeDef.properties;if(!parent){parent=sap.galilei.ui.common.shape.Shape}properties=properties||{};if(sShapeName){properties.name={value:sShapeName,writable:false,configurable:false};delete oShapeDef.shapeName}if(sShapeCategory){properties.category={value:sShapeCategory,writable:false,configurable:false};delete oShapeDef.shapeCategory}oShapeDef.parent=parent;oShapeDef.properties=properties;return oShapeDef};
"use strict";sap.galilei.ui.common.shape.ShapeRegistry=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.shape.ShapeRegistry",statics:{_shapesMap:undefined,shapesMap:{get:function(){if(!sap.galilei.ui.common.shape.ShapeRegistry._shapesMap){sap.galilei.ui.common.shape.ShapeRegistry._shapesMap=new sap.galilei.core.DefaultLookupClass()}return sap.galilei.ui.common.shape.ShapeRegistry._shapesMap}},registerShape:function(sShape,ShapeClass){if(sShape&&ShapeClass){sap.galilei.ui.common.shape.ShapeRegistry.shapesMap.add(sShape,ShapeClass)}},unregisterShape:function(sShape){if(sShape){sap.galilei.ui.common.shape.ShapeRegistry.shapesMap.remove(sShape)}},findShape:function(sShape){if(sShape){return sap.galilei.ui.common.shape.ShapeRegistry.shapesMap.get(sShape)}return undefined},createShape:function(sShape,oParam){if(sShape){var ShapeClass=sap.galilei.ui.common.shape.ShapeRegistry.findShape(sShape);if(ShapeClass){return new ShapeClass(oParam)}}return undefined},cloneShape:function(oShape){if(oShape){var sProperyty,oParam={},oCloneShape;for(sProperyty in oShape){if(oShape.hasOwnProperty(sProperyty)&&sProperyty!=="_shapes"&&sProperyty!=="_bindings"){if(oShape[sProperyty] instanceof sap.galilei.ui.common.Points){oParam[sProperyty]=oShape[sProperyty].clone()}else{oParam[sProperyty]=oShape[sProperyty]}}}oCloneShape=sap.galilei.ui.common.shape.ShapeRegistry.createShape(oShape.name,oParam);oCloneShape.d3Node=undefined;oCloneShape.eventHandlers=undefined;if(oShape.shapes.length>0){this.cloneSubShapes(oCloneShape,oShape)}return oCloneShape}return undefined},cloneSubShapes:function(oCloneShape,oShape){if(oCloneShape&&oShape){var iShape,oCloneSubShape;for(iShape=0;iShape<oShape.shapes.length;iShape++){oCloneSubShape=this.cloneShape(oShape.shapes[iShape]);if(oCloneSubShape){oCloneShape.shapes.add(oCloneSubShape)}}}return oCloneShape}}});
"use strict";sap.galilei.ui.common.shape.ShapeSerializer=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.shape.ShapeSerializer",statics:{load:function(aShapeComposition){if(aShapeComposition){if(sap.galilei.core.isInstanceOf(aShapeComposition,"Array")){return this.loadSubShapes(undefined,aShapeComposition)}else{if(sap.galilei.core.isInstanceOf(aShapeComposition,"Object")){return this.loadOneShape(undefined,aShapeComposition)}}}return undefined},loadOneShape:function(oParentShape,oShapeComposition){if(oShapeComposition&&sap.galilei.core.isInstanceOf(oShapeComposition,"Object")){var oShapeParams,sProperty,vValue,oBindings,ShapeClass,aShapes,oShape;oShapeParams={};for(sProperty in oShapeComposition){vValue=oShapeComposition[sProperty];if(sProperty==="shape"){ShapeClass=sap.galilei.ui.common.shape.ShapeRegistry.findShape(vValue)}else{if(sProperty==="shapes"){aShapes=vValue}else{if(sProperty==="bindings"){continue}else{if(sap.galilei.ui.common.binding.Binding.isBindingExpression(vValue)){if(!oBindings){oBindings={}}oBindings[sProperty]=vValue}else{oShapeParams[sProperty]=vValue}}}}}if(ShapeClass){oShape=new ShapeClass(oShapeParams);if(oShape){if(oParentShape){if(oParentShape.isComposite){oParentShape.shapes.add(oShape)}}else{oParentShape=oShape}if(oBindings){oShape.bindProperty(oBindings)}if(aShapes&&oShape.isComposite){if(sap.galilei.core.isInstanceOf(aShapes,"Array")){this.loadSubShapes(oShape,aShapes)}else{if(sap.galilei.core.isInstanceOf(aShapes,"Object")){this.loadOneShape(oShape,aShapes)}}}}}return oShape}return undefined},loadSubShapes:function(oParentShape,aShapeComposition){if(aShapeComposition&&sap.galilei.core.isInstanceOf(aShapeComposition,"Array")){if(!oParentShape){oParentShape=new sap.galilei.ui.common.shape.Group()}if(oParentShape.isComposite){var iShape,oShapeDef;for(iShape=0;iShape<aShapeComposition.length;++iShape){oShapeDef=aShapeComposition[iShape];this.loadOneShape(oParentShape,oShapeDef)}}}return oParentShape}}});
"use strict";sap.galilei.ui.common.shape.Line=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Line",shapeName:"Line",shapeCategory:"Standard",statics:{propertiesMap:{x1:"x1",y1:"y1",x2:"x2",y2:"y2"}},properties:{isSupportFill:false,x1:{field:"_x1",value:0,get:function(){return this._x1},set:function(nValue){this._x1=sap.galilei.core.validateNumeric(nValue,this._x1);if(this.orientation===sap.galilei.ui.common.Orientation.vertical){this._x2=this._x1}}},y1:{field:"_y1",value:0,get:function(){return this._y1},set:function(nValue){this._y1=sap.galilei.core.validateNumeric(nValue,this._y1);if(this.orientation===sap.galilei.ui.common.Orientation.horizontal){this._y2=this._y1}}},x2:{field:"_x2",value:0,get:function(){return this._x2},set:function(nValue){this._x2=sap.galilei.core.validateNumeric(nValue,this._x2);if(this.orientation===sap.galilei.ui.common.Orientation.vertical){this._x1=this._x2}}},y2:{field:"_y2",value:0,get:function(){return this._y2},set:function(nValue){this._y2=sap.galilei.core.validateNumeric(nValue,this._y2);if(this.orientation===sap.galilei.ui.common.Orientation.horizontal){this._y1=this._y2}}},orientation:{field:"_orientation",value:undefined,get:function(){return this._orientation},set:function(value){if(this._orientation!==value){this._orientation=value;if(this._orientation===sap.galilei.ui.common.Orientation.horizontal){this._y2=this._y1}else{if(this._orientation===sap.galilei.ui.common.Orientation.vertical){this._x2=this._x1}}}}},x:{get:function(){if(this.x1!==undefined&&this.x2!==undefined){return Math.min(this.x1,this.x2)}else{if(this.x1!==undefined){return this.x1}else{if(this.x2!==undefined){return this.x2}}}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(this.x1!==undefined&&this.x2!==undefined&&nValue!==undefined){var x=Math.min(this.x1,this.x2),dx=nValue-x;if(!isNaN(dx)&&dx!==0){this.moveBy(dx,0)}}}},y:{get:function(){if(this.y1!==undefined&&this.y2!==undefined){return Math.min(this.y1,this.y2)}else{if(this.y1!==undefined){return this.y1}else{if(this.y2!==undefined){return this.y2}}}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(this.y1!==undefined&&this.y2!==undefined&&nValue!==undefined){var y=Math.min(this.y1,this.y2),dy=nValue-y;if(!isNaN(dy)&&dy!==0){this.moveBy(0,dy)}}}},width:{get:function(){if(this.x1!==undefined&&this.x2!==undefined){return Math.abs(this.x2-this.x1)}else{return 0}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(this.x1!==undefined&&this.x2!==undefined&&nValue!==undefined){if(this.orientation===sap.galilei.ui.common.Orientation.vertical){nValue=0}else{nValue=Math.abs(nValue)}if(this.x2>=this.x1){this.x2=this.x1+nValue}else{this.x1=this.x2+nValue}}}},height:{get:function(){if(this.y1!==undefined&&this.y2!==undefined){return Math.abs(this.y2-this.y1)}else{return 0}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(this.y1!==undefined&&this.y2!==undefined&&nValue!==undefined){if(this.orientation===sap.galilei.ui.common.Orientation.horizontal){nValue=0}else{nValue=Math.abs(nValue)}if(this.y2>=this.y1){this.y2=this.y1+nValue}else{this.y1=this.y2+nValue}}}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:line",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Line.propertiesMap,sap.galilei.ui.common.shape.Line.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertFromNode,aAttributes);sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Line.propertiesMap,sap.galilei.ui.common.shape.Line.convertFromNode,aAttributes);return this.d3Node},getBBox:function(){var rect;if(this.x1!=undefined&&this.y1!=undefined&&this.x2!=undefined&&this.y2!=undefined){rect=new sap.galilei.ui.common.Rect(new sap.galilei.ui.common.Point(this.x1,this.y1),new sap.galilei.ui.common.Point(this.x2,this.y2))}else{rect=new sap.galilei.ui.common.Rect()}return rect},moveBy:function(dx,dy){if(dx!==undefined&&!isNaN(dx)&&dx!==0){this._x1+=dx;this._x2+=dx}if(dy!==undefined&&!isNaN(dy)&&dy!==0){this._y1+=dy;this._y2+=dy}}}});
"use strict";sap.galilei.ui.common.shape.Rectangle=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Rectangle",shapeName:"Rectangle",shapeCategory:"Standard",statics:{propertiesMap:{x:"x",y:"y",width:"width",height:"height"}},properties:{x:{field:"_x",value:0,get:function(){return this._x},set:function(nValue){this._x=sap.galilei.core.validateNumeric(nValue,this._x)}},y:{field:"_y",value:0,get:function(){return this._y},set:function(nValue){this._y=sap.galilei.core.validateNumeric(nValue,this._y)}},width:{field:"_width",value:0,get:function(){return this._width},set:function(nValue){this._width=sap.galilei.core.validateNumeric(nValue,this._width)}},height:{field:"_height",value:0,get:function(){return this._height},set:function(nValue){this._height=sap.galilei.core.validateNumeric(nValue,this._height)}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:rect",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Rectangle.propertiesMap,sap.galilei.ui.common.shape.Rectangle.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertFromNode,aAttributes);sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Rectangle.propertiesMap,sap.galilei.ui.common.shape.Rectangle.convertFromNode,aAttributes);return this.d3Node}}});
"use strict";sap.galilei.ui.common.shape.Path=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Path",shapeName:"Path",shapeCategory:"Standard",statics:{propertiesMap:{path:"d",pathTransform:"transform",markerStart:"marker-start",markerMiddle:"marker-mid",markerEnd:"marker-end"},convertToNode:function(viewer,shape,sShapeProp,sNodeProp,vValue){if(viewer&&shape&&sShapeProp&&sNodeProp){switch(sShapeProp){case"path":if(!vValue){vValue=shape.generatePath()}break;case"markerStart":if(shape.markerStart){vValue=viewer.libraries.getMarkerUrl(shape.markerStart)}else{vValue=undefined}break;case"markerMiddle":if(shape.markerMiddle){vValue=viewer.libraries.getShapeUrl(shape.markerMiddle)}else{vValue=undefined}break;case"markerEnd":if(shape.markerEnd){vValue=viewer.libraries.getMarkerUrl(shape.markerEnd)}else{vValue=undefined}break}}return vValue}},properties:{path:undefined,isEnableTransform:true,pathTransform:{get:function(){var sTransform,sTranslate,oBBox=this.getSvgBBox(false),scaleX=1,scaleY=1,dx=this.x,dy=this.y;if(this.isEnableTransform&&oBBox&&oBBox.width!==0&&oBBox.height!==0&&(oBBox.width!==this.width||oBBox.height!==this.height)&&this.width!==undefined&&!isNaN(this.width)&&this.height!==undefined&&!isNaN(this.height)){scaleX=this.width/oBBox.width;scaleY=this.height/oBBox.height;if(scaleX!==0&&scaleY!==0){sTransform="scale("+scaleX+","+scaleY+")"}}if(this.x!==undefined&&!isNaN(this.x)&&this.y!==undefined&&!isNaN(this.y)){if(scaleX!==0){dx/=scaleX}if(scaleY!==0){dy/=scaleY}if(oBBox){dx-=oBBox.x;dy-=oBBox.y}sTranslate="translate("+dx+","+dy+")";if(!sTransform){sTransform=sTranslate}else{sTransform+=sTranslate}}return sTransform}},markerStart:undefined,markerEnd:undefined,markerMiddle:undefined},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:path",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},generatePath:function(){return undefined},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,self=this,bFixIE=false,sMarkerStart,sMarkerMiddle,sMarkerEnd,sMarkerStartUrl,sMarkerMiddleUrl,sMarkerEndUrl,delay=15;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);if(this.d3Node&&(navigator.appVersion.indexOf("MSIE 9")!==-1||navigator.appVersion.indexOf("MSIE 10")!==-1||navigator.appVersion.indexOf("MSIE 11")!==-1)&&(this.markerStart||this.markerMiddle||this.markerEnd)){bFixIE=true;sMarkerStart=this.markerStart;sMarkerMiddle=this.markerMiddle;sMarkerEnd=this.markerEnd;this.markerStart=undefined;this.markerMiddle=undefined;this.markerEnd=undefined;if(sMarkerStart){sMarkerStartUrl=this.d3Node.attr("marker-start");this.d3Node.attr("marker-start",null)}if(sMarkerMiddle){sMarkerMiddleUrl=this.d3Node.attr("marker-mid");this.d3Node.attr("marker-mid",null)}if(sMarkerEnd){sMarkerEndUrl=this.d3Node.attr("marker-end");this.d3Node.attr("marker-end",null)}}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Path.propertiesMap,sap.galilei.ui.common.shape.Path.convertToNode,aAttributes);if(this.d3Node&&bFixIE){this.markerStart=sMarkerStart;this.markerMiddle=sMarkerMiddle;this.markerEnd=sMarkerEnd;if(oTransitionDef){delay=oTransitionDef.duration}setTimeout(function(){if(sMarkerStart){if(!sMarkerStartUrl){sMarkerStartUrl=oViewer.libraries.getMarkerUrl(sMarkerStart)}self.d3Node.attr("marker-start",sMarkerStartUrl)}if(sMarkerMiddle){if(!sMarkerMiddleUrl){sMarkerMiddleUrl=oViewer.libraries.getMarkerUrl(sMarkerMiddle)}self.d3Node.attr("marker-mid",sMarkerMiddleUrl)}if(sMarkerEnd){if(!sMarkerEndUrl){sMarkerEndUrl=oViewer.libraries.getMarkerUrl(sMarkerEnd)}self.d3Node.attr("marker-end",sMarkerEndUrl)}},delay)}return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertFromNode,aAttributes);sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Path.propertiesMap,sap.galilei.ui.common.shape.Path.convertFromNode,aAttributes);return this.d3Node}}});
"use strict";sap.galilei.ui.common.shape.Group=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Group",shapeName:"Group",shapeCategory:"Standard",statics:{propertiesMap:{groupTransform:"transform"}},properties:{isComposite:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.COMPOSITE,value:sap.galilei.ui.common.shape.ShapeStates.COMPOSITE,writable:false,configurable:false},isGroup:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.GROUP,value:sap.galilei.ui.common.shape.ShapeStates.GROUP,writable:false,configurable:false},isSupportStroke:false,isSupportFill:false,x:{get:function(){if(this._x!==undefined){return this._x}else{if(this.shapes.length>0){var rect=this.getChildrenBBox();return rect.x}}return this._x},set:function(nValue){this._x=sap.galilei.core.validateNumeric(nValue,this._x,true)}},y:{get:function(){if(this._y!==undefined){return this._y}else{if(this.shapes.length>0){var rect=this.getChildrenBBox();return rect.y}}return this._y},set:function(nValue){this._y=sap.galilei.core.validateNumeric(nValue,this._y,true)}},width:{get:function(){if(this._width!==undefined){return this._width}else{if(this.shapes.length>0){var rect=this.getChildrenBBox();return rect.width}}return this._width},set:function(nValue){this._width=sap.galilei.core.validateNumeric(nValue,this._width,true)}},height:{get:function(){if(this._height!==undefined){return this._height}else{if(this.shapes.length>0){var rect=this.getChildrenBBox();return rect.height}}return this._height},set:function(nValue){this._height=sap.galilei.core.validateNumeric(nValue,this._height,true)}},isEnableTransform:false,groupTransform:{get:function(){var sTransform,sTranslate,oBBox;if(this.isEnableTransform){if(this._width!==undefined&&!isNaN(this._width)&&this._height!==undefined&&!isNaN(this._height)){oBBox=this.getBBox();if(oBBox&&oBBox.width!==0&&oBBox.height!==0&&(oBBox.width!==this._width||oBBox.height!==this._height)){sTransform="scale("+this._width/oBBox.width+","+this._height/oBBox.height+")"}}if(this._x!==undefined&&!isNaN(this._x)&&this._y!==undefined&&!isNaN(this._y)&&(this._x!==0||this._y!==0)){sTranslate="translate("+this._x+","+this._y+")";if(!sTransform){sTransform=sTranslate}else{sTransform+=sTranslate}}}return sTransform}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){this.createNode("svg:g",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector);var index,shape;for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];shape.draw(oViewer,this.d3Node,oTransitionDef)}return this.d3Node},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,index,shape;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];shape.updateDrawing(oViewer,oTransitionDef,aAttributes)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Group.propertiesMap,sap.galilei.ui.common.shape.Group.convertToNode,aAttributes);return this.d3Node},layout:function(layoutRect,bUpdateShape){var index,shape,rect,outputLayoutRect=new sap.galilei.ui.common.Rect();for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];rect=shape.layout(layoutRect,bUpdateShape);if(index===0){outputLayoutRect.set(rect)}else{outputLayoutRect.unionRect(rect)}}this.layoutRect=outputLayoutRect;return outputLayoutRect},getBBox:function(){var rect,childrenRect=this.getChildrenBBox();if(childrenRect){rect=childrenRect.clone();if(this.x!==undefined&&this.y!==undefined&&this.isEnableTransform){rect.moveBy(this.x,this.y)}}else{rect=new sap.galilei.ui.common.Rect(this.x,this.y,this.width,this.height)}return rect}}});
"use strict";sap.galilei.ui.common.shape.Circle=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Circle",shapeName:"Circle",shapeCategory:"Standard",statics:{propertiesMap:{cx:"cx",cy:"cy",r:"r"}},properties:{cx:{field:"_cx",get:function(){return this._cx},set:function(nValue){this._cx=sap.galilei.core.validateNumeric(nValue,this._cx,true)}},cy:{field:"_cy",get:function(){return this._cy},set:function(nValue){this._cy=sap.galilei.core.validateNumeric(nValue,this._cy,true)}},r:{field:"_r",get:function(){return this._r},set:function(nValue){this._r=sap.galilei.core.validateNumeric(nValue,this._r,true)}},x:{get:function(){if(this.cx!==undefined&&this.r!==undefined){return this.cx-this.r}else{return this._x}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&this.r!==undefined){this.cx=nValue+this.r}else{this._x=nValue}}},y:{get:function(){if(this.cy!==undefined&&this.r!==undefined){return this.cy-this.r}else{return this._y}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&this.r!==undefined){this.cy=nValue+this.r}else{this._y=nValue}}},width:{get:function(){if(this.r!==undefined){return this.r*2}else{return this._width}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined){var x=this.x,y=this.y;nValue=Math.abs(nValue);this.r=nValue/2;this.cx=x+this.r;this.cy=y+this.r}else{this._width=nValue;this._height=nValue}}},height:{get:function(){if(this.r!==undefined){return this.r*2}else{return this._height}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined){var x=this.x,y=this.y;nValue=Math.abs(nValue);this.r=nValue/2;this.cx=x+this.r;this.cy=y+this.r}else{this._width=nValue;this._height=nValue}}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:circle",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,x0=this.x,y0=this.y,width0=this.width,height0=this.height;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);if(this.cx===undefined||this.cy===undefined){if(x0!==undefined&&y0!==undefined&&width0!==undefined&&height0!==undefined){this.cx=x0+width0/2;this.cy=y0+height0/2}}if(this.r===undefined){if(width0!==undefined&&height0!==undefined){this.r=Math.min(width0/2,height0/2)}}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Circle.propertiesMap,sap.galilei.ui.common.shape.Circle.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertFromNode,aAttributes);sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Circle.propertiesMap,sap.galilei.ui.common.shape.Circle.convertFromNode,aAttributes);return this.d3Node},getCenter:function(){if(this.cx!==undefined&&this.cy!==undefined){return[this.cx,this.cy]}var oRect=this.getBBox();if(oRect){return oRect.getCenter()}return[undefined,undefined]},setCenter:function(x,y,bRounded){this.cx=x;this.cy=y},setBBox:function(x,y,width,height){var oRect;if(arguments.length===1){oRect=arguments[0];x=oRect.x;y=oRect.y;width=oRect.width;height=oRect.height}else{if(arguments.length!==4){return}}width=Math.abs(width);height=Math.abs(height);this.cx=x+width/2;this.cy=y+height/2;this.r=Math.min(width,height)/2},getIntersection:function(oSegment,oParentBBox){if(oSegment){var oRect=this.getBBox();if(oParentBBox){oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}oRect=this.inflateStrokeWidth(oRect);return sap.galilei.ui.common.geometry.intersectSegmentEllipse(oSegment,oRect)}return undefined},isPointInShape:function(oPoint,oParentBBox){if(oPoint){var oRect=this.getBBox();if(oParentBBox){oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}oRect=this.inflateStrokeWidth(oRect);return sap.galilei.ui.common.geometry.isPointInEllipse(oPoint,oRect)}return false}}});
"use strict";sap.galilei.ui.common.shape.ContentGroup=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.ContentGroup",shapeName:"ContentGroup",shapeCategory:"Internal",parent:sap.galilei.ui.common.shape.Group,properties:{mainShape:undefined,boundaryShape:{get:function(){if(this.mainShape){return this.mainShape.isComposite&&this.mainShape.shapes[0]?this.mainShape.shapes[0]:this.mainShape}return undefined}},contentShape:undefined,displayMode:sap.galilei.ui.common.ShapeLayoutModes.detail,isEnableTransform:true,isAdjustToContent:true},methods:{layout:function(layoutRect,bUpdateShape){var rect,contentRect=new sap.galilei.ui.common.Rect(),outputLayoutRect=new sap.galilei.ui.common.Rect(),oMatrix,newRect,index,shape;if(this.mainShape){if(this.isAdjustToContent&&!bUpdateShape){if(this.displayMode!==sap.galilei.ui.common.ShapeLayoutModes.icon&&this.contentShape){contentRect.set(layoutRect);rect=this.contentShape.layout(contentRect,bUpdateShape);rect=this.contentShape.checkLayoutRect(rect);rect=this.boundaryShape.getMainShapeBox(rect,true);rect=this.boundaryShape.checkLayoutRect(rect);outputLayoutRect.set(rect)}else{contentRect.set(layoutRect);rect=this.boundaryShape.getBBox();rect=this.boundaryShape.checkLayoutRect(rect);outputLayoutRect.set(rect)}}else{rect=this.mainShape.layout(layoutRect,bUpdateShape);rect.width=layoutRect.width;rect.height=layoutRect.height;if(!bUpdateShape){rect=this.boundaryShape.checkLayoutRect(rect)}if(bUpdateShape){oMatrix=new sap.galilei.ui.common.Matrix();var r=this.boundaryShape.getBBox();oMatrix.transformRectangles(this.boundaryShape.getBBox(),layoutRect);this.mainShape.setBBox(layoutRect);if(this.mainShape.isComposite){for(index=0;index<this.mainShape.shapes.length;++index){shape=this.mainShape.shapes[index];if(shape.isResizable!==false){newRect=shape.getBBox();newRect.matrixTransform(oMatrix,false);shape.setBBox(layoutRect)}}}}outputLayoutRect.set(rect);if(this.contentShape){contentRect=this.boundaryShape.getContentBox(this.displayMode);if(!bUpdateShape){contentRect=this.contentShape.checkLayoutRect(contentRect)}rect=this.contentShape.layout(contentRect,bUpdateShape);if(this.displayMode!==sap.galilei.ui.common.ShapeLayoutModes.icon){outputLayoutRect.unionRect(rect)}}}}this.layoutRect=outputLayoutRect;return outputLayoutRect}}});
"use strict";sap.galilei.ui.common.shape.Ellipse=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Ellipse",shapeName:"Ellipse",shapeCategory:"Standard",statics:{propertiesMap:{cx:"cx",cy:"cy",rx:"rx",ry:"ry"}},properties:{cx:{field:"_cx",get:function(){return this._cx},set:function(nValue){this._cx=sap.galilei.core.validateNumeric(nValue,this._cx,true)}},cy:{field:"_cy",get:function(){return this._cy},set:function(nValue){this._cy=sap.galilei.core.validateNumeric(nValue,this._cy,true)}},rx:{field:"_rx",get:function(){return this._rx},set:function(nValue){this._rx=sap.galilei.core.validateNumeric(nValue,this._rx,true)}},ry:{field:"_ry",get:function(){return this._ry},set:function(nValue){this._ry=sap.galilei.core.validateNumeric(nValue,this._ry,true)}},x:{get:function(){if(this.cx!==undefined&&this.rx!==undefined){return this.cx-this.rx}else{return this._x}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&this.rx!==undefined){this.cx=nValue+this.rx}else{this._x=nValue}}},y:{get:function(){if(this.cy!==undefined&&this.ry!==undefined){return this.cy-this.ry}else{return this._y}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&this.ry!==undefined){this.cy=nValue+this.ry}else{this._y=nValue}}},width:{get:function(){if(this.rx!==undefined){return this.rx*2}else{return this._width}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined){var x=this.x;nValue=Math.abs(nValue);this.rx=nValue/2;this.cx=x+this.rx}else{this._width=nValue}}},height:{get:function(){if(this.ry!==undefined){return this.ry*2}else{return this._height}},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined){var y=this.y;nValue=Math.abs(nValue);this.ry=nValue/2;this.cy=y+this.ry}else{this._height=nValue}}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:ellipse",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,x0=this.x,y0=this.y,width0=this.width,height0=this.height;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);if(this.cx===undefined||this.cy===undefined){if(x0!==undefined&&y0!==undefined&&width0!==undefined&&height0!==undefined){this.cx=x0+width0/2;this.cy=y0+height0/2}}if(this.rx===undefined||this.ry===undefined){if(x0!==undefined&&y0!==undefined&&width0!==undefined&&height0!==undefined){this.rx=width0/2;this.ry=height0/2}}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Ellipse.propertiesMap,sap.galilei.ui.common.shape.Ellipse.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertFromNode,aAttributes);sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Ellipse.propertiesMap,sap.galilei.ui.common.shape.Ellipse.convertFromNode,aAttributes);return this.d3Node},getCenter:function(){if(this.cx!==undefined&&this.cy!==undefined){return[this.cx,this.cy]}var oRect=this.getBBox();if(oRect){return oRect.getCenter()}return[undefined,undefined]},setCenter:function(x,y,bRounded){this.cx=x;this.cy=y},setBBox:function(x,y,width,height){var oRect;if(arguments.length===1){oRect=arguments[0];x=oRect.x;y=oRect.y;width=oRect.width;height=oRect.height}else{if(arguments.length!==4){return}}width=Math.abs(width);height=Math.abs(height);this.cx=x+width/2;this.cy=y+height/2;this.rx=width/2;this.ry=height/2},getIntersection:function(oSegment,oParentBBox){if(oSegment){var oRect=this.getBBox();if(oParentBBox){oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}oRect=this.inflateStrokeWidth(oRect);return sap.galilei.ui.common.geometry.intersectSegmentEllipse(oSegment,oRect)}return undefined},isPointInShape:function(oPoint,oParentBBox){if(oPoint){var oRect=this.getBBox();if(oParentBBox){oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}oRect=this.inflateStrokeWidth(oRect);return sap.galilei.ui.common.geometry.isPointInEllipse(oPoint,oRect)}return false}}});
"use strict";sap.galilei.ui.common.shape.Image=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Image",shapeName:"Image",shapeCategory:"Standard",statics:{propertiesMap:{x:"x",y:"y",width:"width",height:"height",href:"xlink:href"},convertToNode:function(viewer,shape,sShapeProp,sNodeProp,vValue){if(viewer&&shape&&sShapeProp&&sNodeProp){switch(sShapeProp){case"href":if(shape.href&&shape.href.length>0&&shape.href[0]==="#"){var value;try{value=viewer.libraries.getShapeUrl(shape.href.substr(1))}catch(e){return vValue}vValue=value}break}}return vValue}},properties:{isSupportStroke:false,isSupportFill:false,x:{field:"_x",value:0,get:function(){return this._x},set:function(nValue){this._x=sap.galilei.core.validateNumeric(nValue,this._x)}},y:{field:"_y",value:0,get:function(){return this._y},set:function(nValue){this._y=sap.galilei.core.validateNumeric(nValue,this._y)}},width:{field:"_width",value:0,get:function(){if(this.href&&this.isVisible!==false){return this._width}return 0},set:function(nValue){this._width=sap.galilei.core.validateNumeric(nValue,this._width)}},height:{field:"_height",value:0,get:function(){if(this.href&&this.isVisible!==false){return this._height}return 0},set:function(nValue){this._height=sap.galilei.core.validateNumeric(nValue,this._height)}},useReference:false,href:undefined},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){var svgTag="svg:image";if(this.useReference||(this.href!==undefined&&this.href.length>0&&this.href[0]==="#")){this.useReference=true;svgTag="svg:use"}return this.createNode(svgTag,oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}if(this.width!==Math.abs(this.width)){this.width=Math.abs(this.width)}if(this.height!==Math.abs(this.height)){this.height=Math.abs(this.height)}if(this.href&&aAttributes){if(aAttributes.indexOf("width")===-1){aAttributes.push("width")}if(aAttributes.indexOf("height")===-1){aAttributes.push("height")}}if(!this.href){this.href="#Icons.invisible-icon"}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Image.propertiesMap,sap.galilei.ui.common.shape.Image.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertFromNode,aAttributes);sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Image.propertiesMap,sap.galilei.ui.common.shape.Image.convertFromNode,aAttributes);return this.d3Node}}});
"use strict";sap.galilei.ui.common.shape.Panel=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Panel",shapeName:"Panel",shapeCategory:"Internal",properties:{isComposite:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.COMPOSITE,value:sap.galilei.ui.common.shape.ShapeStates.COMPOSITE,writable:false,configurable:false},isTransparent:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.TRANSPARENT,value:sap.galilei.ui.common.shape.ShapeStates.TRANSPARENT,writable:false,configurable:false},x:{field:"_x",value:0,get:function(){return this._x},set:function(nValue){this._x=sap.galilei.core.validateNumeric(nValue,this._x)}},y:{field:"_y",value:0,get:function(){return this._y},set:function(nValue){this._y=sap.galilei.core.validateNumeric(nValue,this._y)}},width:{field:"_width",value:0,get:function(){return this._width},set:function(nValue){this._width=sap.galilei.core.validateNumeric(nValue,this._width)}},height:{field:"_height",value:0,get:function(){return this._height},set:function(nValue){this._height=sap.galilei.core.validateNumeric(nValue,this._height)}},innerPadding:{field:"_innerPadding",value:0,get:function(){return this._innerPadding},set:function(nValue){this._innerPadding=sap.galilei.core.validateNumeric(nValue,this._innerPadding)}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){var d3Parent,index,shape;if(oViewer){if(!d3ParentNode){d3Parent=oViewer.d3MainShapeLayer}else{d3Parent=d3ParentNode}}for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];shape.draw(oViewer,d3Parent,oTransitionDef)}return d3ParentNode},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,index,shape;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];shape.updateDrawing(oViewer,oTransitionDef,aAttributes)}return this.d3Node},layout:function(layoutRect,bUpdateShape){var outputLayoutRect=new sap.galilei.ui.common.Rect(),x,y,width,height;if(layoutRect){x=layoutRect.x;y=layoutRect.y;if(x===undefined){x=this.x}if(y===undefined){y=this.y}if(layoutRect.width!==undefined&&layoutRect.width!==0){width=layoutRect.width}if(layoutRect.height!==undefined&&layoutRect.height!==0){height=layoutRect.height}}else{x=this.x;y=this.y}outputLayoutRect.set(x,y,width,height);return sap.galilei.ui.common.shape.Panel.layout(this,this.shapes,outputLayoutRect,bUpdateShape)}},statics:{layout:function(oPanelShape,cShapes,layoutRect,bUpdateShape){var outputLayoutRect=new sap.galilei.ui.common.Rect(),x,y,width,height,index,shape,shapeX,shapeY,shapeWidth,shapeHeight,left,top,right,bottom,paddingLeft=0,paddingTop=0,paddingRight=0,paddingBottom=0,sHorzAlignment,sVertAlignment,childRect=new sap.galilei.ui.common.Rect(),innerWidth,innerHeight,innerLeft,innerTop,innerRight,innerBottom,nLeftSize=0,nTopSize=0,nRightSize=0,nBottomSize=0;if(cShapes&&layoutRect){x=layoutRect.x;y=layoutRect.y;width=layoutRect.width;height=layoutRect.height;x=sap.galilei.core.validateNumeric(x,0);y=sap.galilei.core.validateNumeric(y,0);width=sap.galilei.core.validateNumeric(width);height=sap.galilei.core.validateNumeric(height);outputLayoutRect.set(x,y,width,height);left=x;top=y;right=x+width;bottom=y+height;innerWidth=width;innerHeight=height;if(oPanelShape){paddingLeft=oPanelShape.paddingLeft;paddingTop=oPanelShape.paddingTop;paddingRight=oPanelShape.paddingRight;paddingBottom=oPanelShape.paddingBottom;paddingLeft=sap.galilei.core.validateNumeric(paddingLeft,0);paddingTop=sap.galilei.core.validateNumeric(paddingTop,0);paddingRight=sap.galilei.core.validateNumeric(paddingRight,0);paddingBottom=sap.galilei.core.validateNumeric(paddingBottom,0)}left+=paddingLeft;top+=paddingTop;if(width!==undefined&&width!==0){innerWidth=width-paddingLeft-paddingRight;right=left+innerWidth}if(height!==undefined&&height!==0){innerHeight=height-paddingTop-paddingBottom;bottom=top+innerHeight}innerLeft=left;innerTop=top;innerRight=right;innerBottom=bottom;for(index=0;index<cShapes.length;++index){shape=cShapes[index];shapeX=shape.x;shapeY=shape.y;if(shapeX===undefined){shapeX=0}if(shapeY===undefined){shapeY=0}if(!bUpdateShape){childRect.set(shapeX,shapeY,width,height);shape.layout(childRect,false)}else{if(oPanelShape&&oPanelShape.layoutRect&&(oPanelShape.layoutRect.width!==width||oPanelShape.layoutRect.height!==height)){childRect.set(shapeX,shapeY,innerWidth-shape.marginRight,innerHeight-shape.marginBottom);shape.layout(childRect,false)}}}if(bUpdateShape){for(index=0;index<cShapes.length;++index){shape=cShapes[index];shapeX=shape.x;shapeY=shape.y;if(shapeX===undefined){shapeX=0}if(shapeY===undefined){shapeY=0}if(shape.layoutRect){shapeWidth=shape.layoutRect.width;shapeHeight=shape.layoutRect.height}else{shapeWidth=shape.width;shapeHeight=shape.height}sHorzAlignment=shape.horizontalAlignment;sVertAlignment=shape.verticalAlignment;switch(shape.dockPosition){case sap.galilei.ui.common.DockPosition.topLeft:nTopSize=Math.max(nTopSize,shape.marginTop+shapeHeight+shape.marginBottom);nLeftSize=Math.max(nLeftSize,shape.marginLeft+shapeWidth+shape.marginRight);sVertAlignment=sap.galilei.ui.common.VerticalAlignment.top;sHorzAlignment=sap.galilei.ui.common.HorizontalAlignment.left;break;case sap.galilei.ui.common.DockPosition.top:nTopSize=Math.max(nTopSize,shape.marginTop+shapeHeight+shape.marginBottom);sVertAlignment=sap.galilei.ui.common.VerticalAlignment.top;if(!sHorzAlignment){sHorzAlignment=sap.galilei.ui.common.HorizontalAlignment.center}break;case sap.galilei.ui.common.DockPosition.topRight:nTopSize=Math.max(nTopSize,shape.marginTop+shapeHeight+shape.marginBottom);nRightSize=Math.max(nRightSize,shape.marginLeft+shapeWidth+shape.marginRight);sVertAlignment=sap.galilei.ui.common.VerticalAlignment.top;sHorzAlignment=sap.galilei.ui.common.HorizontalAlignment.right;break;case sap.galilei.ui.common.DockPosition.right:nRightSize=Math.max(nRightSize,shape.marginLeft+shapeWidth+shape.marginRight);sHorzAlignment=sap.galilei.ui.common.HorizontalAlignment.right;if(!sVertAlignment){sVertAlignment=sap.galilei.ui.common.VerticalAlignment.middle}break;case sap.galilei.ui.common.DockPosition.bottomRight:nBottomSize=Math.max(nBottomSize,shape.marginTop+shapeHeight+shape.marginBottom);nRightSize=Math.max(nRightSize,shape.marginLeft+shapeWidth+shape.marginRight);sVertAlignment=sap.galilei.ui.common.VerticalAlignment.bottom;sHorzAlignment=sap.galilei.ui.common.HorizontalAlignment.right;break;case sap.galilei.ui.common.DockPosition.bottom:nBottomSize=Math.max(nBottomSize,shape.marginTop+shapeHeight+shape.marginBottom);sVertAlignment=sap.galilei.ui.common.VerticalAlignment.bottom;if(!sHorzAlignment){sHorzAlignment=sap.galilei.ui.common.HorizontalAlignment.center}break;case sap.galilei.ui.common.DockPosition.bottomLeft:nBottomSize=Math.max(nBottomSize,shape.marginTop+shapeHeight+shape.marginBottom);nLeftSize=Math.max(nLeftSize,shape.marginLeft+shapeWidth+shape.marginRight);sVertAlignment=sap.galilei.ui.common.VerticalAlignment.bottom;sHorzAlignment=sap.galilei.ui.common.HorizontalAlignment.left;break;case sap.galilei.ui.common.DockPosition.left:nLeftSize=Math.max(nLeftSize,shape.marginLeft+shapeWidth+shape.marginRight);sHorzAlignment=sap.galilei.ui.common.HorizontalAlignment.left;if(!sVertAlignment){sVertAlignment=sap.galilei.ui.common.VerticalAlignment.middle}break}switch(sHorzAlignment){case sap.galilei.ui.common.HorizontalAlignment.right:shapeX=right-shapeWidth-shape.marginRight;break;case sap.galilei.ui.common.HorizontalAlignment.left:shapeX=left+shape.marginLeft;break}switch(sVertAlignment){case sap.galilei.ui.common.VerticalAlignment.bottom:shapeY=bottom-shapeHeight-shape.marginBottom;break;case sap.galilei.ui.common.VerticalAlignment.top:shapeY=top+shape.marginTop;break}if(shapeX!==shape.x||shapeY!==shape.y){shape.moveTo(shapeX,shapeY)}}innerLeft+=nLeftSize;innerTop+=nTopSize;innerRight-=nRightSize;innerBottom-=nRightSize;innerWidth=innerRight-innerLeft;innerHeight=innerBottom-innerTop;for(index=0;index<cShapes.length;++index){shape=cShapes[index];shapeX=shape.x;shapeY=shape.y;if(shapeX===undefined){shapeX=0}if(shapeY===undefined){shapeY=0}if(shape.layoutRect){shapeWidth=shape.layoutRect.width;shapeHeight=shape.layoutRect.height}else{shapeWidth=shape.width;shapeHeight=shape.height}sHorzAlignment=shape.horizontalAlignment;sVertAlignment=shape.verticalAlignment;switch(shape.dockPosition){case sap.galilei.ui.common.DockPosition.top:if(!sHorzAlignment){sHorzAlignment=sap.galilei.ui.common.HorizontalAlignment.center}break;case sap.galilei.ui.common.DockPosition.right:if(!sVertAlignment){sVertAlignment=sap.galilei.ui.common.VerticalAlignment.middle}break;case sap.galilei.ui.common.DockPosition.bottom:if(!sHorzAlignment){sHorzAlignment=sap.galilei.ui.common.HorizontalAlignment.center}break;case sap.galilei.ui.common.DockPosition.left:if(!sVertAlignment){sVertAlignment=sap.galilei.ui.common.VerticalAlignment.middle}break;case sap.galilei.ui.common.DockPosition.center:sHorzAlignment=sap.galilei.ui.common.HorizontalAlignment.center;sVertAlignment=sap.galilei.ui.common.VerticalAlignment.middle;break;case sap.galilei.ui.common.DockPosition.width:if(!sHorzAlignment){sHorzAlignment=sap.galilei.ui.common.HorizontalAlignment.width}break;case sap.galilei.ui.common.DockPosition.height:if(!sVertAlignment){sVertAlignment=sap.galilei.ui.common.VerticalAlignment.height}break;case sap.galilei.ui.common.DockPosition.maximize:if(!sHorzAlignment){sHorzAlignment=sap.galilei.ui.common.HorizontalAlignment.width}if(!sVertAlignment){sVertAlignment=sap.galilei.ui.common.VerticalAlignment.height}break}switch(sHorzAlignment){case sap.galilei.ui.common.HorizontalAlignment.center:shapeX=innerLeft+Math.round((innerWidth-shapeWidth)/2);break;case sap.galilei.ui.common.HorizontalAlignment.width:shapeX=innerLeft+shape.marginLeft;shapeWidth=innerWidth-shape.marginLeft-shape.marginRight;break}switch(sVertAlignment){case sap.galilei.ui.common.VerticalAlignment.middle:shapeY=innerTop+Math.round((innerHeight-shapeHeight)/2);break;case sap.galilei.ui.common.VerticalAlignment.height:shapeY=innerTop+shape.marginTop;shapeHeight=innerHeight-shape.marginTop-shape.marginBottom;break}if(shapeX!==shape.x||shapeY!==shape.y){shape.moveTo(shapeX,shapeY)}if(shapeWidth!==undefined){if(shape.width!==shapeWidth){shape.width=shapeWidth}if(shape.layoutRect){shape.layoutRect.width=shapeWidth}}if(shapeHeight!==undefined){if(shape.height!==shapeHeight){shape.height=shapeHeight}if(shape.layoutRect){shape.layoutRect.height=shapeHeight}}}}if(oPanelShape){oPanelShape.layoutRect=new sap.galilei.ui.common.Rect(outputLayoutRect)}}return outputLayoutRect}}});
"use strict";sap.galilei.ui.common.shape.Polygon=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Polygon",shapeName:"Polygon",shapeCategory:"Standard",statics:{propertiesMap:{points:"d"},convertToNode:function(viewer,shape,sShapeProp,sNodeProp,vValue){if(viewer&&shape&&sShapeProp&&sNodeProp){switch(sShapeProp){case"points":if(shape.path){vValue=shape.path}else{vValue=shape.generatePath()}break}}return vValue}},properties:{points:{field:"_points",get:function(){if(!this._points){this._points=new sap.galilei.ui.common.Points()}return this._points},set:function(value){if(sap.galilei.core.isInstanceOf(value,sap.galilei.ui.common.Points)){this._points=value}else{if((value instanceof Array)||(typeof value==="string")){this.points.points=value}}}},lineStyle:sap.galilei.ui.common.LineStyle.DEFAULT,roundedCornerSize:{field:"_roundedCornerSize",value:sap.galilei.ui.common.Path.ROUNDED_CORNER_SIZE,get:function(){return this._roundedCornerSize},set:function(nValue){this._roundedCornerSize=sap.galilei.core.validateNumeric(nValue,this._roundedCornerSize)}},x:{get:function(){var rect=this.getBBox();return rect.x},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;var x=+this.x;if(x!==undefined&&!isNaN(x)&&nValue!==x){this.moveBy(nValue-x,0)}}}},y:{get:function(){var rect=this.getBBox();return rect.y},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;var y=+this.y;if(y!==undefined&&!isNaN(y)&&nValue!==y){this.moveBy(0,nValue-y)}}}},width:{get:function(){var rect=this.getBBox();return rect.width},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;var oldRect=this.getBBox(),newRect,oMatrix;if(oldRect&&nValue!==oldRect.width){newRect=oldRect.clone();newRect.width=nValue;oMatrix=new sap.galilei.ui.common.Matrix();oMatrix.transformRectangles(oldRect,newRect);this.points.matrixTransform(oMatrix)}}}},height:{get:function(){var rect=this.getBBox();return rect.height},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;var oldRect=this.getBBox(),newRect,oMatrix;if(oldRect&&nValue!==oldRect.height){newRect=oldRect.clone();newRect.height=nValue;oMatrix=new sap.galilei.ui.common.Matrix();oMatrix.transformRectangles(oldRect,newRect);this.points.matrixTransform(oMatrix)}}}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:path",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},generatePath:function(){var sPath;if(this.lineStyle===sap.galilei.ui.common.LineStyle.quadraticBezier){sPath=sap.galilei.ui.common.Path.generateQuadraticBezier(this.points,true)}else{if(this.lineStyle===sap.galilei.ui.common.LineStyle.cubicBezier){sPath=sap.galilei.ui.common.Path.generateCubicBezier(this.points,true)}else{if(this.lineStyle===sap.galilei.ui.common.LineStyle.rounded){sPath=sap.galilei.ui.common.Path.generateRoundedPath(this.points,this.roundedCornerSize,true)}else{sPath=sap.galilei.ui.common.Path.generatePolyline(this.points,true)}}}return sPath},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Polygon.propertiesMap,sap.galilei.ui.common.shape.Polygon.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertFromNode,aAttributes);sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Polygon.propertiesMap,sap.galilei.ui.common.shape.Polygon.convertFromNode,aAttributes);return this.d3Node},flipHorizontal:function(){this.points.flipHorizontal()},flipVertical:function(){this.points.flipVertical()},getBBox:function(){return this.points.getBBox()},getIntersection:function(oSegment,oParentBBox){if(oSegment){var oRect=this.getBBox(),oPoints=this.points;if(oParentBBox){oPoints=this.points.clone();oPoints.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}return sap.galilei.ui.common.geometry.intersectSegmentPolygon(oSegment,oPoints)}return undefined},isPointInShape:function(oPoint,oParentBBox){if(oPoint){var oRect=this.getBBox(),oPoints=this.points;if(oParentBBox){oPoints=this.points.clone();oPoints.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}return sap.galilei.ui.common.geometry.isPointInPolygon(oPoint,oPoints)}return false},moveBy:function(dx,dy){return this.points.moveBy(dx,dy)}}});
"use strict";sap.galilei.ui.common.shape.Polyline=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Polyline",shapeName:"Polyline",shapeCategory:"Standard",statics:{propertiesMap:{points:"d",markerStart:"marker-start",markerMiddle:"marker-mid",markerEnd:"marker-end"},convertToNode:function(viewer,shape,sShapeProp,sNodeProp,vValue){if(viewer&&shape&&sShapeProp&&sNodeProp){switch(sShapeProp){case"points":if(shape.path){vValue=shape.path}else{vValue=shape.generatePath()}break;case"markerStart":if(shape.markerStart){vValue=viewer.libraries.getMarkerUrl(shape.markerStart)}else{vValue=undefined}break;case"markerMiddle":if(shape.markerMiddle){vValue=viewer.libraries.getShapeUrl(shape.markerMiddle)}else{vValue=undefined}break;case"markerEnd":if(shape.markerEnd){vValue=viewer.libraries.getMarkerUrl(shape.markerEnd)}else{vValue=undefined}break}}return vValue}},properties:{points:{field:"_points",get:function(){if(!this._points){this._points=new sap.galilei.ui.common.Points()}return this._points},set:function(value){if(sap.galilei.core.isInstanceOf(value,sap.galilei.ui.common.Points)){this._points=value}else{if((value instanceof Array)||(typeof value==="string")){this.points.points=value}}}},lineStyle:sap.galilei.ui.common.LineStyle.DEFAULT,layoutStyle:sap.galilei.ui.common.LayoutStyle.DEFAULT,roundedCornerSize:{field:"_roundedCornerSize",value:sap.galilei.ui.common.Path.ROUNDED_CORNER_SIZE,get:function(){return this._roundedCornerSize},set:function(nValue){this._roundedCornerSize=sap.galilei.core.validateNumeric(nValue,this._roundedCornerSize)}},fill:{value:"none",writable:false},isSupportFill:false,x:{get:function(){var rect=this.getBBox();return rect.x},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;var x=+this.x;if(x!==undefined&&!isNaN(x)&&nValue!==x){this.moveBy(nValue-x,0)}}}},y:{get:function(){var rect=this.getBBox();return rect.y},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;var y=+this.y;if(y!==undefined&&!isNaN(y)&&nValue!==y){this.moveBy(0,nValue-y)}}}},width:{get:function(){var rect=this.getBBox();return rect.width},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;var oldRect=this.getBBox(),newRect,oMatrix;if(oldRect&&nValue!==oldRect.width){newRect=oldRect.clone();newRect.width=nValue;oMatrix=new sap.galilei.ui.common.Matrix();oMatrix.transformRectangles(oldRect,newRect);this.points.matrixTransform(oMatrix)}}}},height:{get:function(){var rect=this.getBBox();return rect.height},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);if(nValue!==undefined&&!isNaN(nValue)){nValue=+nValue;var oldRect=this.getBBox(),newRect,oMatrix;if(oldRect&&nValue!==oldRect.height){newRect=oldRect.clone();newRect.height=nValue;oMatrix=new sap.galilei.ui.common.Matrix();oMatrix.transformRectangles(oldRect,newRect);this.points.matrixTransform(oMatrix)}}}},markerStart:undefined,markerEnd:undefined,markerMiddle:undefined},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:path",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},generatePath:function(){var sPath;if(this.lineStyle===sap.galilei.ui.common.LineStyle.quadraticBezier){sPath=sap.galilei.ui.common.Path.generateQuadraticBezier(this.points)}else{if(this.lineStyle===sap.galilei.ui.common.LineStyle.cubicBezier){sPath=sap.galilei.ui.common.Path.generateCubicBezier(this.points)}else{if(this.lineStyle===sap.galilei.ui.common.LineStyle.rounded){sPath=sap.galilei.ui.common.Path.generateRoundedPath(this.points,this.roundedCornerSize)}else{sPath=sap.galilei.ui.common.Path.generatePolyline(this.points)}}}return sPath},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,self=this,bFixIE=false,sMarkerStart,sMarkerMiddle,sMarkerEnd,sMarkerStartUrl,sMarkerMiddleUrl,sMarkerEndUrl,delay=15;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);if(this.d3Node&&(navigator.appVersion.indexOf("MSIE 9")!==-1||navigator.appVersion.indexOf("MSIE 10")!==-1||navigator.appVersion.indexOf("MSIE 11")!==-1)&&(this.markerStart||this.markerMiddle||this.markerEnd)){bFixIE=true;sMarkerStart=this.markerStart;sMarkerMiddle=this.markerMiddle;sMarkerEnd=this.markerEnd;this.markerStart=undefined;this.markerMiddle=undefined;this.markerEnd=undefined;if(sMarkerStart){sMarkerStartUrl=this.d3Node.attr("marker-start");this.d3Node.attr("marker-start",null)}if(sMarkerMiddle){sMarkerMiddleUrl=this.d3Node.attr("marker-mid");this.d3Node.attr("marker-mid",null)}if(sMarkerEnd){sMarkerEndUrl=this.d3Node.attr("marker-end");this.d3Node.attr("marker-end",null)}}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Polyline.propertiesMap,sap.galilei.ui.common.shape.Polyline.convertToNode,aAttributes);if(this.d3Node&&bFixIE){this.markerStart=sMarkerStart;this.markerMiddle=sMarkerMiddle;this.markerEnd=sMarkerEnd;if(oTransitionDef){delay=oTransitionDef.duration}setTimeout(function(){if(sMarkerStart){if(!sMarkerStartUrl){sMarkerStartUrl=oViewer.libraries.getMarkerUrl(sMarkerStart)}if(self.d3Node&&sMarkerStartUrl){self.d3Node.attr("marker-start",sMarkerStartUrl)}}if(sMarkerMiddle){if(!sMarkerMiddleUrl){sMarkerMiddleUrl=oViewer.libraries.getMarkerUrl(sMarkerMiddle)}if(self.d3Node&&sMarkerMiddleUrl){self.d3Node.attr("marker-mid",sMarkerMiddleUrl)}}if(sMarkerEnd){if(!sMarkerEndUrl){sMarkerEndUrl=oViewer.libraries.getMarkerUrl(sMarkerEnd)}if(self.d3Node&&sMarkerEndUrl){self.d3Node.attr("marker-end",sMarkerEndUrl)}}},delay)}return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertFromNode,aAttributes);sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Polyline.propertiesMap,sap.galilei.ui.common.shape.Polyline.convertFromNode,aAttributes);return this.d3Node},getBBox:function(){return this.points.getBBox()},isHorizontal:function(nDelta){return this.points.isHorizontal(nDelta)},isVertical:function(nDelta){return this.points.isVertical(nDelta)},isPointOnBorder:function(vPoint,oParentBBox,nRadius){var oRect,aPoints,bResult=false;if(vPoint){oRect=this.getBBox();aPoints=this.points;if(oParentBBox&&aPoints&&aPoints.clone){aPoints=aPoints.clone();aPoints.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}if(aPoints&&aPoints.length>=2){switch(this.lineStyle){case sap.galilei.ui.common.LineStyle.quadraticBezier:case sap.galilei.ui.common.LineStyle.cubicBezier:bResult=sap.galilei.ui.common.geometry.isPointOnBezier(vPoint,aPoints,(this.lineStyle===sap.galilei.ui.common.LineStyle.cubicBezier),nRadius);break;case sap.galilei.ui.common.LineStyle.rounded:case sap.galilei.ui.common.LineStyle.orthogonal:case sap.galilei.ui.common.LineStyle.normal:bResult=sap.galilei.ui.common.geometry.isPointOnPolyline(vPoint,aPoints,nRadius);break}}}return bResult},flipHorizontal:function(){this.points.flipHorizontal()},flipVertical:function(){this.points.flipVertical()},moveBy:function(dx,dy){return this.points.moveBy(dx,dy)}}});
"use strict";sap.galilei.ui.common.shape.RoundedRectangle=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.RoundedRectangle",parent:sap.galilei.ui.common.shape.Rectangle,shapeName:"RoundedRectangle",shapeCategory:"Standard",statics:{propertiesMap:{rx:"rx",ry:"ry"}},properties:{rx:{field:"_rx",get:function(){if(this._rx!==undefined){if(this._rx===this._ry){return this.checkR(this._rx,this._ry)}return this.checkRx(this._rx)}if(this._ry===undefined){return this.getDefaultR()}return this.getDefaultRx()},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue,this._rx,true);nValue=this.checkRx(nValue);this._rx=nValue}},ry:{field:"_ry",get:function(){if(this._ry!==undefined){if(this._rx===this._ry){return this.checkR(this._rx,this._ry)}return this.checkRy(this._ry)}if(this._rx===undefined){return this.getDefaultR()}return this.getDefaultRy()},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue,this._ry,true);nValue=this.checkRy(nValue);this._ry=nValue}},r:{get:function(){var rx=this.rx,ry=this.ry;if(rx!==undefined&&ry!==undefined&&!isNaN(rx)&&!isNaN(ry)){return Math.min(rx,ry)}return rx!==undefined?rx:ry},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);this.rx=nValue;this.ry=nValue}},paddingLeft:{field:"_paddingLeft",value:0,get:function(){if(this._paddingLeft!==0){return this._paddingLeft}var rx2=Math.round(this.rx/2);return Math.max(rx2,sap.galilei.ui.common.shape.Shape.DEFAULT_CONTENT_PADDING)},set:function(nValue){this._paddingLeft=sap.galilei.core.validateNumeric(nValue,this._paddingLeft)}},paddingTop:{field:"_paddingTop",value:0,get:function(){if(this._paddingTop!==0){return this._paddingTop}var ry2=Math.round(this.ry/2);return Math.max(ry2,sap.galilei.ui.common.shape.Shape.DEFAULT_CONTENT_PADDING)},set:function(nValue){this._paddingTop=sap.galilei.core.validateNumeric(nValue,this._paddingTop)}},paddingRight:{field:"_paddingRight",value:0,get:function(){if(this._paddingRight!==0){return this._paddingRight}var rx2=Math.round(this.rx/2);return Math.max(rx2,sap.galilei.ui.common.shape.Shape.DEFAULT_CONTENT_PADDING)},set:function(nValue){this._paddingRight=sap.galilei.core.validateNumeric(nValue,this._paddingRight)}},paddingBottom:{field:"_paddingBottom",value:0,get:function(){if(this._paddingBottom!==0){return this._paddingBottom}var ry2=Math.round(this.ry/2);return Math.max(ry2,sap.galilei.ui.common.shape.Shape.DEFAULT_CONTENT_PADDING)},set:function(nValue){this._paddingBottom=sap.galilei.core.validateNumeric(nValue,this._paddingBottom)}}},methods:{checkRx:function(rx){if(rx!==undefined&&!isNaN(rx)){rx=+rx;if(rx<0){rx=0}if(this.width!==undefined&&this.width!==0&&!isNaN(this.width)&&rx>this.width/2){rx=Math.floor(this.width/2)}}else{rx=undefined}return rx},checkRy:function(ry){if(ry!==undefined&&!isNaN(ry)){ry=+ry;if(ry<0){ry=0}if(this.height!==undefined&&this.height!==0&&!isNaN(this.height)&&ry>this.height/2){ry=Math.floor(this.height/2)}}else{ry=undefined}return ry},checkR:function(rx,ry){rx=this.checkRx(rx);ry=this.checkRy(ry);if(rx!==undefined&&ry!==undefined){return Math.min(rx,ry)}return undefined},getDefaultRx:function(){var rx=this._rx,ry=this._ry;if(rx===undefined&&ry===undefined){rx=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleR(this.width,this.height)}else{if(rx===undefined){rx=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRx(this.width)}}return rx},getDefaultRy:function(){var rx=this._rx,ry=this._ry;if(rx===undefined&&ry===undefined){ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleR(this.width,this.height)}else{if(ry===undefined){ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRy(this.height)}}return ry},getDefaultR:function(){var rx=this.getDefaultRx(),ry=this.getDefaultRy();if(rx!==undefined&&ry!==undefined){return Math.min(rx,ry)}return undefined},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Rectangle.propertiesMap,sap.galilei.ui.common.shape.Rectangle.convertToNode,aAttributes);sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.RoundedRectangle.propertiesMap,sap.galilei.ui.common.shape.RoundedRectangle.convertToNode,aAttributes);return this.d3Node},retrieveDrawing:function(viewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(viewer,nodeSelector)}sap.galilei.ui.common.shape.Shape.retrieveDrawing(viewer,this,this.d3Node,sap.galilei.ui.common.shape.Rectangle.propertiesMap,sap.galilei.ui.common.shape.Rectangle.convertFromNode,aAttributes);sap.galilei.ui.common.shape.Shape.retrieveDrawing(viewer,this,this.d3Node,sap.galilei.ui.common.shape.RoundedRectangle.propertiesMap,sap.galilei.ui.common.shape.RoundedRectangle.convertFromNode,aAttributes);return this.d3Node},getIntersection:function(oSegment,oParentBBox){if(oSegment){var oRect=this.getBBox();if(oParentBBox){oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}oRect=this.inflateStrokeWidth(oRect);return sap.galilei.ui.common.geometry.intersectSegmentRoundedRectangle(oSegment,oRect,this.rx,this.ry)}return undefined},isPointInShape:function(oPoint,oParentBBox){if(oPoint){var oRect=this.getBBox();if(oParentBBox){oRect=oRect.clone();oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}oRect=this.inflateStrokeWidth(oRect);return sap.galilei.ui.common.geometry.isPointInRoundedRectangle(oPoint,oRect,this.rx,this.ry)}return false},isPointOnBorder:function(vPoint,oParentBBox,nRadius){if(vPoint){var oInnerRect,oOuterRect;if(nRadius===undefined){nRadius=1}oInnerRect=this.getBBox();oOuterRect=this.getBBox();if(oParentBBox){oInnerRect=oInnerRect.clone();oOuterRect=oOuterRect.clone();oInnerRect.moveBy(oParentBBox.x-oInnerRect.x,oParentBBox.y-oInnerRect.y);oOuterRect.moveBy(oParentBBox.x-oOuterRect.x,oParentBBox.y-oOuterRect.y)}oInnerRect.inflate(-nRadius,-nRadius);oOuterRect.inflate(nRadius,nRadius);return sap.galilei.ui.common.geometry.isPointInRoundedRectangle(vPoint,oOuterRect,this.rx,this.ry)&&!sap.galilei.ui.common.geometry.isPointInRoundedRectangle(vPoint,oInnerRect,this.rx,this.ry)}return false},getClosestPointOnBorder:function(vPoint,oBoundaryRect,oParentBBox){var aPoint,aClosestPoint,oRect,oSegment;if(vPoint){aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint);if(oBoundaryRect){oRect=oBoundaryRect}else{oRect=this.getBBox()}if(oParentBBox){oRect=oRect.clone();oRect.moveBy(oParentBBox.x-oRect.x,oParentBBox.y-oRect.y)}aClosestPoint=oRect.getClosestPointOnBorder(aPoint);if(!sap.galilei.ui.common.geometry.isPointInRoundedRectangle(aClosestPoint,oRect,this.rx,this.ry)){oSegment=new sap.galilei.ui.common.Segment(aClosestPoint,oRect.getCenter());aClosestPoint=sap.galilei.ui.common.geometry.intersectSegmentRoundedRectangle(oSegment,oRect,this.rx,this.ry)}}return aClosestPoint}}});
"use strict";sap.galilei.ui.common.shape.Separator=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Separator",parent:sap.galilei.ui.common.shape.Line,shapeName:"Separator",shapeCategory:"Standard",properties:{orientation:{field:"_orientation",value:sap.galilei.ui.common.Orientation.horizontal,get:function(){return this._orientation},set:function(value){if(this._orientation!==value){this._orientation=value;if(this._orientation===sap.galilei.ui.common.Orientation.horizontal){this._y2=this._y1}else{if(this._orientation===sap.galilei.ui.common.Orientation.vertical){this._x2=this._x1}}}}}}});
"use strict";sap.galilei.ui.common.shape.Stack=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Stack",shapeName:"Stack",shapeCategory:"Internal",properties:{isComposite:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.COMPOSITE,value:sap.galilei.ui.common.shape.ShapeStates.COMPOSITE,writable:false,configurable:false},isTransparent:{type:sap.galilei.core.EnumPropertyType.bitwiseEnum,field:sap.galilei.core.internal.FIELDNAME_PREFIX+"states",mask:sap.galilei.ui.common.shape.ShapeStates.TRANSPARENT,value:sap.galilei.ui.common.shape.ShapeStates.TRANSPARENT,writable:false,configurable:false},isSupportStroke:false,isSupportFill:false,x:{field:"_x",value:0,get:function(){return this._x},set:function(nValue){this._x=sap.galilei.core.validateNumeric(nValue,this._x)}},y:{field:"_y",value:0,get:function(){return this._y},set:function(nValue){this._y=sap.galilei.core.validateNumeric(nValue,this._y)}},width:{field:"_width",value:0,get:function(){return this._width},set:function(nValue){this._width=sap.galilei.core.validateNumeric(nValue,this._width)}},height:{field:"_height",value:0,get:function(){return this._height},set:function(nValue){this._height=sap.galilei.core.validateNumeric(nValue,this._height)}},orientation:sap.galilei.ui.common.Orientation.vertical,innerPadding:{field:"_innerPadding",value:2,get:function(){return this._innerPadding},set:function(nValue){this._innerPadding=sap.galilei.core.validateNumeric(nValue,this._innerPadding)}},innerAlignment:undefined,contentPosition:undefined,contentSize:undefined,contentLayoutRect:{field:"_contentLayoutRect",get:function(){return this._contentLayoutRect}},contentMarginTop:undefined,contentMarginBottom:undefined,contentMarginLeft:undefined,contentMarginRight:undefined,contentMargin:{get:function(){if((this.contentMarginLeft===this.contentMarginTop)&&(this.contentMarginBottom===this.contentMarginRight)&&(this.contentMarginLeft===this.contentMarginRight)){return this.contentMarginLeft}},set:function(margin){this.contentMarginLeft=this.contentMarginTop=this.contentMarginBottom=this.contentMarginRight=margin}}},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){var d3Parent;if(oViewer){if(!d3ParentNode){d3Parent=oViewer.d3MainShapeLayer}else{d3Parent=d3ParentNode}}var index,shape;for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];shape.draw(oViewer,d3Parent,oTransitionDef)}return d3ParentNode},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,index,shape;if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];shape.updateDrawing(oViewer,oTransitionDef,aAttributes)}return this.d3Node},layout:function(oLayoutRect,bUpdateShape){var oOutputLayoutRect=new sap.galilei.ui.common.Rect(),x,y,width,height,bCompleteLayoutRect=false,left,top,right,bottom,paddingLeft,paddingTop,paddingRight,paddingBottom,innerPadding,innerWidth,innerHeight,x0,y0,index,oShape,oRect,oChildRect,maxInnerWidth=0,maxInnerHeight=0,totalWidth=0,totalHeight=0,shapeX,shapeY,shapeWidth,shapeHeight,length,minWidth,minHeight,maxWidth,maxHeight,usedWidth,usedHeight;if(oLayoutRect){x=oLayoutRect.x;y=oLayoutRect.y;if(x===undefined){x=this.x}if(y===undefined){y=this.y}if(oLayoutRect.width!=undefined&&oLayoutRect.width!=0){width=oLayoutRect.width}if(oLayoutRect.height!=undefined&&oLayoutRect.height!=0){height=oLayoutRect.height}if(x!==undefined&&y!==undefined&&width!==undefined&&height!==undefined){bCompleteLayoutRect=true}}else{x=this.x;y=this.y}x=sap.galilei.core.validateNumeric(x,0);y=sap.galilei.core.validateNumeric(y,0);width=sap.galilei.core.validateNumeric(width);height=sap.galilei.core.validateNumeric(height);oOutputLayoutRect.set(x,y,width,height);if(bUpdateShape&&!this.layoutRect){this.layoutRect=oOutputLayoutRect.clone()}left=x;top=y;right=x;bottom=y;paddingLeft=this.paddingLeft;paddingTop=this.paddingTop;paddingRight=this.paddingRight;paddingBottom=this.paddingBottom;innerPadding=this.innerPadding;innerWidth=width;innerHeight=height;oChildRect=new sap.galilei.ui.common.Rect();length=this.shapes.length;paddingLeft=sap.galilei.core.validateNumeric(paddingLeft,0);paddingTop=sap.galilei.core.validateNumeric(paddingTop,0);paddingRight=sap.galilei.core.validateNumeric(paddingRight,0);paddingBottom=sap.galilei.core.validateNumeric(paddingBottom,0);innerPadding=sap.galilei.core.validateNumeric(innerPadding,0);minWidth=sap.galilei.core.validateNumeric(this.minWidth,0);minHeight=sap.galilei.core.validateNumeric(this.minHeight,0);maxWidth=sap.galilei.core.validateNumeric(this.maxWidth,0);maxHeight=sap.galilei.core.validateNumeric(this.maxHeight,0);left+=paddingLeft;top+=paddingTop;if(width!==undefined&&width!==0){innerWidth=width-paddingLeft-paddingRight;right=left+innerWidth}if(height!==undefined&&height!==0){innerHeight=height-paddingTop-paddingBottom;bottom=top+innerHeight}x0=left;y0=top;for(index=0;index<length;++index){oShape=this.shapes[index];shapeX=oShape.x;shapeY=oShape.y;if(shapeX===undefined){shapeX=0}if(shapeY===undefined){shapeY=0}if(!bUpdateShape){oChildRect.set(shapeX,shapeY,width,height);oRect=oShape.layout(oChildRect,false)}else{if(this.layoutRect&&(this.layoutRect.width!==width||this.layoutRect.height!==height)){oChildRect.set(shapeX,shapeY,innerWidth!==undefined?innerWidth-oShape.marginRight:undefined,innerHeight!==undefined?innerHeight-oShape.marginBottom:undefined);oRect=oShape.layout(oChildRect,false)}else{if(!oShape.layoutRect){oShape.layoutRect=oShape.getBBox().clone()}oRect=oShape.layoutRect}}if(!(oShape instanceof sap.galilei.ui.common.shape.Separator)){if(this.orientation===sap.galilei.ui.common.Orientation.vertical){maxInnerWidth=Math.max(maxInnerWidth,oRect.width)}else{maxInnerHeight=Math.max(maxInnerHeight,oRect.height)}}}for(index=0;index<length;++index){oShape=this.shapes[index];oRect=undefined;shapeX=oShape.x;shapeY=oShape.y;if(this.orientation===sap.galilei.ui.common.Orientation.vertical){if(!oShape.isComposite){shapeY=y0+oShape.marginTop}}else{if(!oShape.isComposite){shapeX=x0+oShape.marginLeft}}shapeWidth=oShape.width;shapeHeight=oShape.height;if(shapeX===undefined){shapeX=0}if(shapeY===undefined){shapeY=0}if(shapeWidth===undefined){shapeWidth=0}if(shapeHeight===undefined){shapeHeight=0}if(!bUpdateShape){oRect=oShape.layoutRect}else{if(this.orientation===sap.galilei.ui.common.Orientation.vertical){usedHeight=undefined;oChildRect.set(shapeX,shapeY,maxInnerWidth,usedHeight)}else{usedWidth=undefined;oChildRect.set(shapeX,shapeY,usedWidth,maxInnerHeight)}oRect=oShape.layout(oChildRect,true)}if(!(oShape instanceof sap.galilei.ui.common.shape.Separator)){oRect.inflate(oShape.marginLeft,oShape.marginTop,oShape.marginRight,oShape.marginBottom)}if(this.orientation===sap.galilei.ui.common.Orientation.vertical){if(oShape.isComposite){shapeY=y0+oShape.marginTop}y0+=oRect.height;totalHeight+=oRect.height;if(oShape instanceof sap.galilei.ui.common.shape.Separator){y0+=paddingTop;if(index<length-1){totalHeight+=paddingTop}}else{if(index<length-1&&(this.shapes[index+1] instanceof sap.galilei.ui.common.shape.Separator)){y0+=paddingBottom;if(index<length-1){totalHeight+=paddingBottom}}else{y0+=innerPadding;if(index<length-1){totalHeight+=innerPadding}}}}else{if(oShape.isComposite){shapeX=x0+oShape.marginLeft}x0+=oRect.width;totalWidth+=oRect.width;if(oShape instanceof sap.galilei.ui.common.shape.Separator){x0+=paddingLeft;if(index<length-1){totalWidth+=paddingLeft}}else{if(index<length-1&&(this.shapes[index+1] instanceof sap.galilei.ui.common.shape.Separator)){x0+=paddingRight;if(index<length-1){totalWidth+=paddingRight}}else{x0+=innerPadding;if(index<length-1){totalWidth+=innerPadding}}}}if(bUpdateShape){oShape.moveTo(shapeX,shapeY);if(this.orientation===sap.galilei.ui.common.Orientation.vertical){if(bottom!==undefined){if(shapeY>bottom-oShape.marginBottom){oShape.isVisible=false}else{if(shapeY+oShape.height>bottom-oShape.marginBottom){oRect.height=bottom-oShape.marginBottom-shapeY;oShape.height=oRect.height;oShape.layoutRect.height=oRect.height}}}}else{if(right!==undefined){if(shapeX>right-oShape.marginRight){oShape.isVisible=false}else{if(shapeX+oShape.width>right-oShape.marginRight){oRect.width=right-oShape.marginRight-shapeX;oShape.width=oRect.width;oShape.layoutRect.width=oRect.width}}}}}if(this.orientation===sap.galilei.ui.common.Orientation.vertical){totalWidth=Math.max(totalWidth,oRect.width)}else{totalHeight=Math.max(totalHeight,oRect.height)}}if(innerWidth===undefined||innerWidth===0){innerWidth=totalWidth}if(innerHeight===undefined||innerHeight===0){innerHeight=totalHeight}if(minWidth>0&&innerWidth<minWidth){innerWidth=minWidth}if(minHeight>0&&innerHeight<minHeight){innerHeight=minHeight}if(maxWidth>0&&innerWidth>maxWidth){innerWidth=maxWidth}if(maxHeight>0&&innerHeight>maxHeight){innerHeight=maxHeight}right=left+innerWidth;bottom=top+innerHeight;if(bUpdateShape){var nAdjust=0,nAdjustSize=0,offset=0,dSize=0,contentX,contentY,contentWidth,contentHeight,contentMarginLeft,contentMarginTop,contentMarginRight,contentMarginBottom,contentSize,bHasContent=this.contentPosition!==undefined,contentPosition=this.contentPosition>length?length:this.contentPosition,oPreviousShape,oNextShape;if(bHasContent){contentMarginLeft=sap.galilei.core.validateNumeric(this.contentMarginLeft,0);contentMarginTop=sap.galilei.core.validateNumeric(this.contentMarginTop,0);contentMarginRight=sap.galilei.core.validateNumeric(this.contentMarginRight,0);contentMarginBottom=sap.galilei.core.validateNumeric(this.contentMarginBottom,0);contentSize=sap.galilei.core.validateNumeric(this.contentSize,1);if(contentPosition<length){oNextShape=this.shapes[contentPosition]}if(contentPosition>=1&&contentPosition-1<length){oPreviousShape=this.shapes[contentPosition-1]}}if(this.orientation===sap.galilei.ui.common.Orientation.vertical){for(index=0;index<length;++index){oShape=this.shapes[index];shapeX=oShape.x;shapeY=oShape.y;if(shapeX===undefined){shapeX=0}if(shapeY===undefined){shapeY=0}shapeWidth=oShape.layoutRect.width;if(shapeWidth!==undefined&&shapeWidth>innerWidth-oShape.marginLeft-oShape.marginRight){shapeWidth=innerWidth-oShape.marginLeft-oShape.marginRight;if(shapeWidth<0){shapeWidth=0}}if(oShape instanceof sap.galilei.ui.common.shape.Image&&oShape.useReference===true){shapeWidth=oShape.width}if(oShape instanceof sap.galilei.ui.common.shape.Separator){shapeX=x;shapeWidth=width}else{switch(oShape.horizontalAlignment){case sap.galilei.ui.common.HorizontalAlignment.right:shapeX=right-shapeWidth-oShape.marginRight;break;case sap.galilei.ui.common.HorizontalAlignment.center:shapeX=left+Math.round((innerWidth-shapeWidth)/2);break;case sap.galilei.ui.common.HorizontalAlignment.width:shapeX=left+oShape.marginLeft;shapeWidth=innerWidth-oShape.marginLeft-oShape.marginRight;break;case sap.galilei.ui.common.HorizontalAlignment.left:default:shapeX=left+oShape.marginLeft;break}}oShape.moveTo(shapeX,shapeY);if(shapeWidth!==undefined){oShape.width=shapeWidth;oShape.layoutRect.width=shapeWidth}if(oShape.verticalAlignment===sap.galilei.ui.common.VerticalAlignment.height&&oShape.layoutRect.height!==0){++nAdjust;nAdjustSize+=oShape.layoutRect.height}}if(bHasContent){contentX=left+contentMarginLeft;contentWidth=innerWidth-contentMarginLeft-contentMarginRight;contentHeight=contentSize;nAdjust++;nAdjustSize+=contentSize;totalHeight+=contentSize;if(oNextShape){totalHeight+=(oNextShape instanceof sap.galilei.ui.common.shape.Separator)?paddingBottom:innerPadding}}if(innerHeight!==totalHeight||bHasContent){if(nAdjust===0&&innerHeight>totalHeight){switch(this.innerAlignment){case sap.galilei.ui.common.VerticalAlignment.bottom:offset=innerHeight-totalHeight;break;case sap.galilei.ui.common.VerticalAlignment.middle:offset=Math.floor((innerHeight-totalHeight)/2);break;case sap.galilei.ui.common.VerticalAlignment.height:offset=Math.floor((innerHeight-totalHeight)/(length+1));dSize=offset;break;case sap.galilei.ui.common.VerticalAlignment.top:default:offset=0;break}}if(offset>0||nAdjust>0){for(index=0;index<length;++index){oShape=this.shapes[index];shapeX=oShape.x;shapeY=oShape.y;if(nAdjust===0){shapeY+=offset;offset+=dSize}else{shapeY+=offset;if(oShape.verticalAlignment===sap.galilei.ui.common.VerticalAlignment.height){dSize=Math.floor((innerHeight-totalHeight)*oShape.layoutRect.height/nAdjustSize);oShape.height+=dSize;oShape.layoutRect.height+=dSize;offset+=dSize}}oShape.moveTo(shapeX,shapeY)}if(bHasContent){if(oNextShape){contentY=oNextShape.y-oNextShape.marginTop+contentMarginTop}else{if(oPreviousShape){contentY=oPreviousShape.y+oPreviousShape.height+oPreviousShape.marginBottom+innerPadding+contentMarginTop}else{contentY=top+contentMarginTop}}contentHeight+=Math.floor((innerHeight-totalHeight)*contentSize/nAdjustSize)-contentMarginTop-contentMarginBottom;if(contentHeight<0){contentHeight=0}offset=contentHeight+contentMarginTop+contentMarginBottom;if(oNextShape){offset+=oNextShape instanceof sap.galilei.ui.common.shape.Separator?paddingBottom:innerPadding}for(index=contentPosition;index<length;index++){oShape=this.shapes[index];oShape.moveBy(0,offset)}this._contentLayoutRect=new sap.galilei.ui.common.Rect(contentX,contentY,contentWidth,contentHeight)}}}}else{for(index=0;index<length;++index){oShape=this.shapes[index];shapeX=oShape.x;shapeY=oShape.y;if(shapeX===undefined){shapeX=0}if(shapeY===undefined){shapeY=0}shapeHeight=oShape.layoutRect.height;if(shapeHeight>innerHeight-oShape.marginTop-oShape.marginBottom){shapeHeight=innerHeight-oShape.marginTop-oShape.marginBottom;if(shapeHeight<0){shapeHeight=0}}if(oShape instanceof sap.galilei.ui.common.shape.Image&&oShape.useReference===true){shapeHeight=oShape.height}if(oShape instanceof sap.galilei.ui.common.shape.Separator){shapeY=y;shapeHeight=height}else{switch(oShape.verticalAlignment){case sap.galilei.ui.common.VerticalAlignment.bottom:shapeY=bottom-shapeHeight-oShape.marginBottom;break;case sap.galilei.ui.common.VerticalAlignment.middle:shapeY=top+Math.round((innerHeight-shapeHeight)/2);break;case sap.galilei.ui.common.VerticalAlignment.height:shapeY=top+oShape.marginTop;shapeHeight=innerHeight-oShape.marginTop-oShape.marginBottom;break;case sap.galilei.ui.common.VerticalAlignment.top:default:shapeY=top+oShape.marginTop;break}}oShape.moveTo(shapeX,shapeY);if(shapeHeight!==undefined){oShape.height=shapeHeight;oShape.layoutRect.height=shapeHeight}if(oShape.horizontalAlignment===sap.galilei.ui.common.HorizontalAlignment.width&&oShape.layoutRect.width!==0){++nAdjust;nAdjustSize+=oShape.layoutRect.width}}if(bHasContent){contentY=top+contentMarginTop;contentHeight=innerHeight-contentMarginTop-contentMarginBottom;contentWidth=contentSize;nAdjust++;nAdjustSize+=contentSize;totalWidth+=contentSize;if(oNextShape){totalWidth+=(oNextShape instanceof sap.galilei.ui.common.shape.Separator)?paddingRight:innerPadding}}if(innerWidth!==totalWidth||bHasContent){if(nAdjust===0&&innerWidth>totalWidth){switch(this.innerAlignment){case sap.galilei.ui.common.HorizontalAlignment.right:offset=innerWidth-totalWidth;break;case sap.galilei.ui.common.HorizontalAlignment.center:offset=Math.floor((innerWidth-totalWidth)/2);break;case sap.galilei.ui.common.HorizontalAlignment.width:offset=Math.floor((innerWidth-totalWidth)/(length+1));dSize=offset;break;case sap.galilei.ui.common.HorizontalAlignment.left:default:offset=0;break}}if(offset>0||nAdjust>0){for(index=0;index<length;++index){oShape=this.shapes[index];shapeX=oShape.x;shapeY=oShape.y;if(nAdjust===0){shapeX+=offset;offset+=dSize}else{shapeX+=offset;if(oShape.horizontalAlignment===sap.galilei.ui.common.HorizontalAlignment.width){dSize=Math.floor((innerWidth-totalWidth)*oShape.layoutRect.width/nAdjustSize);oShape.width+=dSize;oShape.layoutRect.width+=dSize;offset+=dSize}}oShape.moveTo(shapeX,shapeY)}if(bHasContent){if(oNextShape){contentX=oNextShape.x-oNextShape.marginLeft+contentMarginLeft}else{if(oPreviousShape){contentX=oPreviousShape.x+oPreviousShape.width+oPreviousShape.marginRight+innerPadding+contentMarginLeft}else{contentX=left+contentMarginLeft}}contentWidth+=Math.floor((innerWidth-totalWidth)*contentSize/nAdjustSize)-contentMarginLeft-contentMarginRight;if(contentWidth<0){contentWidth=0}offset=contentWidth+contentMarginLeft+contentMarginRight;if(oNextShape){offset+=oNextShape instanceof sap.galilei.ui.common.shape.Separator?paddingRight:innerPadding}for(index=contentPosition;index<length;index++){oShape=this.shapes[index];oShape.moveBy(offset,0)}this._contentLayoutRect=new sap.galilei.ui.common.Rect(contentX,contentY,contentWidth,contentHeight)}}}}}oOutputLayoutRect.width=innerWidth+paddingLeft+paddingRight;oOutputLayoutRect.height=innerHeight+paddingTop+paddingBottom;this.layoutRect=new sap.galilei.ui.common.Rect(oOutputLayoutRect);return oOutputLayoutRect}}});
"use strict";sap.galilei.ui.common.shape.Text=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Text",shapeName:"Text",shapeCategory:"Standard",statics:{propertiesMap:{dx:"dx",dy:"dy"}},properties:{x:{field:"_x",value:0,get:function(){return this._x},set:function(nValue){this._x=sap.galilei.core.validateNumeric(nValue,this._x)}},y:{field:"_y",value:0,get:function(){return this._y},set:function(nValue){this._y=sap.galilei.core.validateNumeric(nValue,this._y)}},dx:{field:"_dx",get:function(){return this._dx},set:function(nValue){this._dx=sap.galilei.core.validateNumeric(nValue,this._dx,true)}},dy:{field:"_dy",get:function(){return this._dy},set:function(nValue){this._dy=sap.galilei.core.validateNumeric(nValue,this._dy,true)}},text:{field:"_text",value:undefined,get:function(){return this._text},set:function(value){if(value!==undefined){this._text=value.toString()}else{this._text=undefined}}},font:undefined,horizontalAlignment:{expression:"sap.galilei.ui.common.HorizontalAlignment.left"},verticalAlignment:{expression:"sap.galilei.ui.common.VerticalAlignment.top"},isWordWrap:false,isEllipsis:false,cx:{field:"_cx",get:function(){return this._cx},set:function(nValue){this._cx=sap.galilei.core.validateNumeric(nValue,this._cx,true)}},cy:{field:"_cy",get:function(){return this._cy},set:function(nValue){this._cy=sap.galilei.core.validateNumeric(nValue,this._cy,true)}},textWidth:{field:"_textWidth",get:function(){return this._textWidth},set:function(nValue){this._textWidth=sap.galilei.core.validateNumeric(nValue,this._textWidth,true)}},textHeight:{field:"_textHeight",get:function(){return this._textHeight},set:function(nValue){this._textHeight=sap.galilei.core.validateNumeric(nValue,this._textHeight,true)}},cursor:"default"},methods:{draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){return this.createNode("svg:text",oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector)},updateDrawing:function(oViewer,oTransitionDef,aAttributes){var oTransition,d3Node=this.d3Node,sText=this.text===undefined?"":this.text,x=this.x,y=this.y,width=this.width,height=this.height,cx=this.cx,cy=this.cy,oPoints,oRect,matrix;if(x!==undefined){x=+x}if(y!==undefined){y=+y}if(width!==undefined){width=+width}if(height!==undefined){height=+height}if(cx!==undefined){cx=+cx}if(cy!==undefined){cy=+cy}if(oTransitionDef){oTransition=oTransitionDef.getTransition(this)}sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertToNode,aAttributes);if(this.d3Node&&sText!==undefined){if(typeof sText!=="string"){sText=sText.toString()}if(oTransition){d3Node=oTransition}if(this.angle&&this.angle!==0){if(this.textWidth!==undefined){width=this.textWidth}if(this.textHeight!==undefined){height=this.textHeight}oPoints=new sap.galilei.ui.common.Points();oPoints.points=[[x,y],[x+width,y],[x+width,y+height],[x,y+height]];matrix=new sap.galilei.ui.common.Matrix();matrix.rotate(this.angle,x,y);oPoints.matrixTransform(matrix);oRect=oPoints.getBBox();x+=x-oRect.left;y+=y-oRect.top;if(cx===undefined||cy===undefined){cx=x;cy=y}}sap.galilei.ui.common.svg.Svg.updateText(d3Node,sText,x,y,width,height,this.font,this.horizontalAlignment,this.verticalAlignment,this.isWordWrap,this.isEllipsis,this.angle,cx,cy);sap.galilei.ui.common.shape.Shape.updateDrawing(oViewer,this,oTransition,sap.galilei.ui.common.shape.Text.propertiesMap,sap.galilei.ui.common.shape.Text.convertToNode,aAttributes)}return this.d3Node},retrieveDrawing:function(oViewer,nodeSelector,aAttributes){if(nodeSelector){this.findNode(oViewer,nodeSelector)}sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Shape.propertiesMap,sap.galilei.ui.common.shape.Shape.convertFromNode,aAttributes);if(this.d3Node){var svgText=this.d3Node.node(),n,node,text="",x,y,width,height;if(svgText){for(n=0;n<svgText.childNodes.length;n++){node=svgText.childNodes[n];if(n===0){text=node.textContent}else{text+="\r\n"+node.textContent}}this.text=text;x=svgText.getAttribute("x");y=svgText.getAttribute("y");width=svgText.getAttribute("g:width");height=svgText.getAttribute("g:height");if(x!==undefined){this.x=x}if(y!==undefined){this.y=y}if(width!==undefined){this.width=width;this.textWidth=width}if(height!==undefined){this.height=height;this.textHeight=height}}sap.galilei.ui.common.shape.Shape.retrieveDrawing(oViewer,this,this.d3Node,sap.galilei.ui.common.shape.Text.propertiesMap,sap.galilei.ui.common.shape.Text.convertFromNode,aAttributes)}return this.d3Node},layout:function(oLayoutRect,bUpdateShape){var oOutputLayoutRect=new sap.galilei.ui.common.Rect(),oTextLayoutRect,sText=this.text,x=this.x,y=this.y,width=this.width,height=this.height,oLayout,oPoints,oMatrix,oRect,cx,cy;if(x!==undefined){x=+x}if(y!==undefined){y=+y}if(width!==undefined){width=+width}if(height!==undefined){height=+height}if(oLayoutRect!==undefined){x=sap.galilei.core.validateNumeric(oLayoutRect.x,x);y=sap.galilei.core.validateNumeric(oLayoutRect.y,y);width=sap.galilei.core.validateNumeric(oLayoutRect.width,width);height=sap.galilei.core.validateNumeric(oLayoutRect.height,height)}if(this.angle&&this.angle!==0){if(x!==undefined&&y!==undefined){if(width===undefined){width=100000}if(height===undefined){height=100000}cx=x;cy=y;oMatrix=new sap.galilei.ui.common.Matrix();oMatrix.rotate(-this.angle,cx,cy);oPoints=new sap.galilei.ui.common.Points();oPoints.points=[[x,y],[x+width,y],[x+width,y+height],[x,y+height]];oPoints.matrixTransform(oMatrix);oRect=oPoints.getBBox();width=oRect.width;height=oRect.height}else{if(this.textWidth!==undefined){width=this.textWidth}if(this.textHeight!==undefined){height=this.textHeight}}}if(sText&&(typeof sText!=="string")){sText=sText.toString()}oTextLayoutRect=sap.galilei.ui.common.Text.layoutText(sText,width,height,this.horizontalAlignment,this.verticalAlignment,this.isWordWrap,this.isEllipsis,this.font);oOutputLayoutRect.width=oTextLayoutRect.totalWidth;oOutputLayoutRect.height=oTextLayoutRect.totalHeight;if(this.angle&&this.angle!==0&&oMatrix){oMatrix.inverse();oPoints.points=[[oOutputLayoutRect.left,oOutputLayoutRect.top],[oOutputLayoutRect.left+oOutputLayoutRect.width,oOutputLayoutRect.top],[oOutputLayoutRect.left+oOutputLayoutRect.width,oOutputLayoutRect.top+oOutputLayoutRect.height],[oOutputLayoutRect.left,oOutputLayoutRect.top+oOutputLayoutRect.height]];oPoints.matrixTransform(oMatrix);oOutputLayoutRect=oPoints.getBBox()}if(oLayoutRect){oOutputLayoutRect.x=oLayoutRect.x;oOutputLayoutRect.y=oLayoutRect.y}else{oOutputLayoutRect.x=x;oOutputLayoutRect.y=y}this.layoutRect=oOutputLayoutRect;this.textWidth=oTextLayoutRect.totalWidth;this.textHeight=oTextLayoutRect.totalHeight;if(bUpdateShape){this.width=oOutputLayoutRect.width;this.height=oOutputLayoutRect.height}return oOutputLayoutRect}}});
namespace("sap.galilei.ui.common.shape.basic");
"use strict";sap.galilei.ui.common.shape.CalloutDirection={left:"left",top:"top",right:"right",bottom:"bottom"};sap.galilei.ui.common.shape.Callout=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Callout",parent:sap.galilei.ui.common.shape.Path,shapeName:"Callout",shapeCategory:"Basic",properties:{rx:{field:"_rx",get:function(){if(this._rx!==undefined){if(this._rx===this._ry){return this.checkR(this._rx,this._ry)}return this.checkRx(this._rx)}if(this._ry===undefined){return this.getDefaultR()}return this.getDefaultRx()},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue,this._rx,true);nValue=this.checkRx(nValue);this._rx=nValue}},ry:{field:"_ry",get:function(){if(this._ry!==undefined){if(this._rx===this._ry){return this.checkR(this._rx,this._ry)}return this.checkRy(this._ry)}if(this._rx===undefined){return this.getDefaultR()}return this.getDefaultRy()},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue,this._ry,true);nValue=this.checkRy(nValue);this._ry=nValue}},r:{get:function(){var rx=this.rx,ry=this.ry;if(rx!==undefined&&ry!==undefined&&!isNaN(rx)&&!isNaN(ry)){return Math.min(rx,ry)}return rx!==undefined?rx:ry},set:function(nValue){nValue=sap.galilei.core.validateNumeric(nValue);this.rx=nValue;this.ry=nValue}},arrowLength:undefined,arrowWidth:undefined,arrowBaseOffset:0,arrowOffset:0,arrowDirection:sap.galilei.ui.common.shape.CalloutDirection.bottom,strokeLineJoin:sap.galilei.ui.common.LineJoin.round,isEnableTransform:false,paddingLeft:{field:"_paddingLeft",value:0,get:function(){if(this._paddingLeft!==0){return this._paddingLeft}var rx2=Math.round(this.rx/2);return Math.max(rx2,sap.galilei.ui.common.shape.Shape.DEFAULT_CONTENT_PADDING)},set:function(nValue){this._paddingLeft=sap.galilei.core.validateNumeric(nValue,this._paddingLeft)}},paddingTop:{field:"_paddingTop",value:0,get:function(){if(this._paddingTop!==0){return this._paddingTop}var ry2=Math.round(this.ry/2);return Math.max(ry2,sap.galilei.ui.common.shape.Shape.DEFAULT_CONTENT_PADDING)},set:function(nValue){this._paddingTop=sap.galilei.core.validateNumeric(nValue,this._paddingTop)}},paddingRight:{field:"_paddingRight",value:0,get:function(){if(this._paddingRight!==0){return this._paddingRight}var rx2=Math.round(this.rx/2);return Math.max(rx2,sap.galilei.ui.common.shape.Shape.DEFAULT_CONTENT_PADDING)},set:function(nValue){this._paddingRight=sap.galilei.core.validateNumeric(nValue,this._paddingRight)}},paddingBottom:{field:"_paddingBottom",value:0,get:function(){if(this._paddingBottom!==0){return this._paddingBottom}var ry2=Math.round(this.ry/2);return Math.max(ry2,sap.galilei.ui.common.shape.Shape.DEFAULT_CONTENT_PADDING)},set:function(nValue){this._paddingBottom=sap.galilei.core.validateNumeric(nValue,this._paddingBottom)}}},methods:{checkRx:function(rx){if(rx!==undefined&&!isNaN(rx)){rx=+rx;if(rx<0){rx=0}if(this.width!==undefined&&this.width!==0&&!isNaN(this.width)&&rx>this.width/2){rx=Math.floor(this.width/2)}}else{rx=undefined}return rx},checkRy:function(ry){if(ry!==undefined&&!isNaN(ry)){ry=+ry;if(ry<0){ry=0}if(this.height!==undefined&&this.height!==0&&!isNaN(this.height)&&ry>this.height/2){ry=Math.floor(this.height/2)}}else{ry=undefined}return ry},checkR:function(rx,ry){rx=this.checkRx(rx);ry=this.checkRy(ry);if(rx!==undefined&&ry!==undefined){return Math.min(rx,ry)}return undefined},getDefaultRx:function(){var rx=this._rx,ry=this._ry;if(rx===undefined&&ry===undefined){rx=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleR(this.width,this.height)}else{if(rx===undefined){rx=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRx(this.width)}}return rx},getDefaultRy:function(){var rx=this._rx,ry=this._ry;if(rx===undefined&&ry===undefined){ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleR(this.width,this.height)}else{if(ry===undefined){ry=sap.galilei.ui.common.geometry.getDefaultRoundedRectangleRy(this.height)}}return ry},getDefaultR:function(){var rx=this.getDefaultRx(),ry=this.getDefaultRy();if(rx!==undefined&&ry!==undefined){return Math.min(rx,ry)}return undefined},generatePath:function(){var x=this.x,y=this.y,width=this.width,height=this.height,rx=this.rx,ry=this.ry,nArrowLength=this.arrowLength,nArrowWidth=this.arrowWidth,nArrowBaseOffset=this.arrowBaseOffset,nArrowOffset=this.arrowOffset,x2,y2,aPoint1,aPoint2,aPoint3,xA,xB,xC,yA,yB,yC,sPath;if(x!==undefined&&y!==undefined&&width!==undefined&&height!==undefined&&rx!==undefined&&ry!==undefined){if(nArrowLength===undefined){if(this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.top||this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.bottom){nArrowLength=height/3;if(nArrowLength>16){nArrowLength=16}}else{nArrowLength=width/3;if(nArrowLength>16){nArrowLength=16}}}if(this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.top||this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.bottom){height=height-nArrowLength;if(this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.top){y+=nArrowLength}}else{width=width-nArrowLength;if(this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.left){x+=nArrowLength}}if(nArrowWidth===undefined){if(this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.top||this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.bottom){nArrowWidth=width/4}else{nArrowWidth=height/4}}if(nArrowWidth>16){nArrowWidth=16}x2=x+width;y2=y+height;if(this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.top||this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.bottom){xA=(x+width/2)+nArrowBaseOffset-nArrowWidth/2;if(xA<x+rx){nArrowBaseOffset+=(x+rx)-xA;xA=x+rx}xB=(x+width/2)+nArrowBaseOffset+nArrowWidth/2;if(xB>x2-rx){nArrowBaseOffset-=xB-(x2-rx);xB=x2-rx}xC=(x+width/2)+nArrowOffset}else{yA=(y+height/2)+nArrowBaseOffset-nArrowWidth/2;if(yA<y+ry){nArrowBaseOffset+=(y+ry)-yA;yA=y+ry}yB=(y+height/2)+nArrowBaseOffset+nArrowWidth/2;if(yB>y2-ry){nArrowBaseOffset-=yB-(y2-ry);yB=x2-rx}yC=(y+height/2)+nArrowOffset}sPath="M"+sap.galilei.ui.common.Path.generatePoint([x+rx,y]);if(this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.top){sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([xA,y]);sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([xC,y-nArrowLength]);sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([xB,y])}sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([x2-rx,y]);sPath+=" Q"+sap.galilei.ui.common.Path.generatePoint([x2,y])+" "+sap.galilei.ui.common.Path.generatePoint([x2,y+ry]);if(this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.right){sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([x2,yA]);sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([x2+nArrowLength,yC]);sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([x2,yB])}sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([x2,y2-ry]);sPath+=" Q"+sap.galilei.ui.common.Path.generatePoint([x2,y2])+" "+sap.galilei.ui.common.Path.generatePoint([x2-rx,y2]);if(this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.bottom){sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([xB,y2]);sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([xC,y2+nArrowLength]);sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([xA,y2])}sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([x+rx,y2]);sPath+=" Q"+sap.galilei.ui.common.Path.generatePoint([x,y2])+" "+sap.galilei.ui.common.Path.generatePoint([x,y2-ry]);if(this.arrowDirection===sap.galilei.ui.common.shape.CalloutDirection.left){sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([x,yB]);sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([x-nArrowLength,yC]);sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([x,yA])}sPath+=" L"+sap.galilei.ui.common.Path.generatePoint([x,y+ry]);sPath+=" Q"+sap.galilei.ui.common.Path.generatePoint([x,y])+" "+sap.galilei.ui.common.Path.generatePoint([x+rx,y]);sPath+=" Z"}return sPath}}});
"use strict";sap.galilei.ui.common.shape.Package=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Package",parent:sap.galilei.ui.common.shape.Path,shapeName:"Package",shapeCategory:"Basic",properties:{isEnableTransform:false},methods:{generatePath:function(){var sRect,aPoint,sPath,dx,dy;if(this.x!==undefined&&this.y!==undefined&&this.width!==undefined&&this.height!==undefined){sRect=new sap.galilei.ui.common.Rect(this.x,this.y,this.width,this.height);dx=this.width*0.4;dy=10;aPoint=sRect.getPoint(sap.galilei.ui.common.DockPosition.topLeft);sPath="M"+sap.galilei.ui.common.Path.generatePoint(aPoint);aPoint[0]+=dx;sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(aPoint);aPoint[1]+=dy;sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(aPoint);aPoint=sRect.getPoint(sap.galilei.ui.common.DockPosition.topRight);aPoint[1]+=dy;sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(aPoint);sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(sRect.getPoint(sap.galilei.ui.common.DockPosition.bottomRight));sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(sRect.getPoint(sap.galilei.ui.common.DockPosition.bottomLeft));aPoint=sRect.getPoint(sap.galilei.ui.common.DockPosition.topLeft);sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(aPoint)+" Z";aPoint[1]+=dy;sPath+=" M"+sap.galilei.ui.common.Path.generatePoint(aPoint);aPoint[0]+=dx;sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(aPoint)}return sPath}}});
"use strict";sap.galilei.ui.common.shape.Process=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.shape.Process",parent:sap.galilei.ui.common.shape.Path,shapeName:"Process",shapeCategory:"Basic",properties:{arrowLengthPercent:0.288675,isFlatTail:false,isFlatNose:false,strokeLineJoin:sap.galilei.ui.common.LineJoin.round,isEnableTransform:false},methods:{generatePath:function(){var sRect,aPoint,sPath,nLength;if(this.x!==undefined&&this.y!==undefined&&this.width!==undefined&&this.height!==undefined){sRect=new sap.galilei.ui.common.Rect(this.x,this.y,this.width,this.height);if(this.arrowLengthPercent!==undefined){nLength=this.arrowLengthPercent*this.height;if(nLength>this.width){nLength=this.width}}else{nLength=this.height/2}sPath="M"+sap.galilei.ui.common.Path.generatePoint(sRect.getPoint(sap.galilei.ui.common.DockPosition.topLeft));aPoint=sRect.getPoint(sap.galilei.ui.common.DockPosition.topRight);if(!this.isFlatNose){aPoint[0]-=nLength}sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(aPoint);if(!this.isFlatNose){sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(sRect.getPoint(sap.galilei.ui.common.DockPosition.right))}aPoint=sRect.getPoint(sap.galilei.ui.common.DockPosition.bottomRight);if(!this.isFlatNose){aPoint[0]-=nLength}sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(aPoint);sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(sRect.getPoint(sap.galilei.ui.common.DockPosition.bottomLeft));if(!this.isFlatTail){aPoint=sRect.getPoint(sap.galilei.ui.common.DockPosition.left);aPoint[0]+=nLength;sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(aPoint)}sPath+=" L"+sap.galilei.ui.common.Path.generatePoint(sRect.getPoint(sap.galilei.ui.common.DockPosition.topLeft))+" Z"}return sPath}}});
namespace("sap.galilei.ui.common.library");
"use strict";sap.galilei.ui.common.library.defineLibrary=function(oLibraryDef){var sName=oLibraryDef.libraryName,oStatics=oLibraryDef.statics||{},oLibraryClass;if(!sName){throw'The library name "libraryName" is mandatory for defining a new library.'}if(sap.galilei.ui.common.library.LibraryManager.hasLibrary(sName)){throw'The library "'+sName+'" already exists.'}delete oLibraryDef.libraryName;if(!oStatics._markerDefinitions){oStatics._markerDefinitions={}}if(!oStatics.addMarker){oStatics.addMarker=function(sName,oMarkerDef){if(sName&&oMarkerDef){this._markerDefinitions[sName]=oMarkerDef}}}if(!oStatics.getMarkerDefinition){oStatics.getMarkerDefinition=function(sLibraryName,sName,oViewer){if(sName){var oMarkerDef=this._markerDefinitions[sName];if((typeof oMarkerDef)==="function"){oMarkerDef=oMarkerDef.call(this,sLibraryName,sName,oViewer)}return oMarkerDef}return undefined}}if(!oStatics._shapeDefinitions){oStatics._shapeDefinitions={}}if(!oStatics.addShape){oStatics.addShape=function(sName,oShapeDef){if(sName&&oShapeDef){this._shapeDefinitions[sName]=oShapeDef}}}if(!oStatics.getShapeDefinition){oStatics.getShapeDefinition=function(sLibraryName,sName,oViewer){if(sName){var oShapeDef=this._shapeDefinitions[sName];if((typeof oShapeDef)==="function"){oShapeDef=oShapeDef.call(this,sLibraryName,sName,oViewer)}return oShapeDef}return undefined}}if(!oStatics._shadowDefinitions){oStatics._shadowDefinitions={}}if(!oStatics.addShadow){oStatics.addShadow=function(sName,oShadowDef){if(sName&&oShadowDef){this._shadowDefinitions[sName]=oShadowDef}}}if(!oStatics.registerShadowFilter){oStatics.registerShadowFilter=function(sLibraryName,sName,oViewer){if(sLibraryName&&sName&&oViewer){var oShadowDef=this._shadowDefinitions[sName];if((typeof oShadowDef)==="function"){return oShadowDef.call(this,sLibraryName,sName,oViewer)}}return undefined}}oLibraryDef.statics=oStatics;oLibraryClass=sap.galilei.core.defineClass(oLibraryDef);sap.galilei.ui.common.library.LibraryManager.registerLibrary(sName,oLibraryClass);return oLibraryClass};sap.galilei.ui.common.library.LibraryManager=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.library.LibraryManager",initialize:function(oViewer){if(!oViewer){throw"The library manager must be associated with a SVG viewer."}this._viewer=oViewer},fields:{_markers:{},_shapes:{},_shadowFilters:{},_viewer:undefined},statics:{_libraries:{},registerLibrary:function(sLibraryName,oLibraryClass){if(sLibraryName&&oLibraryClass){if(oLibraryClass.onInitialize){oLibraryClass.onInitialize()}sap.galilei.ui.common.library.LibraryManager._libraries[sLibraryName]=oLibraryClass}},getLibrary:function(sLibraryName){if(sLibraryName){return sap.galilei.ui.common.library.LibraryManager._libraries[sLibraryName]}return undefined},hasLibrary:function(sLibraryName){return sap.galilei.ui.common.library.LibraryManager.getLibrary(sLibraryName)!==undefined}},methods:{registerMarker:function(sLibraryName,sName){var sId=sLibraryName+"."+sName,oDef,d3Marker,oShape,d3Shape,sProp,oLibraries=sap.galilei.ui.common.library.LibraryManager._libraries;if(this._markers.hasOwnProperty(sId)){return true}if(oLibraries[sLibraryName]){oDef=oLibraries[sLibraryName].getMarkerDefinition(sLibraryName,sName,this._viewer)}if(oDef){d3Marker=this._viewer.d3SvgDefs.append("svg:marker");d3Marker.attr("id",sId);for(sProp in oDef){if(sProp==="shapeDef"){oShape=sap.galilei.ui.common.shape.ShapeSerializer.load(oDef[sProp]);d3Shape=oShape.draw(this._viewer,d3Marker)}else{d3Marker.attr(sProp,oDef[sProp])}}if(d3Shape){this._markers[sId]={d3Node:d3Marker,url:"url(#"+sId+")"};return true}}return false},registerShape:function(sLibraryName,sName){var sId=sLibraryName+"."+sName,oDef,d3Shape,oShape,oLibraries=sap.galilei.ui.common.library.LibraryManager._libraries;if(this._shapes.hasOwnProperty(sId)){return true}if(oLibraries[sLibraryName]){oDef=oLibraries[sLibraryName].getShapeDefinition(sLibraryName,sName,this._viewer)}if(oDef){oShape=sap.galilei.ui.common.shape.ShapeSerializer.load(oDef);if(oShape){oShape.id=sId;d3Shape=oShape.draw(this._viewer,this._viewer.d3SvgDefs);this._shapes[sId]={d3Node:d3Shape,url:"#"+sId};return true}}return false},registerShadowFilter:function(sLibraryName,sName){var sId=sLibraryName+"."+sName,oLibraries=sap.galilei.ui.common.library.LibraryManager._libraries,d3Node;if(this._shadowFilters.hasOwnProperty(sId)){return true}if(oLibraries[sLibraryName]){d3Node=oLibraries[sLibraryName].registerShadowFilter(sLibraryName,sName,this._viewer);if(d3Node){this._shadowFilters[sId]={d3Node:d3Node,url:"url(#"+sId+")"};return true}}return false},getMarkerUrl:function(sId){var sLibraryName,sName,aNames;aNames=sId.split(".");if(aNames.length!==2){throw'The marker id "'+sId+'" is invalid.'}sLibraryName=aNames[0];sName=aNames[1];if(!this._markers.hasOwnProperty(sId)){if(!this.registerMarker(sLibraryName,sName)){return undefined}}return this._markers[sId]["url"]},getShapeUrl:function(sId){var sLibraryName,sName,aNames;aNames=sId.split(".");if(aNames.length!==2){throw'The shape id "'+sId+'" is invalid.'}sLibraryName=aNames[0];sName=aNames[1];if(!this._shapes.hasOwnProperty(sId)){if(!this.registerShape(sLibraryName,sName)){return undefined}}return this._shapes[sId]["url"]},getShadowFilterUrl:function(sId){var sLibraryName,sName,aNames;aNames=sId.split(".");if(aNames.length!==2){throw'The shadow filter id "'+sId+'" is invalid.'}sLibraryName=aNames[0];sName=aNames[1];if(!this._shadowFilters.hasOwnProperty(sId)){if(!this.registerShadowFilter(sLibraryName,sName)){return undefined}}return this._shadowFilters[sId]["url"]},clearCache:function(){this._markers={};this._shapes={};this._shadowFilters={};this._shadowFilters={}}}});
"use strict";sap.galilei.ui.common.library.ArrowLibrary=sap.galilei.ui.common.library.defineLibrary({fullClassName:"sap.galilei.ui.common.library.ArrowLibrary",libraryName:"Arrows",statics:{onInitialize:function(){this.addMarker("FilledEnd",{markerUnits:"userSpaceOnUse",refX:14,refY:5,markerWidth:14,markerHeight:10,orient:"auto",shapeDef:{shape:"Path",path:"M 0 0 L 14 5 L 0 10 z",fill:"black",stroke:"none"}});this.addShape("FilledMiddle",{shape:"Path",path:"M -7 -5 L 7 0 L -7 5 z",fill:"black",stroke:"none",strokeWidth:1});this.addMarker("FilledStart",{markerUnits:"userSpaceOnUse",refX:0,refY:5,markerWidth:14,markerHeight:10,orient:"auto",shapeDef:{shape:"Path",path:"M 0 5 L 14 0 L 14 10 z",fill:"black",stroke:"none"}});this.addMarker("LineEnd",{markerUnits:"userSpaceOnUse",refX:13,refY:7,markerWidth:14,markerHeight:14,orient:"auto",shapeDef:{shape:"Path",path:"M 1 1 L 13 7 L 1 13",fill:"none",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"}});this.addMarker("LineStart",{markerUnits:"userSpaceOnUse",refX:0,refY:7,markerWidth:14,markerHeight:14,orient:"auto",shapeDef:{shape:"Path",path:"M 13 1 L 1 7 L 13 13",fill:"none",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"}});this.addMarker("CircleEnd",{markerUnits:"userSpaceOnUse",refX:13,refY:7,markerWidth:14,markerHeight:14,orient:"auto",shapeDef:{shape:"Circle",r:5,cx:7,cy:7,fill:"white",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"}});this.addShape("CircleMiddle",{shape:"Circle",r:5,cx:0,cy:0,fill:"white",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"});this.addMarker("CircleStart",{markerUnits:"userSpaceOnUse",refX:0,refY:7,markerWidth:14,markerHeight:14,orient:"auto",shapeDef:{shape:"Circle",r:5,cx:7,cy:7,fill:"white",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"}});this.addMarker("WhiteFilledEnd",{markerUnits:"userSpaceOnUse",refX:13,refY:7,markerWidth:14,markerHeight:14,orient:"auto",shapeDef:{shape:"Path",path:"M 1 1 L 13 7 L 1 13 L 1 1 z",fill:"white",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"}});this.addMarker("WhiteFilledStart",{markerUnits:"userSpaceOnUse",refX:0,refY:7,markerWidth:14,markerHeight:14,orient:"auto",shapeDef:{shape:"Path",path:"M 13 1 L 1 7 L 13 13 L 13 1 z",fill:"white",strokeWidth:1,stroke:"black",strokeDashArray:"1000,1"}});this.addMarker("DiamondStart",{markerUnits:"userSpaceOnUse",refX:0,refY:5.5,markerWidth:16,markerHeight:11,orient:"auto",shapeDef:{shape:"Path",path:"M 0 5.5 L 8 0.5 L 16 5.5 L 8 10.5 z",fill:"white",stroke:"black"}});this.addMarker("SlashStart",{markerUnits:"userSpaceOnUse",refX:0,refY:5,markerWidth:16,markerHeight:10,orient:"auto",shapeDef:{shape:"Path",path:"M 3 0 L 13 10",fill:"white",stroke:"black"}})}}});
"use strict";sap.galilei.ui.common.library.IconLibrary=sap.galilei.ui.common.library.defineLibrary({fullClassName:"sap.galilei.ui.common.library.IconLibrary",libraryName:"Icons",statics:{onInitialize:function(){this.addShape("invisible-icon",function(sLibraryName,sName,oViewer){return{shape:"Rectangle",x:0,y:0,width:0,height:0,opacity:0}});this.addShape("handle-selection",function(sLibraryName,sName,oViewer){var sShadowUrl=oViewer.libraries.getShadowFilterUrl("Shapes.shadow-smallBadge");return{shape:"Badge",x:-6,y:-6,width:12,height:12,outerOffset:1,filter:sShadowUrl,innerFill:"#0099EB"}});this.addShadow("shadow-smallBadge",function(sLibraryName,sName,oViewer){if(sLibraryName&&sName&&oViewer){var sIdShadowFilter=sLibraryName+"."+sName,dropShadowFilter;dropShadowFilter=new sap.galilei.ui.common.style.DropShadow({id:sIdShadowFilter,opacity:"0.4",dx:0,dy:0});return dropShadowFilter.createDropShadow(oViewer)}return undefined})}}});
"use strict";namespace("sap.galilei.ui.common.layout");sap.galilei.ui.common.layout.getAttachBBox=function(vAttachValue){var oBBox;if(vAttachValue){if(sap.galilei.core.isInstanceOf(vAttachValue,"sap.galilei.ui.common.shape.Shape")){oBBox=vAttachValue.getBBox().clone()}else{if(sap.galilei.core.isInstanceOf(vAttachValue,"sap.galilei.ui.common.Rect")){oBBox=vAttachValue.clone()}else{if(sap.galilei.core.isInstanceOf(vAttachValue,"sap.galilei.ui.common.Point")){oBBox=new sap.galilei.ui.common.Rect(vAttachValue.x,vAttachValue.y,0,0)}else{if((vAttachValue instanceof Array)&&vAttachValue.length>=2){oBBox=new sap.galilei.ui.common.Rect(vAttachValue[0],vAttachValue[1],0,0)}}}}}return oBBox};sap.galilei.ui.common.layout.getRelativePosition=function(oOptions){var oAttachBBox,aAttachPosition,oAlignBBox,aAlignPosition,nOffsetX,nOffsetY,aAttachPoint,aAlignPoint,oRect=new sap.galilei.ui.common.Rect(),nDeltaX,nDeltaY;if(oOptions){oAttachBBox=oOptions.attachBBox;aAttachPosition=oOptions.attachPosition;oAlignBBox=oOptions.alignBBox;aAlignPosition=oOptions.alignPosition;nOffsetX=oOptions.offsetX;nOffsetY=oOptions.offsetY;if(oAttachBBox&&oAlignBBox){aAttachPosition=aAttachPosition||sap.galilei.ui.common.DockPosition.topLeft;aAlignPosition=aAlignPosition||sap.galilei.ui.common.DockPosition.bottomLeft;if(nOffsetX===undefined){nOffsetX=0}if(nOffsetY===undefined){nOffsetY=0}aAttachPoint=oAttachBBox.getPoint(aAttachPosition);aAlignPoint=oAlignBBox.getPoint(aAlignPosition);nDeltaX=aAttachPoint[0]-aAlignPoint[0]+nOffsetX;nDeltaY=aAttachPoint[1]-aAlignPoint[1]+nOffsetY;oRect=oAlignBBox.clone();oRect.moveBy(nDeltaX,nDeltaY)}}return oRect};
"use strict";sap.galilei.ui.common.layout.PointsLayout=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.layout.PointsLayout",statics:{ELBOW_DISTANCE:8,getLinkDirection:function(aStartPoint,aEndPoint){if(aStartPoint&&aEndPoint){var xDistance,yDistance;xDistance=aEndPoint[0]-aStartPoint[0];yDistance=aEndPoint[1]-aStartPoint[1];if(xDistance>=0){if(yDistance>=0){return(yDistance>=xDistance)?sap.galilei.ui.common.LinkDirection.south:sap.galilei.ui.common.LinkDirection.east}else{return(Math.abs(yDistance)>=xDistance)?sap.galilei.ui.common.LinkDirection.north:sap.galilei.ui.common.LinkDirection.east}}else{if(yDistance>=0){return(yDistance>=Math.abs(xDistance))?sap.galilei.ui.common.LinkDirection.south:sap.galilei.ui.common.LinkDirection.west}else{return(Math.abs(yDistance)>=Math.abs(xDistance))?sap.galilei.ui.common.LinkDirection.north:sap.galilei.ui.common.LinkDirection.west}}}return sap.galilei.ui.common.LinkDirection.DEFAULT},getLinkEndingDirection:function(aPoint,oRect){if(aPoint&&oRect){return oRect.getPointDirection(aPoint)}return sap.galilei.ui.common.LinkDirection.DEFAULT},routeLinkPoints:function(vPoint1,vPoint2,oRect1,oRect2,direction1,direction2){var aPoint1=sap.galilei.ui.common.Point.getPointArray(vPoint1),aPoint2=sap.galilei.ui.common.Point.getPointArray(vPoint2),oMatrix,nDegree,oTransformedRect1,oTransformedRect2,aTransformedPoint2,transformedDirection2,aRoutePoints;if(aPoint1&&aPoint1.length===2&&aPoint1[0]!==undefined&&!isNaN(aPoint1[0])&&aPoint1[1]!==undefined&&!isNaN(aPoint1[1])&&aPoint2&&aPoint2.length===2&&aPoint2[0]!==undefined&&!isNaN(aPoint2[0])&&aPoint2[1]!==undefined&&!isNaN(aPoint2[1])&&oRect1&&oRect2){nDegree=sap.galilei.ui.common.LinkDirection.degree(direction1,sap.galilei.ui.common.LinkDirection.east);oMatrix=new sap.galilei.ui.common.Matrix();oMatrix.rotate(nDegree);oMatrix.translate(-aPoint1[0],-aPoint1[1]);oTransformedRect1=oRect1.matrixTransform(oMatrix,false,true);oTransformedRect2=oRect2.matrixTransform(oMatrix,false,true);aTransformedPoint2=sap.galilei.ui.common.Point.matrixTransform(aPoint2[0],aPoint2[1],oMatrix,false);transformedDirection2=sap.galilei.ui.common.LinkDirection.rotate(direction2,nDegree);aRoutePoints=sap.galilei.ui.common.layout.PointsLayout.calculateOrthogonalLinkPoints(oTransformedRect1,oTransformedRect2,aTransformedPoint2,transformedDirection2);if(aRoutePoints&&aRoutePoints.length>0){aRoutePoints.matrixTransform(oMatrix.inverse(),false,false);aRoutePoints.splice(0,0,aPoint1);aRoutePoints.push(aPoint2);return aRoutePoints}}},calculateOrthogonalLinkPoints:function(oSourceRect,oRect,vPoint,direction){var mid,points,aPoint=sap.galilei.ui.common.Point.getPointArray(vPoint),nRouteMargin=50;if(!aPoint||aPoint.length<2||aPoint[0]===undefined||isNaN(aPoint[0]||aPoint[1]===undefined||isNaN(aPoint[1]))){return undefined}points=new sap.galilei.ui.common.Points();switch(direction){case sap.galilei.ui.common.LinkDirection.west:if(aPoint[0]<=0){if(oSourceRect.top>oRect.bottom){mid=(oSourceRect.top-oRect.bottom)*0.5;points.push([nRouteMargin,0]);points.push([nRouteMargin,oRect.bottom+mid]);points.push([aPoint[0]-nRouteMargin,oRect.bottom+mid]);points.push([aPoint[0]-nRouteMargin,aPoint[1]])}else{if(oRect.top>oSourceRect.bottom){mid=(oRect.top-oSourceRect.bottom)*0.5;points.push([nRouteMargin,0]);points.push([nRouteMargin,oSourceRect.bottom+mid]);points.push([aPoint[0]-nRouteMargin,oSourceRect.bottom+mid]);points.push([aPoint[0]-nRouteMargin,aPoint[1]])}else{points.push([nRouteMargin,0]);points.push([nRouteMargin,Math.min(oSourceRect.top,oRect.top)-nRouteMargin]);points.push([Math.min(oSourceRect.left,aPoint[0])-nRouteMargin,Math.min(oSourceRect.top,oRect.top)-nRouteMargin]);points.push([Math.min(oSourceRect.left,aPoint[0])-nRouteMargin,aPoint[1]])}}}else{if(aPoint[1]!==0){mid=oRect.left*0.5;points.push([mid,0]);points.push([mid,aPoint[1]])}}break;case sap.galilei.ui.common.LinkDirection.north:if(aPoint[1]>0){if(aPoint[0]>0){points.push([aPoint[0],0])}else{if(aPoint[1]>oSourceRect.bottom){mid=(aPoint[1]-oSourceRect.bottom)*0.5;points.push([nRouteMargin,0]);points.push([nRouteMargin,oSourceRect.bottom+mid]);points.push([aPoint[0],oSourceRect.bottom+mid])}else{points.push([nRouteMargin,0]);points.push([nRouteMargin,oSourceRect.top-nRouteMargin]);points.push([aPoint[0],oSourceRect.top-nRouteMargin])}}}else{if(oRect.left>0){mid=oRect.left*0.5;points.push([mid,0]);points.push([mid,aPoint[1]-nRouteMargin]);points.push([aPoint[0],aPoint[1]-nRouteMargin])}else{points.push([oRect.right+nRouteMargin,0]);points.push([oRect.right+nRouteMargin,Math.min(oSourceRect.top,aPoint[1])-nRouteMargin]);points.push([aPoint[0],Math.min(oSourceRect.top,aPoint[1])-nRouteMargin])}}break;case sap.galilei.ui.common.LinkDirection.east:if(aPoint[0]>=0){if(oRect.top>0||oRect.bottom<0){points.push([aPoint[0]+nRouteMargin,0]);points.push([aPoint[0]+nRouteMargin,aPoint[1]])}else{mid=oRect.left*0.5;points.push([mid,0]);if(aPoint[1]>0){points.push([mid,oRect.bottom+nRouteMargin]);points.push([aPoint[0]+nRouteMargin,oRect.bottom+nRouteMargin]);points.push([aPoint[0]+nRouteMargin,aPoint[1]])}else{points.push([mid,oRect.top-nRouteMargin]);points.push([aPoint[0]+nRouteMargin,oRect.top-nRouteMargin]);points.push([aPoint[0]+nRouteMargin,aPoint[1]])}}}else{if(aPoint[1]<oSourceRect.top||aPoint[1]>oSourceRect.bottom||oRect.right>oSourceRect.left){points.push([nRouteMargin,0]);points.push([nRouteMargin,aPoint[1]])}else{mid=(oSourceRect.left-oRect.right)*0.5;points.push([nRouteMargin,0]);points.push([nRouteMargin,oSourceRect.top-nRouteMargin]);points.push([oRect.right+mid,oSourceRect.top-nRouteMargin]);points.push([oRect.right+mid,aPoint[1]])}}break;case sap.galilei.ui.common.LinkDirection.south:if(aPoint[1]<0){if(aPoint[0]>0){points.push([aPoint[0],0])}else{if(aPoint[1]<oSourceRect.top){mid=(oSourceRect.top-aPoint[1])*0.5;points.push([nRouteMargin,0]);points.push([nRouteMargin,oSourceRect.top-mid]);points.push([aPoint[0],oSourceRect.top-mid])}else{points.push([nRouteMargin,0]);points.push([nRouteMargin,oSourceRect.bottom+nRouteMargin]);points.push([aPoint[0],oSourceRect.bottom+nRouteMargin])}}}else{if(oRect.left>0){mid=oRect.left*0.5;points.push([mid,0]);points.push([mid,aPoint[1]+nRouteMargin]);points.push([aPoint[0],aPoint[1]+nRouteMargin])}else{points.push([oRect.right+nRouteMargin,0]);points.push([oRect.right+nRouteMargin,Math.max(oSourceRect.bottom,aPoint[1])+nRouteMargin]);points.push([aPoint[0],Math.max(oSourceRect.bottom,aPoint[1])+nRouteMargin])}}break}return points},removeElbows:function(aPoints){function removeElbow(index,aPoints){var nDiff;if(index<=aPoints.length-4){if(aPoints[index+1][0]===aPoints[index+2][0]){if(Math.abs(aPoints[index+1][1]-aPoints[index+2][1])<sap.galilei.ui.common.layout.PointsLayout.ELBOW_DISTANCE&&(aPoints[index][0]-aPoints[index+1][0])*(aPoints[index+3][0]-aPoints[index+2][0])<0){nDiff=aPoints[index+3][1]-aPoints[index][1];aPoints[index][1]+=nDiff*0.5;aPoints[index+3][1]=aPoints[index][1];aPoints.splice(index+1,2);return true}}if(aPoints[index+1][1]===aPoints[index+2][1]){if(Math.abs(aPoints[index+1][0]-aPoints[index+2][0])<sap.galilei.ui.common.layout.PointsLayout.ELBOW_DISTANCE&&(aPoints[index][1]-aPoints[index+1][1])*(aPoints[index+3][1]-aPoints[index+2][1])<0){nDiff=aPoints[index+3][0]-aPoints[index][0];aPoints[index][0]+=nDiff*0.5;aPoints[index+3][0]=aPoints[index][0];aPoints.splice(index+1,2);return true}}}}var i,aNewPoints;if(aPoints){aNewPoints=aPoints.clone();if(aNewPoints.length>=3){for(i=0;i<aNewPoints.length-2;i++){if(aNewPoints[i][1]===aNewPoints[i+1][1]&&aNewPoints[i+1][1]===aNewPoints[i+2][1]){aNewPoints.splice(i+1,1);i--}else{if(aNewPoints[i][0]===aNewPoints[i+1][0]&&aNewPoints[i+1][0]===aNewPoints[i+2][0]){aNewPoints.splice(i+1,1);i--}}}}if(aNewPoints.length>=4){for(i=0;i<aNewPoints.length-3;i++){if(removeElbow(i,aNewPoints)){return sap.galilei.ui.common.layout.PointsLayout.removeElbows(aNewPoints)}}}}return aNewPoints}}});
"use strict";namespace("sap.galilei.ui.common.widget");sap.galilei.ui.common.widget.Widget=sap.galilei.ui.common.shape.defineShape({fullClassName:"sap.galilei.ui.common.widget.Widget",parent:sap.galilei.ui.common.shape.Group,shapeName:"Widget",shapeCategory:"Internal",initialize:function(options){if(options){this.set(options)}this.updatePosition();if(this.isUseAnimation&&!this.transitionDefinition){this.transitionDefinition=new sap.galilei.ui.common.TransitionDefinition({duration:this.transitionDuration})}this.createWidget()},fields:{_group:undefined,_referenceBBox:undefined,_widgetBBox:undefined,_widgetAlignPoint:undefined,_bounceDuration:300,_bounceUpAnimation:undefined,_bounceDownAnimation:undefined,_isUseSemanticZoomLayer:true},properties:{isUseAnimation:true,shape:{get:function(){if(this.shapes.length===1){return this.shapes[0]}return this.shapes},set:function(vShape){var self=this;this.remove();this._group=new sap.galilei.ui.common.shape.Group();this._group.isEnableTransform=true;if(sap.galilei.core.isInstanceOf(vShape,"sap.galilei.ui.common.shape.Shape")){this._group.shapes.add(vShape);this.shapes.add(this._group)}else{if(vShape instanceof Array){vShape.forEach(function(oShape){if(oShape){self._group.shapes.add(oShape)}});this.shapes.add(this._group)}}}},shapeTemplate:{field:"_shapeTemplate",get:function(){return this._shapeTemplate},set:function(vShapeTemplate){this.remove();if(vShapeTemplate){this.shape=sap.galilei.ui.common.shape.ShapeSerializer.load(vShapeTemplate)}}},attachTo:{field:"_attachTo",get:function(){return this._attachTo},set:function(vValue){this._attachTo=vValue;this._referenceBBox=sap.galilei.ui.common.layout.getAttachBBox(vValue)}},attachPosition:sap.galilei.ui.common.DockPosition.topLeft,alignPosition:sap.galilei.ui.common.DockPosition.bottomLeft,offsetX:0,offsetY:0,isZoomable:false,isAutoHide:true,isUseDropAnimation:false,dropDuration:500,isEnableBounce:false,bounceNumber:undefined,tooltip:undefined,viewer:undefined,transitionDefinition:undefined,transitionDuration:200},methods:{createWidget:function(){},updateWidget:function(){},updateAttachTo:function(){},updatePosition:function(){this.updateAttachTo();if(this._referenceBBox){var oAlignBBox=this.getBBox(),oRect,oLayer;oRect=sap.galilei.ui.common.layout.getRelativePosition({attachBBox:this._referenceBBox,attachPosition:this.attachPosition,alignBBox:oAlignBBox,alignPosition:this.alignPosition,offsetX:this.offsetX,offsetY:this.offsetY});this._widgetBBox=oRect;this._widgetAlignPoint=this._widgetBBox.getPoint(this.alignPosition);if(this._group){this._group.x+=oRect.x-oAlignBBox.x;this._group.y+=oRect.y-oAlignBBox.y}else{this.moveBy(oRect.x-oAlignBBox.x,oRect.y-oAlignBBox.y)}if(this.viewer&&this.isDrawn&&!this.isZoomable&&this._widgetAlignPoint){this.updateDrawing(this.viewer,undefined,["x","y","cx","cy","path","points","groupTransform"]);if(this._isUseSemanticZoomLayer){oLayer=this.viewer.getLayerByName(sap.galilei.ui.common.svg.SemanticZoomLayer.NAME);oLayer.setAttachPoint(this,this._widgetAlignPoint[0],this._widgetAlignPoint[1])}}}},draw:function(oViewer,d3ParentNode,oTransitionDef,insertBeforeSelector){var self=this,oDropTransitionDef,oViewRect,y,index,shape,nDuration=0,oLayer;oViewer=oViewer||this.viewer;if(!oViewer){return}if(!this.isZoomable){oLayer=oViewer.getLayerByName(sap.galilei.ui.common.svg.SemanticZoomLayer.NAME);d3ParentNode=d3ParentNode||oLayer.d3Layer;if(d3ParentNode!==oLayer.d3Layer){oLayer=undefined;this._isUseSemanticZoomLayer=false}}oTransitionDef=oTransitionDef||this.transitionDefinition;if(this.isUseDropAnimation){oDropTransitionDef=new sap.galilei.ui.common.TransitionDefinition({duration:this.dropDuration,ease:sap.galilei.ui.common.EasingFunction.bounce});oTransitionDef=undefined;nDuration=this.dropDuration}else{if(oTransitionDef){nDuration=oTransitionDef.duration}}this.removeEventHandlers();this.addEventHandlers();if(oDropTransitionDef){y=this._group.y;oViewRect=oViewer.getViewRect();if(this._group){this._group.y=oViewRect.y}else{this.moveTo(this.x,oViewRect.y)}}this.createNode("svg:g",oViewer,d3ParentNode,undefined,insertBeforeSelector);for(index=0;index<this.shapes.length;++index){shape=this.shapes[index];shape.draw(oViewer,this.d3Node,undefined)}if(!this.isZoomable&&this._widgetAlignPoint&&oLayer){oLayer.setAttachPoint(this,this._widgetAlignPoint[0],this._widgetAlignPoint[1])}if(oDropTransitionDef){if(this._group){this._group.y=y}else{this.moveTo(this.x,y)}this.updateDrawing(oViewer,oDropTransitionDef,["x","y","cx","cy","path","points","groupTransform"])}if(this.isEnableBounce){setTimeout(function(){self.startBounce()},nDuration)}return this.d3Node},addWidgetEventHandlers:function(){if(this.isAutoHide){sap.galilei.core.Event.subscribe("viewer.zoompan.before",this.onHideWidget,this);sap.galilei.core.Event.subscribe("viewer.zoompan.after",this.onShowWidget,this)}},removeWidgetEventHandlers:function(){if(this.isAutoHide){sap.galilei.core.Event.unSubscribeScope("viewer.zoompan.before",this);sap.galilei.core.Event.unSubscribeScope("viewer.zoompan.after",this)}},addEventHandlers:function(){this.addWidgetEventHandlers()},removeEventHandlers:function(){this.removeWidgetEventHandlers()},showWidget:function(){this.updatePosition();if(!this.isEnableBounce){this.show(this.viewer,this.transitionDefinition)}},hideWidget:function(){if(!this.isEnableBounce){this.hide(this.viewer)}},removeWidget:function(){this.hideWidget();this.dispose()},onShowWidget:function(oEvent){if(oEvent&&oEvent.source===this.viewer){this.showWidget()}},onHideWidget:function(oEvent){if(oEvent&&oEvent.source===this.viewer){this.hideWidget()}},onRemoveWidget:function(oEvent){if(oEvent&&oEvent.source===this.viewer&&!this.isEnableBounce){this.removeWidget()}},_bounce:function(){var self=this,oBBox=this.getBBox();if(this._group){this._group.y-=oBBox.height}else{this.moveBy(0,-oBBox.height)}this.updateDrawing(this.viewer,this._bounceUpAnimation,["x","y","cx","cy","path","points","groupTransform"]);setTimeout(function(){if(self._group){self._group.y+=oBBox.height}else{self.moveBy(0,oBBox.height)}self.updateDrawing(this.viewer,self._bounceDownAnimation,["x","y","cx","cy","path","points","groupTransform"])},this._bounceDuration)},_repeatBounce:function(){var self=this;if(this.bounceNumber!==undefined){--this.bounceNumber;if(this.bounceNumber<0){this.bounceNumber=undefined;this.isEnableBounce=false}}if(this.isEnableBounce){this._bounce();setTimeout(function(){if(self.isEnableBounce){self._repeatBounce()}},self._bounceDuration*2)}},startBounce:function(){if(!this._bounceUpAnimation){this._bounceUpAnimation=new sap.galilei.ui.common.TransitionDefinition({duration:this._bounceDuration,ease:sap.galilei.ui.common.EasingFunction.cubicInOut})}if(!this._bounceDownAnimation){this._bounceDownAnimation=new sap.galilei.ui.common.TransitionDefinition({duration:this._bounceDuration,ease:sap.galilei.ui.common.EasingFunction.bounce})}this.isEnableBounce=true;this._repeatBounce()},stopBounce:function(){this.isEnableBounce=false},disposeWidget:function(){this.isEnableBounce=false;this.removeEventHandlers();this.remove();this._group=undefined},dispose:function(){this.disposeWidget()}}});sap.galilei.ui.common.widget.defineWidget=function(oWidgetDef){var sWidgetName,WidgetClass;if(oWidgetDef){if(!oWidgetDef.parent){oWidgetDef.parent=sap.galilei.ui.common.widget.Widget}sWidgetName=oWidgetDef.widgetName;if(sWidgetName){oWidgetDef.shapeName=sWidgetName;delete oWidgetDef.widgetName}oWidgetDef.shapeCategory="Widget";oWidgetDef=sap.galilei.ui.common.shape.transformShapeDef(oWidgetDef);WidgetClass=sap.galilei.core.defineClass(oWidgetDef);if(sWidgetName){sap.galilei.ui.common.shape.ShapeRegistry.registerShape(sWidgetName,WidgetClass)}}return WidgetClass};
"use strict";sap.galilei.ui.common.widget.Badge=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.common.widget.Badge",widgetName:"Badge",properties:{cx:undefined,cy:undefined,x:{field:"_x",get:function(){if(this._cx!==undefined&&this._width!==undefined){return this._cx-this._width/2}else{return this._x}},set:function(value){if(value!==undefined&&this._width!==undefined){this._cx=value+this._width/2}else{this._x=value}}},y:{field:"_y",get:function(){if(this._cy!==undefined&&this._height!==undefined){return this._cy-this._height/2}else{return this._y}},set:function(value){if(value!==undefined&&this._height!==undefined){this._cy=value+this._height/2}else{this._y=value}}},rx:undefined,ry:undefined,outerOffset:1,outerStroke:undefined,outerFill:"white",outerFilter:undefined,innerFill:"#0099EB",innerFilter:undefined,isShowImage:{field:"_isShowImage",get:function(){if(this._isShowImage!==undefined){return this._isShowImage}return this.image!==undefined},set:function(bValue){this._isShowImage=bValue}},image:undefined,imageWidth:16,imageHeight:16,isShowText:{field:"_isShowText",get:function(){if(this._isShowText!==undefined){return this._isShowText}return this.text!==undefined},set:function(bValue){this._isShowText=bValue}},text:undefined,font:undefined,textColor:"black",isSupportHover:false,opacityHover:1,opacityOut:0.6,animationDuration:200,isSupportDrag:false,outerShape:undefined,innerShape:undefined,imageShape:undefined,textShape:undefined},methods:{createWidget:function(){if(!this.outerShape&&!this.innerShape){this.outerShape=new sap.galilei.ui.common.shape.RoundedRectangle();this.shapes.add(this.outerShape);this.innerShape=new sap.galilei.ui.common.shape.RoundedRectangle();this.shapes.add(this.innerShape);if(this.isShowImage&&this.image){this.imageShape=new sap.galilei.ui.common.shape.Image();this.shapes.add(this.imageShape)}if(this.isShowText&&this.text){this.textShape=new sap.galilei.ui.common.shape.Text();this.shapes.add(this.textShape)}this.updateWidget()}},updateWidget:function(){var x,y,width=this.width,height=this.height,outerSize=this.outerOffset,innerWidth,innerHeight,imageWidth=0,imageHeight=0,textWidth=0,textHeight=0,imageTextMargin=2,imageTextPadding=0,rx=this.rx,ry=this.ry,r,offsetX,offsetY,opacity=this.opacity;if(this.cx===undefined||isNaN(this.cx)){if(this.x!==undefined&&this.width!==undefined){this.cx=this.x+this.width/2}else{this.cx=0}}if(this.cy===undefined||isNaN(this.cy)){if(this.y!==undefined&&this.height!==undefined){this.cy=this.y+this.height/2}else{this.cy=0}}if(outerSize===undefined||isNaN(outerSize)){outerSize=0}if(width!==undefined&&width!==0&&!isNaN(width)){innerWidth=width-outerSize-outerSize}if(height!==undefined&&height!==0&&!isNaN(height)){innerHeight=height-outerSize-outerSize}if(this.isShowImage&&this.isShowText&&this.text){imageTextPadding=2}if(this.isShowImage){imageWidth=this.imageWidth;imageHeight=this.imageHeight}if(this.isShowText&&this.text){if(!this.font){this.font=sap.galilei.ui.common.Text.DEFAULT_UI_FONT}textWidth=sap.galilei.ui.common.Text.measureTextLineWidth(this.text,this.font)+4;textHeight=sap.galilei.ui.common.Font.getFontHeight(this.font);innerWidth=textWidth+imageWidth+imageTextMargin+imageTextPadding+imageTextMargin+imageTextPadding;width=innerWidth+outerSize+outerSize;r=rx=ry=4}if(width===undefined||width===0||isNaN(width)){innerWidth=imageTextMargin+imageWidth+imageTextPadding+textWidth+imageTextMargin;width=innerWidth+outerSize+outerSize}if(height===undefined||height===0||isNaN(height)){innerHeight=imageTextMargin+Math.max(imageHeight,textHeight)+imageTextMargin;height=innerHeight+outerSize+outerSize}if(rx===undefined||isNaN(rx)){rx=width/2}if(ry===undefined||isNaN(ry)){ry=height/2}r=Math.min(rx,ry);x=this.x;y=this.y;if(opacity===undefined&&this.isSupportHover){opacity=this.opacityOut}this.opacity=opacity;if(this.outerShape){this.outerShape.set({x:x,y:y,width:width,height:height,rx:r,ry:r,stroke:this.outerStroke,fill:this.outerFill,filter:this.outerFilter})}if(!this.textShape){rx=this.rx;ry=this.ry;if(rx===undefined||isNaN(rx)){rx=innerWidth/2}if(ry===undefined||isNaN(ry)){ry=innerHeight/2}r=Math.min(rx,ry)}if(this.innerShape){this.innerShape.set({x:x+outerSize,y:y+outerSize,width:innerWidth,height:innerHeight,rx:r,ry:r,stroke:"none",fill:this.innerFill,filter:this.innerFilter})}if(this.imageShape){if(!this.textShape){offsetX=(width-imageWidth)/2}else{offsetX=outerSize+imageTextMargin}offsetY=(height-imageHeight)/2;this.imageShape.set({x:x+offsetX,y:y+offsetY,width:imageWidth,height:imageHeight,href:this.image})}if(this.textShape){offsetX=outerSize+imageTextMargin+imageWidth+imageTextPadding;offsetY=outerSize;this.textShape.set({x:x+offsetX,y:y+offsetY,width:textWidth,height:innerHeight,text:this.text,font:this.font,fill:this.textColor,verticalAlignment:sap.galilei.ui.common.VerticalAlignment.middle})}if(this.width===undefined||this.width===0||isNaN(this.width)){this.width=width}if(this.height===undefined||this.height===0||isNaN(this.height)){this.height=height}this.addEventHandlers()},addEventHandlers:function(){if(!this.eventHandlers){if(this.isSupportDrag){this.on("pointerdown",function(oEvent){oEvent.preventDefault();oEvent.stopPropagation()},this);this.on("dragstart",function(oEvent){var aCenter=this.getCenter();this._isDragging=true;this._cx0=aCenter[0];this._cy0=aCenter[1]},this);this.on("dragend",function(oEvent){delete this._isDragging;delete this._cx0;delete this._cy0},this)}if(this.isSupportHover&&this.opacityHover!==undefined&&this.opacityOut!==undefined){this.on("pointerover",function(oEvent){if(!this._isDragging){this.d3Node.transition().duration(this.animationDuration).attr("opacity",this.opacityHover);if(this.isSupportDrag){this.opacity=this.opacityHover}}},this);this.on("pointerout",function(oEvent){if(!this._isDragging){this.d3Node.transition().duration(this.animationDuration).attr("opacity",this.opacityOut);if(this.isSupportDrag){this.opacity=this.opacityOut}}},this)}}},getCenter:function(){if(this.cx!==undefined&&this.cy!==undefined){return[this.cx,this.cy]}var oRect=this.getBBox();if(oRect){return oRect.getCenter()}return[undefined,undefined]},setCenter:function(x,y,bRounded){var aCenter=this.getCenter();if(aCenter){this.moveBy(x-aCenter[0],y-aCenter[1])}this.cx=x;this.cy=y}}});
"use strict";sap.galilei.ui.common.widget.Button=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.common.widget.Button",parent:sap.galilei.ui.common.widget.Badge,widgetName:"Button",properties:{},methods:{}});
"use strict";sap.galilei.ui.common.widget.ButtonPad=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.common.widget.ButtonPad",widgetName:"ButtonPad",properties:{attachToBBox:undefined,isBBoxViewCoordinates:false,buttonsDefinition:undefined},methods:{create:function(oViewer,oTransitionDef,oBBox,aButtonDef){var oRect,aPt,oContextButton,radius=16,oLayer,oParamCommon,oParam,index,oButtonParam,nHandleRadius=sap.galilei.ui.common.tracker.Handle.DEFAULT_SIZE/2,nSpeedMenuOffset=1,nButtonOffset=-1,aButtons=[],nMaxWidth=0,j,oShape,nDeltaWidth;if(oViewer&&oBBox&&aButtonDef){this.viewer=oViewer;this.transitionDefinition=undefined;this.buttonsDefinition=aButtonDef;oRect=oBBox.clone();oRect.inflate(nHandleRadius+nSpeedMenuOffset,nHandleRadius+nSpeedMenuOffset,false);this.attachTo=oRect;this.attachPosition=sap.galilei.ui.common.DockPosition.right;this.alignPosition=sap.galilei.ui.common.DockPosition.left;aPt=[0,0];oParamCommon={width:radius+radius,height:radius+radius,outerOffset:2,outerFill:"white",innerFill:"#009DE0"};for(index=0;index<aButtonDef.length;index++){oButtonParam=aButtonDef[index];oParam={cx:aPt[0],cy:aPt[1],image:oButtonParam.image,imageWidth:oButtonParam.imageWidth,imageHeight:oButtonParam.imageHeight};sap.galilei.core.copyProperties(oParam,oParamCommon);oContextButton=this.createButton(oParam,oButtonParam);if(oContextButton){aButtons.push(oContextButton);if(oContextButton.shape&&oContextButton.shape.length>0){nMaxWidth=Math.max(nMaxWidth,oContextButton.shape[0].width)}aPt[1]+=radius+radius+nButtonOffset}}for(index=0;index<aButtons.length;index++){oContextButton=aButtons[index];if(oContextButton.shape&&oContextButton.shape.length>0){for(j=0;j<oContextButton.shape.length;j++){oShape=oContextButton.shape[j];if(j===0){nDeltaWidth=nMaxWidth-oShape.width;oShape.width=nMaxWidth}else{oShape.width+=nDeltaWidth}}}}this.shape=aButtons;this.updatePosition();oLayer=oViewer.getLayerByName(sap.galilei.ui.common.svg.ZoomToolLayer.NAME);this.draw(oViewer,oLayer.d3Layer)}},createButton:function(oParam,oButtonParam){if(oParam){return new sap.galilei.ui.common.widget.Button(oParam)}else{return undefined}}}});
"use strict";namespace("sap.galilei.ui.common.command");sap.galilei.ui.common.command.Command=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.command.Command",properties:{name:undefined,displayName:undefined,tooltip:undefined,type:undefined,parameters:undefined,isEnabled:true,isHidden:false,smallIcon:undefined,smallIconWidth:16,smallIconHeight:16,largeIcon:undefined,largeIconWidth:32,largeIconHeight:32,publish:undefined,viewer:undefined},methods:{canExecute:function(oParam){return this.isEnabled&&!this.isHidden},execute:undefined,executeCommand:function(oParam){if(!this.canExecute||(this.canExecute&&this.canExecute(oParam))){if(this.execute){this.execute(oParam)}else{if(this.publish&&this.publish.type){sap.galilei.core.Event.publish(this.publish.type,this.publish.source,this.publish.target,oParam)}}}},dispose:function(){}}});sap.galilei.ui.common.command.defineCommand=function(oCommandDef){var CommandClass;if(oCommandDef){if(!oCommandDef.parent){oCommandDef.parent=sap.galilei.ui.common.command.Command}CommandClass=sap.galilei.core.defineClass(oCommandDef)}return CommandClass};sap.galilei.ui.common.command.getCommand=function(sCommandName){var oCommand;if(sCommandName&&sap.galilei.ui.common.command.CommandRegistry){oCommand=sap.galilei.ui.common.command.CommandRegistry.get(sCommandName)}return oCommand};sap.galilei.ui.common.command.addCommand=function(sCommandName,oCommand){if(sCommandName&&oCommand&&sap.galilei.ui.common.command.CommandRegistry){sap.galilei.ui.common.command.CommandRegistry.add(sCommandName,oCommand)}};sap.galilei.ui.common.command.removeCommand=function(sCommandName){if(sCommandName&&sap.galilei.ui.common.command.CommandRegistry){sap.galilei.ui.common.command.CommandRegistry.remove(sCommandName)}};(function(){sap.galilei.ui.common.command.CommandRegistry=new sap.galilei.core.DefaultLookupClass()})();
"use strict";sap.galilei.ui.common.svg.GridLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.GeometricZoomLayer,fullClassName:"sap.galilei.ui.common.svg.GridLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}this.add()},properties:{name:sap.galilei.ui.common.svg.Layer.GRID_LAYER,id:sap.galilei.ui.common.svg.Layer.GRID_LAYER,domClass:sap.galilei.ui.common.svg.Layer.GRID_LAYER},methods:{add:function(){return this.createGridLayer()},createGridLayer:function(){if(this.viewer&&!this.d3Layer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:rect").attr("id",this.id).attr("class",this.domClass);if(!this.viewer.showGrid){this.d3Layer.attr("opacity",0)}}this.onUpdatePageSize();this.addGridPattern();this.updateGrid();return this.d3Layer},onUpdatePageSize:function(sEventHandlerName){if(this.d3Layer&&this.viewer){this.d3Layer.attr("x",this.viewer.allPagesLeft).attr("y",this.viewer.allPagesTop).attr("width",this.viewer.allPagesWidth).attr("height",this.viewer.allPagesHeight)}return this.d3Layer},addGridPattern:function(){if(this.d3Layer&&this.viewer){var d3SvgDefs=this.viewer.d3SvgDefs,d3Pattern;d3Pattern=d3SvgDefs.select("#gridPattern");if(!d3Pattern.node()){d3Pattern=d3SvgDefs.append("svg:pattern").attr("id","gridPattern").attr("patternUnits","userSpaceOnUse")}this.onUpdateGridPattern()}},onUpdateGridPattern:function(){if(this.d3Layer&&this.viewer){var d3SvgDefs=this.viewer.d3SvgDefs,nSize=5*this.viewer.gridSize,d3Pattern,svgPattern,d3Border1,d3Border2,path;d3Pattern=d3SvgDefs.select("#gridPattern");svgPattern=d3Pattern.node();if(svgPattern){d3Pattern.attr("width",nSize).attr("height",nSize);if(svgPattern.hasChildNodes()){for(path=svgPattern.firstChild;path;path=svgPattern.firstChild){svgPattern.removeChild(path)}}d3Border1=d3Pattern.append("svg:path").attr("d","M0 "+this.viewer.gridSize+" H"+nSize+" M0 "+2*this.viewer.gridSize+" H"+nSize+" M0 "+3*this.viewer.gridSize+" H"+nSize+" M0 "+4*this.viewer.gridSize+" H"+nSize+" M"+this.viewer.gridSize+" 0 V"+nSize+" M"+2*this.viewer.gridSize+" 0 V"+nSize+" M"+3*this.viewer.gridSize+" 0 V"+nSize+" M"+4*this.viewer.gridSize+" 0 V"+nSize).attr("fill","none").attr("stroke",this.viewer.gridBorderInnerColor).attr("stroke-width",1);d3Border2=d3Pattern.append("svg:path").attr("d","M"+nSize+" 0 L0 0 L0 "+nSize+" L"+nSize+" "+nSize+" L"+nSize+" 0").attr("fill","none").attr("stroke",this.viewer.gridBorderOuterColor).attr("stroke-width",1.5);this.d3Layer.attr("fill","url(#gridPattern)")}}},updateGrid:function(bShowGrid){if(this.d3Layer&&this.viewer){if(bShowGrid===undefined){bShowGrid=this.viewer.showGrid}if(bShowGrid){this.show(true)}else{this.hide(true)}}},onUpdateGrid:function(){this.updateGrid()},onZoomPanUpdate:function(sEventHandlerName,scale,translate,bUseAnimation){if(this.d3Layer&&this.viewer){var oldGridVisible=(this.viewer.oldZoomScale>=0.5)&&this.viewer.showGrid,newGridVisible=(scale>=0.5)&&this.viewer.showGrid;if(newGridVisible!==oldGridVisible){this.updateGrid(newGridVisible)}}}},statics:{ID:sap.galilei.ui.common.svg.Layer.GRID_LAYER,NAME:sap.galilei.ui.common.svg.Layer.GRID_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.GRID_LAYER}});(function(){sap.galilei.core.extendStatic(sap.galilei.ui.common.svg.Viewer,{GRID_SIZE:10,GRID_BORDER_INNER_COLOR:"#CEE0F2",GRID_BORDER_OUTER_COLOR:"#ADCDED"});var oProps={showGrid:{value:false,onChange:function(newValue,oldValue){this.notifyLayers("onUpdateGrid",newValue,oldValue)}},gridSize:{expression:"sap.galilei.ui.common.svg.Viewer.GRID_SIZE",onChange:function(newValue,oldValue){this.notifyLayers("onUpdateGridPattern",newValue,oldValue)}},gridBorderInnerColor:{expression:"sap.galilei.ui.common.svg.Viewer.GRID_BORDER_INNER_COLOR",onChange:function(newValue,oldValue){this.notifyLayers("onUpdateGridPattern",newValue,oldValue)}},gridBorderOuterColor:{expression:"sap.galilei.ui.common.svg.Viewer.GRID_BORDER_OUTER_COLOR",onChange:function(newValue,oldValue){this.notifyLayers("onUpdateGridPattern",newValue,oldValue)}}};var oExtension={};sap.galilei.core.ClassDefinitionBuilder.transformProperties(oExtension,oProps);sap.galilei.core.extend(sap.galilei.ui.common.svg.Viewer,oExtension)})();
"use strict";sap.galilei.ui.common.svg.PageBackgroundLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.GeometricZoomLayer,fullClassName:"sap.galilei.ui.common.svg.PageBackgroundLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}this.add()},properties:{name:sap.galilei.ui.common.svg.Layer.PAGE_BACKGROUND_LAYER,id:sap.galilei.ui.common.svg.Layer.PAGE_BACKGROUND_LAYER,domClass:sap.galilei.ui.common.svg.Layer.PAGE_BACKGROUND_LAYER},methods:{add:function(){if(!this.d3Layer&&this.viewer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:rect").attr("id",this.id).attr("class",this.domClass).attr("fill",this.viewer.pageBackgroundFill)}this.onUpdatePageSize();return this.d3Layer},onUpdatePageSize:function(sEventHandlerName){if(this.d3Layer&&this.viewer){this.d3Layer.attr("x",this.viewer.allPagesLeft).attr("y",this.viewer.allPagesTop).attr("width",this.viewer.allPagesWidth).attr("height",this.viewer.allPagesHeight)}return this.d3Layer},onUpdatePageBackground:function(){if(this.d3Layer&&this.viewer){this.d3Layer.attr("fill",this.viewer.pageBackgroundFill)}return this.d3Layer}},statics:{ID:sap.galilei.ui.common.svg.Layer.PAGE_BACKGROUND_LAYER,NAME:sap.galilei.ui.common.svg.Layer.PAGE_BACKGROUND_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.PAGE_BACKGROUND_LAYER}});(function(){sap.galilei.core.extendStatic(sap.galilei.ui.common.svg.Viewer,{PAGE_BACKGROUND_COLOR:"#FFFFFF"});var oProps={pageBackgroundFill:{expression:"sap.galilei.ui.common.svg.Viewer.PAGE_BACKGROUND_COLOR",onChange:function(newValue,oldValue){this.notifyLayers("onUpdatePageBackground",newValue,oldValue)}}};var oExtension={};sap.galilei.core.ClassDefinitionBuilder.transformProperties(oExtension,oProps);sap.galilei.core.extend(sap.galilei.ui.common.svg.Viewer,oExtension)})();
"use strict";sap.galilei.ui.common.svg.PageLimitLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.GeometricZoomLayer,fullClassName:"sap.galilei.ui.common.svg.PageLimitLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}this.add()},properties:{name:sap.galilei.ui.common.svg.Layer.PAGE_LIMIT_LAYER,id:sap.galilei.ui.common.svg.Layer.PAGE_LIMIT_LAYER,domClass:sap.galilei.ui.common.svg.Layer.PAGE_LIMIT_LAYER},methods:{add:function(){if(!this.d3Layer&&this.viewer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:rect").attr("id",this.id).attr("class",this.domClass)}this.onUpdatePageSize();this.addPagePattern();this.onUpdatePageLimit();return this.d3Layer},addPagePattern:function(){var d3SvgDefs=this.viewer.d3SvgDefs,d3Pattern;d3Pattern=d3SvgDefs.select("#pagePattern");if(!d3Pattern.node()){d3Pattern=d3SvgDefs.append("svg:pattern").attr("id","pagePattern").attr("patternUnits","userSpaceOnUse")}this.onUpdatePagePattern();this.onUpdatePageLimit();return d3Pattern},onUpdatePageSize:function(sEventHandlerName){if(this.d3Layer&&this.viewer){this.d3Layer.attr("x",this.viewer.allPagesLeft).attr("y",this.viewer.allPagesTop).attr("width",this.viewer.allPagesWidth).attr("height",this.viewer.allPagesHeight)}return this.d3Layer},onUpdatePagePattern:function(){if(this.viewer){var d3SvgDefs=this.viewer.d3SvgDefs,nSizeH=this.viewer.pageWidth,nSizeV=this.viewer.pageHeight,d3Pattern,svgPattern,d3Border,path;d3Pattern=d3SvgDefs.select("#pagePattern");svgPattern=d3Pattern.node();if(svgPattern){d3Pattern.attr("width",this.viewer.pageWidth).attr("height",this.viewer.pageHeight);if(svgPattern.hasChildNodes()){for(path=svgPattern.firstChild;path;path=svgPattern.firstChild){svgPattern.removeChild(path)}}d3Border=d3Pattern.append("svg:path").attr("d","M"+nSizeH+" 0 L0 0 L0 "+nSizeV+" L"+nSizeH+" "+nSizeV+" L"+nSizeH+" 0").attr("fill","none").attr("stroke",this.viewer.pageLimitColor).attr("stroke-width",1.5);this.d3Layer.attr("fill","url(#pagePattern)");return d3Pattern}}return undefined},updatePageLimit:function(bShowPageLimit){if(this.d3Layer&&this.viewer){if(bShowPageLimit===undefined){bShowPageLimit=this.viewer.showPageLimit}if(bShowPageLimit){this.show(true)}else{this.hide(true)}}},onUpdatePageLimit:function(){this.updatePageLimit()}},statics:{ID:sap.galilei.ui.common.svg.Layer.PAGE_LIMIT_LAYER,NAME:sap.galilei.ui.common.svg.Layer.PAGE_LIMIT_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.PAGE_LIMIT_LAYER}});(function(){sap.galilei.core.extendStatic(sap.galilei.ui.common.svg.Viewer,{PAGE_LIMIT_COLOR:"#808080"});var oProps={showPageLimit:{value:true,onChange:function(newValue,oldValue){this.notifyLayers("onUpdatePageLimit",newValue,oldValue)}},pageLimitColor:{expression:"sap.galilei.ui.common.svg.Viewer.PAGE_LIMIT_COLOR",onChange:function(newValue,oldValue){this.notifyLayers("onUpdatePagePattern",newValue,oldValue)}}};var oExtension={};sap.galilei.core.ClassDefinitionBuilder.transformProperties(oExtension,oProps);sap.galilei.core.extend(sap.galilei.ui.common.svg.Viewer,oExtension)})();
"use strict";sap.galilei.ui.common.svg.SemanticZoomLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.FixedLayer,fullClassName:"sap.galilei.ui.common.svg.SemanticZoomLayer",properties:{name:sap.galilei.ui.common.svg.Layer.SEMANTIC_ZOOM_LAYER,id:sap.galilei.ui.common.svg.Layer.SEMANTIC_ZOOM_LAYER,domClass:sap.galilei.ui.common.svg.Layer.SEMANTIC_ZOOM_LAYER,matrix:{expression:"new sap.galilei.ui.common.Matrix()",writable:false,configurable:false},isUseAnimation:false,animationDuration:0},methods:{add:function(){if(!this.d3Layer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:g").attr("id",this.id).attr("class",this.domClass)}return this.d3Layer},transformPoint:function(aPoint){var oPt=new sap.galilei.ui.common.Point(aPoint);oPt.matrixTransform(this.matrix);return[oPt.x,oPt.y]},getTransform:function(aPoint){var aNewPoint=this.transformPoint(aPoint);return"translate("+(aNewPoint[0]-aPoint[0])+","+(aNewPoint[1]-aPoint[1])+")"},moveNodeBy:function(d3Node,dx,dy,oTransitionDef){if(d3Node){var x=d3Node.attr("g:x0"),y=d3Node.attr("g:y0");if(x==undefined||x===""||y==undefined||y===""){x=d3Node.attr("x");y=d3Node.attr("y")}if(x!=undefined&&x!==""&&y!=undefined&&y!==""){x=+x+dx;y=+y+dy;this.moveNodeTo(d3Node,x,y,oTransitionDef)}}},setNodeAttachPoint:function(d3Node,x,y,oTransitionDef){if(d3Node){var d3Selection=d3Node;if(oTransitionDef){d3Selection=oTransitionDef.getTransition(d3Node)}d3Selection.attr("g:x0",x).attr("g:y0",y).attr("transform",this.getTransform([x,y]))}},moveNodeTo:function(d3Node,x,y,oTransitionDef){if(d3Node){var d3Selection=d3Node;if(oTransitionDef){d3Selection=oTransitionDef.getTransition(d3Node)}d3Selection.attr("x",x).attr("y",y).attr("g:x0",x).attr("g:y0",y).attr("transform",this.getTransform([x,y]))}},moveBy:function(oShape,dx,dy,oTransitionDef){if(oShape&&oShape.d3Node){this.moveNodeBy(oShape.d3Node,dx,dy,oTransitionDef)}},moveTo:function(oShape,x,y,oTransitionDef){if(oShape&&oShape.d3Node){this.moveNodeTo(oShape.d3Node,x,y,oTransitionDef)}},setAttachPoint:function(oShape,x,y,oTransitionDef){if(oShape&&oShape.d3Node){this.setNodeAttachPoint(oShape.d3Node,x,y,oTransitionDef)}},onZoomPan:function(eventName,scale,translate,bUseAnimation){this.isUseAnimation=(bUseAnimation===true);this.animationDuration=0;if(this.isUseAnimation){if(scale!==this.viewer.oldZoomScale){this.animationDuration=this.viewer.zoomDuration}else{if(translate[0]!==this.viewer.oldZoomTranslate[0]||translate[1]!==this.viewer.oldZoomTranslate[1]){this.animationDuration=this.viewer.panDuration}}}this.matrix.setIdentity();this.matrix.translate(translate[0],translate[1]).scale(scale);var i,node,box,x0,y0,selection,pt=new sap.galilei.ui.common.Point();for(i=0;i<this.svgLayer.childNodes.length;i++){node=this.svgLayer.childNodes[i];selection=d3.select(node);x0=selection.attr("g:x0");y0=selection.attr("g:y0");if(x0==undefined||x0===""||y0==undefined||y0===""){box=sap.galilei.ui.common.svg.Svg.getBBox(node,true,this.svgLayer);if(box.width!==undefined&&box.height!==undefined){x0=box.x+box.width/2;y0=box.y+box.height/2}else{x0=box.x;y0=box.y}selection.attr("g:x0",x0);selection.attr("g:y0",y0)}if(this.isUseAnimation&&this.animationDuration!==0){selection=selection.transition().duration(this.animationDuration).ease("linear")}pt.set(x0,y0);pt.matrixTransform(this.matrix);selection.attr("transform","translate("+(pt.x-x0)+","+(pt.y-y0)+")")}}},statics:{ID:sap.galilei.ui.common.svg.Layer.SEMANTIC_ZOOM_LAYER,NAME:sap.galilei.ui.common.svg.Layer.SEMANTIC_ZOOM_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.SEMANTIC_ZOOM_LAYER}});
"use strict";sap.galilei.ui.common.svg.ShapeLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.GeometricZoomLayer,fullClassName:"sap.galilei.ui.common.svg.ShapeLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}this.add()},properties:{name:sap.galilei.ui.common.svg.Layer.SHAPE_LAYER,id:sap.galilei.ui.common.svg.Layer.SHAPE_LAYER,domClass:sap.galilei.ui.common.svg.Layer.SHAPE_LAYER,isShapeLayer:{value:true,writable:false,configurable:false},isMainShapeLayer:false,isShapeDecoratorLayer:false},methods:{add:function(){if(!this.d3Layer&&this.d3DrawingSurface){this.d3Layer=this.d3DrawingSurface.append("svg:g").attr("id",this.id).attr("class",this.domClass)}return this.d3Layer},getGlobalViewRect:function(){return sap.galilei.ui.common.svg.Svg.getChildNodesBBox(this.svgLayer)}},statics:{ID:sap.galilei.ui.common.svg.Layer.SHAPE_LAYER,NAME:sap.galilei.ui.common.svg.Layer.SHAPE_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.SHAPE_LAYER}});
"use strict";sap.galilei.ui.common.svg.ZoomToolLayer=sap.galilei.core.defineClass({parent:sap.galilei.ui.common.svg.FixedLayer,fullClassName:"sap.galilei.ui.common.svg.ZoomToolLayer",initialize:function(viewer,options){this.viewer=viewer;if(options){this.set(options)}this.add()},properties:{name:{expression:"sap.galilei.ui.common.svg.ZoomToolLayer.NAME"},zoomToolPadding:20,panGroupRayon:24,zoomButtonSize:24,zoomToolHorizontalAlignment:{get:function(){if(this.viewer){return this.viewer.zoomToolHorizontalAlignment}return sap.galilei.ui.common.HorizontalAlignment.left}},zoomToolVerticalAlignment:{get:function(){if(this.viewer){return this.viewer.zoomToolVerticalAlignment}return sap.galilei.ui.common.VerticalAlignment.top}},opacityOff:1,opacityOn:0.5,animationDuration:200,zoomTextFont:"normal normal normal 12px Verdana, Helvetica",zoomToolGroup:undefined,panGroup:undefined,zoomInGroup:undefined,zoomOutGroup:undefined,zoomTextRect:undefined,zoomText:undefined,zoomTextTimer:undefined},methods:{add:function(){var self=this,x0=0,y0=0,cx=x0+this.panGroupRayon,cy=y0+this.panGroupRayon,d1=4,d2=10,d3_=6,d4=-1,d,x1,y1,dd1,dd3,dd2,y2,d3SvgZoomText;this._super.prototype.add.apply(this);this.zoomToolGroup=self.d3Layer.append("svg:g").attr("opacity",0);this.panGroup=self.zoomToolGroup.append("svg:g").attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.panGroup.on("mouseover",function(){self.onMouseOver()}).on("mouseout",function(){self.onMouseOut()});this.panGroup.append("svg:circle").attr("cx",cx).attr("cy",cy).attr("r",this.panGroupRayon).attr("stroke-width","3").attr("stroke","gray").attr("fill","white");d="M"+(cx-self.panGroupRayon+d1)+","+cy+" l"+d2+","+(-d3_)+" l"+d4+","+d3_+" l"+(-d4)+","+d3_+" l"+(-d2)+","+(-d3_)+" z";this.panGroup.append("svg:path").attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").attr("d",d).on("mouseup",function(){self.viewer.panLeft()});d="M"+(cx+self.panGroupRayon-d1)+","+cy+" l"+(-d2)+","+(-d3_)+" l"+(-d4)+","+d3_+" l"+d4+","+d3_+" l"+d2+","+(-d3_)+" z";this.panGroup.append("svg:path").attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").attr("d",d).on("mouseup",function(){self.viewer.panRight()});d="M"+cx+","+(cy-self.panGroupRayon+d1)+" l"+d3_+","+d2+" l"+(-d3_)+","+d4+" l"+(-d3_)+","+(-d4)+" l"+d3_+","+(-d2)+" z";this.panGroup.append("svg:path").attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").attr("d",d).on("mouseup",function(){self.viewer.panUp()});d="M"+cx+","+(cy+self.panGroupRayon-d1)+" l"+d3_+","+(-d2)+" l"+(-d3_)+","+(-d4)+" l"+(-d3_)+","+d4+" l"+d3_+","+d2+" z";this.panGroup.append("svg:path").attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").attr("d",d).on("mouseup",function(e){self.viewer.panDown()});this.panGroup.append("svg:circle").attr("cx",cx).attr("cy",cy).attr("r",8).attr("stroke","none").attr("fill","none").on("mouseup",function(){self.viewer.showInitialView()});this.panGroup.append("svg:circle").attr("cx",cx).attr("cy",cy).attr("r",4).attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").on("mouseup",function(){self.viewer.showInitialView()});x1=x0+Math.round(this.panGroupRayon-this.zoomButtonSize/2);y1=cy+self.panGroupRayon+10;dd1=5;dd3=2;dd2=Math.floor((self.zoomButtonSize-dd1*2-dd3)/2);this.zoomInGroup=self.zoomToolGroup.append("svg:g").attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn).on("mouseup",function(){self.viewer.zoomIn()}).on("mouseover",function(){self.onMouseOver()}).on("mouseout",function(){self.onMouseOut()}).on("touchstart",function(){self.onMouseOver()}).on("touchmove",function(){self.onMouseOver()}).on("touchend",function(){self.viewer.zoomIn();self.onTouchEnd()});this.zoomInGroup.append("svg:rect").attr("x",x1).attr("y",y1).attr("width",this.zoomButtonSize).attr("height",this.zoomButtonSize).attr("rx",4).attr("ry",4).attr("stroke-width","2").attr("stroke","gray").attr("fill","white");d="M"+(x1+dd1)+","+(y1+dd1+dd2)+" l"+dd2+",0 l0, "+(-dd2)+" l"+dd3+",0 l0,"+dd2+" l"+dd2+",0 l0,"+dd3+" l"+(-dd2)+",0 l0,"+dd2+" l"+(-dd3)+",0 l0,"+(-dd2)+" l"+(-dd2)+",0 l0,"+(-dd3)+" Z",this.zoomInGroup.append("svg:path").attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").attr("d",d);y1+=this.zoomButtonSize+4;this.zoomOutGroup=self.zoomToolGroup.append("svg:g").attr("opacity",self.opacityOn).attr("stroke-opacity",this.opacityOn).on("mouseup",function(){self.viewer.zoomOut()}).on("mouseover",function(){self.onMouseOver()}).on("mouseout",function(){self.onMouseOut()}).on("touchstart",function(){self.onMouseOver()}).on("touchmove",function(){self.onMouseOver()}).on("touchend",function(){self.viewer.zoomOut();self.onTouchEnd()});this.zoomOutGroup.append("svg:rect").attr("x",x1).attr("y",y1).attr("width",this.zoomButtonSize).attr("height",this.zoomButtonSize).attr("rx",4).attr("ry",4).attr("stroke-width","2").attr("stroke","gray").attr("fill","white");d="M"+(x1+dd1)+","+(y1+dd1+dd2)+" l"+(dd2+dd3+dd2)+",0 l0, "+dd3+" l"+(-dd2-dd3-dd2)+",0 l0,"+(-dd3)+" Z";this.zoomOutGroup.append("svg:path").attr("stroke-width","1").attr("stroke","darkgray").attr("fill","darkgray").attr("d",d);y2=y1+self.zoomButtonSize+10;this.zoomTextRect=self.zoomToolGroup.append("svg:rect").attr("x",x0-4).attr("y",y2).attr("width",this.panGroupRayon*2+8).attr("height",this.zoomButtonSize).attr("rx",8).attr("ry",8).attr("stroke-width","2").attr("stroke","gray").attr("fill","white").attr("opacity",0).attr("stroke-opacity",0).on("mouseover",function(){self.onMouseOver()}).on("mouseout",function(){self.onMouseOut()});d3SvgZoomText=sap.galilei.ui.common.svg.Svg.appendText(this.zoomToolGroup,(this.viewer.zoomScale*100).toFixed(0)+"%",x0,y2,this.panGroupRayon*2,self.zoomButtonSize,self.zoomTextFont,sap.galilei.ui.common.HorizontalAlignment.center,sap.galilei.ui.common.VerticalAlignment.middle,false,false,0,undefined,undefined,{style:"font: "+this.zoomTextFont+";",fill:"black",opacity:this.opacityOn});this.zoomText=d3SvgZoomText.on("mouseover",function(){self.onMouseOver()}).on("mouseout",function(){self.onMouseOut()});this.onPostZoomPan=function(eventName,scale,translate){var opacity=self.opacityOn;if(scale!==self.viewer.oldZoomScale){if(self.zoomTextTimer){clearTimeout(self.zoomTextTimer);self.zoomTextTimer=undefined}self.onMouseOverText();opacity=self.opacityOff}sap.galilei.ui.common.svg.Svg.updateText(d3SvgZoomText,(scale*100).toFixed(0)+"%",x0,y2,self.panGroupRayon*2,self.zoomButtonSize,self.zoomTextFont,sap.galilei.ui.common.HorizontalAlignment.center,sap.galilei.ui.common.VerticalAlignment.middle,false,false,0,undefined,undefined,{style:"font: "+self.zoomTextFont+";",fill:"black",opacity:opacity});if(scale!==self.viewer.oldZoomScale){self.zoomTextTimer=setTimeout(function(){self.onMouseOutText(true)},1000)}};this.updateZoomTools();this.updateZoomToolsLocation();document.addEventListener("keydown",function(oEvent){if(!self.isDisableKeyboardEvents){self.onKeyDown(oEvent)}},false);return self.d3Layer},onResize:function(sEventHandlerName){this._super.prototype.onResize.apply(this);this.updateZoomToolsLocation()},updateZoomToolsLocation:function(){var x,y,rect;if(this.zoomToolGroup&&this.zoomToolGroup.node()){rect=sap.galilei.ui.common.svg.Svg.getBBox(this.zoomToolGroup.node());if(rect){if(this.zoomToolHorizontalAlignment===sap.galilei.ui.common.HorizontalAlignment.right){x=this.viewer.viewWidth-this.panGroupRayon*2-this.zoomToolPadding}else{x=this.zoomToolPadding}if(this.zoomToolVerticalAlignment===sap.galilei.ui.common.VerticalAlignment.middle){y=Math.round((this.viewer.viewHeight-rect.height)/2)}else{if(this.zoomToolVerticalAlignment===sap.galilei.ui.common.VerticalAlignment.bottom){y=this.viewer.viewHeight-rect.height-this.zoomToolPadding}else{y=this.zoomToolPadding}}this.zoomToolGroup.transition().duration(this.animationDuration).attr("transform","translate("+x+","+y+")").attr("opacity",1)}}},updateZoomTools:function(bShowZoomTools){if(this.d3Layer&&this.viewer){if(bShowZoomTools===undefined){bShowZoomTools=this.viewer.showZoomTools}if(this.zoomToolGroup){if(bShowZoomTools){this.zoomToolGroup.attr("opacity",1).attr("display","inline")}else{this.zoomToolGroup.attr("opacity",0).attr("display","none")}}}},onChangeShowZoomTools:function(){this.updateZoomTools()},onChangeZoomToolsLocation:function(){this.updateZoomToolsLocation()},onMouseOver:function(){this.panGroup.transition().duration(this.animationDuration).attr("opacity",this.opacityOff).attr("stroke-opacity",this.opacityOff);this.zoomInGroup.transition().duration(this.animationDuration).attr("opacity",this.opacityOff).attr("stroke-opacity",this.opacityOff);this.zoomOutGroup.transition().duration(this.animationDuration).attr("opacity",this.opacityOff).attr("stroke-opacity",this.opacityOff);this.onMouseOverText()},onMouseOut:function(){this.panGroup.transition().duration(this.animationDuration).attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.zoomInGroup.transition().duration(this.animationDuration).attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.zoomOutGroup.transition().duration(this.animationDuration).attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.onMouseOutText()},onTouchEnd:function(){this.panGroup.transition().delay(1000).duration(this.animationDuration).attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.zoomInGroup.transition().delay(1000).duration(this.animationDuration).attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.zoomOutGroup.transition().delay(1000).duration(this.animationDuration).attr("opacity",this.opacityOn).attr("stroke-opacity",this.opacityOn);this.onMouseOutText()},onMouseOverText:function(){this.zoomTextRect.transition().duration(this.animationDuration).attr("opacity",this.opacityOff).attr("stroke-opacity",this.opacityOff);this.zoomText.transition().duration(this.animationDuration).attr("opacity",this.opacityOff)},onMouseOutText:function(bZoomPan){var duration=this.animationDuration;if(bZoomPan===true){duration=2000}this.zoomTextRect.transition().duration(duration).attr("opacity",0).attr("stroke-opacity",0);this.zoomText.transition().duration(duration).attr("opacity",this.opacityOn)},defaultOnKeyDown:function(oEvent){var bProcessed=true;if(this.viewer&&!this.viewer.hasFocus){return false}switch(oEvent.keyCode){case 37:this.viewer.panLeft();break;case 39:this.viewer.panRight();break;case 38:this.viewer.panUp();break;case 40:this.viewer.panDown();break;case 36:this.viewer.panPageLeft();break;case 35:this.viewer.panPageRight();break;case 33:this.viewer.panPageUp();break;case 34:this.viewer.panPageDown();break;case 116:this.viewer.showActualSize();break;case 117:this.viewer.zoomIn();break;case 118:this.viewer.zoomOut();break;case 119:this.viewer.showGlobalView();break;default:bProcessed=false;break}return bProcessed},onKeyDown:function(oEvent){var bProcessed=this.defaultOnKeyDown(oEvent);if(bProcessed){oEvent.preventDefault();oEvent.stopImmediatePropagation()}return bProcessed}},statics:{ID:sap.galilei.ui.common.svg.Layer.ZOOM_TOOL_LAYER,NAME:sap.galilei.ui.common.svg.Layer.ZOOM_TOOL_LAYER,CLASS:sap.galilei.ui.common.svg.Layer.ZOOM_TOOL_LAYER}});(function(){var oProps={showZoomTools:{value:false,onChange:function(newValue,oldValue){this.notifyLayers("onChangeShowZoomTools",newValue,oldValue)}},zoomToolHorizontalAlignment:{value:sap.galilei.ui.common.HorizontalAlignment.left,onChange:function(newValue,oldValue){this.notifyLayers("onChangeZoomToolsLocation",newValue,oldValue)}},zoomToolVerticalAlignment:{value:sap.galilei.ui.common.VerticalAlignment.top,onChange:function(newValue,oldValue){this.notifyLayers("onChangeZoomToolsLocation",newValue,oldValue)}}};var oExtension={};sap.galilei.core.ClassDefinitionBuilder.transformProperties(oExtension,oProps);sap.galilei.core.extend(sap.galilei.ui.common.svg.Viewer,oExtension)})();
"use strict";namespace("sap.galilei.ui.common.tracker");sap.galilei.ui.common.tracker.Tracker=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.tracker.Tracker",initialize:function(options){if(options){this.set(options)}this.onInitialize();this.createHandles();this.drawHandles();this.addEventHandlers()},properties:{mainShape:undefined,cloneMainShape:undefined,viewer:undefined,transitionDefinition:undefined,endTransitionDefinition:undefined,handleProperties:undefined,handles:{type:sap.galilei.core.EnumPropertyType.collection,objectClass:"sap.galilei.ui.common.shape.Shape",writable:false},shapes:{type:sap.galilei.core.EnumPropertyType.collection,objectClass:"sap.galilei.ui.common.shape.Shape",writable:false}},methods:{onInitialize:function(){},createHandles:function(){},defaultAddEventHandlers:function(){var index,oHandle,oShape;for(index=0;index<this.handles.length;index++){oHandle=this.handles[index];oHandle.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartHandle,this,oHandle);oHandle.on(sap.galilei.ui.common.GestureEvents.drag,this.onDragHandle,this,oHandle);oHandle.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndHandle,this,oHandle)}for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];if(oShape.fill!==undefined&&oShape.fill!=="none"){oShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownShape,this,oShape);oShape.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartShape,this,oShape);oShape.on(sap.galilei.ui.common.GestureEvents.drag,this.onDragShape,this,oShape);oShape.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndShape,this,oShape)}}if(this.mainShape){this.mainShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownShape,this,this.mainShape);this.mainShape.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartShape,this,this.mainShape);this.mainShape.on(sap.galilei.ui.common.GestureEvents.drag,this.onDragShape,this,this.mainShape);this.mainShape.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndShape,this,this.mainShape)}},addEventHandlers:function(){this.defaultAddEventHandlers()},defaultRemoveEventHandlers:function(){var index,oHandle,oShape;for(index=0;index<this.handles.length;index++){oHandle=this.handles[index];oHandle.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartHandle,this);oHandle.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragHandle,this);oHandle.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndHandle,this)}for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];if(oShape.fill!==undefined&&oShape.fill!=="none"){oShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownShape,this);oShape.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartShape,this);oShape.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragShape,this);oShape.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndShape,this)}}if(this.mainShape){this.mainShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownShape,this);this.mainShape.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartShape,this);this.mainShape.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragShape,this);this.mainShape.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndShape,this)}},removeEventHandlers:function(){this.defaultRemoveEventHandlers()},defaultRemoveHandles:function(){var index,oHandle,oShape;for(index=0;index<this.handles.length;index++){oHandle=this.handles[index];oHandle.removeNode(this.viewer,this.transitionDefinition)}for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];oShape.removeNode(this.viewer,this.transitionDefinition)}this.handles.clear();this.shapes.clear();if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}},removeHandles:function(){this.defaultRemoveHandles()},onDragStartHandle:function(oEvent,oHandle){},defaultOnDragHandle:function(oEvent,oHandle){if(oEvent&&oHandle){var aDelta=this.viewer.pageDeltaToViewDelta([oEvent.gesture.deltaX,oEvent.gesture.deltaY]),oLayer=this.viewer.getLayerByName(sap.galilei.ui.common.svg.SemanticZoomLayer.NAME),aCenter;oEvent.stopPropagation();aCenter=[oHandle._cx0+aDelta[0],oHandle._cy0+aDelta[1]];oHandle.setCenter(aCenter[0],aCenter[1]);oHandle.updateDrawing(this.viewer);oLayer.moveTo(oHandle,oHandle.cx,oHandle.cy)}},canDragHandle:function(oEvent,oHandle){return true},onDragHandle:function(oEvent,oHandle){if(this.canDragHandle(oEvent,oHandle)){this.defaultOnDragHandle(oEvent,oHandle)}},onDragEndHandle:function(oEvent,oHandle){},onPointerDownShape:function(oEvent,oShape){oEvent.preventDefault();oEvent.stopPropagation()},onDragStartShape:function(oEvent,oShape){},canDragShape:function(oEvent,oShape){return true},onDragShape:function(oEvent,oShape){if(this.canDragShape(oEvent,oShape)){}},onDragEndShape:function(oEvent,oShape){},updateHandles:function(bUseAnimation){},defaultDrawHandles:function(){var oLayer=this.viewer.getLayerByName(sap.galilei.ui.common.svg.SemanticZoomLayer.NAME),index,oHandle,oShape,aCenter;for(index=0;index<this.handles.length;index++){oHandle=this.handles[index];oHandle.draw(this.viewer,oLayer.d3Layer,this.transitionDefinition);aCenter=oHandle.getCenter();oLayer.moveTo(oHandle,aCenter[0],aCenter[1])}for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];oShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition)}},drawHandles:function(){this.defaultDrawHandles()},showHandles:function(){var self=this,index,oHandle,oShape;for(index=0;index<this.handles.length;index++){oHandle=this.handles[index];oHandle.show(this.viewer,this.transitionDefinition)}for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];oHandle.show(this.viewer,this.transitionDefinition)}},hideHandles:function(){var self=this,index,oHandle,oShape;for(index=0;index<this.handles.length;index++){oHandle=this.handles[index];oHandle.hide(this.viewer,this.transitionDefinition)}for(index=0;index<this.shapes.length;index++){oShape=this.shapes[index];oHandle.hide(this.viewer,this.transitionDefinition)}},defaultCancel:function(){},cancel:function(){this.defaultCancel()},defaultDispose:function(){this.removeEventHandlers();this.removeHandles()},dispose:function(){this.defaultDispose()}}});sap.galilei.ui.common.tracker.defineTracker=function(oTrackerDef){var sTrackerName,TrackerClass;if(oTrackerDef){if(!oTrackerDef.parent){oTrackerDef.parent=sap.galilei.ui.common.tracker.Tracker}sTrackerName=oTrackerDef.trackerName;if(sTrackerName){delete oTrackerDef.trackerName}TrackerClass=sap.galilei.core.defineClass(oTrackerDef)}return TrackerClass};
"use strict";sap.galilei.ui.common.tracker.Handle=sap.galilei.ui.common.widget.defineWidget({fullClassName:"sap.galilei.ui.common.tracker.Handle",widgetName:"SelectionHandle",parent:sap.galilei.ui.common.widget.Badge,properties:{width:{expression:"sap.galilei.ui.common.tracker.Handle.DEFAULT_SIZE"},height:{expression:"sap.galilei.ui.common.tracker.Handle.DEFAULT_SIZE"},isSupportDrag:true},statics:{DEFAULT_SIZE:12}});
"use strict";sap.galilei.ui.common.tracker.PointsTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.common.tracker.PointsTracker",trackerName:"PointsTracker",fields:{_isDraggingHandle:false,_isDraggingShape:false,_previewShape:undefined},properties:{snapToGrid:false,isReadOnly:false,gridSize:sap.galilei.ui.common.svg.Viewer.GRID_SIZE,initialPoints:undefined,modifiedPoints:undefined,pointsShape:undefined,clonedPointsShape:undefined,draggedSegmentIndex:undefined},methods:{createHandles:function(){if(!this.viewer){throw"The viewer must be defined."}if(!this.initialPoints&&this.pointsShape&&this.pointsShape.points){this.initialPoints=this.pointsShape.points.clone()}if(!this.initialPoints||this.handles.length>0){return}if(!this._previewShape&&this.pointsShape){this._previewShape=sap.galilei.ui.common.shape.ShapeRegistry.createShape(this.pointsShape.name);this._previewShape.set({points:this.pointsShape.points.clone(),stroke:sap.galilei.ui.common.style.Color.orange,strokeWidth:2,strokeDashArray:"3",markerStart:undefined,markerEnd:undefined,markerMiddle:undefined});this._previewShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}if(!this.isReadOnly&&this.pointsShape){if(!this.clonedPointsShape){this.clonedPointsShape=sap.galilei.ui.common.shape.ShapeRegistry.createShape(this.pointsShape.name);this.clonedPointsShape.set({points:this.pointsShape.points.clone(),strokeWidth:10,opacity:0,stroke:sap.galilei.ui.common.style.Color.orange});this.clonedPointsShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}this.updateHandles()}},removeHandles:function(){var index,length,oHandle;for(index=0,length=this.handles.length;index<length;index++){oHandle=this.handles[index];oHandle.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartHandle,this);oHandle.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragHandle,this);oHandle.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndHandle,this);oHandle.removeNode(this.viewer,this.transitionDefinition)}this.handles.clear();if(this.clonedPointsShape){this.clonedPointsShape.dispose();this.clonedPointsShape=undefined}if(this._previewShape){this._previewShape.dispose();this._previewShape=undefined}},drawHandles:function(){var node;if(this._previewShape){if(!this._previewShape.isDrawn){this._previewShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer,this.transitionDefinition);if(this.clonedPointsShape&&this.clonedPointsShape.isDrawn){node=this._previewShape.d3Node.node();if(node){node.parentNode.insertBefore(node,this.clonedPointsShape.d3Node.node())}}}else{this._previewShape.updateDrawing(this.viewer,this.transitionDefinition)}}this.defaultDrawHandles()},updateHandles:function(){var index,length,aPoint,oHandle;if(this.clonedPointsShape&&this.pointsShape.points){this.clonedPointsShape.points=this.pointsShape.points.clone();this.clonedPointsShape.updateDrawing(this.viewer)}if(this._previewShape&&this.pointsShape.points){if(this._previewShape){this._previewShape.dispose()}this._previewShape.points=this.pointsShape.points.clone()}for(index=0,length=this.handles.length;index<length;index++){oHandle=this.handles[index];oHandle.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartHandle,this);oHandle.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragHandle,this);oHandle.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndHandle,this);oHandle.removeNode(this.viewer)}this.handles.clear();if(this.initialPoints){for(index=0,length=this.initialPoints.length;index<length;index++){if(!this.isPointEditable(index)){continue}aPoint=this.initialPoints[index];oHandle=new sap.galilei.ui.common.tracker.Handle({cx:aPoint[0],cy:aPoint[1]});oHandle._index=index;oHandle.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartHandle,this,oHandle);oHandle.on(sap.galilei.ui.common.GestureEvents.drag,this.onDragHandle,this,oHandle);oHandle.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndHandle,this,oHandle);this.handles.add(oHandle)}}},defaultAddEventHandlers:function(){if(this.clonedPointsShape){this.clonedPointsShape.on(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownShape,this,this.clonedPointsShape);this.clonedPointsShape.on(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUpShape,this,this.clonedPointsShape);this.clonedPointsShape.on(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartShape,this,this.clonedPointsShape);this.clonedPointsShape.on(sap.galilei.ui.common.GestureEvents.drag,this.onDragShape,this,this.clonedPointsShape);this.clonedPointsShape.on(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndShape,this,this.clonedPointsShape)}},defaultRemoveEventHandlers:function(){if(this.clonedPointsShape){this.clonedPointsShape.off(sap.galilei.ui.common.PointerEvents.pointerdown,this.onPointerDownShape,this);this.clonedPointsShape.off(sap.galilei.ui.common.PointerEvents.pointerup,this.onPointerUpShape,this);this.clonedPointsShape.off(sap.galilei.ui.common.GestureEvents.dragstart,this.onDragStartShape,this);this.clonedPointsShape.off(sap.galilei.ui.common.GestureEvents.drag,this.onDragShape,this);this.clonedPointsShape.off(sap.galilei.ui.common.GestureEvents.dragend,this.onDragEndShape,this)}},isPointEditable:function(index){return true},canDragStartHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&!this.isReadOnly){oEvent.cancel=false;oEvent.handle=oHandle;oEvent.handleIndex=oHandle._index;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];sap.galilei.core.Event.publish("pointsshape.handle.dragstart",this,undefined,oEvent);return !oEvent.cancel}return false},defaultOnDragStartHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this.canDragStartHandle(oEvent,oHandle)){this._isDraggingHandle=true}},onDragStartHandle:function(oEvent,oHandle){this.defaultOnDragStartHandle(oEvent,oHandle)},canDragHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this._isDraggingHandle){oEvent.cancel=false;oEvent.handle=oHandle;oEvent.handleIndex=oHandle._index;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentPoint=[oHandle.cx,oHandle.cy];sap.galilei.core.Event.publish("pointsshape.handle.drag",this,undefined,oEvent);return !oEvent.cancel}return false},snapToAttachPoint:function(oEvent,oHandle,aPoint){return aPoint},defaultOnDragHandle:function(oEvent,oHandle){var aDelta,aCenter,oLayer;if(oEvent&&oHandle&&this._isDraggingHandle){this.viewer.normalizePointerEvent(oEvent);aDelta=[oEvent.deltaClientViewX,oEvent.deltaClientViewY];oLayer=this.viewer.getLayerByName(sap.galilei.ui.common.svg.SemanticZoomLayer.NAME);oEvent.stopPropagation();aCenter=[oHandle._cx0+aDelta[0],oHandle._cy0+aDelta[1]];if(this.snapToGrid){aCenter.snapToGrid(this.gridSize)}aCenter=this.snapToAttachPoint(oEvent,oHandle,aCenter);if(this.canDragHandle(oEvent,oHandle)){oHandle.setCenter(aCenter[0],aCenter[1]);oHandle.updateDrawing(this.viewer);oLayer.moveTo(oHandle,oHandle.cx,oHandle.cy)}}},onDragHandle:function(oEvent,oHandle){this.defaultOnDragHandle(oEvent,oHandle)},defaultOnDragEndHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this._isDraggingHandle){this._isDraggingHandle=false;this.modifiedPoints=this.initialPoints.clone();this.modifiedPoints[oHandle._index][0]=oHandle.cx;this.modifiedPoints[oHandle._index][1]=oHandle.cy;if(this.canModifyPointsShape()){this.modifyPointsShape(true,oHandle._index);this.updateHandles();this.drawHandles()}}},onDragEndHandle:function(oEvent,oHandle){this.defaultOnDragEndHandle(oEvent,oHandle)},defaultOnPointerDownShape:function(oEvent,oShape){var oRect,oSegment,aPoint,i,length;oEvent.preventDefault();oEvent.stopPropagation();aPoint=this.viewer.normalizePointerEvent(oEvent);oRect=new sap.galilei.ui.common.Rect(aPoint[0]-5,aPoint[1]-5,10,10);for(i=0,length=this.initialPoints.length;i<length-1;i++){oSegment=new sap.galilei.ui.common.Segment(this.initialPoints[i],this.initialPoints[i+1]);if(oRect.isIntersectSegment(oSegment)){this.draggedSegmentIndex=i;break}}},onPointerDownShape:function(oEvent,oShape){this.defaultOnPointerDownShape(oEvent,oShape)},onPointerUpShape:function(oEvent,oShape){},canDragStartShape:function(oEvent,oShape){if(oEvent&&!this.isReadOnly){this.viewer.normalizePointerEvent(oEvent);var aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.segmentIndex=this.draggedSegmentIndex;sap.galilei.core.Event.publish("pointsshape.dragstart",this,undefined,oEvent);return !oEvent.cancel}return false},defaultOnDragStartShape:function(oEvent,oShape){if(oEvent&&this.canDragStartShape(oEvent,oShape)){this._isDraggingShape=true}},onDragStartShape:function(oEvent,oShape){this.defaultOnDragStartShape(oEvent,oShape)},defaultOnDragShape:function(oEvent,oShape){var aPoint,aPoints,aNewPoints,oSegment;if(this._isDraggingShape&&this.draggedSegmentIndex!==undefined&&this._previewShape){aPoint=this.viewer.normalizePointerEvent(oEvent);oSegment=new sap.galilei.ui.common.Segment(this.initialPoints[this.draggedSegmentIndex],this.initialPoints[this.draggedSegmentIndex+1]);oSegment.parallelMoveTo(aPoint[0],aPoint[1]);aPoints=this.initialPoints.clone();if(this.initialPoints.length===2){aPoints.splice(1,0,oSegment.point1,oSegment.point2)}else{if(this.draggedSegmentIndex===0){aPoints.splice(1,1,oSegment.point1,oSegment.point2)}else{if(this.draggedSegmentIndex===this.initialPoints.length-2){aPoints.splice(this.draggedSegmentIndex,1,oSegment.point1,oSegment.point2)}else{aPoints.splice(this.draggedSegmentIndex,2,oSegment.point1,oSegment.point2)}}}aNewPoints=sap.galilei.ui.common.layout.PointsLayout.removeElbows(aPoints);if(aNewPoints&&aNewPoints.length>=2&&aNewPoints.length!==aPoints){this._previewShape.points=aNewPoints}else{this._previewShape.points=aPoints}this._previewShape.updateDrawing(this.viewer)}},onDragShape:function(oEvent,oShape){this.defaultOnDragShape(oEvent,oShape)},defaultOnDragEndShape:function(oEvent,oShape){if(this._isDraggingShape){this._isDraggingShape=false;if(this._previewShape){this.modifiedPoints=this._previewShape.points.clone()}if(this.canModifyPointsShape()){this.modifyPointsShape(false);this.updateHandles();this.drawHandles()}}},onDragEndShape:function(oEvent,oShape){this.defaultOnDragEndShape(oEvent,oShape)},canModifyPointsShape:function(){return true},modifyPointsShape:function(){},defaultCancel:function(){this.initialPoints=this.symbol.points.clone();this.modifiedPoints=undefined;this.draggedSegmentIndex=undefined;this._isDraggingHandle=false;this._isDraggingShape=false;this.updateHandles();this.drawHandles();if(this.clonedPointsShape){this.clonedPointsShape.dispose();this.clonedPointsShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.hideSnapLines()}},dispose:function(){this.defaultDispose();this.initialPoints=undefined;this.modifiedPoints=undefined;this.pointsShape=undefined;if(this.clonedPointsShape){this.clonedPointsShape.dispose();this.clonedPointsShape=undefined}if(this._previewShape){this._previewShape.dispose();this._previewShape=undefined}this.draggedSegmentIndex=undefined}}});
"use strict";sap.galilei.ui.common.tracker.ResizeTracker=sap.galilei.ui.common.tracker.defineTracker({fullClassName:"sap.galilei.ui.common.tracker.ResizeTracker",trackerName:"ResizeTracker",properties:{initialBBox:undefined,resizedBBox:undefined,movedBBox:undefined,snapToGrid:false,gridSize:sap.galilei.ui.common.svg.Viewer.GRID_SIZE,snapToShapes:true,snapToShapesCenter:true,snapToShapesBorder:true,isReadOnly:false,isKeepSize:{field:"_isKeepSize",value:false,get:function(){if(this.isReadOnly){return true}return this._isKeepSize},set:function(bValue){this._isKeepSize=bValue}},isKeepAspectRatio:false,isKeepCenter:false,isKeepPosition:{field:"_isKeepPosition",value:false,get:function(){if(this.isReadOnly||this.isPinching){return true}return this._isKeepPosition},set:function(bValue){this._isKeepPosition=bValue}},isDraggingHandle:false,isDraggingShape:false,isPinching:false,frameShape:undefined,frameColor:"gray",frameMargin:1,snapToShapesHandler:undefined},methods:{createHandles:function(){if(!this.viewer){throw"The viewer must be defined."}if(this.mainShape){if(!this.initialBBox){this.initialBBox=this.mainShape.getBBox()}}if(!this.initialBBox||this.handles.length>0){return}var aPosition=[sap.galilei.ui.common.DockPosition.topLeft,sap.galilei.ui.common.DockPosition.top,sap.galilei.ui.common.DockPosition.topRight,sap.galilei.ui.common.DockPosition.right,sap.galilei.ui.common.DockPosition.bottomRight,sap.galilei.ui.common.DockPosition.bottom,sap.galilei.ui.common.DockPosition.bottomLeft,sap.galilei.ui.common.DockPosition.left],oCursors={topLeft:"nw-resize",top:"n-resize",topRight:"ne-resize",right:"e-resize",bottomRight:"se-resize",bottom:"s-resize",bottomLeft:"sw-resize",left:"w-resize"},index,aPt,oParams=this.handleProperties||{},oHandle,oFrameRect,oShape;this.initialBBox.normalize();this.resizedBBox=this.initialBBox.clone();this.movedBBox=this.initialBBox.clone();oShape=this.mainShape;if(oShape&&oShape.isComposite&&oShape.shapes.length>0){oShape=oShape.shapes[0]}if(oShape&&oShape.isComposite&&oShape.shapes.length>0){oShape=oShape.shapes[0]}if(oShape&&oShape.strokeWidth!==undefined&&oShape.strokeWidth!==1&&this.frameMargin===1){this.frameMargin=(oShape.strokeWidth-1)/2+1}oFrameRect=this.initialBBox.clone();oFrameRect.inflate(this.frameMargin,this.frameMargin);if(!this.isReadOnly&&!this.isKeepSize){for(index=0;index<aPosition.length;index++){aPt=oFrameRect.getPoint(aPosition[index]);sap.galilei.core.copyProperties(oParams,{cx:aPt[0],cy:aPt[1],cursor:oCursors[aPosition[index]]});oHandle=new sap.galilei.ui.common.tracker.Handle(oParams);oHandle._position=aPosition[index];this.handles.add(oHandle)}}this.frameShape=new sap.galilei.ui.common.shape.Rectangle({x:oFrameRect.x,y:oFrameRect.y,width:oFrameRect.width,height:oFrameRect.height,fill:"none",stroke:this.frameColor,strokeWidth:2,strokeDashArray:"3,3"});this.shapes.add(this.frameShape)},updateHandles:function(bUseEndTransition){var aPosition=[sap.galilei.ui.common.DockPosition.topLeft,sap.galilei.ui.common.DockPosition.top,sap.galilei.ui.common.DockPosition.topRight,sap.galilei.ui.common.DockPosition.right,sap.galilei.ui.common.DockPosition.bottomRight,sap.galilei.ui.common.DockPosition.bottom,sap.galilei.ui.common.DockPosition.bottomLeft,sap.galilei.ui.common.DockPosition.left],oLayer,index,aPt,oHandle,oTransformDef=bUseEndTransition?this.endTransitionDefinition:undefined,oResizedRect=this.resizedBBox.clone(),oMovedRect=this.movedBBox.normalize(true);oLayer=this.viewer.getLayerByName(sap.galilei.ui.common.svg.SemanticZoomLayer.NAME);oResizedRect.inflate(this.frameMargin,this.frameMargin);for(index=0;(index<aPosition.length&&index<this.handles.length);index++){aPt=oResizedRect.getPoint(aPosition[index]);oHandle=this.handles[index];if(oHandle.cx!==aPt[0]||oHandle.cy!==aPt[1]){oHandle.setCenter(aPt[0],aPt[1]);oHandle.updateDrawing(this.viewer,oTransformDef);if(oLayer){oLayer.moveTo(oHandle,oHandle.cx,oHandle.cy,oTransformDef)}}}if(this.cloneMainShape){this.cloneMainShape.x=oMovedRect.x;this.cloneMainShape.y=oMovedRect.y;this.cloneMainShape.updateDrawing(this.viewer,oTransformDef)}if(this.frameShape){oMovedRect.inflate(this.frameMargin,this.frameMargin);this.frameShape.setBBox(oMovedRect);this.frameShape.updateDrawing(this.viewer,oTransformDef)}},canDragStartHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&!this.isKeepSize){var oResizedRect=this.resizedBBox.normalize(true);oEvent.cancel=false;oEvent.handle=oHandle;oEvent.handlePosition=oHandle._position;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentBBox=oResizedRect;sap.galilei.core.Event.publish("resize.shape.handle.dragstart",this,undefined,oEvent);return !oEvent.cancel}return false},defaultOnDragStartHandle:function(oEvent,oHandle){if(oEvent&&oHandle){if(this.canDragStartHandle(oEvent,oHandle)){this.isDraggingHandle=true}}},onDragStartHandle:function(oEvent,oHandle){this.defaultOnDragStartHandle(oEvent,oHandle)},canDragHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this.isDraggingHandle){var oResizedRect=this.resizedBBox.normalize(true);oEvent.cancel=false;oEvent.handle=oHandle;oEvent.handlePosition=oHandle._position;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentPoint=[oHandle.cx,oHandle.cy];oEvent.currentBBox=oResizedRect;sap.galilei.core.Event.publish("resize.shape.handle.drag",this,undefined,oEvent);return !oEvent.cancel}return false},defaultOnDragHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this.isDraggingHandle){this.viewer.normalizePointerEvent(oEvent);var aDelta=[oEvent.deltaClientViewX,oEvent.deltaClientViewY],aCenter,aOldPoint,aOldBBox,bShiftKey=oEvent.gesture.srcEvent.shiftKey,bCtrlKey=oEvent.gesture.srcEvent.ctrlKey;oEvent.stopPropagation();aCenter=[oHandle._cx0+aDelta[0],oHandle._cy0+aDelta[1]];aOldBBox=this.resizedBBox.clone();this.resizedBBox=this.initialBBox.resizeByHandle(aCenter[0],aCenter[1],oHandle._position,true,this.isKeepAspectRatio||bShiftKey,this.isKeepCenter||bCtrlKey);if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(this.resizedBBox,true,oHandle._position)}if(this.snapToGrid){this.resizedBBox.snapToGrid(this.gridSize)}aOldPoint=[oHandle.cx,oHandle.cy];oHandle.cx=aCenter[0];oHandle.cy=aCenter[1];if(this.canDragHandle(oEvent,oHandle)){this.movedBBox=this.resizedBBox.clone();oHandle.cx=aOldPoint[0];oHandle.cy=aOldPoint[1];this.updateHandles()}else{oHandle.cx=aOldPoint[0];oHandle.cy=aOldPoint[1];this.resizedBBox=aOldBBox}}},onDragHandle:function(oEvent,oHandle){this.defaultOnDragHandle(oEvent,oHandle)},defaultCanResizeShape:function(oEvent,oHandle){if(oEvent){var oResizedRect=this.resizedBBox.normalize(true);oEvent.cancel=false;if(oHandle){oEvent.handle=oHandle;oEvent.handlePosition=oHandle._position;oEvent.initialPoint=[oHandle._cx0,oHandle._cy0];oEvent.currentPoint=[oHandle.cx,oHandle.cy];oEvent.currentBBox=oResizedRect;sap.galilei.core.Event.publish("resize.shape.handle.dragend",this,undefined,oEvent)}else{oEvent.currentBBox=oResizedRect;sap.galilei.core.Event.publish("resize.shape.pinchend",this,undefined,oEvent)}return !oEvent.cancel}return false},canResizeShape:function(oEvent,oHandle){return this.defaultCanResizeShape(oEvent,oHandle)},defaultResizeShape:function(){if(this.mainShape){if(this.endTransitionDefinition){this.frameShape.fill="white";this.frameShape.fillOpacity="0.01";this.frameShape.updateDrawing(this.viewer,undefined,["fill","fillOpacity"])}this.mainShape.setBBox(this.resizedBBox);this.mainShape.updateDrawing(this.viewer,this.endTransitionDefinition);if(this.endTransitionDefinition){var self=this;setTimeout(function(){self.frameShape.fill="none";self.frameShape.fillOpacity="0";self.frameShape.updateDrawing(self.viewer,undefined,["fill","fillOpacity"])},self.endTransitionDefinition.duration)}}},resizeShape:function(){this.defaultResizeShape()},defaultOnDragEndHandle:function(oEvent,oHandle){if(oEvent&&oHandle&&this.isDraggingHandle){this.isDraggingHandle=false;this.resizedBBox.normalize();if(this.snapToShapesHandler){this.snapToShapesHandler.highlightAndHideSnapLines(this.endTransitionDefinition)}if(this.canResizeShape(oEvent,oHandle)){this.initialBBox=this.resizedBBox.clone();this.movedBBox=this.resizedBBox.clone();this.resizeShape()}else{this.resizedBBox=this.initialBBox.clone();this.movedBBox=this.initialBBox.clone();this.updateHandles()}}},onDragEndHandle:function(oEvent,oHandle){this.defaultOnDragEndHandle(oEvent,oHandle)},onPinchStartShape:function(oEvent){},canPinchShape:function(oEvent){if(oEvent){oEvent.cancel=false;oEvent.currentBBox=this.resizedBBox;sap.galilei.core.Event.publish("resize.shape.pinch",this,undefined,oEvent);return !oEvent.cancel}return false},onPinchShape:function(oEvent){if(oEvent&&!this.isKeepSize){oEvent.preventDefault();oEvent.stopPropagation();if(!this.isPinching){this.isPinching=true;this.onPinchStartShape(oEvent)}var oNewRect=new sap.galilei.ui.common.Rect(this.initialBBox),oOldRect=this.resizedBBox.clone(),nPinchScale=oEvent.gesture.scale,nNewWidth=this.initialBBox.width*nPinchScale,nNewHeight=this.initialBBox.height*nPinchScale;this.resizedBBox=oNewRect.resize(nNewWidth,nNewWidth,false,true,true);if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(this.resizedBBox,true,undefined,true)}if(this.snapToGrid){this.resizedBBox.snapToGrid(this.gridSize)}if(this.canPinchShape(oEvent)){this.movedBBox=this.resizedBBox.clone();this.updateHandles()}else{this.resizedBBox=oOldRect}}},onPinchEndShape:function(oEvent){if(oEvent&&!this.isKeepSize){this.resizedBBox.normalize();if(this.snapToShapesHandler){this.snapToShapesHandler.highlightAndHideSnapLines(this.transitionDefinition)}if(this.canResizeShape(oEvent)){this.movedBBox=this.resizedBBox.clone();this.resizeShape()}else{this.resizedBBox=this.initialBBox.clone();this.movedBBox=this.initialBBox.clone();this.updateHandles()}}},onReleaseShape:function(oEvent){if(this.isPinching){this.onPinchEndShape(oEvent);this.isPinching=false;this.initialBBox=this.resizedBBox.clone();this.movedBBox=this.resizedBBox.clone()}},canDragStartShape:function(oEvent){if(oEvent&&!this.isKeepPosition){this.viewer.normalizePointerEvent(oEvent);var aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentBBox=this.movedBBox;sap.galilei.core.Event.publish("move.shape.dragstart",this,undefined,oEvent);return !oEvent.cancel}return false},defaultOnDragStartShape:function(oEvent){if(oEvent){if(this.canDragStartShape(oEvent)){this.isDraggingShape=true;if(!this.cloneMainShape){this.cloneMainShape=sap.galilei.ui.common.shape.ShapeRegistry.cloneShape(this.mainShape);this.cloneMainShape.x=this.initialBBox.x;this.cloneMainShape.y=this.initialBBox.y;this.cloneMainShape.filter=undefined;this.cloneMainShape.opacity=0.6;this.cloneMainShape.transform=undefined;if(sap.galilei.core.isInstanceOf(this.cloneMainShape,"sap.galilei.ui.common.shape.Group")){this.cloneMainShape.isEnableTransform=true;this.cloneMainShape.width=undefined;this.cloneMainShape.height=undefined}this.cloneMainShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}}}},onDragStartShape:function(oEvent){this.defaultOnDragStartShape(oEvent)},canDragShape:function(oEvent){if(oEvent&&this.isDraggingShape){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;sap.galilei.core.Event.publish("move.shape.drag",this,undefined,oEvent);return !oEvent.cancel}return false},defaultOnDragShape:function(oEvent){if(oEvent&&this.isDraggingShape){this.viewer.normalizePointerEvent(oEvent);var aDelta=[oEvent.deltaClientViewX,oEvent.deltaClientViewY],oOldBBox=this.movedBBox.clone();this.movedBBox.x=this.initialBBox.x+aDelta[0];this.movedBBox.y=this.initialBBox.y+aDelta[1];if(this.snapToShapesHandler){this.snapToShapesHandler.updateSnapLines(this.movedBBox,true)}if(this.snapToGrid){this.movedBBox.snapToGrid(this.gridSize)}if(this.canDragShape(oEvent)){this.updateHandles()}else{this.movedBBox=oOldBBox}}},onDragShape:function(oEvent){this.defaultOnDragShape(oEvent)},defaultCanMoveShape:function(oEvent){if(oEvent){var aCurrentPoint=this.viewer.normalizePointerEvent(oEvent),aInitialPoint=[oEvent.startClientViewX,oEvent.startClientViewY];oEvent.cancel=false;oEvent.initialPoint=aInitialPoint;oEvent.currentPoint=aCurrentPoint;oEvent.currentBBox=this.movedBBox;sap.galilei.core.Event.publish("move.shape.dragend",this,undefined,oEvent);return !oEvent.cancel}return true},canMoveShape:function(oEvent){return this.defaultCanMoveShape(oEvent)},defaultMoveShape:function(){if(this.mainShape){if(this.endTransitionDefinition){this.frameShape.fill="white";this.frameShape.fillOpacity="0.01";this.frameShape.updateDrawing(this.viewer,undefined,["fill","fillOpacity"])}this.mainShape.setBBox(this.movedBBox);this.mainShape.updateDrawing(this.viewer,this.endTransitionDefinition);this.updateHandles(true);if(this.endTransitionDefinition){var self=this;setTimeout(function(){self.frameShape.fill="none";self.frameShape.fillOpacity="0";self.frameShape.updateDrawing(self.viewer,undefined,["fill","fillOpacity"])},self.endTransitionDefinition.duration)}}},moveShape:function(){this.defaultMoveShape()},defaultOnDragEndShape:function(oEvent){if(oEvent&&this.isDraggingShape){this.isDraggingShape=false;if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.highlightAndHideSnapLines(this.endTransitionDefinition)}if(this.canMoveShape(oEvent)){this.resizedBBox=this.movedBBox.clone();this.initialBBox=this.movedBBox.clone();this.moveShape()}else{this.movedBBox=this.initialBBox.clone();this.updateHandles()}}},onDragEndShape:function(oEvent){this.defaultOnDragEndShape(oEvent)},defaultCancel:function(){this.isDraggingHandle=false;this.isDraggingShape=false;this.isPinching=false;this.resizedBBox=this.initialBBox.clone();this.movedBBox=this.initialBBox.clone();this.updateHandles();if(this.cloneMainShape){this.cloneMainShape.dispose();this.cloneMainShape=undefined}if(this.snapToShapesHandler){this.snapToShapesHandler.hideSnapLines()}},defaultDispose:function(){this.removeEventHandlers();this.removeHandles();this.isDraggingHandle=false;this.isDraggingShape=false;this.isPinching=false;if(this.snapToShapesHandler){this.snapToShapesHandler.dispose();this.snapToShapesHandler=undefined}}}});
"use strict";sap.galilei.ui.common.tracker.SnapToShapes=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.tracker.SnapToShapes",statics:{SNAP_LINE_THRESHOLD:4,SNAP_LINE_COLOR:sap.galilei.ui.common.style.Color.orange},properties:{horizontalShapesIndex:[],verticalShapesIndex:[],snapToShapesCenter:true,snapToShapesBorder:true,viewer:undefined,transitionDefinition:undefined,horizontalLine1:undefined,horizontalLine2:undefined,horizontalLine3:undefined,verticalLine1:undefined,verticalLine2:undefined,verticalLine3:undefined},methods:{addShapeBBox:function(oRect){if(oRect){var oNormRect=oRect.normalize(true),left=Math.round(oNormRect.x),top=Math.round(oNormRect.y),right=Math.round(oNormRect.right),bottom=Math.round(oNormRect.bottom),aCenter=oNormRect.getCenter(true),hCenter=aCenter[0],vCenter=aCenter[1];if(this.snapToShapesBorder){this.addHorizontalShapeIndex(left,top,bottom);this.addHorizontalShapeIndex(right,top,bottom);this.addVerticalShapeIndex(top,left,right);this.addVerticalShapeIndex(bottom,left,right)}if(this.snapToShapesCenter){this.addHorizontalShapeIndex(hCenter,top,bottom);this.addVerticalShapeIndex(vCenter,left,right)}}},addHorizontalShapeIndex:function(x,top,bottom){var oResult={},oEntry;if(!this.findShapeIndexEntry(oResult,this.horizontalShapesIndex,x)){oEntry={coordinate:x,minValue:top,maxValue:bottom};this.horizontalShapesIndex.splice(oResult.index,0,oEntry)}else{oEntry=oResult.entry;oEntry.minValue=Math.min(oEntry.minValue,top);oEntry.maxValue=Math.max(oEntry.maxValue,bottom)}},addVerticalShapeIndex:function(y,left,right){var oResult={},oEntry;if(!this.findShapeIndexEntry(oResult,this.verticalShapesIndex,y)){oEntry={coordinate:y,minValue:left,maxValue:right};this.verticalShapesIndex.splice(oResult.index,0,oEntry)}else{oEntry=oResult.entry;oEntry.minValue=Math.min(oEntry.minValue,left);oEntry.maxValue=Math.max(oEntry.maxValue,right)}},findShapeIndexEntry:function(oResult,aShapeIndex,nCoordinate){if(oResult&&aShapeIndex){var index,oEntry;oResult.index=-1;oResult.entry=undefined;for(index=0;index<aShapeIndex.length;index++){oEntry=aShapeIndex[index];if(oEntry.coordinate===nCoordinate){oResult.index=index;oResult.entry=oEntry;return true}else{if(oEntry.coordinate>nCoordinate){oResult.index=index;return false}}}oResult.index=aShapeIndex.length}return false},findVerticalSnapLine:function(x,nThreshold){return this.findSnapLine(this.horizontalShapesIndex,x,nThreshold)},findHorizontalSnapLine:function(y,nThreshold){return this.findSnapLine(this.verticalShapesIndex,y,nThreshold)},findSnapLine:function(aShapeIndex,nCoordinate,nThreshold){if(aShapeIndex){var index,oEntry,nDiff,nMinValue,nBestIndex;for(index=0;index<aShapeIndex.length;index++){oEntry=aShapeIndex[index];nDiff=Math.abs(oEntry.coordinate-nCoordinate);if(nDiff<=nThreshold){if(nBestIndex===undefined||nDiff<nMinValue){nBestIndex=index;nMinValue=nDiff}else{break}}}if(nBestIndex!==undefined){return aShapeIndex[nBestIndex]}}return undefined},createSnapLines:function(){var aSnapLines=["verticalLine1","verticalLine2","verticalLine3","horizontalLine1","horizontalLine2","horizontalLine3"],index;for(index=0;index<aSnapLines.length;index++){if(!this[aSnapLines[index]]){this[aSnapLines[index]]=new sap.galilei.ui.common.shape.Line({x1:0,y1:0,x2:0,y2:0,opacity:0,stroke:sap.galilei.ui.common.tracker.SnapToShapes.SNAP_LINE_COLOR})}}},updateSnapLines:function(oRect,bModify,sDockPosition,bNoSnapCenter,bNoSnapBorder){if(oRect){var oNormRect=oRect.normalize(true),left=Math.round(oNormRect.x),top=Math.round(oNormRect.y),right=Math.round(oNormRect.right),bottom=Math.round(oNormRect.bottom),aCenter=oNormRect.getCenter(true),hCenter=aCenter[0],vCenter=aCenter[1],aSnapLines=[[false,left,top,bottom,this.verticalLine1,true,false],[false,hCenter,top,bottom,this.verticalLine2,true,false],[false,right,top,bottom,this.verticalLine3,true,false],[true,top,left,right,this.horizontalLine1,true,false],[true,vCenter,left,right,this.horizontalLine2,true,false],[true,bottom,left,right,this.horizontalLine3,true,false]],oEnabledLines={topLeft:[0,3],top:[3],topRight:[3,2],right:[2],bottomRight:[5,2],bottom:[5],bottomLeft:[5,0],left:[0]},aSnapLine,aEnabledLines,index,oEntry,nThreshold=sap.galilei.ui.common.tracker.SnapToShapes.SNAP_LINE_THRESHOLD,bHorizontal,nCoordinate,nMinValue,nMaxValue,oShape,bEnabled,bShow,dx=0,dy=0,dx2,dy2,aNewPoint;if(sDockPosition){for(index=0;index<aSnapLines.length;index++){aSnapLine=aSnapLines[index][5]=false}aEnabledLines=oEnabledLines[sDockPosition];if(aEnabledLines){for(index=0;index<aEnabledLines.length;index++){aSnapLine=aSnapLines[aEnabledLines[index]][5]=true}}}if(bNoSnapCenter){aSnapLines[1][5]=false;aSnapLines[4][5]=false}if(bNoSnapBorder){aSnapLines[0][5]=false;aSnapLines[2][5]=false;aSnapLines[3][5]=false;aSnapLines[5][5]=false}for(index=0;index<aSnapLines.length;index++){aSnapLine=aSnapLines[index];bHorizontal=aSnapLine[0];nCoordinate=aSnapLine[1];nMinValue=aSnapLine[2];nMaxValue=aSnapLine[3];oShape=aSnapLine[4];bEnabled=aSnapLine[5];if(bEnabled){if(bHorizontal){oEntry=this.findHorizontalSnapLine(nCoordinate,nThreshold)}else{oEntry=this.findVerticalSnapLine(nCoordinate,nThreshold)}if(oEntry){nMinValue=Math.min(oEntry.minValue,nMinValue);nMaxValue=Math.max(oEntry.maxValue,nMaxValue);if(bHorizontal){dy2=oEntry.coordinate-nCoordinate;if(dy===0||dy2===dy){aSnapLine[6]=true;oShape.x1=nMinValue-20;oShape.x2=nMaxValue+20;oShape.y1=oShape.y2=oEntry.coordinate;if(dy===0){dy=dy2}}}else{dx2=oEntry.coordinate-nCoordinate;if(dx===0||dx2===dx){aSnapLine[6]=true;oShape.y1=nMinValue-20;oShape.y2=nMaxValue+20;oShape.x1=oShape.x2=oEntry.coordinate;if(dx===0){dx=dx2}}}}}}if(aSnapLines[0][6]&&aSnapLines[1][6]&&aSnapLines[2][6]&&Math.abs(aSnapLines[0][4].y1-aSnapLines[1][4].y1)<=1&&Math.abs(aSnapLines[0][4].y1-aSnapLines[2][4].y1)<=1&&Math.abs(aSnapLines[0][4].y2-aSnapLines[1][4].y2)<=1&&Math.abs(aSnapLines[0][4].y2-aSnapLines[2][4].y2)<=1){aSnapLines[0][6]=false;aSnapLines[2][6]=false}if(aSnapLines[3][6]&&aSnapLines[4][6]&&aSnapLines[5][6]&&Math.abs(aSnapLines[3][4].x1-aSnapLines[4][4].x1)<=1&&Math.abs(aSnapLines[3][4].x1-aSnapLines[5][4].x1)<=1&&Math.abs(aSnapLines[3][4].x2-aSnapLines[4][4].x2)<=1&&Math.abs(aSnapLines[3][4].x2-aSnapLines[5][4].x2)<=1){aSnapLines[3][6]=false;aSnapLines[5][6]=false}for(index=0;index<aSnapLines.length;index++){aSnapLine=aSnapLines[index];oShape=aSnapLine[4];bShow=aSnapLine[6];if(bShow){if(!oShape.isDrawn){oShape.draw(this.viewer,this.viewer.d3ShapeDecoratorLayer)}oShape.opacity=1;oShape.updateDrawing(this.viewer,this.transitionDefinition,["x1","y1","x2","y2","opacity"])}else{this.hideSnapLine(oShape)}}if(bModify&&(dx!==0||dy!==0)){if(sDockPosition){aNewPoint=oRect.getPoint(sDockPosition);oRect.resizeByHandle(aNewPoint[0]+dx,aNewPoint[1]+dy,sDockPosition)}else{oRect.moveBy(dx,dy)}}}},hideSnapLine:function(oShape,oTransitionDef){if(oShape&&oShape.isDrawn){oTransitionDef=oTransitionDef||this.transitionDefinition;oShape.removeNode(this.viewer,oTransitionDef)}},hideSnapLines:function(oTransitionDef){var aSnapLines=["verticalLine1","verticalLine2","verticalLine3","horizontalLine1","horizontalLine2","horizontalLine3"],index;for(index=0;index<aSnapLines.length;index++){this.hideSnapLine(this[aSnapLines[index]],oTransitionDef)}},highlightAndHideShape:function(oShape,oTransitionDef){var self=this;oShape.strokeWidth=2;oShape.updateDrawing(this.viewer,oTransitionDef,["strokeWidth"]);setTimeout(function(){oShape.strokeWidth=1;oShape.opacity=0.01;oShape.updateDrawing(self.viewer,oTransitionDef,["strokeWidth, opacity"]);setTimeout(function(){oShape.removeNode()},oTransitionDef.duration)},oTransitionDef.duration)},highlightAndHideSnapLines:function(oTransitionDef){var aSnapLines=["verticalLine1","verticalLine2","verticalLine3","horizontalLine1","horizontalLine2","horizontalLine3"],index,oShape;if(!oTransitionDef){oTransitionDef=this.transitionDefinition}for(index=0;index<aSnapLines.length;index++){oShape=this[aSnapLines[index]];if(oTransitionDef){this.highlightAndHideShape(oShape,oTransitionDef)}else{this.hideSnapLine(oShape)}}},clearShapeIndexes:function(){this.horizontalShapesIndex=[];this.verticalShapesIndex=[]},dispose:function(){this.hideSnapLines();this.clearShapeIndexes()}}});
"use strict";sap.galilei.ui.common.Font=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Font",statics:{getFontHeight:function(sFontProps){return sap.galilei.ui.common.canvas.Canvas.getFontHeight(sFontProps)},getFontProperties:function(dElement){if(dElement){var style=window.getComputedStyle(dElement,null);return sap.galilei.ui.common.Font.getFontPropertiesFromStyle(style)}return""},getFontPropertiesFromStyle:function(style){var sFont="",fontWeight;if(style){if(style.font&&style.font.length>0){return style.font}if(style.fontStyle&&style.fontStyle.length>0){sFont+=style.fontStyle+" "}if(style.fontVariant&&style.fontVariant.length>0){sFont+=style.fontVariant+" "}if(style.fontWeight&&style.fontWeight.length>0){fontWeight=style.fontWeight;switch(fontWeight){case"100":case"200":fontWeight="lighter";break;case"300":case"400":case"500":fontWeight="normal";break;case"600":case"700":case"800":fontWeight="bold";break;case"900":fontWeight="bolder";break}sFont+=fontWeight+" "}sFont+=style.fontSize;if(style.lineHeight&&style.lineHeight.length>0){sFont+="/"+style.lineHeight}sFont+=" ";if(style.fontFamily&&style.fontFamily.length>0){sFont+="'"+style.fontFamily+"'"}}return sFont}}});
"use strict";sap.galilei.ui.common.Image=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Image",statics:{_htmlImage:undefined,convertImageToDataUrl:function(oImage,sImageFormat,width,height,bAdjustSize,backColor){return sap.galilei.ui.common.canvas.Canvas.convertImageToDataUrl(oImage,sImageFormat,width,height,bAdjustSize,backColor)},convertSVGToImageDataUrl:function(sSVG,fnImageReady,sImageFormat,width,height,bAdjustSize){var sExtension,sSvgDataURL,sImageDataURL;if(sSVG){if(sSVG.length>4){sExtension=sSVG.substring(sSVG.length-4);sExtension=sExtension.toLowerCase()}if(sExtension===".svg"){sSvgDataURL=sSVG}else{sSvgDataURL=sap.galilei.ui.common.svg.Svg.convertSvgToDataUrl(sSVG)}if(sSvgDataURL){sap.galilei.ui.common.Image._htmlImage=new Image();sap.galilei.ui.common.Image._htmlImage.onload=function(){if(!sImageFormat||(sImageFormat!=="image/png"&&sImageFormat!=="image/jpeg")){sImageFormat="image/png"}sImageDataURL=sap.galilei.ui.common.Image.convertImageToDataUrl(sap.galilei.ui.common.Image._htmlImage,sImageFormat,width,height,bAdjustSize);if(sImageDataURL){if(fnImageReady){fnImageReady(sImageDataURL)}}delete sap.galilei.ui.common.Image._htmlImage};sap.galilei.ui.common.Image._htmlImage.src=sSvgDataURL}}},convertSVGToImage:function(sSVG,fnImageReady,sImageFormat,width,height,bAdjustSize){var sExtension,sSvgDataURL,sImageDataURL;if(sSVG&&window.atob){if(sSVG.length>4){sExtension=sSVG.substring(sSVG.length-4);sExtension=sExtension.toLowerCase()}if(sExtension===".svg"){sSvgDataURL=sSVG}else{sSvgDataURL=sap.galilei.ui.common.svg.Svg.convertSvgToDataUrl(sSVG)}if(sSvgDataURL){sap.galilei.ui.common.Image._htmlImage=new Image();sap.galilei.ui.common.Image._htmlImage.onload=function(){if(!sImageFormat||(sImageFormat!=="image/png"&&sImageFormat!=="image/jpeg")){sImageFormat="image/png"}sImageDataURL=sap.galilei.ui.common.Image.convertImageToDataUrl(sap.galilei.ui.common.Image._htmlImage,sImageFormat,width,height,bAdjustSize);if(sImageDataURL){sImageDataURL=sImageDataURL.replace(/^data:image\/(png|jpeg);base64,/,"");sImageDataURL=atob(sImageDataURL);if(fnImageReady){fnImageReady(sImageDataURL)}}delete sap.galilei.ui.common.Image._htmlImage};sap.galilei.ui.common.Image._htmlImage.src=sSvgDataURL}}},convertSVGToImageBlob:function(sSVG,fnImageReady,sImageFormat,width,height,bAdjustSize){var aBytes,index,oBlob;if(sSVG&&window.Uint8Array&&window.Blob){sap.galilei.ui.common.Image.convertSVGToImage(sSVG,function(sImageData){if(sImageData){aBytes=new Uint8Array(sImageData.length);for(index=0;index<sImageData.length;index++){aBytes[index]=sImageData.charCodeAt(index)}if(!sImageFormat||(sImageFormat!=="image/png"&&sImageFormat!=="image/jpeg")){sImageFormat="image/png"}oBlob=new Blob([aBytes],{type:sImageFormat});if(fnImageReady){fnImageReady(oBlob)}}},sImageFormat,width,height,bAdjustSize)}}}});
"use strict";sap.galilei.ui.common.Matrix=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Matrix",initialize:function(options){this.set.apply(this,arguments)},properties:{a:1,b:0,c:0,d:1,e:0,f:0,isIdentity:{get:function(){return(this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.e===0&&this.f===0)}}},methods:{set:function(oMatrix){if(arguments.length===1){if(oMatrix instanceof SVGMatrix){sap.galilei.ui.common.Matrix.setMatrixProperties(this,oMatrix)}else{this.a=oMatrix.a;this.b=oMatrix.b;this.c=oMatrix.c;this.d=oMatrix.d;this.e=oMatrix.e;this.f=oMatrix.f}}else{if(arguments.length===6){this.a=+arguments[0];this.b=+arguments[1];this.c=+arguments[2];this.d=+arguments[3];this.e=+arguments[4];this.f=+arguments[5]}}return this},clone:function(){return new sap.galilei.ui.common.Matrix(this)},setIdentity:function(){this.a=1;this.b=0;this.c=0;this.d=1;this.e=0;this.f=0},transformRectangles:function(oRect1,oRect2){if(oRect1&&oRect2){var scaleX,scaleY,ptCenter1,ptCenter2;ptCenter1=oRect1.getCenter(false);ptCenter2=oRect2.getCenter(false);if(oRect1.width!==0&&oRect1.height!==0){scaleX=oRect2.width/oRect1.width;scaleY=oRect2.height/oRect1.height;this.translate(ptCenter2[0],ptCenter2[1]);this.scale(scaleX,scaleY);this.translate(-ptCenter1[0],-ptCenter1[1])}}return this},multiply:function(oSecondMatrix){var svgMatrix1,svgMatrix2;if(oSecondMatrix){svgMatrix1=sap.galilei.ui.common.Matrix.getSVGMatrix(this);svgMatrix2=sap.galilei.ui.common.Matrix.getSVGMatrix2(oSecondMatrix);this.set(svgMatrix1.multiply(svgMatrix2))}return this},inverse:function(){var svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);this.set(svgMatrix.inverse());return this},translate:function(dx,dy){var svgMatrix;dx=+dx;dy=+dy;if(dx!==undefined&&dy!==undefined&&!isNaN(dx)&&!isNaN(dy)){svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);this.set(svgMatrix.translate(dx,dy))}return this},scale:function(scaleX,scaleY,cx,cy){var svgMatrix,newSvgMatrix;scaleX=+scaleX;scaleY=+scaleY;if(scaleX!==undefined&&!isNaN(scaleX)){cx=+cx;cy=+cy;if(arguments.length===4&&!isNaN(cx)&&!isNaN(cy)){this.translate(cx,cy)}svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);if(scaleY===undefined||isNaN(scaleY)||scaleY===scaleX){newSvgMatrix=svgMatrix.scale(scaleX)}else{newSvgMatrix=svgMatrix.scaleNonUniform(scaleX,scaleY)}this.set(newSvgMatrix);if(arguments.length===4&&!isNaN(cx)&&!isNaN(cy)){this.translate(-cx,-cy)}}return this},rotate:function(angle,cx,cy){var svgMatrix;angle=+angle;if(angle!==undefined&&!isNaN(angle)){cx=+cx;cy=+cy;if(arguments.length===3&&!isNaN(cx)&&!isNaN(cy)){this.translate(cx,cy)}svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);this.set(svgMatrix.rotate(angle));if(arguments.length===3&&!isNaN(cx)&&!isNaN(cy)){this.translate(-cx,-cy)}}return this},rotateFromVector:function(dx,dy,cx,cy){var svgMatrix;dx=+dx;dy=+dy;if(dx!==undefined&&dy!==undefined&&!isNaN(dx)&&!isNaN(dy)){cx=+cx;cy=+cy;if(dx===0){if(dy<0){return this.rotate(-90,cx,cy)}else{return this.rotate(90,cx,cy)}}if(dy!==0){if(arguments.length===3&&!isNaN(cx)&&!isNaN(cy)){this.translate(cx,cy)}svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);this.set(svgMatrix.rotateFromVector(dx,dy));if(arguments.length===3&&!isNaN(cx)&&!isNaN(cy)){this.translate(-cx,-cy)}}}return this},rotateFromVectors:function(x1,y1,x2,y2,cx,cy){x1=+x1;y1=+y1;x2=+x2;y2=+y2;if(x1!==undefined&&y1!==undefined&&x2!==undefined&&y2!==undefined&&!isNaN(x1)&&!isNaN(y1)&&!isNaN(x2)&&!isNaN(y2)){var dx1,dy1,dx2,dy2;cx=+cx;cy=+cy;if(cx===undefined||isNaN(cx)){cx=0}if(cy===undefined||isNaN(cy)){cy=0}dx1=x1-cx;dy1=y1-cy;dx2=x2-cx;dy2=y2-cy;this.rotateFromVector(dx2,dy2,cx,cy);this.rotateFromVector(dx1,-dy1,cx,cy)}return this},flipX:function(cx){var svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);cx=+cx;if(arguments.length===1&&!isNaN(cx)){this.translate(cx,0)}this.set(svgMatrix.flipX());if(arguments.length===1&&!isNaN(cx)){this.translate(-cx-cx,0)}return this},flipY:function(cy){var svgMatrix=sap.galilei.ui.common.Matrix.getSVGMatrix(this);cy=+cy;if(arguments.length===1&&!isNaN(cy)){this.translate(0,cy)}this.set(svgMatrix.flipY());if(arguments.length===1&&!isNaN(cy)){this.translate(0,-cy-cy)}return this},getTransform:function(){var sTransform;if(this.b===0&&this.c===0){if(this.e!==0||this.f!==0){sTransform="translate("+this.e+" "+this.f+")"}if(this.a!==0||this.d!==0){if(!sTransform){sTransform=""}else{sTransform+=" "}sTransform+="scale("+this.a+" "+this.d+")"}}else{sTransform="matrix("+this.a+" "+this.b+" "+this.c+" "+this.d+" "+this.e+" "+this.f+")"}return sTransform}},statics:{_svgMatrx:undefined,_svgMatrx2:undefined,svgMatrix:{get:function(){if(this._svgMatrx===undefined){this._svgMatrx=sap.galilei.ui.common.svg.Svg.hiddenSvg.createSVGMatrix()}return this._svgMatrx}},svgMatrix2:{get:function(){if(this._svgMatrx2===undefined){this._svgMatrx2=sap.galilei.ui.common.svg.Svg.hiddenSvg.createSVGMatrix()}return this._svgMatrx2}},setSvgMatrixProperties:function(oSvgMatrix,oMatrix){if(oSvgMatrix&&oMatrix){oSvgMatrix.a=oMatrix.a;oSvgMatrix.b=oMatrix.b;oSvgMatrix.c=oMatrix.c;oSvgMatrix.d=oMatrix.d;oSvgMatrix.e=oMatrix.e;oSvgMatrix.f=oMatrix.f}return oSvgMatrix},setMatrixProperties:function(oMatrix,oSvgMatrix){if(oMatrix&&oSvgMatrix){oMatrix.a=oSvgMatrix.a;oMatrix.b=oSvgMatrix.b;oMatrix.c=oSvgMatrix.c;oMatrix.d=oSvgMatrix.d;oMatrix.e=oSvgMatrix.e;oMatrix.f=oSvgMatrix.f}return oMatrix},getNewMatrix:function(oSvgMatrix){return new sap.galilei.ui.common.Matrix(oSvgMatrix)},getSVGMatrix:function(oMatrix){var oSvgMatrix=sap.galilei.ui.common.Matrix.svgMatrix;sap.galilei.ui.common.Matrix.setSvgMatrixProperties(oSvgMatrix,oMatrix);return oSvgMatrix},getSVGMatrix2:function(oMatrix){var oSvgMatrix=sap.galilei.ui.common.Matrix.svgMatrix2;sap.galilei.ui.common.Matrix.setSvgMatrixProperties(oSvgMatrix,oMatrix);return oSvgMatrix}}});
"use strict";sap.galilei.ui.common.Text=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.Text",statics:{DEFAULT_FONT:"12px Arial, Helvetica, sans-serif",DEFAULT_UI_FONT:"14px Arial, Helvetica, sans-serif",NEWLINE_SEPARATOR:"\r\n",WORD_SEPARATORS:" \t,;.!?-_()[]{}'\"*+/%<>|@=&#",measureTextLineWidth:function(sText,sFontProps){return sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(sText,sFontProps)},measureTextSize:function(sText,sFontProps){return sap.galilei.ui.common.canvas.Canvas.measureTextSize(sText,sFontProps)},ellipsisTextLine:function(sText,iClipWidth,sFontProps){var clipText="",iTextWidth=0,iTextHeight=0;iClipWidth=(iClipWidth!==undefined)?+iClipWidth:-1;if(sText&&sText.length>0){sap.galilei.ui.common.canvas.Canvas.font(sFontProps);iTextHeight=sap.galilei.ui.common.canvas.Canvas.getFontHeight();if(iClipWidth>=0){var iEllipsisWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth("..."),len=sText.length,sLine=sText,iWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(sText),bAddEllipsis=true;if(sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(sText.slice(0,2))+iEllipsisWidth>iClipWidth){bAddEllipsis=false;iEllipsisWidth=0}if(len>0){if(bAddEllipsis){iWidth+=iEllipsisWidth}while(iWidth>iClipWidth){--len;if(len===0){sLine="";iWidth=0;iTextHeight=0;break}if(len<=1){bAddEllipsis=false;iEllipsisWidth=0}sLine=sText.slice(0,len);iWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(sLine);if(bAddEllipsis){iWidth+=iEllipsisWidth}}if(bAddEllipsis){sLine+="..."}}clipText=sLine;iTextWidth=iWidth}else{clipText=sText+"...";iTextWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(clipText)}}return{text:clipText,width:iTextWidth,height:iTextHeight}},clipTextLine:function(sText,iClipWidth,iClipHeight,bAddEllipsis,sFontProps){var clipText="",iTextWidth=0,iTextHeight=0;iClipWidth=(iClipWidth!==undefined)?+iClipWidth:-1;iClipHeight=(iClipHeight!==undefined)?+iClipHeight:-1;if(bAddEllipsis===undefined){bAddEllipsis=true}if(sText&&sText.length>0){sap.galilei.ui.common.canvas.Canvas.font(sFontProps);iTextHeight=sap.galilei.ui.common.canvas.Canvas.getFontHeight();if(iClipHeight===-1||iClipHeight>=iTextHeight){if(iClipWidth>=0){var len=sText.length,oldLen=len,sLine=sText.slice(0,len),iWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(sLine);if(iWidth>iClipWidth){while(iWidth>iClipWidth){oldLen=len;len=Math.floor(len/2);if(len===0){break}sLine=sText.slice(0,len);iWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(sLine)}len=oldLen;var iEllipsisWidth=0;if(bAddEllipsis){iEllipsisWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth("...")}if(len<5||(sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(sText.slice(0,2))+iEllipsisWidth>iClipWidth)){bAddEllipsis=false;iEllipsisWidth=0}if(len>0){sLine=sText.slice(0,len);iWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(sLine);if(bAddEllipsis){iWidth+=iEllipsisWidth}while(iWidth>iClipWidth){--len;if(len===0){sLine="";iWidth=0;iTextHeight=0;break}if(len<=1){bAddEllipsis=false;iEllipsisWidth=0}sLine=sText.slice(0,len);iWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(sLine);if(bAddEllipsis){iWidth+=iEllipsisWidth}}if(bAddEllipsis){sLine+="..."}}}clipText=sLine;iTextWidth=iWidth}else{clipText=sText;iTextWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(clipText)}}else{iTextHeight=0}}if(clipText.length===0){iTextWidth=iTextHeight=0}return{text:clipText,width:iTextWidth,height:iTextHeight}},isWordSeparator:function(c){var i;if(c&&c.length===1){for(i=0;i<this.WORD_SEPARATORS.length;++i){if(c===this.WORD_SEPARATORS[i]){return true}}}return false},getWord:function(text){var word="",i,c;if(text&&text.length>0){for(i=0;i<text.length;++i){c=text[i];word+=c;if(this.isWordSeparator(c)){return word}}}return word},wrapWord:function(word,iClipWidth,iClipHeight,sFontProps){var aLines=[],aLineWidths=[],iLineHeight=0,iTotalWidth=0,iTotalHeight=0,bLinesClipped=false,iWidth,sRest,c,sLine,iCharWidth;iClipWidth=(iClipWidth!==undefined)?+iClipWidth:-1;iClipHeight=(iClipHeight!==undefined)?+iClipHeight:-1;if(word&&word.length>0){sap.galilei.ui.common.canvas.Canvas.font(sFontProps);iLineHeight=sap.galilei.ui.common.canvas.Canvas.getFontHeight();if(iClipHeight===-1||iClipHeight>=iLineHeight){iWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(word);if(iClipWidth>=0&&iWidth>iClipWidth){sRest=word;sLine="";iWidth=0;do{c=sRest.slice(0,1);if(iClipHeight!==-1&&iTotalHeight+iLineHeight>iClipHeight){bLinesClipped=true;sLine="";break}iCharWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(c);if(iWidth+iCharWidth>iClipWidth){if(sLine.length>0){aLines.push(sLine);aLineWidths.push(iWidth);iTotalWidth=Math.max(iTotalWidth,iWidth);iTotalHeight+=iLineHeight;sLine=c;iWidth=iCharWidth}else{aLines.push(c);aLineWidths.push(iCharWidth);iTotalWidth=Math.max(iTotalWidth,iCharWidth);iTotalHeight+=iLineHeight}}else{sLine+=c;iWidth+=iCharWidth}sRest=sRest.slice(1)}while(sRest.length>0);if(sLine.length>0){aLines.push(sLine);aLineWidths.push(iWidth);iTotalWidth=Math.max(iTotalWidth,iWidth);iTotalHeight+=iLineHeight}}else{aLines[0]=word;aLineWidths[0]=iTotalWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(word);iTotalHeight=iLineHeight}}else{iLineHeight=0;bLinesClipped=true}}return{lines:aLines,lineWidths:aLineWidths,lineHeight:iLineHeight,totalWidth:iTotalWidth,totalHeight:iTotalHeight,isLinesClipped:bLinesClipped}},lineWrapText:function(sText,iClipHeight,sFontProps){var aLines=[],aLineWidths=[],iLineHeight=0,iTotalWidth=0,iTotalHeight=0,bLinesClipped=false,aInternalLines,i,sLine,iWidth;iClipHeight=(iClipHeight!==undefined)?+iClipHeight:-1;if(sText&&sText.length>0){sap.galilei.ui.common.canvas.Canvas.font(sFontProps);iLineHeight=sap.galilei.ui.common.canvas.Canvas.getFontHeight();aInternalLines=sText.split("\r\n");for(i=0;i<aInternalLines.length;++i){if(iClipHeight!==-1&&iTotalHeight+iLineHeight>iClipHeight){bLinesClipped=true;break}sLine=aInternalLines[i];iWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(sLine);aLines.push(sLine);aLineWidths.push(iWidth);iTotalWidth=Math.max(iTotalWidth,iWidth);iTotalHeight+=iLineHeight}}if(aLines.length==0){iLineHeight=0}return{lines:aLines,lineWidths:aLineWidths,lineHeight:iLineHeight,totalWidth:iTotalWidth,totalHeight:iTotalHeight,isLinesClipped:bLinesClipped}},wordWrapText:function(sText,iClipWidth,iClipHeight,sFontProps){var aLines=[],aLineWidths=[],iLineHeight=0,iTotalWidth=0,iTotalHeight=0,bLinesClipped=false,aInternalLines,noLine,sLine,sTrimLine,word,sRest,iWidth,iWordWidth,oWordParts,len,iPart;iClipWidth=(iClipWidth!==undefined)?+iClipWidth:-1;iClipHeight=(iClipHeight!==undefined)?+iClipHeight:-1;if(sText&&sText.length>0){if(iClipWidth===-1){return this.lineWrapText(sText,iClipHeight,sFontProps)}sap.galilei.ui.common.canvas.Canvas.font(sFontProps);iLineHeight=sap.galilei.ui.common.canvas.Canvas.getFontHeight();aInternalLines=sText.split("\r\n");for(noLine=0;noLine<aInternalLines.length;++noLine){if(iClipHeight!==-1&&iTotalHeight+iLineHeight>iClipHeight){bLinesClipped=true;break}sRest=aInternalLines[noLine];sLine="";iWidth=0;do{word=this.getWord(sRest);iWordWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(word);if(iWidth+iWordWidth>iClipWidth){if(sLine.length>0){sTrimLine=sLine.trim();if(sTrimLine.length<sLine.length){sLine=sTrimLine;iWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(sLine)}aLines.push(sLine);aLineWidths.push(iWidth);iTotalWidth=Math.max(iTotalWidth,iWidth);iTotalHeight+=iLineHeight;sLine="";iWidth=0;if(iClipHeight!==-1&&iTotalHeight+iLineHeight>iClipHeight){bLinesClipped=true;sRest="";break}}oWordParts=this.wrapWord(word,iClipWidth,iClipHeight,sFontProps);len=oWordParts.lines.length;for(iPart=0;iPart<len-1;++iPart){aLines.push(oWordParts.lines[iPart]);aLineWidths.push(oWordParts.lineWidths[iPart]);iTotalWidth=Math.max(iTotalWidth,oWordParts.lineWidths[iPart]);iTotalHeight+=iLineHeight;if(iClipHeight!==-1&&iTotalHeight+iLineHeight>iClipHeight){bLinesClipped=true;sRest=sLine="";len=0;break}}if(oWordParts.isLinesClipped){bLinesClipped=true}if(len>0){sLine=oWordParts.lines[len-1];if(sLine[0]===" "){sLine.trimLeft()}iWidth=0;if(sLine.length>0){iWidth=oWordParts.lineWidths[len-1]}}else{sLine="";iWidth=0}}else{sLine+=word;iWidth+=iWordWidth}sRest=sRest.slice(word.length)}while(sRest.length>0);if(sLine.length>0){sTrimLine=sLine.trim();if(sTrimLine.length<sLine.length){sLine=sTrimLine;iWidth=sap.galilei.ui.common.canvas.Canvas.measureTextLineWidth(sLine)}aLines.push(sLine);aLineWidths.push(iWidth);iTotalWidth=Math.max(iTotalWidth,iWidth);iTotalHeight+=iLineHeight}}}if(aLines.length===0){iLineHeight=0}return{lines:aLines,lineWidths:aLineWidths,lineHeight:iLineHeight,totalWidth:iTotalWidth,totalHeight:iTotalHeight,isLinesClipped:bLinesClipped}},layoutText:function(sText,iClipWidth,iClipHeight,eHorzAlignment,eVertAlignment,bWordWrap,bAddEllipsis,sFontProps){var oLayout,iLines,dy,nLast,lastLine,ellipsis,i,x,y,iWidth,sLine,oClipLine;iClipWidth=(iClipWidth!=undefined)?+iClipWidth:-1;iClipHeight=(iClipHeight!=undefined)?+iClipHeight:-1;if(bWordWrap===undefined||iClipWidth===-1){bWordWrap=false}if(bAddEllipsis===undefined){bAddEllipsis=true}eHorzAlignment=sap.galilei.core.validateEnum(sap.galilei.ui.common.HorizontalAlignment,eHorzAlignment);eVertAlignment=sap.galilei.core.validateEnum(sap.galilei.ui.common.VerticalAlignment,eVertAlignment);if(bWordWrap){oLayout=this.wordWrapText(sText,iClipWidth,iClipHeight,sFontProps)}else{oLayout=this.lineWrapText(sText,iClipHeight,sFontProps)}if(oLayout){oLayout.x=[];oLayout.y=[];oLayout.left=oLayout.top=0;iLines=oLayout.lines.length;dy=Math.round(oLayout.lineHeight*0.8);if(iLines>0){if(iClipHeight!=-1){if(oLayout.isLinesClipped&&iLines>0){if(bAddEllipsis){nLast=iLines-1;lastLine=oLayout.lines[nLast];ellipsis=this.ellipsisTextLine(lastLine,iClipWidth);oLayout.lines[nLast]=ellipsis.text;oLayout.lineWidths[nLast]=ellipsis.width}}if(eVertAlignment===sap.galilei.ui.common.VerticalAlignment.middle||eVertAlignment===sap.galilei.ui.common.VerticalAlignment.height){dy+=Math.round((iClipHeight-oLayout.totalHeight)/2)}else{if(eVertAlignment===sap.galilei.ui.common.VerticalAlignment.bottom){dy+=iClipHeight-oLayout.totalHeight}}}y=dy;oLayout.totalWidth=0;for(i=0,x=0;i<oLayout.lines.length;++i){sLine=oLayout.lines[i];if(iClipWidth!=-1){if(!bWordWrap){oClipLine=this.clipTextLine(sLine,iClipWidth,-1,!bWordWrap&&bAddEllipsis);if(sLine!=oClipLine.text){sLine=oClipLine.text;oLayout.lines[i]=oClipLine.text;oLayout.lineWidths[i]=oClipLine.width}iWidth=oClipLine.width}else{iWidth=oLayout.lineWidths[i]}if(eHorzAlignment===sap.galilei.ui.common.HorizontalAlignment.center||eHorzAlignment===sap.galilei.ui.common.HorizontalAlignment.width){x=Math.round((iClipWidth-iWidth)/2)}else{if(eHorzAlignment===sap.galilei.ui.common.HorizontalAlignment.right){x=iClipWidth-iWidth}}}else{iWidth=oLayout.lineWidths[i]}oLayout.totalWidth=Math.max(oLayout.totalWidth,iWidth);oLayout.x.push(x);oLayout.y.push(y);if(i===0){oLayout.left=x;oLayout.top=y-dy}else{oLayout.left=Math.min(x,oLayout.left);oLayout.top=Math.min(y-dy,oLayout.top)}x=0;y+=oLayout.lineHeight}}}return oLayout}}});
"use strict";sap.galilei.ui.common.EasingFunction={linear:"linear",poly:"poly",quad:"quad",cubic:"cubic",cubicInOut:"cubic-in-out",sin:"sin",exp:"exp",circle:"circle",elastic:"elastic",back:"back",bounce:"bounce",DEFAULT:"cubic-in-out"};sap.galilei.ui.common.TransitionDefinition=sap.galilei.core.defineClass({fullClassName:"sap.galilei.ui.common.TransitionDefinition",properties:{duration:500,ease:"cubic-in-out",argument1:undefined,argument2:undefined,delay:undefined},methods:{getTransition:function(oNode){var d3Node,oTransition;if(oNode&&oNode.d3Node){d3Node=oNode.d3Node}else{if(oNode&&oNode.node){d3Node=oNode}}if(d3Node){oTransition=d3Node.transition()}if(oTransition){if(this.delay!==undefined){oTransition.delay(this.delay)}if(this.duration!==undefined){oTransition.duration(this.duration)}if(this.ease!==undefined){oTransition.ease(this.ease,this.argument1,this.argument2)}return oTransition}return d3Node}}});
