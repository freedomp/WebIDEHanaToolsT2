define("tinymce/tableplugin/CellSelection",["tinymce/tableplugin/TableGrid","tinymce/dom/TreeWalker","tinymce/util/Tools"],function(T,a,b){return function(c){var d=c.dom,t,s,f,h=true,r;function g(e){c.getBody().style.webkitUserSelect='';if(e||h){c.dom.removeClass(c.dom.select('td.mce-item-selected,th.mce-item-selected'),'mce-item-selected');h=false;}}function i(e){var j,k,l=e.target;if(r){return;}if(s&&(t||l!=s)&&(l.nodeName=='TD'||l.nodeName=='TH')){k=d.getParent(l,'table');if(k==f){if(!t){t=new T(c,k);t.setStartCell(s);c.getBody().style.webkitUserSelect='none';}t.setEndCell(l);h=true;}j=c.selection.getSel();try{if(j.removeAllRanges){j.removeAllRanges();}else{j.empty();}}catch(m){}e.preventDefault();}}c.on('MouseDown',function(e){if(e.button!=2&&!r){g();s=d.getParent(e.target,'td,th');f=d.getParent(s,'table');}});c.on('mouseover',i);c.on('remove',function(){d.unbind(c.getDoc(),'mouseover',i);});c.on('MouseUp',function(){var e,j=c.selection,k,w,n,l;function m(n,o){var w=new a(n,n);do{if(n.nodeType==3&&b.trim(n.nodeValue).length!==0){if(o){e.setStart(n,0);}else{e.setEnd(n,n.nodeValue.length);}return;}if(n.nodeName=='BR'){if(o){e.setStartBefore(n);}else{e.setEndBefore(n);}return;}}while((n=(o?w.next():w.prev())));}if(s){if(t){c.getBody().style.webkitUserSelect='';}k=d.select('td.mce-item-selected,th.mce-item-selected');if(k.length>0){e=d.createRng();n=k[0];e.setStartBefore(n);e.setEndAfter(n);m(n,1);w=new a(n,d.getParent(k[0],'table'));do{if(n.nodeName=='TD'||n.nodeName=='TH'){if(!d.hasClass(n,'mce-item-selected')){break;}l=n;}}while((n=w.next()));m(l);j.setRng(e);}c.nodeChanged();s=t=f=null;}});c.on('KeyUp Drop SetContent',function(e){g(e.type=='setcontent');s=t=f=null;r=false;});c.on('ObjectResizeStart ObjectResized',function(e){r=e.type!='objectresized';});return{clear:g};};});
