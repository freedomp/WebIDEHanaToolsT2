/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
jQuery.sap.require("sap.apf.modeler.ui.utils.textPoolHelper");jQuery.sap.require('sap.apf.modeler.ui.utils.navigationHandler');jQuery.sap.require('sap.apf.modeler.ui.utils.helper');jQuery.sap.require('sap.apf.modeler.ui.utils.APFTree');sap.ui.controller("sap.apf.modeler.ui.controller.configurationList",{onInit:function(){var c=this.getOwnerComponent();if(c!==undefined){this.oCoreApi=c.oCoreApi;this._setDisplayText();}this._instantiateToolbarView();this._instantiateAPFTree();this._instantiateTitleAndBreadCrumbView();this._addConfigStyleClass();this.oModel=new sap.ui.model.json.JSONModel({aConfigDetails:[]});this.getView().setModel(this.oModel);this.bProgramaticSelection=false;sap.apf.modeler.ui.utils.APFRouter.patternMatch(this);},_instantiateToolbarView:function(){var t=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.toolbar",type:"XML",viewData:{oConfigListInstance:this}});this.toolbarController=t.getController();this.byId("idConfigMasterData").insertItem(t,0);},_instantiateAPFTree:function(){this.oTreeInstance=this.byId("idConfigTree");this.oTreeInstance.setTranslationFunction(this.oCoreApi.getText);var d;if(this.oCoreApi.getRepresentationTypes()[0].metadata){d=this.oCoreApi.getRepresentationTypes()[0].id;}this.oTreeInstance.setDefaultRepresentationType(d);},_instantiateTitleAndBreadCrumbView:function(){this.oTitleBreadCrumbView=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.titleBreadCrumb",type:"XML",viewData:{getText:this.oCoreApi.getText}});this.oTitleBreadCrumbController=this.oTitleBreadCrumbView.getController();this.byId("idConfigDetail").insertItem(this.oTitleBreadCrumbView,0);this.oBreadCrumb=this.oTitleBreadCrumbView.byId("IdBreadCrumb");},setConfigListMasterTitle:function(t){this.byId("idConfigTitleMaster").setText(this.oCoreApi.getText("configurationObjectTitle")+" : "+t);},onAfterRendering:function(){var s=this;this.oTreeInstance.onAfterRendering=function(){s._setHeightForTree();};},_setHeightForTree:function(){var v=this;var t=this.oTreeInstance;var w=jQuery(v.byId("idConfigMasterData").getDomRef()).width();var h=jQuery(window).height();var a=100;var b=jQuery(v.byId("idConfigMasterData").getItems()[0].getDomRef()).height();var c=jQuery(v.byId("configPage").getDomRef()).find("header").height();var f=jQuery(v.byId("configPage").getDomRef()).find("footer").height();var o;if(b>0){o=a+b+c+f;}else{o=205;}t.setHeight(h-o+"px");t.setWidth(w+"px");sap.apf.modeler.ui.utils.helper.onResize(function(){w=jQuery(v.byId("idConfigMasterData").getDomRef()).width();h=jQuery(v.byId("configPage").getDomRef()).height();t.setHeight(h-o+"px");t.setWidth(w+"px");});},_setDisplayText:function(){this.byId("configPage").setTitle(this.oCoreApi.getText("configModelerTitle"));this.byId("idSavebutton").setText(this.oCoreApi.getText("save"));this.byId("idCancelbutton").setText(this.oCoreApi.getText("cancel"));this.byId("idExportbutton").setText(this.oCoreApi.getText("export"));},_addConfigStyleClass:function(){this.getView().addStyleClass("sapUiSizeCompact");this.byId("idConfigTree").addStyleClass("configTree");this.byId("idConfigTitleMaster").addStyleClass("configTitle");this.byId("idConfigMasterData").addStyleClass("configMasterData");this.byId("idConfigDetailData").addStyleClass("configDetailData");},_setSubViewContainerHeight:function(s){var S=this;var a=s.getContent()[0].getItems()[0];var h=jQuery(window).height();var t=jQuery(this.byId("idConfigTitleMaster").getDomRef()).outerHeight()+jQuery(this.byId("idConfigTitleMaster").getDomRef()).offset().top+25;var b=jQuery(this.byId("idConfigMasterData").getItems()[0].getDomRef()).height();var c=jQuery(this.byId("configPage").getDomRef()).find("header").height();var f=jQuery(this.byId("configPage").getDomRef()).find("footer").height();var o,d;if(b>0){o=t+b+c+f;}else{o=265;}var e=h-o+"px";a.setHeight(e);var g=jQuery(this.byId("idConfigDetailData").getDomRef()).width();if(g>0){d=jQuery(this.byId("idConfigMasterData").getDomRef()).offset().left;}else{g=1015;d=15;}var i=g-d;var j=i+"px";a.setWidth(j);sap.apf.modeler.ui.utils.helper.onResize(function(){h=jQuery(S.byId("configPage").getDomRef()).height();e=h-o+"px";a.setHeight(e);g=jQuery(S.byId("idConfigDetailData").getDomRef()).width();i=g-d;j=i+"px";a.setWidth(j);});},_setSubView:function(s){this.oSubView=s;},_getSubView:function(){return this.oSubView;},updateSubView:function(p){var s=this;var P=this._getSubView();var d=this.byId("idConfigDetailData");var v=this.getSPathFromURL(p);if(P){P.destroy();}var S=new sap.ui.view({viewName:"sap.apf.modeler.ui.view."+v.objectType,type:"XML",viewData:{oParams:p,updateConfigTree:s.updateConfigTree.bind(s),updateSelectedNode:s.updateSelectedNode.bind(s),updateTitleAndBreadCrumb:s.updateTitleAndBreadCrumb.bind(s),updateTree:s.updateTree.bind(s),oConfigurationHandler:s.configurationHandler,oApplicationHandler:s.applicationHandler,oConfigurationEditor:s.configEditor,getText:s.oCoreApi.getText,getEntityTypeMetadata:s.oCoreApi.getEntityTypeMetadata,getRepresentationTypes:s.oCoreApi.getRepresentationTypes,oFooter:s.byId("idFooterBarMain"),createMessageObject:s.oCoreApi.createMessageObject,putMessage:s.oCoreApi.putMessage,getAllAvailableSemanticObjects:s.oCoreApi.getAllAvailableSemanticObjects,getSemanticActions:s.oCoreApi.getSemanticActions,getNavigationTargetName:s._getNavigationTargetName.bind(s),setNavigationTargetName:s._setNavigationTargetName.bind(s)}});if(p.name!=="applicationList"){d.removeAllContent();S.placeAt(d);this._setSubViewContainerHeight(S);this._setSubView(S);}},clearTitleAndBreadCrumb:function(){this.oTitleBreadCrumbView.byId("IdFormTitle").setText("");this.oTitleBreadCrumbView.byId("IdBreadCrumb").removeAllContent();},_createLinkForBreadCrumb:function(n,p){var s=this;var l=new sap.m.Link({text:n,press:function(){s._navigateToNode(p);}});return l;},_createTextForBreadCrumb:function(v){var l=new sap.m.Label();l.addStyleClass("dialogText");l.setText(v);return l;},_createIconForBreadCrumb:function(){var b=new sap.ui.core.Icon({src:"sap-icon://open-command-field"});b.addStyleClass("breadCrumbIcon");return b;},_navigateToNode:function(p){var n=this.oTreeInstance.getNodeByContext(p);this.oTreeInstance.setSelection(n);},_getAllPossibleNodes:function(p){var n=[];if(p.configurationId){n.push({id:p.configurationId,name:p.configurationName,oParams:{arguments:{configId:p.configurationId}}});}if(p.facetFilterId){n.push({id:p.facetFilterId,name:p.facetFilterName,oParams:{arguments:{configId:p.configurationId,facetFilterId:p.facetFilterId}}});}if(p.categoryId){n.push({id:p.categoryId,name:p.categoryName,oParams:{arguments:{configId:p.configurationId,categoryId:p.categoryId}}});}if(p.stepId){n.push({id:p.stepId,name:p.stepName,oParams:{arguments:{configId:p.configurationId,categoryId:p.categoryId,stepId:p.stepId}}});}if(p.representationId){n.push({id:p.representationId,name:p.representationName,oParams:{arguments:{configId:p.configurationId,categoryId:p.categoryId,stepId:p.stepId,representationId:p.representationId}}});}if(p.navTargetId){n.push({id:p.navTargetId,name:p.navTargetName,oParams:{arguments:{configId:p.configurationId,navTargetId:p.navTargetId}}});}return n;},_breadCrumbCreation:function(s,t){for(var i=0;i<s.length;i++){var p=this.getSPathFromURL(s[i].oParams).sPath;var l;if(i===1){l=this._createTextForBreadCrumb(t);this.oBreadCrumb.addContent(l);var I=this._createIconForBreadCrumb();this.oBreadCrumb.addContent(I);}if(i!==s.length-1){var L=this._createLinkForBreadCrumb(s[i].name,p);this.oBreadCrumb.addContent(L);var o=this._createIconForBreadCrumb();this.oBreadCrumb.addContent(o);}else{l=this._createTextForBreadCrumb(s[i].name);this.oBreadCrumb.addContent(l);}}},updateTitleAndBreadCrumb:function(t){var f;var s=this.oTreeInstance.getSelection();var S=s?this.oTreeInstance.getAPFTreeNodeContext(s):undefined;var n=S?S.nodeObjectType:undefined;var p=S?this.oTreeInstance.getParentNodeContext(S):undefined;if(t){f=t;}else{if(n){var a=s.getText();f=this.oCoreApi.getText(n)+": "+a;}}if(p){if(this.oBreadCrumb){this.oBreadCrumb.removeAllContent();}var o=this._getAllPossibleNodes(p);var T;switch(n){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:this._breadCrumbCreation(o);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:T=this.oCoreApi.getText("facetFilter");this._breadCrumbCreation(o,T);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:T=this.oCoreApi.getText("category");this._breadCrumbCreation(o,T);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:T=this.oCoreApi.getText("category");this._breadCrumbCreation(o,T);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:T=this.oCoreApi.getText("category");this._breadCrumbCreation(o,T);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:T=this.oCoreApi.getText("navigationTarget");this._breadCrumbCreation(o,T);break;default:break;}}this.oTitleBreadCrumbController.setTitleAndBreadCrumb(f);},setSelectionOnTree:function(b){this.toolbarController.enableCopyDeleteButton();this._enableExportButton();this.oTreeInstance.setSelectionOnTree(b);},removeSelectionOnTree:function(){this.oTreeInstance.removeSelectionOnTree(this.selectedNode);},updateConfigTree:function(o){var a,n,O,i,b,c,d,e,f;var s=this;o.forEach(function(S){var h;a=s.getSPathFromURL(S.oldContext).sPath;O=a.split("/");i=O[2];b=O[6];d=O[8];e=jQuery.extend(true,{},s.oModel.getData().aConfigDetails[i].configData[1].categories[b].steps[d]);f=e.id;e.isSelected=false;n=s.getSPathFromURL(S.newContext).sPath;c=n.split("/")[6];if(S.removeStep===undefined){if(s.oModel.getData().aConfigDetails[i].configData[1].categories[c].steps){s.oModel.getData().aConfigDetails[i].configData[1].categories[c].steps.forEach(function(p){if(p.id===f){h=true;}});if(h===undefined){s.oModel.getData().aConfigDetails[i].configData[1].categories[c].steps.push(e);}}else{s.oModel.getData().aConfigDetails[i].configData[1].categories[c].steps=[];s.oModel.getData().aConfigDetails[i].configData[1].categories[c].steps.push(e);}}else if(S.removeStep===true){if(s.oModel.getData().aConfigDetails[i].configData[1].categories[c].steps){s.oModel.getData().aConfigDetails[i].configData[1].categories[c].steps.forEach(function(p,q){if(p.id===f){var r=s.oModel.getData().aConfigDetails[i].configData[1].categories[c].steps;r.splice(q,1);s.oModel.getData().aConfigDetails[i].configData[1].categories[c].steps=r;}});if(S.changeCategory===true){var j=s.getSPathFromURL(S.categoryChangeContext).sPath;var k=j.split("/");i=k[2];var l=k[6];var m=k[8];s.oModel.getData().aConfigDetails[i].configData[1].categories[l].steps[m].isSelected=true;s.oModel.getData().aConfigDetails[i].configData[1].categories[l].expanded=true;}}}});this.oModel.updateBindings();var g=o.length;if(o[g-1].changeCategory){sap.ui.core.UIComponent.getRouterFor(this).navTo(o[g-1].oldContext.name,o[g-1].categoryChangeContext.arguments,true);}this.configEditor.setIsUnsaved();},updateSelectedNode:function(p,c){if(p){if(this.oTreeInstance.getSelection()){this.selectedNode=this.oTreeInstance.getSelection();}if(this.selectedNode){if(p.name&&this.selectedNode.getBindingContext()&&this.selectedNode.getBindingContext().getObject()){this.selectedNode.getBindingContext().getObject().name=p.name;this.selectedNode.getBindingContext().getObject().isSelected=true;if(this.selectedNode.getBindingContext().getObject().type===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION||this.selectedNode.getBindingContext().getObject().type===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET){this.selectedNode.getBindingContext().getObject().icon=p.icon;}this.oModel.updateBindings();}if(p.id&&this.selectedNode.getBindingContext().getObject().id){this.selectedNode.getBindingContext().getObject().id=p.id;if(p.icon){this.selectedNode.getBindingContext().getObject().icon=p.icon;}}else if(p.id&&this.selectedNode.getBindingContext().getObject().AnalyticalConfiguration){this.selectedNode.getBindingContext().getObject().AnalyticalConfiguration=p.id;this.selectedNode.getBindingContext().getObject().expanded=true;}}if((this.selectedNode.getBindingContext().getObject().type===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION)&&c){sap.ui.core.UIComponent.getRouterFor(this).navTo(this.selectedNode.getBindingContext().getObject().type,c,true);}}},createConfigList:function(){var s=this;this.modelUpdateDeferred={};this.configList=this.configurationHandler.getList();this.configList.forEach(function(c,i){var C={};C.AnalyticalConfiguration=c.AnalyticalConfiguration;C.name=c.AnalyticalConfigurationName;C.Application=c.Application;C.type=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION;C.bIsLoaded=false;C.bToggleState=false;C.isSelected=false;C.expanded=false;C.selectable=true;C.hasExpander=true;s.oModel.getData().aConfigDetails.push(C);s.modelUpdateDeferred[i]=new jQuery.Deferred();});this.oModel.updateBindings();},showNoConfigSelectedText:function(){this.byId("idConfigDetailData").removeAllContent();this.clearTitleAndBreadCrumb();var n=new sap.m.Label().addStyleClass("noConfigSelected");n.setText(this.oCoreApi.getText("noConfigSelected"));n.placeAt(this.byId("idConfigDetailData"));this.toolbarController.disableCopyDeleteButton();this.disableExportButton();},updateConfigListView:function(){this.selectedNode=this.oTreeInstance.getSelection();if(this.selectedNode===null){if(this.configList.length>1){this.showNoConfigSelectedText();}else{this.oModel.getData().aConfigDetails[0].isSelected=true;this.oModel.getData().aConfigDetails[0].expanded=true;this.configId=this.oModel.getData().aConfigDetails[0].AnalyticalConfiguration;this.oModel.updateBindings();var c={appId:this.appId,configId:this.oModel.getData().aConfigDetails[0].AnalyticalConfiguration};this.selectedNode=this.oTreeInstance.getNodes()[0];this.toolbarController.enableCopyDeleteButton();this._enableExportButton();sap.ui.core.UIComponent.getRouterFor(this).navTo(this.oModel.getData().aConfigDetails[0].type,c,true);}}},_getNodeData:function(p,t){var c=this.oModel.getData().aConfigDetails;var n={};var g=function(h){var j={};var k=h||this.configId;for(var i=0;i<c.length;i++){if(c[i].AnalyticalConfiguration===k){j.index=i;j.data=c[i];j.id=c[i].AnalyticalConfiguration;break;}}return j;};var a=function(h){var k=g.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var l={};for(var i=0;i<c[k].configData.length;i++){if(c[k].configData[i].filters instanceof Array){l.indexConfigData=i;for(var j=0;j<c[k].configData[i].filters.length;j++){if(c[k].configData[i].filters[j].id===h){l.index=j;l.data=c[k].configData[i].filters[j];l.id=c[k].configData[i].filters[j].id;l.ffExpansion=c[k].configData[i].expanded;}}}}return l;};var b=function(h){var k=g.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var l={};for(var i=0;i<c[k].configData.length;i++){if(c[k].configData[i].categories instanceof Array){l.indexConfigData=i;for(var j=0;j<c[k].configData[i].categories.length;j++){if(c[k].configData[i].categories[j].id===h){l.index=j;l.data=c[k].configData[i].categories[j];l.id=c[k].configData[i].categories[j].id;l.categoryExpansion=c[k].configData[i].expanded;}}}}return l;};var d=function(h){var j=g.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var k=b.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).indexConfigData;var l=b.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).index;var m={};for(var i=0;i<c[j].configData[k].categories[l].steps.length;i++){if(c[j].configData[k].categories[l].steps[i].id===h){m.index=i;m.data=c[j].configData[k].categories[l].steps[i];m.id=c[j].configData[k].categories[l].steps[i].id;}}return m;};var e=function(h){var j=g.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var k=b.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).indexConfigData;var l=b.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).index;var m=d.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]).index;var o={};for(var i=0;i<c[j].configData[k].categories[l].steps[m].representations.length;i++){if(c[j].configData[k].categories[l].steps[m].representations[i].id===h){o.index=i;o.data=c[j].configData[k].categories[l].steps[m].representations[i];o.id=c[j].configData[k].categories[l].steps[m].representations[i].id;}}return o;};var f=function(h){var k=g.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var l={};for(var i=0;i<c[k].configData.length;i++){if(c[k].configData[i].navTargets instanceof Array){l.indexConfigData=i;for(var j=0;j<c[k].configData[i].navTargets.length;j++){if(c[k].configData[i].navTargets[j].id===h){l.index=j;l.data=c[k].configData[i].navTargets[j];l.id=c[k].configData[i].navTargets[j].id;l.nTExpansion=c[k].configData[i].expanded;}}}}return l;};switch(t){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:n=g.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:n=a.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:n=b.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:n=d.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:n=e.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:n=f.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET]);break;default:break;}return n;},_retainNodeState:function(p,t){var c=this._getNodeData(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION).index;if(!this.oModel.getData().aConfigDetails[c].bIsLoaded){return{};}var n=this._getNodeData(p,t);if(!n.data){return{};}return{expanded:n.data.expanded,isSelected:n.data.isSelected};},updateTree:function(){var s=this;var c=[],f=[],n=[],C=[],a=[],b=[];this.oTextPool=this.configurationHandler.getTextPool();var p={};p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]=this.configId;var d=s._getNodeData(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION).index;var e=this.configId;var F=false;var g=false;var h=false;c=this.configEditor.getCategories();f=this.configEditor.getFacetFilters();n=this.configEditor.getNavigationTargets();var r=this.oCoreApi.getRepresentationTypes();var R={};r.forEach(function(o){var i=o.id;R[i]=o.picture;});c.forEach(function(i){p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]=i.getId();var o=i;var j=o.getId();b=[];s.configEditor.getCategoryStepAssignments(j).forEach(function(S){var v=s.configEditor.getStep(S);p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]=j;p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]=v.getId();var w=s._retainNodeState(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP);var x=v.getRepresentations();var y=x.map(function(z){p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION]=z.getId();var A=s._retainNodeState(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION);return{id:z.getId(),name:s.oCoreApi.getText(z.getRepresentationType()),type:"representation",isSelected:A.isSelected||false,expanded:A.expanded||false,selectable:true,icon:R[z.getRepresentationType()]};});b.push({id:v.getId(),name:s.oTextPool.get(v.getTitleId())?s.oTextPool.get(v.getTitleId()).TextElementDescription:v.getTitleId(),type:"step",representations:y,isSelected:w.isSelected||false,expanded:w.expanded||false,selectable:true,icon:"sap-icon://BusinessSuiteInAppSymbols/icon-phase"});});var q=s._retainNodeState(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY);if(s.oModel.getData().aConfigDetails[d].bIsLoaded){var t=s._getNodeData(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY);if(t.categoryExpansion){h=true;}}C.push({id:i.getId(),name:s.oTextPool.get(i.labelKey)?s.oTextPool.get(i.labelKey).TextElementDescription:i.labelKey,type:"category",steps:b,isSelected:q.isSelected||false,expanded:q.expanded||false,selectable:true,icon:"sap-icon://open-folder"});});var k=[];f.forEach(function(o){p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER]=o.getId();var i=s._retainNodeState(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER);if(s.oModel.getData().aConfigDetails[d].bIsLoaded){var j=s._getNodeData(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER);if(j.ffExpansion){F=true;}}k.push({id:o.getId(),name:s.oTextPool.get(o.getLabelKey())?s.oTextPool.get(o.getLabelKey()).TextElementDescription:o.getLabelKey(),type:"facetFilter",isSelected:i.isSelected||false,expanded:i.expanded||false,selectable:true,icon:"sap-icon://filter"});});a.push({filters:k,name:s.oCoreApi.getText("facetFilters"),expanded:F,selectable:false});a.push({categories:C,name:s.oCoreApi.getText("categories"),expanded:h,selectable:false});var N=[];var l=function(S,o){p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET]=o.getId();var j=s._retainNodeState(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET);if(s.oModel.getData().aConfigDetails[d].bIsLoaded){var q=s._getNodeData(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET);if(q.nTExpansion){g=true;}}var i,t;for(i=0;i<S.length;i++){if(S[i].id===o.getAction()){t=S[i].text;break;}}N.push({id:o.getId(),name:t||o.getSemanticObject(),type:"navigationTarget",isSelected:j.isSelected||false,expanded:j.expanded||false,selectable:true,icon:o.isStepSpecific()?"sap-icon://pushpin-off":"sap-icon://BusinessSuiteInAppSymbols/icon-where-used"});};var m=function(){var o=n.map(function(q){return q.getId();});var t=[];for(var i=0;i<o.length;i++){for(var j=0;j<N.length;j++){if(o[i]===N[j].id){t[i]=N[j];break;}}}N=t;};var u=function(){var o={};o.configData=a;s.oModel.getData().aConfigDetails[d].bIsLoaded=true;var t=s.oModel.getData().aConfigDetails[d];jQuery.extend(t,o);s.oModel.getData().aConfigDetails[d]=t;s.oModel.getData().aConfigDetails[d].name=s.configurationHandler.getConfiguration(e).AnalyticalConfigurationName;for(var i=0;i<s.oModel.getData().aConfigDetails.length;i++){if(s.modelUpdateDeferred[i]&&s.modelUpdateDeferred[i].state()==="pending"&&n.length===0){s.modelUpdateDeferred[i].resolve(s.oModel.getData());}}if(t.configData[2].navTargets.length>0){s._setNavigationTargetName({configIndexInTree:d});s.modelUpdateDeferred[d].resolve(s.oModel.getData());}s.oModel.updateBindings();};n.forEach(function(o){var P=s.oCoreApi.getSemanticActions(o.getSemanticObject());P.then(function(S){l(S.semanticActions,o);if(N.length===n.length){m();if(a[2]){a.splice(2,2);a.push({navTargets:N,name:s.oCoreApi.getText("navigationTargets"),expanded:g,selectable:false});u();var i=sap.apf.modeler.ui.utils.APFRouter.params;if(i.name==="navigationTarget"){sap.apf.modeler.ui.utils.APFRouter.setCurrentSelectionState(i,s);}}}});});a.push({navTargets:N,name:s.oCoreApi.getText("navigationTargets"),expanded:g,selectable:false});u();},_checkIfKeyExists:function(k,c){var i;if(this.navTargetTextsTable[c]){this.navTargetTextsTable[c].texts.forEach(function(n,a){if(n.key===k){i=a;}});}return i;},_getNavigationTargetName:function(k){var s=this;var v;var n=new jQuery.Deferred();var c=s.getSPathForConfig(s.configId).split('/')[2];if(this.modelUpdateDeferred[c]===undefined){this.modelUpdateDeferred[c]=new jQuery.Deferred();this.modelUpdateDeferred[c].resolve(this.oModel.getData());}jQuery.when(this.modelUpdateDeferred[c]).done(function(m){var i=s._checkIfKeyExists(k,c);if(i!==undefined){v=s.navTargetTextsTable[c].texts[i].value;n.resolve(v);}});return n.promise();},_setNavigationTargetName:function(p){var c=p.configIndexInTree!==undefined?p.configIndexInTree:this.getSPathForConfig(this.configId).split('/')[2];if(jQuery.isEmptyObject(this.navTargetTextsTable)){this.navTargetTextsTable={};}if(!this.navTargetTextsTable[c]){this.navTargetTextsTable[c]={texts:[]};}if(p.key&&p.value){var i=this._checkIfKeyExists(p.key,c);if(i===undefined){var n={};n.key=p.key;n.value=p.value;this.navTargetTextsTable[c].texts.push(n);}else{this.navTargetTextsTable[c].texts[i].value=p.value;}}else{var a=this.oModel.getData().aConfigDetails[c].configData[2].navTargets;for(var b=0;b<a.length;b++){var d={};d.key=a[b].id;d.value=a[b].name;this.navTargetTextsTable[p.configIndexInTree].texts.push(d);}}},_handleToggleTreeNode:function(e){var s=this;var c=e.getSource();c.setExpanded(!c.getExpanded());var p=c.getBindingContext().sPath;var a=c.getBindingContext().getObject().type;if(a===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION){var b=p.split('/')[2];if(s.oModel.getData().aConfigDetails[b].bIsLoaded===true){this.oModel.updateBindings();}else{this.configurationHandler.loadConfiguration(this.oModel.getData().aConfigDetails[b].AnalyticalConfiguration,function(d){s.configEditor=d;s.configId=s.oModel.getData().aConfigDetails[b].AnalyticalConfiguration;s.updateTree();});}}},getSPathForConfig:function(c){var p;this.oModel.getData().aConfigDetails.forEach(function(a,i){if(a.AnalyticalConfiguration===c){p="/aConfigDetails/"+i;}});return p;},getSPathFromURL:function(p){var v={sPath:undefined,objectType:undefined};var s=this;this.oModel.getData().aConfigDetails.forEach(function(c,i){if(c.AnalyticalConfiguration===p.arguments.configId){v.sPath="/aConfigDetails/"+i;v.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION;s.oModel.getData().aConfigDetails[i].expanded=true;if(p.arguments.categoryId!==undefined){s.oModel.getData().aConfigDetails[i].configData[1].categories.forEach(function(a,b){if(a.id===p.arguments.categoryId){v.sPath=v.sPath.concat("/configData/1/categories/"+b);v.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY;s.oModel.getData().aConfigDetails[i].configData[1].expanded=true;if(p.arguments.stepId!==undefined){s.oModel.getData().aConfigDetails[i].configData[1].categories[b].steps.forEach(function(d,e){if(d.id===p.arguments.stepId){v.sPath=v.sPath.concat("/steps/"+e);v.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP;s.oModel.getData().aConfigDetails[i].configData[1].categories[b].expanded=true;if(p.arguments.representationId!==undefined){s.oModel.getData().aConfigDetails[i].configData[1].categories[b].steps[e].representations.forEach(function(r,f){if(r.id===p.arguments.representationId){s.oModel.getData().aConfigDetails[i].configData[1].categories[b].steps[e].expanded=true;v.sPath=v.sPath.concat("/representations/"+f);v.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION;}});}}});}}});}if(p.arguments.facetFilterId!==undefined){s.oModel.getData().aConfigDetails[i].configData[0].filters.forEach(function(f,a){if(f.id===p.arguments.facetFilterId){v.sPath=v.sPath.concat("/configData/0/filters/"+a);v.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER;s.oModel.getData().aConfigDetails[i].configData[0].expanded=true;}});}if(p.arguments.navTargetId!==undefined){s.oModel.getData().aConfigDetails[i].configData[2].navTargets.forEach(function(n,a){if(n.id===p.arguments.navTargetId){v.sPath=v.sPath.concat("/configData/2/navTargets/"+a);v.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET;s.oModel.getData().aConfigDetails[i].configData[2].expanded=true;}});}}});return v;},_navHandleExpandDelete:function(n,p,a){var s=this;var c=this.oModel.getData().aConfigDetails;var I=a||this.oTreeInstance.isConfigurationSwitched(this.oPreviousSelectedNode,this.selectedNode);var g=function(j){var r;for(var i=0;i<c.length;i++){if(c[i].AnalyticalConfiguration===j){r=i;break;}}return r;};var b=function(r){var h=g.call(this,p.configId);var t,u;for(var i=0;i<c[h].configData.length;i++){if(c[h].configData[i].filters instanceof Array){t=i;for(var j=0;j<c[h].configData[i].filters.length;j++){if(c[h].configData[i].filters[j].id===r){u=j;break;}else{u=j;}}}}return{indexConfig:t,indexFilter:u};};var d=function(r){var h=g.call(this,p.configId);var t,u;for(var i=0;i<c[h].configData.length;i++){if(c[h].configData[i].navTargets instanceof Array){t=i;for(var j=0;j<c[h].configData[i].navTargets.length;j++){if(c[h].configData[i].navTargets[j].id===r){u=j;break;}else{u=j;}}}}return{indexConfig:t,indexNavTarget:u};};var e=function(r){var h=g.call(this,p.configId);var t,u;for(var i=0;i<c[h].configData.length;i++){if(c[h].configData[i].categories instanceof Array){t=i;for(var j=0;j<c[h].configData[i].categories.length;j++){if(c[h].configData[i].categories[j].id===r){u=j;break;}else{u=j;}}}}return{indexConfig:t,indexCategory:u};};var f=function(j){var h=g.call(this,p.configId);var k=e.call(this,p.categoryId).indexConfig;var m=e.call(this,p.categoryId).indexCategory;var r;for(var i=0;i<c[h].configData[k].categories[m].steps.length;i++){if(c[h].configData[k].categories[m].steps[i].id===j){r=i;break;}else{r=i;}}return r;};if(p.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0&&I){this.configurationHandler.removeConfiguration(p.configId,function(i){var C=s.oModel.getData().aConfigDetails;var h=g.call(s,p.configId);s._deleteConfigNavTargetTexts(h,C.length);C.splice(h,1);s.oModel.getData().aConfigDetails=C;});}else{var h,k,l,m,o,q;switch(n.nodeObjectType){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:h=g.call(this,p.configId);this.oModel.getData().aConfigDetails[h].isSelected=true;this.oModel.getData().aConfigDetails[h].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:h=g.call(this,p.configId);k=b.call(this,p.facetFilterId).indexConfig;l=b.call(this,p.facetFilterId).indexFilter;this.oModel.getData().aConfigDetails[h].expanded=true;this.oModel.getData().aConfigDetails[h].configData[k].expanded=true;this.oModel.getData().aConfigDetails[h].configData[k].filters[l].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:h=g.call(this,p.configId);k=e.call(this,p.categoryId).indexConfig;m=e.call(this,p.categoryId).indexCategory;this.oModel.getData().aConfigDetails[h].expanded=true;this.oModel.getData().aConfigDetails[h].configData[k].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:h=g.call(this,p.configId);k=e.call(this,p.categoryId).indexConfig;m=e.call(this,p.categoryId).indexCategory;o=f.call(this,p.stepId);this.oModel.getData().aConfigDetails[h].expanded=true;this.oModel.getData().aConfigDetails[h].configData[k].expanded=true;this.oModel.getData().aConfigDetails[h].configData[k].categories[m].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:h=g.call(this,p.configId);k=e.call(this,p.categoryId).indexConfig;m=e.call(this,p.categoryId).indexCategory;o=f.call(this,p.stepId);this.oModel.getData().aConfigDetails[h].expanded=true;this.oModel.getData().aConfigDetails[h].configData[k].expanded=true;this.oModel.getData().aConfigDetails[h].configData[k].categories[m].expanded=true;this.oModel.getData().aConfigDetails[h].configData[k].categories[m].steps[o].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:h=g.call(this,p.configId);k=d.call(this,p.navTargetId).indexConfig;q=d.call(this,p.navTargetId).indexNavTarget;this.oModel.getData().aConfigDetails[h].expanded=true;this.oModel.getData().aConfigDetails[h].configData[k].expanded=true;this.oModel.getData().aConfigDetails[h].configData[k].navTargets[q].expanded=true;break;default:break;}}this.oModel.updateBindings();},_isNewSubView:function(p){var i=false;if(p.arguments.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){i=true;}else{if(p.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION){i=(this.configurationHandler.getConfiguration(p.arguments.configId)!==undefined)?false:true;}else if(p.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY){i=(this.configEditor.getCategory(p.arguments.categoryId)!==undefined)?false:true;}else if(p.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER){i=(this.configEditor.getFacetFilter(p.arguments.facetFilterId)!==undefined)?false:true;}else if(p.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP){i=(this.configEditor.getStep(p.arguments.stepId)!==undefined)?false:true;}else if(p.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION){i=(this.configEditor.getRepresentation(p.arguments.representationId)!==undefined)?false:true;}else if(p.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET){i=(this.configEditor.getNavigationTarget(p.arguments.navTargetId)!==undefined)?false:true;}}return i;},_getCurrentConfigurationNode:function(){var p=this.oTreeInstance.getNodes();var c=this.configId;for(var i=0;i<p.length;i++){if(c===p[i].getBindingContext().getObject().AnalyticalConfiguration){return p[i];}}return undefined;},_navMandatoryResetState:function(c,a){var s=c;s.bIsSaved=s.configEditor?s.configEditor.isSaved():undefined;var b=(typeof s.byId("idConfigDetailData").getContent()[0].getController==="function")?s.byId("idConfigDetailData").getContent()[0].getController():undefined;var i=this._isNewSubView(b.oViewData.oParams);if(!i){s.updateTree();var d=s.selectedNode.getBindingContext().getObject();if(d){d.isSelected=true;b.oConfigurationEditor=s.configEditor;b.setDetailData.call(b);s.updateTitleAndBreadCrumb();}else{s.oTreeInstance.setSelection(s._getCurrentConfigurationNode());}if(typeof a==="function"){a();}}else{s.handleConfirmDeletion();}return{bIsSaved:s.bIsSaved,isNewView:i};},_navSaveState:function(s){s();},_navConfigResetState:function(c,a){var s=c;var b=(typeof s.byId("idConfigDetailData").getContent()[0].getController==="function")?s.byId("idConfigDetailData").getContent()[0].getController():undefined;var i=this._isNewSubView(b.oViewData.oParams);if(!i){s.configurationHandler.loadConfiguration(s.configId,function(d){var b=(typeof s.byId("idConfigDetailData").getContent()[0].getController==="function")?s.byId("idConfigDetailData").getContent()[0].getController():undefined;s.configEditor=d;s.updateTree();var e=s.selectedNode.getBindingContext().getObject();if(e){e.isSelected=true;b.oConfigurationEditor=s.configEditor;b.setDetailData.call(b);s.updateTitleAndBreadCrumb();}else{s.oTreeInstance.setSelection(s._getCurrentConfigurationNode());}if(typeof a==="function"){a();}});}else{s.handleConfirmDeletion();}},getRouteContext:function(n){var s=this;if(!n){this.oSelectedNodeDetails=this.oTreeInstance.getAPFTreeNodeContext(this.oTreeInstance.getSelection());this.oParentNodeDetails=this.oTreeInstance.getParentNodeContext(this.oSelectedNodeDetails);n=this.oParentNodeDetails;}var r={appId:s.appId,configId:n.configurationId,categoryId:n.categoryId,facetFilterId:n.facetFilterId,stepId:n.stepId,representationId:n.representationId,navTargetId:n.navTargetId};return r;},_onTreeNodeSelection:function(e){this.selectedNode=e.getParameter("node");var s=this;if(!this.bProgramaticSelection){this.oPreviousSelectedNode=this.oTreeInstance.getSelection();this.bIsDifferntConfig=this.oTreeInstance.isConfigurationSwitched(this.oPreviousSelectedNode,this.selectedNode);this.oSelectedNodeDetails=this.oTreeInstance.getAPFTreeNodeContext(this.selectedNode);this.oParentNodeDetails=this.oTreeInstance.getParentNodeContext(this.oSelectedNodeDetails);this.toolbarController.enableCopyDeleteButton();this._enableExportButton();var a;if(this.byId("idConfigDetailData").getContent().length>=1){a=(typeof this.byId("idConfigDetailData").getContent()[0].getController==="function")?this.byId("idConfigDetailData").getContent()[0].getController():undefined;}var c=this.selectedNode?this.selectedNode.getId():null;var p=this.oPreviousSelectedNode?this.oPreviousSelectedNode.getId():null;var r=function(){var f=s.oPreviousSelectedNode.getBindingContext().getObject();var g=s.selectedNode.getBindingContext().getObject();f.isSelected=true;g.isSelected=false;s.oModel.updateBindings();};if(c!==p||this.bNavDeletionMode){var n=sap.apf.modeler.ui.utils.navigationHandler.getInstance();var i;if(a!==undefined){i=typeof a.getValidationState==="function"?a.getValidationState.call(a):true;}else{i=true;}this.bIsSaved=this.configEditor?this.configEditor.isSaved():undefined;var o;var b=false;var d=this.configurationHandler.getList();if(!i&&(d.length>0)){n.throwMandatoryPopup(s,{yes:function(){var f=s.getRouteContext(s.oParentNodeDetails);var a=(typeof s.byId("idConfigDetailData").getContent()[0].getController==="function")?s.byId("idConfigDetailData").getContent()[0].getController():undefined;var g=s._isNewSubView(a.oViewData.oParams);if(!g){var y=function(k){if(typeof k==="function"){k();}this.updateTree();var l=this.selectedNode.getBindingContext().getObject();this.navigateToDifferntView(this.oParentNodeDetails,this.oSelectedNodeDetails);l.isSelected=true;this.oModel.updateBindings();};if(!s.bIsSaved&&s.bIsDifferntConfig){o(false,function(){y.call(s);});}else{y.call(s);}}else{if(!s.bIsSaved&&s.bIsDifferntConfig){o(false,function(){var h=s.selectedNode.getBindingContext().sPath;var j=s.oPreviousSelectedNode;s.handleConfirmDeletion(j,h);});}else{var h=s.selectedNode.getBindingContext().sPath;var j=s.oPreviousSelectedNode;s.handleConfirmDeletion(j,h);}}s._navHandleExpandDelete.call(s,s.oSelectedNodeDetails,f);},no:function(){r();}});b=true;}o=function(f){n.throwLossOfDataPopup(s,{yes:function(g){if(typeof f==="function"){f(function(){g(function(){if(s.oPreviousSelectedNode){var B=s.oPreviousSelectedNode.getBindingContext().sPath;var C=B.split("/");var h=C[2];}s.oModel.getData().aConfigDetails[h].AnalyticalConfiguration=s.configId;});});}else{g(function(){if(s.oPreviousSelectedNode){var B=s.oPreviousSelectedNode.getBindingContext().sPath;var C=B.split("/");var h=C[2];}s.oModel.getData().aConfigDetails[h].AnalyticalConfiguration=s.configId;var j=s.selectedNode.getBindingContext().getObject();s.navigateToDifferntView(s.oParentNodeDetails,s.oSelectedNodeDetails);j.isSelected=true;s.oModel.updateBindings();});}},no:function(){var g=s.getRouteContext(s.oParentNodeDetails);s.configurationHandler.loadConfiguration(s.configId,function(h){s.configEditor=h;if(s.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){s._navHandleExpandDelete.call(s,{},{configId:s.configId},g);}else{s.updateTree();}s.navigateToDifferntView(s.oParentNodeDetails,s.oSelectedNodeDetails);s._navHandleExpandDelete.call(s,s.oSelectedNodeDetails,g);});},cancel:function(){r();}});};if(!s.bIsSaved&&s.bIsDifferntConfig&&i){o();b=true;}if(!b){if(this.oPreviousSelectedNode&&this.oPreviousSelectedNode.getId()!==this.selectedNode.getId()){var P=this.oPreviousSelectedNode.getBindingContext().getObject();if(P){this.oPreviousSelectedNode.getBindingContext().getObject().isSelected=false;this.oPreviousSelectedNode.setIsSelected(false);}}else{this.selectedNode.getBindingContext().getObject().isSelected=true;}this.navigateToDifferntView(this.oParentNodeDetails,this.oSelectedNodeDetails,this.bIsSaved,this.bIsDifferntConfig);}}}this.bProgramaticSelection=false;this.bNavDeletionMode=false;},navigateToDifferntView:function(p,s,i,I){var c={appId:this.appId,configId:p.configurationId,categoryId:p.categoryId,facetFilterId:p.facetFilterId,stepId:p.stepId,representationId:p.representationId,navTargetId:p.navTargetId};if((!jQuery.isEmptyObject(c)&&(i===undefined||i))||(!I)){sap.ui.core.UIComponent.getRouterFor(this).navTo(s.nodeObjectType,c,true);}},_deleteConfigNavTargetTexts:function(a,n){var s=this;var b;for(var i=a;i<n-1;i++){this.modelUpdateDeferred[i]=this.modelUpdateDeferred[i+1];}delete this.modelUpdateDeferred[n-1];if(this.navTargetTextsTable){if(this.navTargetTextsTable[a]){delete this.navTargetTextsTable[a];}if(a!==(n-1)){Object.keys(this.navTargetTextsTable).forEach(function(k){k=parseInt(k,10);if(k>a){s.navTargetTextsTable[k-1]=s.navTargetTextsTable[k];b=k;}});if(b!==undefined){delete this.navTargetTextsTable[b];}}}},handleConfirmDeletion:function(s,a){var b=((s===undefined)||(typeof s.preventDefault==="function"))?this.oTreeInstance.getAPFTreeNodeContext(this.oTreeInstance.getSelection()):this.oTreeInstance.getAPFTreeNodeContext(s);var c=this;this.selectedNode=this.oTreeInstance.getSelection();var n,N,o,d,i,e,f,g,h;d=b.nodeContext;o=d.split("/");i=o[2];switch(b.nodeObjectType){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:this.configEditor.removeFacetFilter(b.nodeAPFId);e=o[6];var F=this.oModel.getData().aConfigDetails[i].configData[0].filters;F.splice(e,1);this.oModel.getData().aConfigDetails[i].configData[0].filters=F;N=o.slice(0,3);n=N.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:this.configEditor.removeCategory(b.nodeAPFId);f=o[6];var C=this.oModel.getData().aConfigDetails[i].configData[1].categories;C.splice(f,1);this.oModel.getData().aConfigDetails[i].configData[1].categories=C;N=o.slice(0,3);n=N.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:this.configEditor.removeNavigationTarget(b.nodeAPFId);g=o[6];var j=this.oModel.getData().aConfigDetails[i].configData[2].navTargets;j.splice(g,1);this.oModel.getData().aConfigDetails[i].configData[2].navTargets=j;N=o.slice(0,3);n=N.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:var S=this.configEditor.getCategoriesForStep(b.nodeAPFId);var k=b.nodeContext.split("/");i=k[2];S.forEach(function(w){c.configEditor.removeCategoryStepAssignment(w,b.nodeAPFId);c.oModel.getData().aConfigDetails[i].configData[1].categories.forEach(function(x,y){if(x.id===w){c.oModel.getData().aConfigDetails[i].configData[1].categories[y].steps.forEach(function(z,A){if(z.id===b.nodeAPFId){var B=c.oModel.getData().aConfigDetails[i].configData[1].categories[y].steps;B.splice(A,1);c.oModel.getData().aConfigDetails[i].configData[1].categories[y].steps=B;}});}});});N=o.slice(0,7);n=N.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:f=o[6];h=o[8];var p=this.oModel.getData().aConfigDetails[i].configData[1].categories[f].steps[h].id;var P=this.configEditor.getStep(p);var l=this.configEditor.getCategoriesForStep(p);P.removeRepresentation(b.nodeAPFId);l.forEach(function(w){c.oModel.getData().aConfigDetails[i].configData[1].categories.forEach(function(x,y){if(x.id===w){c.oModel.getData().aConfigDetails[i].configData[1].categories[y].steps.forEach(function(z,A){if(z.id===p){c.oModel.getData().aConfigDetails[i].configData[1].categories[y].steps[A].representations.forEach(function(B,D){if(B.id===b.nodeAPFId){var R=c.oModel.getData().aConfigDetails[i].configData[1].categories[y].steps[A].representations;R.splice(D,1);c.oModel.getData().aConfigDetails[i].configData[1].categories[y].steps[A].representations=R;}});}});}});});N=o.slice(0,9);n=N.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:var m=false;if(b.nodeAPFId.indexOf("newConfig")===0){m=true;}if(!m){this.configurationHandler.removeConfiguration(b.nodeAPFId,function(w){var q;var r=c.oModel.getData().aConfigDetails;c._deleteConfigNavTargetTexts(parseInt(i,10),r.length);var u=(c.configurationHandler.getList().length>0)?true:false;r.splice(i,1);c.oModel.getData().aConfigDetails=r;c.oModel.updateBindings();if(a){var t={appId:c.appId,configId:c.selectedNode.getBindingContext().getObject().AnalyticalConfiguration};sap.ui.core.UIComponent.getRouterFor(c).navTo(c.selectedNode.getBindingContext().getObject().type,t,true);}else{c.clearTitleAndBreadCrumb();c.byId("idConfigDetailData").removeAllContent();if(u){q=new sap.m.Label().addStyleClass("noConfigSelected");q.setText(c.oCoreApi.getText("noConfigSelected"));q.placeAt(c.byId("idConfigDetailData"));c.toolbarController.disableCopyDeleteButton();c.disableExportButton();}else{q=new sap.m.Label().addStyleClass("addNewConfig");q.setText(c.oCoreApi.getText("addNewConfig"));q.placeAt(c.byId("idConfigDetailData"));c.toolbarController.disableCopyDeleteButton();c.disableExportButton();}}});}else{var q;var r=c.oModel.getData().aConfigDetails;r.splice(i,1);c.oModel.getData().aConfigDetails=r;c.oModel.updateBindings();if(a){var t={appId:c.appId,configId:c.selectedNode.getBindingContext().getObject().AnalyticalConfiguration};sap.ui.core.UIComponent.getRouterFor(c).navTo(c.selectedNode.getBindingContext().getObject().type,t,true);}else{c.clearTitleAndBreadCrumb();c.byId("idConfigDetailData").removeAllContent();var u=(this.configurationHandler.getList().length>0)?true:false;if(u){q=new sap.m.Label().addStyleClass("noConfigSelected");q.setText(c.oCoreApi.getText("noConfigSelected"));q.placeAt(c.byId("idConfigDetailData"));c.toolbarController.disableCopyDeleteButton();c.disableExportButton();}else{q=new sap.m.Label().addStyleClass("addNewConfig");q.setText(c.oCoreApi.getText("addNewConfig"));q.placeAt(c.byId("idConfigDetailData"));c.toolbarController.disableCopyDeleteButton();c.disableExportButton();}}}break;default:break;}if(a){this.bNavDeletionMode=true;}if(b.nodeObjectType!==sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION){this.configEditor.setIsUnsaved();this.clearTitleAndBreadCrumb();this.byId("idConfigDetailData").removeAllContent();n=a||n;this.oModel.updateBindings();this.selectedNode=this.oTreeInstance.getNodeByContext(n);this.bProgramaticSelection=false;this.oTreeInstance.setSelection(this.selectedNode);if(a){this.selectedNode.getBindingContext().getObject().isSelected=true;this.oModel.updateBindings();}}var v=(this.toolbarController.confirmationDialog===undefined)?false:this.toolbarController.confirmationDialog.isOpen;if(v&&!a){this.toolbarController.confirmationDialog.close();}},handleNavBack:function(){var s;var a=this;if(this.byId("idConfigDetailData").getContent().length>=1){s=(typeof this.byId("idConfigDetailData").getContent()[0].getController==="function")?this.byId("idConfigDetailData").getContent()[0].getController():undefined;}var n=sap.apf.modeler.ui.utils.navigationHandler.getInstance();var i;if(s!==undefined){i=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}else{i=true;}this.bIsSaved=this.configEditor?this.configEditor.isSaved():undefined;var c=(a.configurationHandler.getList().length>0)?true:false;var b=false;var d=function(e){if(this.selectedNode){this.selectedNode=null;}this.oModel=new sap.ui.model.json.JSONModel({aConfigDetails:[]});this.getView().setModel(this.oModel);this.navTargetTextsTable={};window.history.go(-1);};if(c){if(!i){n.throwMandatoryPopup(a,{yes:function(){var e=a._navMandatoryResetState(a);var f=a.configurationHandler.getList();if(e.bIsSaved===false&&f.length>0){n.throwLossOfDataPopup(a,{yes:function(g){g();d.call(a);},no:function(){var r=a.getRouteContext(a.oParentNodeDetails);a.configurationHandler.resetConfiguration(a.configId);if(a.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){a._navHandleExpandDelete.call(a,{},{configId:a.configId},r);}d.call(a);}});}else{d.call(a);}}});b=true;}var S=(a.bIsSaved===undefined)?true:a.bIsSaved;if(!S&&i){n.throwLossOfDataPopup(a,{yes:function(e){e();d.call(a);},no:function(){var r=a.getRouteContext(a.oParentNodeDetails);a.configurationHandler.resetConfiguration(a.configId);if(a.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){a._navHandleExpandDelete.call(a,{},{configId:a.configId},r);}d.call(a);}});b=true;}}if(!b){d.call(a);}},handleSavePress:function(){var s;var a=this;this.selectedNode=this.oTreeInstance.getSelection();if(this.selectedNode){var b=this.selectedNode.getBindingContext().sPath;var c=b.split("/");var i=c[2];}if(this.byId("idConfigDetailData").getContent().length>=1){s=(typeof this.byId("idConfigDetailData").getContent()[0].getController==="function")?this.byId("idConfigDetailData").getContent()[0].getController():undefined;}var d=function(){var a=this;a.configEditor.save(function(g,m,h){if(h===undefined){a.oModel.getData().aConfigDetails[i].AnalyticalConfiguration=g;a.oModel.updateBindings();a.oSelectedNodeDetails=a.oTreeInstance.getAPFTreeNodeContext(a.selectedNode);a.oParentNodeDetails=a.oTreeInstance.getParentNodeContext(a.oSelectedNodeDetails);a.navigateToDifferntView(a.oParentNodeDetails,a.oSelectedNodeDetails,true,false);var j=a.oCoreApi.getText("successOnSave");sap.m.MessageToast.show(j,{width:"20em"});}else{var M=a.oCoreApi.createMessageObject({code:"12000"});M.setPrevious(h);a.oCoreApi.putMessage(M);var k=a.oCoreApi.getText("errorOnSave");sap.m.MessageToast.show(k,{width:"20em"});}});};var n=sap.apf.modeler.ui.utils.navigationHandler.getInstance();var e;if(s!==undefined){e=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}else{e=true;}this.bIsSaved=this.configEditor?this.configEditor.isSaved():undefined;var f=false;if(!e){n.throwMandatoryPopup(a,{yes:function(){a._navMandatoryResetState(a);d.call(a);}});f=true;}if(!f){d.call(this);this.toolbarController.closeDialog();}},_handleExportButtonPress:function(){var s;var a=this;if(this.byId("idConfigDetailData").getContent().length>=1){s=(typeof this.byId("idConfigDetailData").getContent()[0].getController==="function")?this.byId("idConfigDetailData").getContent()[0].getController():undefined;}var n=sap.apf.modeler.ui.utils.navigationHandler.getInstance();var i;if(s!==undefined){i=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}else{i=true;}this.bIsSaved=this.configEditor?this.configEditor.isSaved():undefined;var b=false;var e=function(){if(!this.exportConfigurationDialog){this.exportConfigurationDialog=sap.ui.xmlfragment("idExportConfigurationFragment","sap.apf.modeler.ui.fragment.exportConfiguration",this);this.getView().addDependent(this.exportConfigurationDialog);this._setExportConfigDialogText();this._addStyleClassForExportDialog();}jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this.exportConfigurationDialog);this.exportConfigurationDialog.open();};var d=function(){var c=new sap.m.Label().addStyleClass("noConfigSelected");c.setText(a.oCoreApi.getText("noConfigSelected"));c.placeAt(a.byId("idConfigDetailData"));a.toolbarController.disableCopyDeleteButton();a.disableExportButton();};var o;if(!i){n.throwMandatoryPopup(a,{yes:function(){var c=a._navMandatoryResetState(a);var f=(a.configurationHandler.getList().length>0)?true:false;if(f){if(!c.bIsSaved){o(a);}else{if(a.oParentNodeDetails.configurationId.indexOf("newConfig")!==0){e.call(a);}}}else{d();}}});b=true;}o=function(c){n.throwLossOfDataPopup(c,{yes:function(f){a._navSaveState(function(){f(function(g){if(a.selectedNode){var B=a.selectedNode.getBindingContext().sPath;var C=B.split("/");var h=C[2];}a.oModel.getData().aConfigDetails[h].AnalyticalConfiguration=a.configId;a.oModel.updateBindings();e.call(a);});});},no:function(){var r=a.getRouteContext(a.oParentNodeDetails);if(a.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){a._navHandleExpandDelete.call(a,{},{configId:a.configId},r);a.clearTitleAndBreadCrumb();a.byId("idConfigDetailData").removeAllContent();var f=(a.configurationHandler.getList().length>0)?true:false;if(!f){d();}}else{a._navConfigResetState(a,function(){a._navHandleExpandDelete.call(a,a.oSelectedNodeDetails,r);e.call(a);});}}});};if(!a.bIsSaved&&i){o(a);b=true;}if(!b){e.call(a);}},_enableExportButton:function(){if(!this.byId("idExportbutton").getEnabled()){this.byId("idExportbutton").setEnabled(true);}},disableExportButton:function(){if(this.byId("idExportbutton").getEnabled()){this.byId("idExportbutton").setEnabled(false);}},_setExportConfigDialogText:function(){sap.ui.core.Fragment.byId("idExportConfigurationFragment","idExportConfigDialog").setTitle(this.oCoreApi.getText("exportConfig"));sap.ui.core.Fragment.byId("idExportConfigurationFragment","idOpenConfig").setText(this.oCoreApi.getText("openConfig"));sap.ui.core.Fragment.byId("idExportConfigurationFragment","idOpenTextProperty").setText(this.oCoreApi.getText("openTextProperty"));sap.ui.core.Fragment.byId("idExportConfigurationFragment","idCloseButton").setText(this.oCoreApi.getText("close"));},_addStyleClassForExportDialog:function(){sap.ui.core.Fragment.byId("idExportConfigurationFragment","idOpenConfig").addStyleClass("configLink");sap.ui.core.Fragment.byId("idExportConfigurationFragment","idOpenTextProperty").addStyleClass("textPropertyLink");},_handleCloseOfExportDialog:function(){if(this.exportConfigurationDialog.isOpen()){this.exportConfigurationDialog.close();}},_handleOpenConfigLinkPress:function(){var s=this;this.configurationHandler.exportConfiguration(this.configId,function(c){s._openFile(c);});},_handleOpenTextsLinkPress:function(){var s=this;this.configurationHandler.exportConfiguration(this.configId,function(c){var e=s.configurationHandler.exportTexts();s._openFile(e);});},_openFile:function(f){var e=encodeURIComponent(f);var n;n=window.open("about:blank","","_blank");n.document.write("<textarea rows='50' cols='160'readonly>"+decodeURIComponent(e)+"</textarea>");}});
