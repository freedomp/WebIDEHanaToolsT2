(function(){"use strict";jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchHelper');var S=sap.ushell.renderers.fiori2.search.SearchHelper;jQuery.sap.require('sap.ushell.renderers.fiori2.search.suggestions.SuggestionProvider');var a=sap.ushell.renderers.fiori2.search.suggestions.SuggestionProvider;jQuery.sap.require('sap.ushell.renderers.fiori2.search.suggestions.SuggestionTypes');var b=sap.ushell.renderers.fiori2.search.suggestions.SuggestionTypes;jQuery.sap.declare('sap.ushell.renderers.fiori2.search.suggestions.AppSuggestionProvider');var m=sap.ushell.renderers.fiori2.search.suggestions.AppSuggestionProvider=function(){this.init.apply(this,arguments);};m.prototype=jQuery.extend(new a(),{init:function(p){a.prototype.init.apply(this,arguments);this.suggestApplications=S.refuseOutdatedRequests(this.suggestApplications);},abortSuggestions:function(){this.suggestApplications.abort();},getSuggestions:function(){var t=this;var d=t.model.getDataSource();if(!d.equals(t.model.allDataSource)&&!d.equals(t.model.appDataSource)){return jQuery.when([]);}var s=t.model.getProperty('/searchBoxTerm');return t.suggestApplications(s).then(function(r){var c=r.getElements();var e={};for(var i=0;i<c.length;i++){if(e[c[i].title]){if(!e[c[i].title].alreadyFound){var f="#Action-search&/searchterm="+c[i].title+"&datasource="+JSON.stringify(t.model.appDataSource);e[c[i].title].url=f;var g=sap.ushell.resources.i18n.getText("suggestion_in_apps",e[c[i].title].label);e[c[i].title].label=g;e[c[i].title].alreadyFound=true;var h=sap.ushell.resources.i18n.getText("suggestion_in_apps",c[i].title);e[h]=e[c[i].title];delete e[c[i].title];}}else{e[c[i].title]=c[i];}}c=[];for(var j in e){if(e.hasOwnProperty(j)){c.push(e[j]);}}return[c,r.totalResults];}).then(function(r){var c=r[0];var e=r[1];jQuery.each(c,function(i,j){j.type=b.SUGGESTION_TYPE_APPS;j.dataSource=t.model.appDataSource;j.position=b.apps.position;});var f;if(t.model.isBusinessObjSearchEnabled()&&t.model.isAllCategory()){f=b.apps.limitDsAll;}else{f=b.apps.limitDsApps;}c=c.slice(0,f);if(e>f){if(d.equals(t.model.appDataSource)||t.model.getProperty("/businessObjSearchEnabled")===false){var g=sap.ushell.resources.i18n.getText("showAllNApps",e);g=g.replace(/"/g,"");var h=g;var l="<i>"+g+"</i>";c.push({title:g,tooltip:h,label:l,dataSource:t.model.appDataSource,labelRaw:t.model.getProperty("/searchBoxTerm"),type:b.SUGGESTION_TYPE_OBJECT_DATA});}}return c;});},suggestApplications:function(s){return sap.ushell.Container.getService("Search").queryApplications({searchTerm:s,searchInKeywords:true});}});})();
