/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright
		2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/core/Control','sap/ui/core/IconPool','sap/uxap/BreadCrumbs','sap/ui/core/ResizeHandler','./library'],function(C,I,B,R,l){"use strict";var O=C.extend("sap.uxap.ObjectPageHeader",{metadata:{library:"sap.uxap",properties:{objectImageURI:{type:"string",defaultValue:null},objectImageAlt:{type:"string",defaultValue:''},objectImageDensityAware:{type:"boolean",defaultValue:false},objectTitle:{type:"string",defaultValue:null},objectSubtitle:{type:"string",defaultValue:null},objectImageShape:{type:"sap.uxap.ObjectPageHeaderPictureShape",defaultValue:sap.uxap.ObjectPageHeaderPictureShape.Square},isObjectIconAlwaysVisible:{type:"boolean",defaultValue:false},isObjectTitleAlwaysVisible:{type:"boolean",defaultValue:true},isObjectSubtitleAlwaysVisible:{type:"boolean",defaultValue:true},isActionAreaAlwaysVisible:{type:"boolean",defaultValue:true},headerDesign:{type:"sap.uxap.ObjectPageHeaderDesign",defaultValue:sap.uxap.ObjectPageHeaderDesign.Light},showTitleSelector:{type:"boolean",group:"Misc",defaultValue:false},markFavorite:{type:"boolean",group:"Misc",defaultValue:false},markFlagged:{type:"boolean",group:"Misc",defaultValue:false},showMarkers:{type:"boolean",group:"Misc",defaultValue:false},markLocked:{type:"boolean",group:"Misc",defaultValue:false},showPlaceholder:{type:"boolean",group:"Misc",defaultValue:false}},defaultAggregation:"actions",aggregations:{_breadCrumbs:{type:"sap.uxap.BreadCrumbs",multiple:false,visibility:"hidden"},breadCrumbsLinks:{type:"sap.m.Link",multiple:true,singularName:"breadCrumbLink"},_overflowButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_objectImage:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_lockIconCont:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_lockIcon:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_titleArrowIconCont:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_titleArrowIcon:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_favIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"},_flagIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"},_overflowActionSheet:{type:"sap.m.ActionSheet",multiple:false,visibility:"hidden"},navigationBar:{type:"sap.m.Bar",multiple:false},actions:{type:"sap.ui.core.Control",multiple:true,singularName:"action"}},events:{titleSelectorPress:{parameters:{domRef:{type:"string"}}},markLockedPress:{parameters:{domRef:{type:"string"}}}}}});O.prototype._iAvailablePercentageForActions=0.3;O.prototype.init=function(){if(!this.oLibraryResourceBundle){this.oLibraryResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.m");}this._oOverflowActionSheet=this._getInternalAggregation("_overflowActionSheet");this._oOverflowButton=this._getInternalAggregation("_overflowButton").attachPress(this._handleOverflowButtonPress,this);this._oActionSheetButtonMap={};this._oFlagIcon=this._getInternalAggregation("_flagIcon");this._oFavIcon=this._getInternalAggregation("_favIcon");this._oTitleArrowIcon=this._getInternalAggregation("_titleArrowIcon").attachPress(this._handleArrowPress,this);this._oTitleArrowIconCont=this._getInternalAggregation("_titleArrowIconCont").attachPress(this._handleArrowPress,this);this._oLockIcon=this._getInternalAggregation("_lockIcon").attachPress(this._handleLockPress,this);this._oLockIconCont=this._getInternalAggregation("_lockIconCont").attachPress(this._handleLockPress,this);};O.prototype._handleOverflowButtonPress=function(e){this._oOverflowActionSheet.openBy(this._oOverflowButton);};O.prototype._handleArrowPress=function(e){this.fireTitleSelectorPress({domRef:e.getSource().getDomRef()});};O.prototype._handleLockPress=function(e){this.fireMarkLockedPress({domRef:e.getSource().getDomRef()});};O._internalAggregationFactory={"_objectImage":function(P){var a,s=P.getObjectImageURI();if(s.indexOf("sap-icon://")==0){a=new sap.ui.core.Icon();}else{a=new sap.m.Image({densityAware:P.getObjectImageDensityAware(),alt:P.getObjectImageAlt(),decorative:false});}a.setSrc(s);a.addStyleClass("sapUxAPObjectPageHeaderObjectImage");return a;},"_overflowActionSheet":function(){return new sap.m.ActionSheet({placement:sap.m.PlacementType.Bottom});},"_lockIconCont":function(P){return this._getButton(P,"sap-icon://locked","lock-cont");},"_breadCrumbs":function(P){return new B({links:P.getAggregation("breadCrumbLinks"),currentLocation:new sap.m.Text({text:P.getProperty("objectTitle")}),showCurrentLocation:false});},"_lockIcon":function(P){return this._getButton(P,"sap-icon://locked","lock");},"_titleArrowIconCont":function(P){return this._getButton(P,"sap-icon://arrow-down","titleArrow-cont");},"_titleArrowIcon":function(a){return this._getButton(a,"sap-icon://arrow-down","titleArrow");},"_favIcon":function(P){return this._getIcon(P,"favorite");},"_flagIcon":function(P){return this._getIcon(P,"flag");},"_overflowButton":function(P){return this._getButton(P,"sap-icon://overflow","overflow");},_getIcon:function(P,i){return I.createControlByURI({id:this._getParentAugmentedId(P,i),src:I.getIconURI(i),visible:false});},_getButton:function(P,i,c){return new sap.m.Button({id:this._getParentAugmentedId(P,c),icon:i,type:sap.m.ButtonType.Transparent});},_getParentAugmentedId:function(P,c){return P.getId()+"-"+c}};O.prototype._getInternalAggregation=function(a){if(!this.getAggregation(a)){this.setAggregation(a,O._internalAggregationFactory[a](this));}return this.getAggregation(a);};O.prototype._applyActionProperty=function(P,a){var n=a[0];if(this.getProperty(P)!==n){a.unshift(P);this.setProperty.apply(this,a);this._notifyParentOfChanges();}return this;};O.prototype._applyObjectImageProperty=function(P,a){var n=a[0];if(this.getProperty(P)!==n){a.unshift(P);this.setProperty.apply(this,a);this._destroyObjectImage();this._notifyParentOfChanges();}return this;};O.prototype._proxyMethodToBreadCrumbControl=function(f,a){var b=this._getInternalAggregation("_breadCrumbs");return b[f].apply(b,a);};O.prototype.setHeaderDesign=function(h){this.setProperty("headerDesign",h);if(this.getParent()){this.getParent().invalidate();}return this;};O.prototype.setObjectTitle=function(t){var b=this._getInternalAggregation("_breadCrumbs");if(b){b.getCurrentLocation().setText(t);}return this._applyActionProperty("objectTitle",Array.prototype.slice.call(arguments));};var p=["objectSubtitle","showTitleSelector","markLocked","markFavorite","markFlagged","showMarkers","showPlaceholder"],o=["objectImageURI","objectImageAlt","objectImageDensityAware","objectImageShape"];var g=function(P){var c="set"+P.charAt(0).toUpperCase()+P.slice(1);O.prototype[c]=function(){var a=Array.prototype.slice.call(arguments);this._applyActionProperty.call(this,P,a);}};var G=function(P){var c="set"+P.charAt(0).toUpperCase()+P.slice(1);O.prototype[c]=function(){var a=Array.prototype.slice.call(arguments);this._applyObjectImageProperty.call(this,P,a);}};p.forEach(g);o.forEach(G);O.prototype.getBreadCrumbsLinks=function(){return this._getInternalAggregation("_breadCrumbs").getLinks();};O.prototype.addBreadCrumbLink=function(){return this._proxyMethodToBreadCrumbControl("addLink",arguments);};O.prototype.indexOfBreadCrumbLink=function(){return this._proxyMethodToBreadCrumbControl("indexOfLink",arguments);};O.prototype.insertBreadCrumbLink=function(){return this._proxyMethodToBreadCrumbControl("insertLink",arguments);};O.prototype.removeBreadCrumbLink=function(){return this._proxyMethodToBreadCrumbControl("removeLink",arguments);};O.prototype.removeAllBreadCrumbsLinks=function(){return this._proxyMethodToBreadCrumbControl("removeAllLinks",arguments);};O.prototype.destroyBreadCrumbsLinks=function(){return this._proxyMethodToBreadCrumbControl("destroyLinks",arguments);};O.prototype._destroyObjectImage=function(){var s="_objectImage",a=this.getAggregation(s);if(a){a.destroy();this.setAggregation(s,null);}};O.prototype.onBeforeRendering=function(){if(this.getShowPlaceholder()){this._oPlaceholder=I.createControlByURI({src:I.getIconURI("picture"),visible:true});}var a=this.getActions()||[];this._oOverflowActionSheet.removeAllButtons();this._oActionSheetButtonMap={};if(a.length>1||this._hasOneButtonShowText(a)){jQuery.each(a,jQuery.proxy(function(i,A){if(A instanceof sap.m.Button&&A.getVisible()){if(A instanceof sap.m.Button&&(A.getType()==="Default"||A.getType()==="Unstyled")){A.setProperty("type",sap.m.ButtonType.Transparent,false);}var b=this._createActionSheetButton(A);this._oActionSheetButtonMap[A.getId()]=b;this._oOverflowActionSheet.addButton(b);}},this));}this._oTitleArrowIcon.setVisible(this.getShowTitleSelector());this._oFavIcon.setVisible(this.getMarkFavorite());this._oFlagIcon.setVisible(this.getMarkFlagged());};O.prototype._createActionSheetButton=function(b){var c=new sap.m.Button({press:jQuery.proxy(this._onSeeMoreContentSelect,this),customData:new sap.ui.core.CustomData({key:"originalId",value:b.getId()})});var t=b.getBindingInfo("text"),i=b.getBindingInfo("icon"),m;if(t&&t.parts&&t.parts.length>0){m=t.parts[0].model;c.bindProperty("text",{path:t.parts[0].path,model:m,formatter:t.formatter});c.setBindingContext(b.getBindingContext(m),m);c.setModel(b.getModel(m),m);}else{c.setText(b.getText());}if(i&&i.parts&&i.parts.length>0){m=i.parts[0].model;c.bindProperty("icon",{path:i.parts[0].path,model:m,formatter:i.formatter});c.setBindingContext(b.getBindingContext(m),m);c.setModel(b.getModel(m),m);}else{c.setIcon(b.getIcon());}return c;};O.prototype.onAfterRendering=function(){this._oOverflowButton.$().hide();this._adaptLayout();if(this.getShowPlaceholder()){jQuery(".sapUxAPObjectPageHeaderObjectImage").error(function(){jQuery(this).hide();jQuery(".sapUxAPObjectPageHeaderPlaceholder").removeClass("sapUxAPHidePlaceholder");});}else{jQuery(".sapUxAPObjectPageHeaderObjectImage").error(function(){jQuery(this).addClass("sapMNoImg");});}if(this._iResizeId){R.deregister(this._iResizeId);}this._iResizeId=R.register(this,this._adaptLayout.bind(this));};O.prototype._onSeeMoreContentSelect=function(e){var P=e.getSource(),a=sap.ui.getCore().byId(P.data("originalId"));if(a.firePress){a.firePress({overflowButtonId:this._oOverflowButton.getId()});}this._oOverflowActionSheet.close();};O.prototype._hasOneButtonShowText=function(a){var b=false;if(a.length!==1){return b;}if(a[0]instanceof sap.uxap.ObjectPageHeaderActionButton){b=(!a[0].getHideText()&&a[0].getText()!="");}else if(a[0]instanceof sap.m.Button){b=(a[0].getText()!="");}return b;};O.prototype._adaptLayout=function(){var i=this.$("identifierLine").width(),a=this._getActionsWidth(),A=a/i,b=this._iAvailablePercentageForActions*i;if(A>this._iAvailablePercentageForActions){this._adaptActions(b);}else{this._oOverflowButton.$().hide();}this.$("actions").find(".sapMBtn").css("visibility","visible");this._adaptObjectPageHeaderIndentifierLine();};O.prototype._adaptObjectPageHeaderIndentifierLine=function(){var i=this.$("identifierLine").width(),$=this.$("subtitle"),s,t,a=this.$("actions").width()+this.$().find(".sapUxAPObjectPageHeaderObjectImageContainer").width(),P=3;if($.length){if($.hasClass("sapOPHSubtitleBlock")){$.removeClass("sapOPHSubtitleBlock");}s=$.outerHeight()+$.position().top;t=this.$("innerTitle").outerHeight()+this.$("innerTitle").position().top;if(Math.abs(s-t)>P){$.addClass("sapOPHSubtitleBlock");}}this.$("identifierLineContainer").width((0.95-(a/i))*100+"%");};O.prototype._adaptActions=function(a){var m=jQuery("html").hasClass("sapUiMedia-Std-Phone")||sap.ui.Device.system.phone,v=this._oOverflowButton.$().show().width(),A;this.getActions().forEach(function(b){A=this._oActionSheetButtonMap[b.getId()];if(A){v+=b.$().width();if(a>v&&!m){A.setVisible(false);}else{this._setActionButtonVisibility(b,false);}}},this);};O.prototype._setActionButtonVisibility=function(a,v){var A=this._oActionSheetButtonMap[a.getId()];if(A){if(v){a.$().show();}else{a.$().hide();}A.setVisible(!v);}};O.prototype._getActionsWidth=function(){var w=0;this.getActions().forEach(function(a){if(a instanceof sap.m.Button){a.$().show();a.$().css("visibility","hidden");w+=a.$().outerWidth(true);}});return w;};O.prototype._notifyParentOfChanges=function(){if(this.getParent()&&typeof this.getParent()._headerTitleChangeHandler==="function"){this.getParent()._headerTitleChangeHandler();}};O.prototype._getActionsPaddingStatus=function(){return this.$("actions").hasClass("sapUxAPObjectPageHeaderIdentifierActionsNoPadding");};O.prototype._setActionsPaddingStatus=function(s){return this.$("actions").toggleClass("sapUxAPObjectPageHeaderIdentifierActionsNoPadding",s);};O.prototype.exit=function(){if(this._iResizeId){R.deregister(this._iResizeId);}};return O;});
