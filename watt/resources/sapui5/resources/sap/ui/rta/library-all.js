jQuery.sap.declare('sap.ui.rta.library-all');if(!jQuery.sap.isDeclared('sap.ui.rta.ToolsMenuRenderer')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.ui.rta.ToolsMenuRenderer');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/rta/ToolsMenuRenderer",['jquery.sap.global'],function(q){"use strict";var T={};T.render=function(r,c){r.write("<div ");r.writeClasses();r.writeControlData(c);r.write(">");if(c.getToolbars().length!==0){c.getToolbars().forEach(function(C){r.renderControl(C);});}else{r.write("&nbsp");}r.write("</div>");};return T;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.Utils')){jQuery.sap.declare('sap.ui.rta.Utils');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.fl.Utils');jQuery.sap.require('sap.ui.dt.OverlayUtil');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.comp.odata.FieldSelectorModelConverter');jQuery.sap.require('sap.ui.fl.registry.Settings');jQuery.sap.require('sap.ui.comp.smartform.GroupElement');jQuery.sap.require('sap.ui.comp.smartform.Group');jQuery.sap.require('sap.ui.comp.smartfield.SmartField');sap.ui.define("sap/ui/rta/Utils",["jquery.sap.global","sap/ui/fl/Utils","sap/ui/dt/OverlayUtil","sap/ui/dt/ElementUtil","sap/ui/comp/odata/FieldSelectorModelConverter","sap/ui/fl/registry/Settings",'sap/ui/comp/smartform/GroupElement','sap/ui/comp/smartform/Group','sap/ui/comp/smartfield/SmartField'],function(q,F,O,E,a,S,G,b,c){"use strict";var U={};U._aEditableTypes=["sap.ui.comp.smartform.SmartForm","sap.ui.comp.smartform.Group","sap.ui.comp.smartform.GroupElement"];U._sFocusableOverlayClass=".sapUiDtOverlaySelectable";U.isCustomFieldAvailable=function(C){q.sap.require("sap.ui.fl.fieldExt.Access");var s=F.getComponentClassName(C);var d=false;var f=new a(C.getModel());var e;f.getConvertedModel();return S.getInstance(s).then(function(o){if(o.isModelS){d=o.isModelS();}if(!d){return Promise.resolve();}else{var m=f.getMetaDataAnalyzer();try{var g=f.getEntityTypes();if(g&&g.length>0){e=g[0].key;}var p=sap.ui.fl.fieldExt.Access.getBusinessContexts(m.oModel.sServiceUrl,e);p.fail(function(h){if(h){if(q.isArray(h.errorMessages)){for(var i=0;i<h.errorMessages.length;i++){q.sap.log.error(h.errorMessages[i].text);}}}return Promise.resolve();});return p.then(function(r){if(r){if(r.BusinessContexts){if(r.BusinessContexts.length>0){return Promise.resolve(r);}}}});}catch(h){q.sap.log.error("exception occured in sap.ui.fl.fieldExt.Access.getBusinessContexts");return Promise.resolve();}}});};U.isElementHideable=function(e){return((e instanceof G||e instanceof b)&&!this.isElementMandatory(e));};U.isElementMandatory=function(e){var m=false;if(e instanceof G){var f=e.getFields();for(var i=0;i<f.length;i++){var g=f[i];if(g instanceof c){m=g.getMandatory();if(m){break;}}}}else if(e instanceof b){var d=e.getGroupElements();for(var j=0;j<d.length;j++){return this.isElementMandatory(d[j]);}}return m;};U.isOverlayMutable=function(o){var e=o.getElementInstance();var i,I,h,B;i=this._aEditableTypes.some(function(t){return E.isInstanceOf(e,t);});if(i){I=e.getVisible?e.getVisible():true;if(I){h=F.checkControlId(e);if(h){if(E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){B=h;}else{var d=o.getParentElementOverlay();var f=d?d.getElementInstance():null;B=f&&F.checkControlId(f);}}}}return i&&h&&B;};U.getLabelForElement=function(e){var f=e.getLabelText?e.getLabelText():undefined;if(!f){f=e.getLabel?e.getLabel():undefined;}if(!f){f=e.getText?e.getText():undefined;}return(typeof f)==="string"?f:undefined;};U.isOverlaySelectable=function(o){return o.isSelectable()&&o.$().is(":visible");};U.getPreviousSelectableOverlay=function(o){var p=O.getPreviousOverlay(o);while(p&&!this.isOverlaySelectable(p)){p=O.getPreviousOverlay(p);}return p;};U.getNextSelectableOverlay=function(o){var n=O.getNextOverlay(o);while(n&&!this.isOverlaySelectable(n)){n=O.getNextOverlay(n);}return n;};U.getOverlayInstanceForDom=function(d){var i=q(d).attr("id");if(i){return sap.ui.getCore().byId(i);}};U.getFirstFocusableOverlay=function(){var $=q(this._sFocusableOverlayClass).first();var o=this.getOverlayInstanceForDom($);if(!this.isOverlaySelectable(o)){o=this.getNextSelectableOverlay(o);}return o;};U.getLastFocusableOverlay=function(){var $=q(this._sFocusableOverlayClass).last();var o=this.getOverlayInstanceForDom($);if(!this.isOverlaySelectable(o)){o=this.getPreviousSelectableOverlay(o);}return o;};U.getNextFocusableOverlay=function(){var f=this.getFocusedOverlay();if(f){return this.getNextSelectableOverlay(f);}};U.getPreviousFocusableOverlay=function(){var f=this.getFocusedOverlay();if(f){return this.getPreviousSelectableOverlay(f);}};U.getFocusedOverlay=function(){var e=sap.ui.getCore().byId(document.activeElement.id);if(e instanceof sap.ui.dt.ElementOverlay){return e;}};U.getFirstFocusableChildOverlay=function(o){var f=O.getFirstChildOverlay(o);while(f&&!this.isOverlaySelectable(f)){f=O.getNextSiblingOverlay(f);}return f;};U.getNextFocusableSiblingOverlay=function(o){var n=O.getNextSiblingOverlay(o);while(n&&!this.isOverlaySelectable(n)){n=O.getNextSiblingOverlay(n);}return n;};U.getPreviousFocusableSiblingOverlay=function(o){var p=O.getPreviousSiblingOverlay(o);while(p&&!this.isOverlaySelectable(p)){p=O.getPreviousSiblingOverlay(p);}return p;};U.getClosestViewFor=function(e){if(!e&&!e.getParent){return;}var p=e.getParent();if(p&&p.getMetadata().getName()!=="sap.ui.core.mvc.XMLView"){return this.getClosestViewFor(p);}return p;};U.getClosestTypeForControl=function(C,t){var p=C.getParent();if(p&&p.getMetadata().getName()!==t){return this.getClosestTypeForControl(p,t);}return p;};U._checkIsSupportedControl=function(C,s){for(var i=0;i<s.length;i++){if(C instanceof s[i]){return true;}}};U.hasGroupUnBoundFields=function(g){var e=g.getGroupElements();for(var j=0;j<e.length;j++){var o=e[j];if(!this.hasGroupElementBoundFields(o)){return true;}}return false;};U.hasGroupElementBoundFields=function(g){var e=g.getFields();if(e.length===0){return true;}for(var j=0;j<e.length;j++){var o=e[j];if(!o.getDomRef()){continue;}if(this._isElementBound(o)){return true;}}return false;};U._isElementBound=function(e){var B=e.mBindingInfos;if(Object.keys(B).length===0){return false;}else{for(var p in B){var P=B[p].parts;for(var i=0;i<P.length;i++){if(P[i].model){var m=e.getModel(P[i].model).getMetadata().getName();if(m==="sap.ui.model.odata.ODataModel"||m==="sap.ui.model.odata.v2.ODataModel"){return true;}}else{var m=e.getModel().getMetadata().getName();if(m==="sap.ui.model.odata.ODataModel"||m==="sap.ui.model.odata.v2.ODataModel"){return true;}}}}}};U.findSupportedBlock=function(C,s){if(this._checkIsSupportedControl(C,s)){return C;}else{C=C.getParent();while(C){if(this._checkIsSupportedControl(C,s)){return C;}C=C.getParent();}}};U.createFieldLabelId=function(g,e,f){var C=g.getId()+"_"+e+"_"+f.getBindingPath("value");C=C.replace("/","_");return C;};return U;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.changeHandler.AddControl')){jQuery.sap.declare('sap.ui.rta.changeHandler.AddControl');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.fl.changeHandler.Base');sap.ui.define("sap/ui/rta/changeHandler/AddControl",["jquery.sap.global","sap/ui/fl/changeHandler/Base"],function(q,B){"use strict";var A=function(){};A.prototype=q.sap.newObject(B.prototype);A.prototype.applyChange=function(c,C){try{var d=c.getDefinition();var o=q.sap.getObject(d.content.field.jsType);var n=new o({id:d.content.field.id,text:d.content.field.value});if(n.setTitle){n.setTitle(d.texts.fieldLabel.value);}C.addAggregation(d.content.aggregation,n);}catch(e){throw new Error("Applying add control changes failed: "+e);}};A.prototype.completeChangeContent=function(c,s){var C=c.getDefinition();if(s.fieldLabel){this.setTextInChange(C,"fieldLabel",s.fieldLabel,"XFLD");}else{throw new Error("oSpecificChangeInfo.fieldLabel attribute required");}if(!C.content){C.content={};}if(!C.content.field){C.content.field={};}if(s.fieldValue){C.content.field.value=s.fieldValue;}else{throw new Error("oSpecificChangeInfo.fieldValue attribute required");}if(s.valueProperty){C.content.field.valueProperty=s.valueProperty;}else{throw new Error("oSpecificChangeInfo.valueProperty attribute required");}if(s.newControlId){C.content.field.id=s.newControlId;}else{throw new Error("oSpecificChangeInfo.newControlId attribute required");}if(s.jsType){C.content.field.jsType=s.jsType;}else{throw new Error("oSpecificChangeInfo.jsType attribute required");}if(s.index===undefined){throw new Error("oSpecificChangeInfo.index attribute required");}else{C.content.field.index=s.index;}if(s.entitySet){C.content.field.entitySet=s.entitySet;}};return A;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.changeHandler.Move')){jQuery.sap.declare('sap.ui.rta.changeHandler.Move');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.fl.changeHandler.Base');jQuery.sap.require('sap.ui.fl.Utils');sap.ui.define("sap/ui/rta/changeHandler/Move",["jquery.sap.global","sap/ui/fl/changeHandler/Base","sap/ui/fl/Utils"],function(q,B,F){"use strict";var M=function(){};M.prototype=q.sap.newObject(B.prototype);M.prototype.applyChange=function(c,C){try{var d=c.getDefinition();d.content.forEach(function(m){var s=sap.ui.getCore().byId(m.sourceContainerId);var t=sap.ui.getCore().byId(m.targetContainerId);s.removeAggregation(C.sParentAggregationName,C);t.insertAggregation(m.targetAggregation,C,m.index);});}catch(e){throw new Error("Applying move changes failed: "+e);}};M.prototype.completeChangeContent=function(c,s){var C=c.getDefinition();if(s.parameters){C.content=s.parameters;}else{throw new Error("oSpecificChangeInfo.parameters attribute required");}};return M;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.changeHandler.Property')){jQuery.sap.declare('sap.ui.rta.changeHandler.Property');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.fl.changeHandler.Base');jQuery.sap.require('sap.ui.fl.Utils');sap.ui.define("sap/ui/rta/changeHandler/Property",["jquery.sap.global","sap/ui/fl/changeHandler/Base","sap/ui/fl/Utils"],function(q,B,F){"use strict";var P=function(){};P.prototype=q.sap.newObject(B.prototype);P.prototype.applyChange=function(c,C){try{var d=c.getDefinition();d.content.forEach(function(p){var a=p.propertyName;var b=C.getMetadata().getProperties()[a];var f=b._sMutator;C[f](p.newValue);});}catch(e){throw new Error("Applying property changes failed: "+e);}};P.prototype.completeChangeContent=function(c,s){var C=c.getDefinition();if(s.parameters){C.content=s.parameters;}else{throw new Error("oSpecificChangeInfo.parameters attribute required");}};return P;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.library')){jQuery.sap.declare('sap.ui.rta.library');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Core');jQuery.sap.require('sap.ui.core.library');sap.ui.define("sap/ui/rta/library",['jquery.sap.global','sap/ui/core/Core','sap/ui/core/library'],function(q,C,c){"use strict";sap.ui.getCore().initLibrary({name:"sap.ui.rta",version:"1.32.7",dependencies:["sap.ui.core","sap.m"],types:[],interfaces:[],controls:["sap.ui.rta.ContextMenu","sap.ui.rta.ToolsMenu","sap.ui.rta.FieldRepository"],elements:[]});return sap.ui.rta;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.ContextMenu')){jQuery.sap.declare('sap.ui.rta.ContextMenu');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.unified.Menu');jQuery.sap.require('sap.ui.unified.MenuItem');jQuery.sap.require('sap.ui.core.Popup');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.comp.smartform.GroupElement');jQuery.sap.require('sap.ui.comp.smartform.Group');jQuery.sap.require('sap.ui.comp.smartform.SmartForm');sap.ui.define("sap/ui/rta/ContextMenu",['jquery.sap.global','./library','sap/ui/unified/Menu','sap/ui/unified/MenuItem','sap/ui/core/Popup','sap/ui/dt/ElementUtil','./Utils','sap/ui/comp/smartform/GroupElement','sap/ui/comp/smartform/Group','sap/ui/comp/smartform/SmartForm'],function(q,l,M,a,P,E,U,G,b,S){"use strict";var C=M.extend("sap.ui.rta.ContextMenu",{metadata:{library:"sap.ui.rta",associations:{element:{type:"sap.ui.core.Element",multiple:false}},events:{renameLabel:{},hideElement:{},addElement:{},addGroup:{},adaptElement:{}}},renderer:{}});C.prototype.init=function(){M.prototype.init.apply(this,arguments);this.attachItemSelect(this._onItemSelected,this);this._oTextResources=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");this._fnOnKeyDown=this._onKeyDown.bind(this);q(document).keydown(this._fnOnKeyDown);this.attachBrowserEvent("contextmenu",this._onContextMenu,this);this._oOverlayDomRef=document.body;};C.prototype.exit=function(){M.prototype.exit.apply(this,arguments);this._oRb=null;q(document).off("keydown",this._fnOnKeyDown);delete this._fnOnKeyDown;this.detachBrowserEvent("contextmenu");};C.prototype.setOverlayDomRef=function(o){this._oOverlayDomRef=o.getDomRef();};C.prototype.getElementInstance=function(){return sap.ui.getCore().byId(this.getElement());};C.prototype.setElement=function(e){this.setAssociation("element",e,true);var m=[];var o=this.getElementInstance();if(o instanceof G){m.push({text:"CTX_RENAME_LABEL",enabled:true});m.push({text:"CTX_ADD_FIELD",enabled:true});var h=U.hasGroupElementBoundFields(o);m.push({text:"CTX_HIDE_FIELD",enabled:h});m.push({text:"CTX_ADAPT",startSection:true,enabled:true});}if(o instanceof b){m.push({text:"CTX_RENAME_GROUP",enabled:true});m.push({text:"CTX_ADD_FIELD",enabled:true});m.push({text:"CTX_ADD_GROUP",enabled:true});var H=U.hasGroupUnBoundFields(o);m.push({text:"CTX_HIDE_GROUP",enabled:!H});m.push({text:"CTX_ADAPT",startSection:true,enabled:true});}if(o instanceof S){m.push({text:"CTX_ADD_GROUP",enabled:true});m.push({text:"CTX_ADAPT",enabled:true});}this._createMenuItems(m);};C.prototype._createMenuItems=function(m){this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");this.destroyItems();for(var i=0;i<m.length;i++){var o=new a({text:this._oRb.getText(m[i].text),enabled:m[i].enabled});o.data({id:m[i].text});if(m[i].startSection){o.setStartsSection(true);}this.addItem(o);}};C.prototype._getSmartFormForElement=function(e){while(e&&!E.isInstanceOf(e,"sap.ui.comp.smartform.SmartForm")){e=e.getParent();}return e;};C.prototype._onItemSelected=function(e){var i=e.getParameter("item").data("id");var o=this.getElementInstance();switch(i){case"CTX_ADD_FIELD":this.fireAddElement({element:o});break;case"CTX_ADD_GROUP":this.fireAddGroup({element:o});break;case"CTX_RENAME_LABEL":case"CTX_RENAME_GROUP":this.fireRenameLabel({element:o});break;case"CTX_HIDE_FIELD":case"CTX_HIDE_GROUP":this.fireHideElement({element:o});break;case"CTX_ADAPT":var s=this._getSmartFormForElement(o);this.fireAdaptElement({element:s});break;default:break;}};C.prototype._onOpenCustomField=function(e){var c=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");var h=(c&&c.hrefForExternal({target:{semanticObject:"CustomField",action:"develop"},params:{businessContexts:this._oCurrentFieldExtInfo.BusinessContexts,serviceName:this._oCurrentFieldExtInfo.ServiceName,serviceVersion:this._oCurrentFieldExtInfo.ServiceVersion}}));window.open(h,"_blank");};C.prototype._open=function(p,i){if(this.getItems().length===0){return;}var m=p;var c=i;var X=m;var Y=c;var d=q('body').width();var e=q('body').height();if(!this.getDomRef()){this.open(false,undefined,undefined,undefined,undefined,-2000+" "+-2000,"none");}var f=this.$().context.clientWidth;var g=this.$().context.clientHeight;var x=(d-m<f)?f:0;var y=(e-c<g)?g:0;X=((d/2-m)*-1)+f/2+2-x;Y=((e/2-c)*-1)+g/2+2-y;var h=c-g;if(h<0&&y!==0){Y=Y-h;}this.close();this.open(true,this._oOverlayDomRef,undefined,undefined,document.body,X+" "+Y,"flip");};C.prototype.openMenu=function(c){this._open(c.pageX,c.pageY);};C.prototype._onKeyDown=function(e){if(!this.bOpen){q(document).off("keydown",this._fnOnKeyDown);delete this._fnOnKeyDown;return;}if((e.keyCode===q.sap.KeyCodes.F10)&&(e.shiftKey===true)&&(e.altKey===false)&&(e.ctrlKey===false)){e.preventDefault();}};C.prototype._onContextMenu=function(e){if(!this.bOpen){this.detachBrowserEvent("contextmenu");return;}if(e.preventDefault){e.preventDefault();}};return C;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.FlexAdapter')){jQuery.sap.declare('sap.ui.rta.FlexAdapter');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.fl.FlexControllerFactory');sap.ui.define("sap/ui/rta/FlexAdapter",['jquery.sap.global','sap/ui/fl/FlexControllerFactory','sap/ui/rta/Utils'],function(q,f,U){"use strict";var F=function(c){};F.M_TYPES={move:"move",addGroup:"addGroup",addField:"addField",property:"property",hideControl:"hideControl",unhideControl:"unhideControl"};F.prototype.init=function(c){this._attachFlexController(c);};F.prototype.destroy=function(){if(this.flexController){delete this.flexController;}};F.prototype.createFlexMoveEvent=function(c,s,t,T,i){var a=F.M_TYPES.move;var C={changeType:a,selector:{id:c}};C.parameters=[{targetAggregation:T,sourceContainerId:s,targetContainerId:t,index:i}];return C;};F.prototype.createFlexPropertyChangeEvent=function(c,p,P){var t=F.M_TYPES.property;var C={changeType:t,selector:{id:c}};C.parameters=[{propertyName:p,newValue:P}];return C;};F.prototype.createHideEvent=function(c){var t=F.M_TYPES.hideControl;var C={changeType:t,selector:{id:c}};return C;};F.prototype.createUnhideEvent=function(c){var t=F.M_TYPES.unhideControl;var C={changeType:t,selector:{id:c}};return C;};F.prototype.createAddGroupEvent=function(c){var v=U.getClosestViewFor(sap.ui.getCore().byId(c.selectorId));var a={selector:{id:c.selectorId},index:c.index,newControlId:v.createId(q.sap.uid()),changeType:F.M_TYPES.addGroup,groupLabel:"New Group"};return a;};F.prototype.createAddFieldEvent=function(c){var a={selector:{id:c.selectorId},index:c.index,newControlId:c.newControlId,changeType:F.M_TYPES.addField,fieldLabel:c.fieldLabel,fieldValue:c.fieldValue,valueProperty:c.valueProperty,jsType:c.jsType,value:c.value};return a;};F.prototype.emitHideEvent=function(c){this._emitFlexEvent(c,this.createHideEvent(c.getId()));};F.prototype.emitUnhideEvent=function(c){this._emitFlexEvent(c,this.createUnhideEvent(c.getId()));};F.prototype.emitAddEvent=function(c,C){var o;if(F.M_TYPES.addField===C){o=this.createAddFieldEvent(c);}else if(F.M_TYPES.addGroup===C){o=this.createAddGroupEvent(c);}this._emitFlexEvent(sap.ui.getCore().byId(c.selectorId),o);return o;};F.prototype.emitMoveEvent=function(e,c){this._emitFlexEvent(e,c);};F.prototype.emitPropertyChangeEvent=function(c,p,P){this._emitFlexEvent(c,this.createFlexPropertyChangeEvent(c.getId(),p,P));};F.prototype.onResetToDefault=function(){var t=this;this.flexController.getComponentChanges().then(function(c){return t.flexController.discardChanges(c).then(function(){window.location.reload();});})['catch'](function(e){q.sap.log.error("Flexibility data could not be discarded "+e);});};F.prototype._attachFlexController=function(c){try{if(f){this.flexController=f.createForControl(c);}else{this.flexController=null;}}catch(e){q.sap.log.error("No DT control can be found for "+c.getMetadata().getName());}};F.prototype._emitFlexEvent=function(c,C){if(this.flexController){this.flexController.createAndApplyChange(C,c);this.flexController.saveAll().then(function(){})["catch"](function(e){q.sap.log.error("Flexibility data could not be saved "+e);});}};return F;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.ModelConverter')){jQuery.sap.declare('sap.ui.rta.ModelConverter');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.comp.odata.FieldSelectorModelConverter');jQuery.sap.require('sap.ui.dt.ElementUtil');sap.ui.define("sap/ui/rta/ModelConverter",['jquery.sap.global','sap/ui/comp/odata/FieldSelectorModelConverter','sap/ui/dt/ElementUtil','./Utils'],function(q,F,E,U){"use strict";var M={};M.getConvertedModelWithBoundAndRenamedLabels=function(c,e){var t=this;var m=c.getModel();return this._getModelConverter(m).then(function(f){return t._getFieldModel(c,f,e);});};M._getModelConverter=function(m){var o=m.getMetaModel();return o.loaded().then(function(){return new F(m);},function(r){q.sap.log.error("MetadataModel could not be loaded",r);});};M._getIgnoredFields=function(c){if(c&&c.getIgnoredFields){var C=c.getIgnoredFields();if(C){var i=C.split(",");return i;}}return[];};M._getFieldModel=function(c,f,e){var I=this._getIgnoredFields(c);var C=f.getConvertedModel(e,I);var v=this._findVisibleAndBoundFieldsAndLabelNames(c);var V=v.visibleAndBoundFields;var m=v.fieldsAndLabelNames;var a=v.fieldsAndBoundPropertyName;var b=v.boundFieldsId;var s;for(var z=0;z<e.length;z++){s=e[z];for(var i=0;i<C[s].length;i++){var A=C[s][i];var d=f.getMetaDataAnalyzer()._getNameOfPropertyUsingComplexType(s,A.entityName);if(V[A.name]){A.checked=true;}A.controlId=b[A.name];if(d){A.isComplexType=true;A.complexTypeName=d;if(V[d+"/"+A.name]){A.checked=true;A.controlId=V[d+"/"+A.name];}}var g;if(A.isComplexType){g=m[A.complexTypeName+"/"+A.name];}else{g=m[A.name];}if(g&&g!==A["sap:label"]){A.fieldLabel=g;}A.boundProperty=a[A.name];}}return C[s];};M._findVisibleAndBoundFieldsAndLabelNames=function(c){var v=[];var b=[];var f={};var m={};var e=E.findAllPublicElements(c);var i=0;if(c instanceof sap.m.ObjectHeader){for(i=0;i<e.length;i++){var o=e[i];if(o instanceof sap.m.ObjectAttribute){v.push(o.getBindingPath("text"));}}}else if(c instanceof sap.ui.comp.smartform.SmartForm){for(i=0;i<e.length;i++){var a=e[i];if(a.mBindingInfos){for(var I in a.mBindingInfos){var p=a.mBindingInfos[I].parts[0].path?a.mBindingInfos[I].parts[0].path:"";var P=a.getParent();if(P&&p){m[p]=I;var s=U.getLabelForElement(P);if(s){f[p]=s;}if(a.getDomRef()){v[p]=P.getId();}b[p]=P.getId();}}}}}return{visibleAndBoundFields:v,boundFieldsId:b,fieldsAndLabelNames:f,fieldsAndBoundPropertyName:m};};return M;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.RTADragDropPlugin')){jQuery.sap.declare('sap.ui.rta.RTADragDropPlugin');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.dt.plugin.ControlDragDrop');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.dt.OverlayUtil');sap.ui.define("sap/ui/rta/RTADragDropPlugin",['jquery.sap.global','sap/ui/dt/plugin/ControlDragDrop','sap/ui/dt/ElementUtil','sap/ui/dt/OverlayUtil','./Utils'],function(q,C,E,O,U){"use strict";var R=C.extend("sap.ui.rta.RTADragDropPlugin",{metadata:{library:"sap.ui.rta",properties:{},associations:{},events:{moveElement:{},hideElement:{},openContextMenu:{}}}});R.prototype.init=function(){C.prototype.init.apply(this,arguments);this._fnOnKeyDown=this._onKeyDown.bind(this);q(document).keydown(this._fnOnKeyDown);};R.prototype.exit=function(){C.prototype.exit.apply(this,arguments);q(document).off("keydown",this._fnOnKeyDown);delete this._fnOnKeyDown;};R.prototype.registerOverlay=function(o){o.attachBrowserEvent("click",this._onClick,this);o.attachEvent("selectableChange",this._onSelectableChange,this);o.attachBrowserEvent("contextmenu",this._onContextMenu,this);if(o.isDraggable()){this._attachDraggableBrowserEvents(o);}if(U.isOverlayMutable(o)){o.setSelectable(true);}else{o.setSelectable(false);}if(!o.getDomRef()){var _={onAfterRendering:function(e){var o=e.srcControl;if(o.isSelectable()){o.$().attr("tabindex",0);}o.removeEventDelegate(_);}};o.addEventDelegate(_);}C.prototype.registerOverlay.apply(this,arguments);};R.prototype.deregisterOverlay=function(o){C.prototype.deregisterOverlay.apply(this,arguments);o.detachBrowserEvent("click",this._onClick,this);o.detachEvent("selectableChange",this._onSelectableChange,this);o.detachBrowserEvent("contextmenu",this._onContextMenu,this);this._detachDraggableBrowserEvents(o);};R.prototype._attachDraggableBrowserEvents=function(o){o.attachBrowserEvent("mouseover",this._onMouseOver,this);o.attachBrowserEvent("mouseleave",this._onMouseLeave,this);};R.prototype._detachDraggableBrowserEvents=function(o){o.detachBrowserEvent("mouseover",this._onMouseOver,this);o.detachBrowserEvent("mouseleave",this._onMouseLeave,this);};R.prototype._onContextMenu=function(e){if(e.preventDefault){e.preventDefault();}var o=sap.ui.getCore().byId(e.originalEvent.currentTarget.id);if(o.isSelectable()){o.setSelected(true);this.fireOpenContextMenu({originalEvent:e,overlay:o});e.stopPropagation();}};R.prototype._onKeyDown=function(e){var o=U.getFocusedOverlay();if(e.keyCode===q.sap.KeyCodes.DELETE){this._hideElement();}else if((e.keyCode===q.sap.KeyCodes.ENTER)&&(e.shiftKey===false)&&(e.altKey===false)&&(e.ctrlKey===false)){if((o)&&(!o.isSelected())){o.setSelected(true);}}else if((e.keyCode===q.sap.KeyCodes.F10)&&(e.shiftKey===true)&&(e.altKey===false)&&(e.ctrlKey===false)){if(o){o.setSelected(true);var w=o.$().width()/2;var h=o.$().height()/2;var t=o.$().offset().top;var l=o.$().offset().left;var a=q.Event("click",{pageX:l+w,pageY:t+h});this.fireOpenContextMenu({originalEvent:a,overlay:o});}}else if((e.keyCode===q.sap.KeyCodes.ARROW_UP)&&(e.shiftKey===false)&&(e.altKey===false)&&(e.ctrlKey===false)){if(o){var p=o.getParentElementOverlay();if((p)&&(p.isSelectable())){p.focus();}}}else if((e.keyCode===q.sap.KeyCodes.ARROW_DOWN)&&(e.shiftKey===false)&&(e.altKey===false)&&(e.ctrlKey===false)){if(o){var f=U.getFirstFocusableChildOverlay(o);if(f){f.focus();}}}else if((e.keyCode===q.sap.KeyCodes.ARROW_LEFT)&&(e.shiftKey===false)&&(e.altKey===false)&&(e.ctrlKey===false)){if(o){var P=U.getPreviousFocusableSiblingOverlay(o);if(P){P.focus();}}}else if((e.keyCode===q.sap.KeyCodes.ARROW_RIGHT)&&(e.shiftKey===false)&&(e.altKey===false)&&(e.ctrlKey===false)){if(o){var n=U.getNextFocusableSiblingOverlay(o);if(n){n.focus();}}}};R.prototype._hideElement=function(){var d=this.getDesignTime();var s=d.getSelection();var S=s[0];if(S){var e=S.getElementInstance();this.fireHideElement({element:e});}};R.prototype.onDragStart=function(o){C.prototype.onDragStart.apply(this,arguments);this.getDesignTime().getSelection().forEach(function(o){o.setSelected(false);});o.$().addClass("sapUiRtaOverlayPlaceholder");var p=o.getParentElementOverlay().getElementInstance();this._oSourceParent=p;};R.prototype.onDragEnd=function(o){C.prototype.onDragEnd.apply(this,arguments);o.$().removeClass("sapUiRtaOverlayPlaceholder");o.setSelected(true);o.focus();this._onOverlayMoved(o);};R.prototype._onOverlayMoved=function(o){var m;if(E.isInstanceOf(o.getElementInstance(),"sap.ui.comp.smartform.Group")){m=this._createMoveEventInSmartForm("moveGroups",o);}else if(E.isInstanceOf(o.getElementInstance(),"sap.ui.comp.smartform.GroupElement")){m=this._createMoveEventInSmartForm("moveFields",o);}if(m){this.fireMoveElement(m);}};R.prototype._createMoveEventInSmartForm=function(t,o){var e=o.getElementInstance();var T=o.getParentElementOverlay().getElementInstance();var p=o.getParentAggregationOverlay().getAggregationName();var s=this._oSourceParent.getId();var a=T.getId();var i=this._getIndexInParentAggregation(T,p,e);var c={changeType:t,selector:{id:s},targetId:a!==s?a:null};c[t]=[{id:e.getId(),index:i}];return{element:this._oSourceParent,change:c};};R.prototype._getIndexInParentAggregation=function(p,a,e){var c=E.getAggregation(p,a);return c.indexOf(e);};R.prototype.onDraggableChange=function(o){C.prototype.onDraggableChange.apply(this,arguments);if(o.isDraggable()){this._attachDraggableBrowserEvents(o);}else{this._detachDraggableBrowserEvents(o);}};R.prototype.checkDraggable=function(o){var d=C.prototype.checkDraggable.apply(this,arguments);return d&&U.isOverlayMutable(o);};R.prototype.checkDroppable=function(a){var d=C.prototype.checkDroppable.call(this,a);if(d){var o=a.getParent();var s=O.getClosestOverlayForType("sap.ui.comp.smartform.SmartForm",o);var A=O.getClosestOverlayForType("sap.ui.comp.smartform.SmartForm",this.getDraggedOverlay());if(s!==A){d=false;}}return d;};R.prototype._onClick=function(e){var o=sap.ui.getCore().byId(e.currentTarget.id);if(o.isSelectable()){o.setSelected(!o.getSelected());e.preventDefault();e.stopPropagation();}};R.prototype._onSelectableChange=function(e){var o=e.getSource();var s=e.getParameter("selectable");if(s){o.$().attr("tabindex",0);}else{o.$().attr("tabindex",null);}};R.prototype._onMouseOver=function(e){var o=sap.ui.getCore().byId(e.currentTarget.id);if(o!==this._oPreviousHoverTarget){if(this._oPreviousHoverTarget){this._oPreviousHoverTarget.$().removeClass("sapUiRtaOverlayHover");}this._oPreviousHoverTarget=o;o.$().addClass("sapUiRtaOverlayHover");}e.preventDefault();e.stopPropagation();};R.prototype._onMouseLeave=function(e){if(this._oPreviousHoverTarget){this._oPreviousHoverTarget.$().removeClass("sapUiRtaOverlayHover");}delete this._oPreviousHoverTarget;e.preventDefault();e.stopPropagation();};return R;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.RTARenamePlugin')){jQuery.sap.declare('sap.ui.rta.RTARenamePlugin');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.dt.Plugin');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.dt.OverlayUtil');jQuery.sap.require('sap.ui.fl.FlexControllerFactory');sap.ui.define("sap/ui/rta/RTARenamePlugin",['jquery.sap.global','sap/ui/dt/Plugin','sap/ui/dt/ElementUtil','sap/ui/dt/OverlayUtil','./Utils','sap/ui/fl/FlexControllerFactory'],function(q,P,E,O,U,F){"use strict";var R=P.extend("sap.ui.rta.RTARenamePlugin",{metadata:{library:"sap.ui.rta",properties:{},associations:{},events:{"editable":{},"nonEditable":{}}}});R.prototype.exit=function(){P.prototype.exit.apply(this,arguments);q(document).off("keydown",this._fnOnKeyDown);delete this._fnOnKeyDown;delete this._aSelection;};R.prototype.setDesignTime=function(d){this._aSelection=[];var o=this.getDesignTime();if(o){o.detachSelectionChange(this._onDesignTimeSelectionChange,this);}P.prototype.setDesignTime.apply(this,arguments);if(d){d.attachSelectionChange(this._onDesignTimeSelectionChange,this);this._aSelection=d.getSelection();}};R.prototype.registerOverlay=function(o){o.attachEvent("editableChange",this._manageClickEvent,this);if(this.checkEditable(o)){o.setEditable(true);}};R.prototype.deregisterOverlay=function(o){o.detachEvent("editableChange",this._manageClickEvent,this);o.detachBrowserEvent("click",this._onClick,this);};R.prototype._onClick=function(e){var o=sap.ui.getCore().byId(e.currentTarget.id);this.setEditMode(o);e.preventDefault();};R.prototype.setEditMode=function(o){this._oEditedOverlay=o;this._hideOverlays(true,{currentTarget:{id:o.getId()}});};R.prototype._hideOverlays=function(h,e){var t=sap.ui.getCore().byId(e.currentTarget.id);var $;var r={};if(!h){r={value:t.$()[0].innerText,type:this._oEditedOverlay.getElementInstance().getMetadata().getName()};$=t.$();q("#overlay-container").show();$.removeAttr("contenteditable");if($.hasClass("sapUiRtaEditLabel")){$.removeClass("sapUiRtaEditLabel");}else{$.removeClass("sapUiRtaEditTitle");}$[0].blur();$[0].onfocus=null;$[0].onblur=null;$[0].onkeydown=null;this.fireNonEditable();}else{var $=this._getTargetFor(t);q("#overlay-container").hide();$.attr("contenteditable","true");if($.hasClass("sapMLabel")){$.addClass("sapUiRtaEditLabel");}else{$.addClass("sapUiRtaEditTitle");}setTimeout(function(){$[0].focus();},0);$[0].onfocus=q.proxy(this._onEditableElementFocus,this);$[0].onblur=q.proxy(this._onEditableElementBlur,this);$[0].onkeydown=q.proxy(this._onEditableElementKeydown,this);this._oOldFieldValue=$[0].innerText;this.fireEditable();}return r;};R.prototype._getTargetFor=function(t){var n=t.getElementInstance().getMetadata().getName();var $;switch(n){case"sap.ui.comp.smartform.Group":$=t.getElementInstance().getTitle().$();break;case"sap.ui.comp.smartform.GroupElement":$=t.getElementInstance().getLabel().$();break;default:break;}return $;};R.prototype._createRenameEventInSmartForm=function(t,o){var e=o.getElementInstance();var T=o.getParentElementOverlay().getElementInstance();var p=o.getParentAggregationOverlay().getAggregationName();var s=this._oSourceParent.getId();var a=T.getId();var i=this._getIndexInParentAggregation(T,p,e);var c={changeType:t,selector:{id:s},targetId:a!==s?a:null};c[t]=[{id:e.getId(),index:i}];return{element:this._oSourceParent,change:c};};R.prototype._onDesignTimeSelectionChange=function(e){var t=this;var s=e.getParameter("selection");s.forEach(function(o){if(t._aSelection.indexOf(o)===-1){t._aSelection.push(o);}});t._aSelection.forEach(this._manageClickEvent,this);};R.prototype._manageClickEvent=function(e){var o=e.getSource?e.getSource():e;if(o.isSelected()&&o.isEditable()&&o.isDraggable()){o.attachBrowserEvent("click",this._onClick,this);}else{o.detachBrowserEvent("click",this._onClick,this);}};R.prototype.checkEditable=function(o){return U.isOverlayMutable(o);};R.prototype._onEditableElementKeydown=function(e){if(e.keyCode===q.sap.KeyCodes.ENTER){e.preventDefault();var c=this._hideOverlays(false,e);this._applyChange(e,c);}else if(e.keyCode===q.sap.KeyCodes.ESCAPE){e.preventDefault();this._oEditedOverlay.setSelected(true);this._hideOverlays(false,e);var t=sap.ui.getCore().byId(e.currentTarget.id);t.getDomRef().innerText=this._oOldFieldValue;}};R.prototype._onEditableElementBlur=function(e){var t=this._oEditedOverlay;setTimeout(function(){t.setSelected(true);t.focus();},0);var c=this._hideOverlays(false,e);if(c){var s=window.getSelection();s.removeAllRanges();this._applyChange(e,c);}};R.prototype._applyChange=function(e,c){if(this._oOldFieldValue!=c.value){var i=this._oEditedOverlay.getElementInstance().getId();var C=sap.ui.getCore().byId(i);var f=F.createForControl(C);var o=this._createLabelChange(i,c.value,c.type);f.createAndApplyChange(o,C);f.saveAll();}};R.prototype._onEditableElementFocus=function(e){var a=e.target;var r=document.createRange();r.selectNodeContents(a);var s=window.getSelection();s.removeAllRanges();s.addRange(r);};R.prototype._createLabelChange=function(i,l,t){var L={};L.selector={};L.selector.id=i;switch(t){case"form":L={};break;case"sap.ui.comp.smartform.Group":L.changeType="renameGroup";L.groupLabel=l;break;case"sap.ui.comp.smartform.GroupElement":L.changeType="renameField";L.fieldLabel=l;break;default:L={};break;}return L;};return R;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.ToolsMenu')){jQuery.sap.declare('sap.ui.rta.ToolsMenu');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.m.Toolbar');jQuery.sap.require('sap.m.ToolbarDesign');jQuery.sap.require('sap.m.ToolbarLayoutData');jQuery.sap.require('sap.m.ToolbarSpacer');jQuery.sap.require('sap.m.Label');jQuery.sap.require('sap.ui.fl.registry.Settings');jQuery.sap.require('sap.ui.fl.Utils');sap.ui.define("sap/ui/rta/ToolsMenu",['jquery.sap.global','./library','sap/ui/core/Control','sap/m/Toolbar','sap/m/ToolbarDesign','sap/m/ToolbarLayoutData','sap/m/ToolbarSpacer','sap/m/Label','sap/ui/fl/registry/Settings','sap/ui/fl/Utils'],function(q,l,C,T,a,b,c,L,F,U){"use strict";var d=C.extend("sap.ui.rta.ToolsMenu",{metadata:{library:"sap.ui.rta",aggregations:{"toolbars":{type:"sap.m.Toolbar",multiple:true,singularName:"toolbar"}},events:{"close":{},"restore":{},"transport":{}}}});d.prototype.init=function(){var A=null;var o=null;var B=null;var t=null;var e=null;var r=null;this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");if(!this._oToolBarTop){t=this._oRb.getText("TOOLBAR_TITLE");A=new L({text:t,layoutData:new b({shrinkable:false})});t=null;o=new L({text:t,layoutData:new b({shrinkable:false})});t=this._oRb.getText("BTN_RESTORE");this._oButtonRestore=new sap.m.Button({type:"Transparent",text:t,visible:false,tooltip:t,layoutData:new b({shrinkable:false})});this._oButtonRestore.data("Action","RESTORE",true);this._oButtonRestore.attachEvent('press',this._onRestore,this);t=this._oRb.getText("BTN_EXIT");B=new sap.m.Button({type:"Transparent",text:t,tooltip:t,layoutData:new b({shrinkable:false})});B.data("Action","EXIT",true);B.attachEvent('press',this.close,this);t=this._oRb.getText("BTN_TRANSPORT");this._oButtonTransport=new sap.m.Button({type:"Transparent",text:"Transport",visible:false,tooltip:t,layoutData:new b({shrinkable:false})});this._oButtonTransport.data("Action","TRANSPORT",true);this._oButtonTransport.attachEvent('press',this._onTransport,this);e=new c();r=new c();this._oToolBarTop=new T({active:true,content:[A,e,o,r,this._oButtonRestore,this._oButtonTransport,B]});this._oToolBarTop.addStyleClass("sapUiRTAToolBarTop");this.addToolbar(this._oToolBarTop);}if(!this._oToolBarBottom){this._oToolBarBottom=new T({active:true,content:[]});this._oToolBarBottom.addStyleClass("sapUiRTAToolBarBottom");this.addToolbar(this._oToolBarBottom);}this.placeAt(sap.ui.getCore().getStaticAreaRef());};d.prototype._onTransport=function(){this.fireTransport();};d.prototype._checkTransportAvailable=function(){var t=this;return F.getInstance(U.getComponentClassName(this._oRootControl)).then(function(s){if(!s.isProductiveSystem()&&!s.hasMergeErrorOccured()){t._oButtonTransport.setVisible(true);t._oButtonRestore.setVisible(true);}});};d.prototype.show=function(){this._oToolBarTop.addStyleClass("sapUiRTAToolBarTopVisible");this._oToolBarTop.removeStyleClass("sapUiRTAToolBarTopInvisible");this._oToolBarBottom.addStyleClass("sapUiRTAToolBarBottomVisible");this._oToolBarBottom.removeStyleClass("sapUiRTAToolBarBottomInvisible");};d.prototype.hide=function(){this._oToolBarTop.addStyleClass("sapUiRTAToolBarTopInvisible");this._oToolBarBottom.addStyleClass("sapUiRTAToolBarBottomInvisible");};d.prototype._onRestore=function(){this.fireRestore();};d.prototype.close=function(){var t=this;var o=document.getElementsByClassName("sapUiRTAToolBarBottom")[0];var A=function(){t.fireClose();};o.addEventListener("webkitAnimationEnd",A);o.addEventListener("animationend",A);o.addEventListener("oanimationend",A);this.hide();};d.prototype.setTitle=function(t){var o=this._oToolBarTop.getContent()[2];o.setText(t);};d.prototype.setRootControl=function(o){this._oRootControl=o;};d.prototype.adaptButtonsVisibility=function(){this._checkTransportAvailable();};return d;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.changeHandler.HandlerController')){jQuery.sap.declare('sap.ui.rta.changeHandler.HandlerController');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.fl.registry.ChangeRegistry');jQuery.sap.require('sap.ui.fl.registry.SimpleChanges');sap.ui.define("sap/ui/rta/changeHandler/HandlerController",["jquery.sap.global","sap/ui/rta/changeHandler/Move","sap/ui/rta/changeHandler/Property","sap/ui/rta/changeHandler/AddControl","sap/ui/fl/registry/ChangeRegistry","sap/ui/fl/registry/SimpleChanges"],function(q,M,P,A,C,s){"use strict";s.move={changeType:"move",changeHandler:M};s.property={changeType:"property",changeHandler:P};s.addControl={changeType:"addControl",changeHandler:A};var c=C.getInstance();var S=[s.move,s.property,s.addControl,s.hideControl,s.unhideControl];c.registerControlsForChanges({"sap.m.Button":S,"sap.m.ObjectStatus":S,"sap.m.ObjectHeader":S,"sap.m.ObjectAttribute":S});});};if(!jQuery.sap.isDeclared('sap.ui.rta.FieldRepository')){jQuery.sap.declare('sap.ui.rta.FieldRepository');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Control');jQuery.sap.require('sap.ui.commons.Label');jQuery.sap.require('sap.ui.commons.LabelDesign');jQuery.sap.require('sap.ui.commons.Dialog');jQuery.sap.require('sap.ui.commons.TextView');jQuery.sap.require('sap.ui.commons.CheckBox');jQuery.sap.require('sap.ui.table.Table');jQuery.sap.require('sap.ui.table.SelectionMode');jQuery.sap.require('sap.ui.table.SelectionBehavior');jQuery.sap.require('sap.ui.table.NavigationMode');jQuery.sap.require('sap.ui.core.HorizontalAlign');jQuery.sap.require('sap.ui.layout.VerticalLayout');jQuery.sap.require('sap.ui.layout.HorizontalLayout');jQuery.sap.require('sap.ui.model.json.JSONModel');jQuery.sap.require('sap.m.SearchField');jQuery.sap.require('sap.m.Button');jQuery.sap.require('sap.m.Toolbar');jQuery.sap.require('sap.ui.model.Filter');jQuery.sap.require('sap.ui.model.FilterOperator');jQuery.sap.require('sap.ui.table.SortOrder');sap.ui.define("sap/ui/rta/FieldRepository",['jquery.sap.global','./library','sap/ui/core/Control','sap/ui/commons/Label','sap/ui/commons/LabelDesign','sap/ui/commons/Dialog','sap/ui/commons/TextView','sap/ui/commons/CheckBox','sap/ui/table/Table','sap/ui/table/SelectionMode','sap/ui/table/SelectionBehavior','sap/ui/table/NavigationMode','sap/ui/core/HorizontalAlign','sap/ui/layout/VerticalLayout','sap/ui/layout/HorizontalLayout','sap/ui/model/json/JSONModel','sap/m/SearchField','sap/m/Button','sap/m/Toolbar','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/table/SortOrder','./Utils','sap/ui/rta/FlexAdapter','./ModelConverter'],function(q,l,C,L,a,D,T,b,c,S,d,N,H,V,e,J,f,B,g,F,h,j,U,k,M){"use strict";var m=C.extend("sap.ui.rta.FieldRepository",{metadata:{library:"sap.ui.rta",properties:{},associations:{"rootControl":{type:"sap.ui.core.Control"}},events:{"opened":{},"closed":{},"openCustomField":{}}}});m.prototype.init=function(){this._aData=[];this._aSupportedControls=[sap.ui.comp.smartform.SmartForm,sap.ui.comp.smartform.Group];this._oModel=new J();this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");this._bAscendingSortOrder=true;var o=new B({text:this._oRb.getText("BTN_FREP_OK"),press:[this.closeDialog,this]});this._oCustomFieldButton=new B({text:this._oRb.getText("BTN_FREP_CCF"),enabled:false,press:[this._redirectToCustomFieldCreation,this]});this._oInput=new f({width:"100%",liveChange:[this._updateModelFilter,this]}).addStyleClass("resourceListIF");var r=new L({icon:"sap-icon://sort"}).attachBrowserEvent("mousedown",q.proxy(this._resortTable,this));this.oInputFields=new g({content:[this._oInput,r]});var i=new L({design:a.Bold,tooltip:{parts:[{path:"quickInfo"},{path:"fieldLabel"}],formatter:function(t,u){if(!t){return u;}return t;}},text:"{fieldLabel}"});var n=new e({content:[i]});var p=new V({content:[n]});var s=new b({change:[this._fnSelected,this]}).bindProperty("checked","checked");this._oTable=new c({selectionMode:S.None,selectionBehavior:d.RowOnly,selectedIndex:-1,columnHeaderVisible:false,columns:[{template:s,width:"15%",hAlign:H.Center},{template:p,width:"85%",sortProperty:"fieldLabel",hAlign:H.Left}]});this._oModel.setData({modelData:this._aData});this._oTable.setModel(this._oModel);this._oTable.bindRows("/modelData");this._oTable.sort(this._oTable.getColumns()[1],(this._bAscendingSortOrder)?j.Ascending:j.Descending);this._oDialog=new D({title:this._oRb.getText("HEADER_FREP"),buttons:[this._oCustomFieldButton,o],content:[this.oInputFields,this._oTable],width:"400px",modal:true,closed:[this._revertChanges,this]}).addStyleClass("sapUIRtaFieldRepositoryDialog");this._oDialog.setInitialFocus(this._oInput);};m.prototype._resortTable=function(E){this._bAscendingSortOrder=!this._bAscendingSortOrder;this._oTable.sort(this._oTable.getColumns()[1],(this._bAscendingSortOrder)?j.Ascending:j.Descending);};m.prototype._redirectToCustomFieldCreation=function(E){this.fireOpenCustomField();this._oDialog.close();};m.prototype.setShowCreateCustomField=function(s){this._oCustomFieldButton.setEnabled(s);};m.prototype._updateModelFilter=function(E){var v=E.getParameter("newValue");var o=this._oTable.getBinding("rows");if(v!==""){var i=new F("fieldLabel",h.Contains,v);var n=new F("quickInfo",h.Contains,v);var p=new F({filters:[i,n],and:false});o.filter([p]);}else{o.filter([]);}};m.prototype._revertChanges=function(){for(var i=0;i<this._aChangeData.length;i++){var o=this._aChangeData[i];if(o.controlId){var n=sap.ui.getCore().byId(o.controlId);if(o.changeType==="hideControl"){this._oFlexAdapter.emitHideEvent(n);}else{this._oFlexAdapter.emitUnhideEvent(n);}}}this._oCurrentSelectedBlock.rerender();this._oDialog.close();};m.prototype.closeDialog=function(){this._aChangeData=[];this._oDialog.close();};m.prototype._fnSelected=function(E){var o=this._createChangeData(E.getSource(),E.mParameters.checked);if(o.exists){this._oFlexAdapter.emitUnhideEvent(sap.ui.getCore().byId(o.newControlId));}else if(o.selectorId&&o.changeType===k.M_TYPES.addField){this._oFlexAdapter.emitAddEvent(o,k.M_TYPES.addField);}else if(!E.mParameters.checked){this._oFlexAdapter.emitHideEvent(sap.ui.getCore().byId(o.controlId));}};m.prototype._createChangeData=function(o,s){var i={};var n=o.getBindingContext().getObject();var p=n.controlId?n.controlId:this._oCurrentSelectedBlock.getId()+"_"+n.entityName+"_"+n.name;var r=n.complexTypeName?n.complexTypeName+"/"+n.name:n.name;if(s){var t=sap.ui.getCore().byId(p);if(this._oCurrentSelectedBlock){var G;if(this._oCurrentSelectedBlock instanceof sap.ui.comp.smartform.Group){G=this._oCurrentSelectedBlock;}else{G=this._oCurrentSelectedBlock.getGroups()[0];}i={exists:t,newControlId:p,jsType:"sap.ui.comp.smartfield.SmartField",selectorId:G.getId(),index:G.getGroupElements().length+1,valueProperty:"value",changeType:k.M_TYPES.addField,fieldLabel:n.fieldLabel,fieldValue:r};}this._aChangeData.push({controlId:p,changeType:"hideControl"});}else{i={controlId:p,changeType:"unhideControl"};this._aChangeData.push(i);}return i;};m.prototype.open=function(o){var t=this;this._aChangeData=[];if(!this._oFlexAdapter){this._oFlexAdapter=new k();this._oFlexAdapter.init(sap.ui.getCore().byId(this.getRootControl()));}this._oCurrentSelectedControl=o;this._oCurrentSelectedBlock=U.findSupportedBlock(o,this._aSupportedControls);if(t._oCurrentSelectedBlock){t._createRepositoryFields(t._oCurrentSelectedBlock);t._oDialog.oPopup.attachOpened(function(){t.fireOpened();});t._oDialog.open();}};m.prototype._getIgnoredFields=function(s){if(s){var i=s.getIgnoredFields();if(i){var I=i.split(",");return I;}}return[];};m.prototype._createRepositoryFields=function(o){var E=[];var o=U.getClosestTypeForControl(o,"sap.ui.comp.smartform.SmartForm");var t=this;E=o.getEntityType();if(E){E=E.replace(/\s+/g,'').match(/([^,]+)/g);}M.getConvertedModelWithBoundAndRenamedLabels(o,E).then(function(i){t._oModel.setData({modelData:i});});};m.prototype.close=function(){var t=this;this._oDialog.close();this._oDialog.attachClosed(function(){t.fireClosed();});};return m;},true);};if(!jQuery.sap.isDeclared('sap.ui.rta.RuntimeAuthoring')){jQuery.sap.declare('sap.ui.rta.RuntimeAuthoring');jQuery.sap.require('sap.ui.base.ManagedObject');jQuery.sap.require('sap.ui.comp.smartform.flexibility.FormP13nHandler');jQuery.sap.require('sap.ui.dt.Preloader');jQuery.sap.require('sap.ui.dt.ElementUtil');jQuery.sap.require('sap.ui.dt.DesignTime');jQuery.sap.require('sap.ui.dt.OverlayRegistry');jQuery.sap.require('sap.ui.fl.Transports');jQuery.sap.require('sap.ui.fl.Utils');jQuery.sap.require('sap.m.MessageBox');jQuery.sap.require('sap.ui.comp.smartform.GroupElement');jQuery.sap.require('sap.ui.comp.smartform.Group');sap.ui.define("sap/ui/rta/RuntimeAuthoring",['sap/ui/base/ManagedObject','sap/ui/rta/ToolsMenu','sap/ui/rta/ContextMenu','sap/ui/comp/smartform/flexibility/FormP13nHandler','sap/ui/dt/Preloader','sap/ui/dt/ElementUtil','sap/ui/dt/DesignTime','sap/ui/dt/OverlayRegistry','sap/ui/rta/RTARenamePlugin','sap/ui/rta/RTADragDropPlugin','sap/ui/rta/FlexAdapter','sap/ui/rta/FieldRepository','./Utils','sap/ui/fl/Transports','sap/ui/fl/Utils','sap/m/MessageBox','sap/ui/comp/smartform/GroupElement','sap/ui/comp/smartform/Group'],function(M,T,C,F,D,E,a,O,R,b,c,d,U,e,f,g,G,h){"use strict";var j=M.extend("sap.ui.rta.RuntimeAuthoring",{metadata:{library:"sap.ui.rta",associations:{"rootControl":{type:"sap.ui.core.Control"}},properties:{"customFieldUrl":"string","showCreateCustomField":"boolean"},events:{"start":{},"stop":{}}},_sAppTitle:null});j.prototype.start=function(){var t=this;this._aPopups=[];this._oTextResources=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");if(!this._oDesignTime){this._rootControl=sap.ui.getCore().byId(this.getRootControl());t._oFlexAdapter=new c();t._oFlexAdapter.init(t._rootControl);var i=sap.ui.dt.ElementUtil.findAllPublicElements(this._rootControl);this._oRTADragDropPlugin=new b({draggableTypes:["sap.ui.comp.smartform.Group","sap.ui.comp.smartform.GroupElement"]});this._oRTADragDropPlugin.attachEvent("moveElement",this._handleMoveElement,this);this._oRTADragDropPlugin.attachEvent("hideElement",this._handleHideElement,this);this._oRTADragDropPlugin.attachEvent("openContextMenu",this._handleOpenContextMenu,this);this._oRenamePlugin=new R({editableTypes:["sap.ui.comp.smartform.Group","sap.ui.comp.smartform.GroupElement"]});sap.ui.dt.Preloader.load(i).then(function(){t._oDesignTime=new a({rootElements:[t._rootControl],plugins:[t._oRTADragDropPlugin,t._oRenamePlugin]});t.fireStart();});}if(!this._oToolsMenu){this._sAppTitle=this._getApplicationTitle();this._oToolsMenu=new T();this._oToolsMenu.setTitle(this._sAppTitle);this._oToolsMenu.setRootControl(this._rootControl);this._oToolsMenu.adaptButtonsVisibility();this._oToolsMenu.attachEvent('close',this.stop,this);this._oToolsMenu.attachEvent('transport',this._onTransport,this);this._oToolsMenu.attachEvent('restore',this._onRestore,this);}this._fnOnKeyDown=this._onKeyDown.bind(this);jQuery(document).keydown(this._fnOnKeyDown);var o={"onAfterRendering":function(){this._oToolsMenu._oToolBarTop.focus();this._oToolsMenu._oToolBarTop.removeEventDelegate(o,this);}};this._oToolsMenu._oToolBarTop.addEventDelegate(o,this);this._openPopup=sap.ui.core.Popup.prototype.open;sap.ui.core.Popup.prototype.open=function(){if(t._aPopups.indexOf(this)===-1){t._aPopups.push(this);}jQuery(document).unbind("keydown",t._fnOnKeyDown);var k=Array.prototype.slice.call(arguments);t._openPopup.apply(this,k);};this._closePopup=sap.ui.core.Popup.prototype.close;sap.ui.core.Popup.prototype.close=function(){var I=t._aPopups.indexOf(this);if(I!==-1){t._aPopups.splice(I,1);if(t._aPopups.length===0){jQuery(document).keydown(t._fnOnKeyDown);}}var k=Array.prototype.slice.call(arguments);t._closePopup.apply(this,k);};this._oToolsMenu.show();};j.prototype.stop=function(){this.exit();this.fireStop();};j.prototype.exit=function(){if(this._oToolsMenu){this._oToolsMenu.destroy();this._oToolsMenu=null;}if(this._oFlexAdapter){this._oFlexAdapter.destroy();}if(this._oDesignTime){this._oDesignTime.destroy();this._oDesignTime=null;}if(this._fnOnKeyDown){jQuery(document).unbind("keydown",this._fnOnKeyDown);this._fnOnKeyDown=null;}sap.ui.core.Popup.prototype.open=this._openPopup;sap.ui.core.Popup.prototype.close=this._closePopup;};j.prototype._onKeyDown=function(o){if((o.keyCode===jQuery.sap.KeyCodes.TAB)&&(o.shiftKey===false)&&(o.altKey===false)&&(o.ctrlKey===false)){o.preventDefault();this._focusNextElement();}else if((o.keyCode===jQuery.sap.KeyCodes.TAB)&&(o.shiftKey===true)&&(o.altKey===false)&&(o.ctrlKey===false)){o.preventDefault();this._focusPrevElement();}};j.prototype._focusNextElement=function(){var s=this._checkCurrentFocusedElement();if(s==="NOT RTA"){this._oToolsMenu._oToolBarTop.focus();}else if(s==="OVERLAY"){this._handleNextOverlay();}else if(s.indexOf("TB")!==-1){this._handleNextTbElement();}};j.prototype._focusPrevElement=function(){var s=this._checkCurrentFocusedElement();if(s==="NOT RTA"){this._oToolsMenu._oToolBarTop.focus();}else if(s==="OVERLAY"){this._handlePrevOverlay();}else if(s==="TOP TB"){this._handlePrevTbElement();}else if(s==="BOTTOM TB"){this._handlePrevOverlay();}else if(s==="TOP TB ELEMENT"){this._handlePrevTbElement();}else if(s==="BOTTOM TB ELEMENT"){this._handlePrevTbElement();}};j.prototype._checkCurrentFocusedElement=function(){var s;var o=document.activeElement;this._aTbTopElements=this._oToolsMenu._oToolBarTop.getContent();var t=[];for(var i=this._aTbTopElements.length-1;i>=0;i--){if(this._aTbTopElements[i].getId().indexOf("spacer")>-1){this._aTbTopElements.splice(i,1);}}var k=this._aTbTopElements.length;for(i=0;i<k;i++){t[i]=this._aTbTopElements[i].getId();}this._aTbBottomElements=this._oToolsMenu._oToolBarBottom.getContent();var l=[];for(i=this._aTbBottomElements.length-1;i>=0;i--){if(this._aTbBottomElements[i].getId().indexOf("spacer")>-1){this._aTbBottomElements.splice(i,1);}}var B=this._aTbBottomElements.length;for(i=0;i<B;i++){l[i]=this._aTbBottomElements[i].getId();}var A=t.indexOf(o.id);var m=l.indexOf(o.id);if((o.getAttribute("class"))&&(o.getAttribute("class").search("sapUiDtOverlay")>-1)){this._sArea="OVERLAY";s="OVERLAY";return s;}else if((o.getAttribute("class"))&&(o.getAttribute("class").search("sapUiRTAToolBarTop")>-1)){this._sArea="TOP";this._iActive=-1;this._aElements=this._aTbTopElements;s="TOP TB";return s;}else if((o.getAttribute("class"))&&(o.getAttribute("class").search("sapUiRTAToolBarBottom")>-1)){this._sArea="BOTTOM";this._iActive=-1;this._aElements=this._aTbBottomElements;s="BOTTOM TB";return s;}else if(A>-1){this._sArea="TOP";this._iActive=A;this._aElements=this._aTbTopElements;s="TOP TB ELEMENT";return s;}else if(m>-1){this._sArea="BOTTOM";this._iActive=m;this._aElements=this._aTbBottomElements;s="BOTTOM TB ELEMENT";return s;}else{s="NOT RTA";return s;}};j.prototype._loopOverTbElements=function(r,s){for(var i=s,k=(r)?-1:this._aElements.length,l=(r)?-1:1;i!=k;i+=l){this._aElements[i].focus();if(this._aElements[i].getId()===document.activeElement.id){break;}if(i===k-l){if(!r){(this._sArea==="TOP")?this._handleNextOverlay():this._oToolsMenu._oToolBarTop.focus();}else{if(((this._sArea==="TOP")&&(this._iActive===-1))||(this._sArea==="OVERLAY")){this._oToolsMenu._oToolBarBottom.focus();}else if(((this._sArea==="TOP")&&(this._iActive>0))||(this._sArea==="BOTTOM")){this._oToolsMenu._oToolBarTop.focus();}}}}};j.prototype._handleNextTbElement=function(){if(this._iActive===this._aElements.length-1){(this._sArea==="TOP")?this._handleNextOverlay():this._oToolsMenu._oToolBarTop.focus();}else{this._loopOverTbElements(false,this._iActive+1);}};j.prototype._handlePrevTbElement=function(){if(this._sArea==="TOP"){switch(this._iActive){case-1:this._aElements=this._aTbBottomElements;if(this._aElements.length===0){this._oToolsMenu._oToolBarBottom.focus();}else{this._loopOverTbElements(true,this._aElements.length-1);}break;case 0:this._oToolsMenu._oToolBarTop.focus();break;default:this._loopOverTbElements(true,this._iActive-1);}}else if(this._sArea==="OVERLAY"){this._aElements=this._aTbTopElements;if(this._aElements.length===0){this._oToolsMenu._oToolBarTop.focus();}else{this._loopOverTbElements(true,this._aElements.length-1);}}else if(this._sArea==="BOTTOM"){this._loopOverTbElements(true,this._aElements.length-1);}};j.prototype._handleNextOverlay=function(){var o;if(this._sArea==="TOP"){o=U.getFirstFocusableOverlay();(o)?o.focus():this._oToolsMenu._oToolBarBottom.focus();}else if(this._sArea==="OVERLAY"){o=U.getNextFocusableOverlay();(o)?o.focus():this._oToolsMenu._oToolBarBottom.focus();}};j.prototype._handlePrevOverlay=function(){var o;if(this._sArea==="BOTTOM"){o=U.getLastFocusableOverlay();if(o){o.focus();}else{this._sArea="OVERLAY";this._handlePrevTbElement();}}else if(this._sArea==="OVERLAY"){o=U.getPreviousFocusableOverlay();(o)?o.focus():this._handlePrevTbElement();}};j.prototype._onTransport=function(){this._ensureFormP13Handler();this._handler._oSmartForm=this._rootControl;var t=this;function i(o){f.log.error("SmartForm changes could not be applied or saved: "+o);return t._handler._showApplySaveChangesErrorMessage(o).then(function(){throw new Error('createAndApply failed');});}function k(o){if(o.message==='createAndApply failed'){return;}f.log.error("transport error"+o);return t._handler._showTransportErrorMessage(o);}return this._handler._getFlexController().getComponentChanges().then(function(o){return t._handler._convertToChangeArray(o);}).then(function(A){if(A.length>0){return t._handler._createAndApplyChanges(A);}})['catch'](i).then(function(){return t._handler._getFlexController().getComponentChanges();}).then(function(A){return!!A.length;}).then(function(s){if(s){return t._handler._openTransportSelection(null,true);}else{return t._handler._showTransportInapplicableMessage();}}).then(function(o){if(o&&o.transport&&o.packageName!=="$TMP"){return t._transportAllLocalChanges(o);}})['catch'](k);};j.prototype._deleteChanges=function(i){var t=this;var o=t._handler._getFlexController();var k=i.length-1;return this._handler._setTransports(i,k).then(function(){return o.discardChanges(i);}).then(function(){return t._handler._showDiscardSuccessMessage();})["catch"](function(l){return t._handler._showDiscardErrorMessage(l);});};j.prototype._ensureFormP13Handler=function(){if(!this._handler){this._handler=new F();this._handler.init(this._rootControl);}};j.prototype._onRestore=function(){var t=this;var m=this._oTextResources.getText("FORM_PERS_RESET_MESSAGE");var s=this._oTextResources.getText("FORM_PERS_RESET_TITLE");this._ensureFormP13Handler();function i(A){if(A==="OK"){var o=t._handler._getFlexController();o.getComponentChanges().then(function(k){var l=t._handler._convertToChangeArray(k);return t._deleteChanges(l);})["catch"](function(k){return t._handler._showDiscardErrorMessage();});}}g.confirm(m,{title:s,onClose:i});};j.prototype._transportAllLocalChanges=function(t){var i=this;return i._handler._getFlexController().getComponentChanges().then(function(A){var k=i._handler._convertToChangeTransportData(A);var o=new e();var l={};l.transportId=t.transport;l.changeIds=k;return o.makeChangesTransportable(l).then(function(){A.forEach(function(m){if(m.getPackage()==='$TMP'){var n=m.getDefinition();n.packageName='';m.setResponse(n);}});}).then(function(){return i._handler._showTransportSuccessMessage();});});};j.prototype._handleMoveElement=function(o){var i=o.getParameters();this._oFlexAdapter.emitMoveEvent(i.element,i.change);};j.prototype._handleHideElement=function(o){var i=o.getParameters();var t=this;if(U.isElementHideable(i.element)){this._oFlexAdapter.emitHideEvent(i.element);}else{this._openHideElementDialog(i.element).then(function(r){if(r){t._oFlexAdapter.emitHideEvent(i.element);}});}};j.prototype._openHideElementDialog=function(o){var t=this;var m;var s;return new Promise(function(r,i){var k=function(A){if(A==="OK"){r(true);}else{r(false);}};if(o instanceof h){m=t._oTextResources.getText("CTX_HIDE_GROUP_MESSAGE");s=t._oTextResources.getText("CTX_HIDE_GROUP_TITLE");}else if(o instanceof G){m=t._oTextResources.getText("CTX_HIDE_FIELD_MESSAGE");s=t._oTextResources.getText("CTX_HIDE_FIELD_TITLE");}g.confirm(m,{title:s,icon:"WARNING",onClose:k});});};j.prototype._handleOpenContextMenu=function(o){var i=o.getParameter("originalEvent");var k=o.getParameter("overlay");this._oContextMenu=new C();this._oContextMenu.attachEvent("renameLabel",this._handleRenameLabel,this);this._oContextMenu.attachEvent("hideElement",this._handleHideElement,this);this._oContextMenu.attachEvent("addElement",this._handleAddElement,this);this._oContextMenu.attachEvent("addGroup",this._handleAddGroup,this);this._oContextMenu.attachEvent("adaptElement",this._handleAdaptElement,this);var l=k.getElementInstance();this._oContextMenu.setElement(l);this._oContextMenu.setOverlayDomRef(k);this._oContextMenu.openMenu({pageX:i.pageX,pageY:i.pageY});};j.prototype._handleRenameLabel=function(o){var i=O.getOverlay(o.getParameter("element").getId());this._oRenamePlugin.setEditMode(i);};j.prototype._handleAddElement=function(o){var i=o.getParameter("element");if(!this._oFieldRepository){this._oFieldRepository=new d({rootControl:this._rootControl});this._oFieldRepository.attachEvent("openCustomField",this._onOpenCustomField,this);}this._openFieldRepository(i);};j.prototype._openFieldRepository=function(o){var t=this;U.isCustomFieldAvailable(o).then(function(r){if(r){t._oFieldRepository.setShowCreateCustomField(true);t._oCurrentFieldExtInfo=r;}});this._oFieldRepository.open(o);};j.prototype._handleAddGroup=function(o){var I=0;var t=this;var k=o.getParameters();var l=k.element;var m=null;if(l.getMetadata().getName()==="sap.ui.comp.smartform.Group"){var n=l.getParent().getAggregation("formContainers");for(var i=0;i<n.length;i++){if(n[i].getId()===l.getId()){I=i+1;break;}}m=this._oFlexAdapter.emitAddEvent({selectorId:l.getParent().getParent().getId(),index:I},c.M_TYPES.addGroup);}else if(l.getMetadata().getName()==="sap.ui.comp.smartform.SmartForm"){I=0;m=this._oFlexAdapter.emitAddEvent({selectorId:l.getId(),index:I},c.M_TYPES.addGroup);}var p=O.getOverlay(m.newControlId);p.setSelected(true);var q={"onAfterRendering":function(){t._oRenamePlugin.setEditMode(p);p.removeEventDelegate(q);}};p.addEventDelegate(q);};j.prototype._handleAdaptElement=function(o){var i=o.getParameter("element");if(!this._handler){this._handler=new F();}this._handler.init(i);this._handler.show();};j.prototype._getApplicationTitle=function(){var t="";var o=sap.ui.core.Component.getOwnerComponentFor(this._rootControl);if(o){t=o.getMetadata().getManifestEntry("sap.app").title;}return t;};return j;},true);};
