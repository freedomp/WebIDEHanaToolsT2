/*
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2015 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/m/TextArea","sap/m/Link","sap/m/CheckBox","sap/m/ComboBox","sap/m/DatePicker","sap/m/FlexItemData","sap/m/FlexJustifyContent","sap/m/HBox","sap/m/Input","sap/m/InputType","sap/m/Select","sap/m/Text","sap/ui/core/Renderer","sap/ui/core/TextAlign","sap/ui/comp/navpopover/SmartLink","sap/ui/comp/smartfield/ControlFactoryBase","sap/ui/comp/smartfield/FieldControl","sap/ui/comp/smartfield/ODataControlSelector","sap/ui/comp/smartfield/ODataHelper","sap/ui/comp/smartfield/ODataTypes","sap/m/ObjectNumber","sap/m/ObjectIdentifier"],function(q,T,L,C,a,D,F,b,H,I,c,S,d,R,e,f,g,h,O,i,j,k,l){"use strict";var m=g.extend("sap.ui.comp.smartfield.ODataControlFactory",{constructor:function(M,p,o){g.apply(this,[M,p]);this.sName="ODataControlFactory";this._oMetaData={annotations:{}};this._oMeta=o;this._oHelper=new i(M,this._oBinding);this._oFieldControl=new h(p,this._oHelper);this._oTypes=new j(p);this._oSelector=new O(this._oMetaData,p,this._oTypes);this._bInitialized=false;this.bPending=false;}});m.prototype._init=function(M){this._oMetaData.model=M.model;this._oMetaData.path=M.path;this._oMetaData.entitySet=M.entitySetObject||this._oHelper.oMeta.getODataEntitySet(M.entitySet);this._oMetaData.entityType=M.entityType||this._oHelper.oMeta.getODataEntityType(this._oMetaData.entitySet.entityType);this._oMetaData.navigationPath=M.navigationPath||null;if(this._oModel){this._oHelper.checkNavigationProperty(this._oMetaData,this._oParent);this._oHelper.getProperty(this._oMetaData);if(this._oMetaData.property&&this._oMetaData.property.property){this._oMetaData.annotations.text=this._oHelper.getTextProperty2(this._oMetaData);this._oMetaData.annotations.uom=this._oHelper.getUnitOfMeasure2(this._oMetaData);this._oHelper.getValueListData(this._oMetaData);this._oMetaData.annotations.lineitem=this._oHelper.getAnalyzer().getLineItemAnnotation(this._oMetaData.entitySet.entityType);this._oHelper.getUOMValueListAnnotationPath(this._oMetaData);this._oMetaData.annotations.semantic=this._oHelper.getAnalyzer().getSemanticObjectAnnotationFromProperty(this._oMetaData.property.property);}else{q.sap.log.warning("SmartField: Property "+M.path+" does not exist","SmartField: Property "+M.path+" does not exist","sap.ui.comp.smartfield.ODataControlFactory");}}else{this._oMetaData.modelObject=M.modelObject;this._oMetaData.property=M.property;this._oMetaData.annotations.text=M.annotations.text;this._oMetaData.annotations.uom=M.annotations.uom;this._oMetaData.annotations.valuelist=M.annotations.valuelist;this._oMetaData.annotations.valuelistType=M.annotations.valuelistType;this._oMetaData.annotations.lineitem=M.annotations.lineitem;this._oMetaData.annotations.semantic=M.annotations.semantic;this._oMetaData.annotations.valuelistuom=M.annotations.valuelistuom;}};m.prototype._createEdmDisplay=function(){var o,n,A,p,M,r,s,t,u=this,N={width:true,textAlign:true};var v=this._oSelector.checkComboBox(true);if(v&&v.combobox){return this._createComboBox({annotation:v.annotation,noDialog:true,noTypeAhead:true},true);}if(this._checkLink()){return this._createLink();}A=this.createAttributes(null,this._oMetaData.property,N);r=this._oSelector.checkDatePicker();if(r){p=this.getFormatSettings("dateFormatSettings");A.text={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,p,{displayFormat:"Date"})};}else{A.text={model:this._oMetaData.model,path:this._oHelper.getEdmDisplayPath(this._oMetaData),type:this._oTypes.getType(this._oMetaData.property)};}if(this._oMetaData.property&&this._oMetaData.property.property){M=this._oHelper.oAnnotation.isMasked(this._oMetaData.property.property);if(M){A.text.formatter=function(w){if(w){return w.replace(new RegExp(".","igm"),"*");}return w;};}t=this._oHelper.oAnnotation.getText(this._oMetaData.property.property);if(t){s=this._oSelector.useObjectIdentifier(r,M);if(s){delete A.width;delete A.textAlign;A.text={path:this._oMetaData.path};A.title={path:this._oHelper.getEdmDisplayPath(this._oMetaData)};}else{A.text={};A.text.parts=[];A.text.parts.push(this._oMetaData.path);A.text.parts.push(this._oHelper.getEdmDisplayPath(this._oMetaData));A.text.formatter=function(w,x){if(w&&x){return u._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",w,x);}return w?w:"";};}}else if(this._oSelector.checkCheckBox()){A.text.formatter=function(V){return u._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",V);};}}if(s){n=new l(A);}else{n=new d(A);}o=this._oParent.data("configdata");if(!s&&o&&o.configdata&&o.configdata.onText){o.configdata.onText(n);}return{control:n,onCreate:"_onCreate",params:{noValidations:true}};};m.prototype._createEdmString=function(){var M,n,o,A,p,r,N={width:true,textAlign:true,placeholder:true,name:true,valueState:true,valueStateText:true};if(this._oSelector.checkCheckBox()){return this._createCheckBox();}p=this._oSelector.checkSelection();if(p.selection){return this._createSelect({annotation:p.annotation,noDialog:true,noTypeAhead:true});}p=this._oSelector.checkComboBox();if(p.combobox){return this._createComboBox({annotation:p.annotation,noDialog:true,noTypeAhead:true});}if(this._oMetaData.property&&this._oMetaData.property.property){n=this._oHelper.oAnnotation.isMultiLineText(this._oMetaData.property.property);if(n){return this._createMultiLineText(N);}}A=this.createAttributes("value",this._oMetaData.property,N);this._addMaxLength(A,p.annotation);r=new I(A);if(this._oMetaData.property&&this._oMetaData.property.property){M=this._oHelper.oAnnotation.isMasked(this._oMetaData.property.property);if(M){r.setType(c.Password);}this._handleEventingForEdmString(r,this._oMetaData.property);}o=this._oParent.data("configdata");if(o&&o.configdata&&o.configdata.onInput){o.configdata.onInput(r);}return{control:r,onCreate:"_onCreate",params:{valuehelp:{annotation:p.annotation,noDialog:!this._oParent.getShowValueHelp(),noTypeAhead:!this._oParent.getShowSuggestion(),aggregation:"suggestionRows"},getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};m.prototype._addMaxLength=function(A,o){var B,M;B=this._oParent.getBindingInfo("value");M=this._oTypes.getMaxLength(this._oMetaData.property,B);if(M>0){if(!o||!this._oParent.getShowSuggestion()){A.maxLength=M;}}};m.prototype._handleEventingForEdmString=function(o,p){var u,t=this;if(o){u=this._oHelper.oAnnotation.isUpperCase(p.property);o.attachChange(function(E){var n={};if(E&&E.mParameters){var v=E.mParameters.value;if(u&&v){v=v.toUpperCase();o.setValue(v);}n.value=v;n.newValue=v;if(E.mParameters.validated){n.validated=E.mParameters.validated;}if(o._oSuggestionPopup&&o._oSuggestionPopup.isOpen()){if(!E.mParameters.validated){if(o._iPopupListSelectedIndex>=0){return;}}}try{t._oParent.fireChange(n);}catch(r){q.sap.log.warning(r);}}});}};m.prototype._createComboBox=function(v,n){var o=null;var A,N={width:true,textAlign:true,placeholder:true,name:true};A=this.createAttributes("selectedKey",this._oMetaData.property,N);A.selectionChange=this._oHelper.getSelectionChangeHandler(this._oParent);if(A.width===""){A.width="100%";}if(n){o=this._createDisplayedComboBox(A);}else{o=new a(A);}return{control:o,onCreate:"_onCreate",params:{valuehelp:{annotation:v.annotation,aggregation:"items",noDialog:v.noDialog,noTypeAhead:v.noTypeAhead},getValue:"getSelectedKey",type:{type:A.selectedKey.type,property:this._oMetaData.property}}};};m.prototype._createDisplayedComboBox=function(A){var n=a.extend("sap.ui.comp.smartfield.DisplayComboBox",{metadata:{library:"sap.ui.comp"},renderer:function(r,o){var w=o.getWidth(),t=o.getValue(),s=o.getTextDirection(),p=o.getTextAlign();t.replace(/\r\n/g,"\n");r.write("<span");r.writeControlData(o);r.addClass("sapMText");r.addClass("sapUiSelectable");if(w){r.addStyle("width",w);}else{r.addClass("sapMTextMaxWidth");}if(s!==sap.ui.core.TextDirection.Inherit){r.writeAttribute("dir",s.toLowerCase());}if(p){p=R.getTextAlign(p,s);if(p){r.addStyle("text-align",p);}}r.writeClasses();r.writeStyles();r.write(">");r.writeEscaped(t);r.write("</span>");}});return new n(A);};m.prototype._createSelect=function(v){var A,n={width:true,name:true};A=this.createAttributes("selectedKey",this._oMetaData.property,n);A.change=this._oHelper.getSelectionChangeHandler(this._oParent);if(A.width===""){A.width="100%";}return{control:new S(A),onCreate:"_onCreate",params:{valuehelp:{annotation:v.annotation,aggregation:"items",noDialog:v.noDialog,noTypeAhead:v.noTypeAhead},getValue:"getSelectedKey",type:{type:A.selectedKey.type,property:this._oMetaData.property}}};};m.prototype._createCheckBox=function(){var A=this.createAttributes("selected",null,{},{event:"select",parameter:"selected"});A.editable=(this._oParent.getEditable()&&this._oParent.getEnabled()&&this._oParent.getContextEditable());A.selected.type=this._oTypes.getAbapBoolean();return{control:new C(A),onCreate:"_onCreate",params:{getValue:"getSelected"}};};m.prototype._createEdmDateTime=function(){var A,o,n={width:true,textAlign:true,placeholder:true,name:true};A=this.createAttributes(null,this._oMetaData.property,n,{event:"change",parameter:"value"});o=this.getFormatSettings("dateFormatSettings");if(this._oSelector.checkDatePicker()){A.value={path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,o,{displayFormat:"Date"}),model:this._oMetaData.model};if(o&&o.style){A.displayFormat=o.style;}return{control:new D(A),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};}A.value={path:this._oMetaData.path,model:this._oMetaData.model,type:this._oTypes.getType(this._oMetaData.property,o)};return{control:new I(A),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};m.prototype._createEdmDateTimeOffset=function(){var o,A,n={width:true,textAlign:true,placeholder:true,name:true};o=this.getFormatSettings("dateFormatSettings");A=this.createAttributes(null,this._oMetaData.property,n,{event:"change",parameter:"value"});A.value={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,o)};return{control:new I(A),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};m.prototype._createEdmNumeric=function(){var A,n={width:true,textAlign:true,placeholder:true,name:true};A=this.createAttributes("value",this._oMetaData.property,n,{event:"change",parameter:"value"});return{control:new I(A),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:A.value.type,property:this._oMetaData.property}}};};m.prototype._createEdmUOM=function(){var p,o,t,A,n,P,B,r=null;A=this._createEdmUOMAttributes();n=this._oParent.getObjectBinding(this._oMetaData.model);this.addObjectBinding(A,n);o=new I(A);if(this._oParent.data("suppressUnit")==="true"){P={getValue:"getValue"};if(!this._oHelper.oAnnotation.isCurrency(this._oMetaData.annotations.uom.property.property)){P.type={type:A.value.type,property:this._oMetaData.property};}return{control:o,onCreate:"_onCreate",params:P};}if(!this._oHelper.oAnnotation.isCurrency(this._oMetaData.annotations.uom.property.property)){r={type:A.value.type,property:this._oMetaData.property};}p=this._oHelper.getUOMPath(this._oMetaData);A={value:{model:this._oMetaData.model,path:p},change:this._oHelper.getUOMChangeHandler(this._oParent,true),textAlign:this._getEdmUOMTextAlignment()};this.addObjectBinding(A,n);this.mapBindings(A,{"uomEditable":"editable","uomEnabled":"enabled","uomVisible":"visible","mandatory":"mandatory"});t=new sap.ui.comp.smartfield.SmartField(A);t.data("configdata",{"configdata":{isUOM:!this._oParent.data("configdata"),model:this._oMetaData.model,navigationPath:this._oMetaData.annotations.uom.navigationPath||null,path:p,entitySetObject:this._oMetaData.annotations.uom.entitySet,entityType:this._oMetaData.annotations.uom.entityType,property:this._oMetaData.annotations.uom.property,annotations:{valuelist:this._oMetaData.annotations.valuelistuom},modelObject:this._oMetaData.modelObject||this._oModel,onText:function(s){o.setLayoutData(new F({growFactor:1}));t.setLayoutData(new F({shrinkFactor:0}));if(s){s.addStyleClass("sapUiCompSmartFieldUnit");}},onInput:function(s){o.setLayoutData(new F({growFactor:1}));t.setLayoutData(new F({growFactor:0}));if(s){s.addStyleClass("sapUiCompSmartFieldUnit");}}}});t.data("errorCheck","setComplexClientErrorSecondOperandNested");o.addStyleClass("smartFieldPaddingRight");o.addStyleClass("sapUiCompSmartFieldValue");B=new H({justifyContent:b.End,items:[o,t],fitContainer:true,width:this._oParent.getWidth()});B.addStyleClass("sapUiCompUOM");if(this._oParent.isContextTable()){B.addStyleClass("sapUiCompUOMInTable");}return{control:B,onCreate:"_onCreateUOM",params:{getValue:true,valuehelp:true,type:r}};};m.prototype._createEdmUOMAttributes=function(){var A={textAlign:this._getEdmUOMTextAlignment(),placeholder:this.getAttribute("placeholder"),name:this.getAttribute("name"),change:this._oHelper.getUOMChangeHandler(this._oParent)};if(this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this._oMetaData.annotations.uom.property.property)){A.value={parts:[{path:this._oMetaData.path},{path:this._oHelper.getUOMPath(this._oMetaData)}],model:this._oMetaData.model,type:this._oTypes.getCurrencyType(this._oMetaData.property)};}else{A.value={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)};}return A;};m.prototype._getEdmUOMTextAlignment=function(){var A=this.getAttribute("textAlign");if(!A){A=e.Initial;}if(A===e.Initial){if(this._oParent.isContextTable()){return e.End;}else{if(this._oParent.getEditable()&&this._oParent.getContextEditable()){return e.End;}return e.Begin;}}return A;};m.prototype._createEdmUOMDisplay=function(){var v,o,p,n,A,s,J=b.Start,B;if(this._oParent.data("suppressUnit")==="true"){return this._createEdmDisplay();}s=this._getEdmUOMTextAlignment();p=this._oHelper.getUOMPath(this._oMetaData);A={text:{parts:[{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},{path:p}],model:this._oMetaData.model,formatter:this._oTypes.getCurrencyDisplayFormatter(this._oHelper.oAnnotation.isCurrency(this._oMetaData.property.property)),useRawValues:true},textAlign:s};n=this._oParent.getObjectBinding(this._oMetaData.model);this.addObjectBinding(A,n);v=new d(A);A={text:{path:p},textAlign:s};this.addObjectBinding(A,n);o=new d(A);v.addStyleClass("sapUiCompSmartFieldValue");o.addStyleClass("sapUiCompSmartFieldUnit");if(s===e.End){J=b.End;}B=new H({items:[v,o],width:this._oParent.getWidth()});if(this._oParent.isContextTable()){J=b.End;B.addStyleClass("sapUiCompUOMInTable");}B.setJustifyContent(J);B.addStyleClass("sapUiCompUOM");return{control:B};};m.prototype._createEdmUOMObjectNumber=function(){var A,o,n,s;s=this._getEdmUOMTextAlignment();if(this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this._oMetaData.annotations.uom.property.property)){A={number:{parts:[{path:this._oMetaData.path},{path:this._oHelper.getUOMPath(this._oMetaData)}],type:this._oTypes.getCurrencyType(this._oMetaData.property)},unit:{path:this._oHelper.getUOMPath(this._oMetaData)},model:this._oMetaData.model,textAlign:s};}else{A={model:this._oMetaData.model,number:{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},unit:{path:this._oHelper.getUOMPath(this._oMetaData)},textAlign:s};}o=this._oParent.getObjectBinding(this._oMetaData.model);this.addObjectBinding(A,o);n=new k(A);n.addStyleClass("sapUiCompUOM");return{control:n};};m.prototype._createEdmSemantic=function(){var p,o=this._oParent.getBindingInfo("value");p=o.parts[0].path;var s=this._oMetaData.property.property["sap:label"];if(this._oMetaData.annotations.lineitem&&this._oMetaData.annotations.lineitem.labels&&this._oMetaData.annotations.lineitem.labels[p]){s=this._oMetaData.annotations.lineitem.labels[p];}return{control:new f({semanticObject:this._oMetaData.annotations.semantic.semanticObject,semanticObjectLabel:s,fieldName:p,text:{path:p,model:this._oMetaData.model},width:this.getAttribute("width"),createControlCallback:q.proxy(function(){var n=this.createControl(true);if(n){return n.control;}return null;},this)}),onCreate:"_onCreate",params:{getValue:"getInnerControlValue"}};};m.prototype._createMultiLineText=function(n){var A=this.createAttributes("value",this._oMetaData.property,n);var o=this.getFormatSettings("multiLineSettings");A=q.extend(true,o,A);var p=new T(A);this._handleEventingForEdmString(p,this._oMetaData.property);return{control:p,onCreate:"_onCreate",getValue:"getValue",params:{type:{type:A.value.type,property:this._oMetaData.property}}};};m.prototype._checkLink=function(){var o=this._oParent.getBindingInfo("url");if(o){return true;}if(this._oParent.getUrl()){return true;}return false;};m.prototype._createLink=function(){var t=this;var A={text:"",href:""};var o=this._oParent.getBindingInfo("url");if(o){A["href"]=this._oBinding.toBinding(o);}else{A["href"]=this._oParent.getUrl();}o=this._oParent.getBindingInfo("value");if(o){if(this._oMetaData.annotations.text&&this._oMetaData.property.property.type==="Edm.String"){A.text={parts:[this._oMetaData.path,this._oHelper.getEdmDisplayPath(this._oMetaData)],formatter:function(s,n){if(s&&n){return t._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",s,n);}return s?s:"";}};}else{A["text"]=this._oBinding.toBinding(o);}}else{A["text"]=this._oParent.getValue();}return{control:new L(A),onCreate:"_onCreate",params:{noValidation:true}};};m.prototype._createEdmBoolean=function(){var A,o,n,t=this,p=null,E=false;E=this._oParent.getEditable()&&this._oParent.getEnabled()&&this._oParent.getContextEditable();o=this._oSelector.checkComboBox();if(o.combobox){return this._createComboBox({annotation:o.annotation,noDialog:true,noTypeAhead:true},!E);}if(E){A=this.createAttributes("selected",this._oMetaData.property,{},{event:"select",parameter:"selected"});n=new C(A);p={getValue:"getSelected"};}else{A=this.createAttributes("text",this._oMetaData.property,{width:true,textAlign:true});A.text={model:this._oMetaData.model,path:this._oMetaData.path};A.text.formatter=function(v){return t._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",v);};n=new d(A);}return{control:n,onCreate:"_onCreate",params:p};};m.prototype._getCreator=function(B){return this._oSelector.getCreator(B);};m.prototype._onCreate=function(o,p){var G,n,v=true,t=this;if(p){if(p.noValidation){v=false;}if(p.valuehelp){this._getValueHelpDialogTitle(p.valuehelp);p.valuehelp["analyser"]=this._oHelper.getAnalyzer(this._oModel||this._oMetaData.modelObject);this.addValueHelp(o,this._oMetaData.property.property,p.valuehelp,this._oModel||this._oMetaData.modelObject,function(E){t._oParent.fireValueListChanged({"changes":E.mParameters.changes});});}if(p.getValue){G=p.getValue;p.getValue=function(){return o[G]();};}if(p.type){n=this._oFieldControl.getMandatoryCheck(p.type.property);if(n){p.type.type.oFieldControl=n;}}}if(v){this.addValidations(o,this._oParent.data("errorCheck")||"setSimpleClientError");}if(!this._checkUOM()){o.addStyleClass("sapUiCompSmartFieldValue");}};m.prototype._checkUOM=function(){var o=this._oParent.data("configdata");if(o&&o.configdata){if(o.configdata.onInput){return true;}if(o.configdata.onText){return true;}}return false;};m.prototype._getValueHelpDialogTitle=function(v){v.dialogtitle=this._oParent.getTextLabel();if(!v.dialogtitle){v.dialogtitle=this._oHelper.oAnnotation.getLabel(this._oMetaData.property.property)||this._oMetaData.property.property.name;}};m.prototype._onCreateUOM=function(o,p){var n,r;n=o.getItems();this.addValidations(n[0],"setComplexClientErrorFirstOperand");if(p&&p.getValue){p.getValue=function(){return n[0].getValue();};}p.uom=function(){var s=n[1].getAggregation("_content");return s.getValue();};p.uomset=function(v){var s=n[1].getAggregation("_content");s.setValue(v);};if(p.type){r=this._oFieldControl.getMandatoryCheck(p.type.property);if(r){p.type.type.oFieldControl=r;}}};m.prototype.bind=function(){var t=this,n,o,p=function(M,P){try{t._init(M);t._setUOMEditState();t._bind(P);}catch(r){q.sap.log.warning(r,null,"sap.ui.comp.smartfield.ODataControlFactory.bind.fInit");}};if(!this._bInitialized&&!this.bPending){this._bInitialized=true;n=this._oFieldControl.getBindableAttributes();o=this._oParent.data("configdata");if(o&&o.configdata){p(this._oMeta,n);}else if(this._oModel){this.bPending=true;this._oModel.getMetaModel().loaded().then(function(){t.bPending=false;p(t._oMeta,n);});}}};m.prototype._bind=function(B){var n,o,p;p=this._oFieldControl.getControlProperties(this._oMetaData,B);for(n in p){o=this._oBinding.fromFormatter(this._oMetaData.model,p[n]);this._oParent.bindProperty(n,o);}this._oParent.fireInitialise();};m.prototype._setUOMEditState=function(){var o,B;if(this._oFieldControl.hasUomEditState(this._oMetaData)){o=this._oFieldControl.getUOMEditState(this._oMetaData);if(o){B=this._oBinding.fromFormatter(this._oMetaData.model,o);this._oParent.bindProperty("uomEditState",B);}}};m.prototype.getDataProperty=function(){return this._oMetaData.property;};m.prototype.getMetaData=function(){return this._oMetaData;};m.prototype.destroy=function(){this._oFieldControl.destroy();this._oSelector.destroy();this._oTypes.destroy();this._oHelper.destroy();this._oHelper=null;this._oFieldControl=null;this._oTypes=null;this._oSelector=null;this._oMetaData=null;g.prototype.destroy.apply(this,[]);};return m;},true);
