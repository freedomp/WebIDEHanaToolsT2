// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(g){"use strict";jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchShellHelper');jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchBar');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchHelper');sap.ui.jsview("sap.ushell.renderers.fiori2.search.container.App",{createContent:function(){var t=this;if(!this.oModel){this.oModel=sap.ushell.renderers.fiori2.search.getModelSingleton();}this.setModel(sap.ushell.resources.i18nModel,"i18n");this.oSearchResults=sap.ui.view({id:"searchContainerResultsView",tooltip:"{i18n>searchResultsView_tooltip}",viewName:"sap.ushell.renderers.fiori2.search.container.Search",type:sap.ui.core.mvc.ViewType.JS});this.oSearchResults.setModel(t.oModel);this.oSearchResults.setAppView(t);this.oModel.deserializeURL();this.oPage=this.pageFactory("searchPage",[this.oSearchResults]);return this.oPage;},beforeExit:function(){},pageFactory:function(i,c,d){var t=this;var s=new sap.ushell.renderers.fiori2.search.controls.SearchBar({oSearchLayout:t.oSearchResults.searchLayout,filterButtonPressed:t.oModel.getProperty('/facetVisibility'),filterButtonVisible:{parts:[{path:'/businessObjSearchEnabled'}],formatter:function(b){return!sap.ui.Device.system.phone&&b;}},contentMiddle:new sap.m.Label({text:{parts:[{path:'/count'}],formatter:function(a){var b=sap.ushell.resources.i18n.getText("searchResults")+' ('+sap.ui.core.format.NumberFormat.getIntegerInstance({style:"short"}).format(a)+')';return b;}}})});s.setModel(t.oModel);var p=new sap.m.Page({id:i,customHeader:s,content:c,enableScrolling:true,showFooter:true});p.setModel(t.oModel);var e=["onAfterHide","onAfterShow","onBeforeFirstShow","onBeforeHide","onBeforeShow"];var D={};t.createFooter(p);jQuery.each(e,function(I,E){D[E]=jQuery.proxy(function(a){jQuery.each(this.getContent(),function(I,c){c._handleEvent(a);});},p);});p.addEventDelegate(D);if(!sap.ui.Device.system.desktop){p._bUseIScroll=true;}if(d){this.disableBouncing(p);}if(!sap.ui.Device.support.touch){var v=sap.ui.getCore().byId("searchContainerApp");v.addStyleClass('sapUiSizeCompact');}return p;},getControllerName:function(){return"sap.ushell.renderers.fiori2.search.container.App";},createFooter:function(p){var t=this;if(jQuery.device.is.phone){return;}var b=new sap.ushell.ui.footerbar.AddBookmarkButton({beforePressHandler:function(){var A={url:document.URL,title:t.getTileTitleProposal(),icon:sap.ui.core.IconPool.getIconURI("search")};b.setAppData(A);}});b.setWidth('auto');var e=new sap.m.Button();e.setIcon("sap-icon://email");e.setText(sap.ushell.resources.i18n.getText("eMailFld"));e.attachPress(function(){sap.m.URLHelper.triggerEmail(null,t.getTileTitleProposal(),document.URL);});e.setWidth('auto');var a=new sap.m.ActionSheet({placement:'Top',buttons:[b,e]});var s=new sap.m.Button({icon:'sap-icon://action',tooltip:sap.ushell.resources.i18n.getText('shareBtn'),press:function(){a.openBy(s);}});var B=new sap.m.Bar({contentRight:[s]});var f=p.getFooter();if(f&&f.destroy){f.destroy();}p.setFooter(B);},getTileTitleProposal:function(){var s=this.oModel.getSearchBoxTerm();var d=this.oModel.getDataSource().label;var t;if(this.oModel.getDataSource().equals(this.oModel.allDataSource)){t=sap.ushell.resources.i18n.getText('searchTileTitleProposalAll',[s]);}else{t=sap.ushell.resources.i18n.getText('searchTileTitleProposal',[s,d]);}return t;}});}(window));
