/*!
* SAP APF Analysis Path Framework
* 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
jQuery.sap.require('sap.apf.ui.utils.facetFilterListHandler');jQuery.sap.require('sap.apf.ui.utils.facetFilterListConverter');(function(){'use strict';var c={};var f={};var s;var F=new sap.apf.ui.utils.FacetFilterListConverter();function _(C){var g;var h=C.getView().byId("idAPFFacetFilter").getLists();h.forEach(function(o){g=o.getId();f[g].getSelectedFFValues().then(e.bind(null,o));});}function a(o,g){var h=o.getId();var i=o.getModel();i.setSizeLimit(g.length);if(!o.getMultiSelect()){o.setGrowingThreshold(g.length);}i.setData(g);i.updateBindings();f[h].getSelectedFFValues().then(e.bind(null,o));}function b(o){var C=this;C.getView().byId("idAPFFacetFilter").removeList(o);}function d(g,o){var i;g.forEach(function(h){h.selected=false;});if(g.length!==o.length){o.forEach(function(h){for(i=0;i<g.length;i++){if(h===g[i].key){g[i].selected=true;break;}}});}return g;}function e(o,S){var g=o.getId();var h=o.getModel();var i=h.getData();c[g]=S;i=d(i,S);h.setData(i);h.updateBindings();}sap.ui.controller("sap.apf.ui.reuse.controller.facetFilter",{onInit:function(){var C=this,g;s=false;var v=C.getView().getViewData();v.aConfiguredFilters.forEach(function(o,n){g=C.getView().byId("idAPFFacetFilter").getLists()[n].getId();f[g]=new sap.apf.ui.utils.FacetFilterListHandler(v.oCoreApi,v.oUiApi,o,F);});C.populateAndSelectFFListValues();},populateAndSelectFFListValues:function(){var C=this,g;var h=C.getView().byId("idAPFFacetFilter").getLists();h.forEach(function(o){g=o.getId();f[g].getFacetFilterListData().then(a.bind(null,o),b.bind(C,o));});},onListClose:function(E){var C=this;var o=E.getSource();var i=E.getParameter('allSelected');var S=[],g,h,j,k,l,m;if(i){g=o.getItems();if(!jQuery.isEmptyObject(g)){S=g.map(function(D){return D.getKey();});}}else{g=o.getSelectedItems();S=g.map(function(I){return I.getKey();});}h=o.getId();j=c[h];if(S.length!==0&&j!==undefined){k=JSON.stringify(S.sort());l=JSON.stringify(j.sort());m=(k===l);if(!m){c[h]=S;s=true;f[h].setSelectedFFValues(S);C.getView().getViewData().oUiApi.selectionChanged(true);}}},onResetPress:function(){var C=this;if(s){C.getView().getViewData().oStartFilterHandler.resetVisibleStartFilters();_(C);C.getView().getViewData().oUiApi.selectionChanged(true);s=false;}}});}());
