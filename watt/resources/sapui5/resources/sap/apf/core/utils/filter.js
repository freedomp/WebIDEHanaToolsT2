/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare('sap.apf.core.utils.filter');jQuery.sap.require('sap.apf.core.utils.filterTerm');jQuery.sap.require('sap.apf.core.constants');(function(){'use strict';sap.apf.core.utils.Filter=function(m,a,b,c,d){var e="%20and%20";var f="%20or%20";this.type="internalFilter";var l;if(a&&(a instanceof sap.apf.core.utils.FilterTerm||a instanceof sap.apf.core.utils.Filter)){l=a;}else if(a!==undefined&&b!==undefined&&c!==undefined){l=new sap.apf.core.utils.FilterTerm(m,a,b,c,d);}else if(a!==undefined||b!==undefined||c!==undefined){m.check(false,"wrong arguments in construction of sap.apf.core.utils.Filter");}var r=[];var g;this.getProperties=function(){var i;var p=[];var P=[];var j="";if(l===undefined){return p;}if(l instanceof sap.apf.core.utils.FilterTerm){j=l.getProperty();p.push(j);}else if(l instanceof sap.apf.core.utils.Filter){p=l.getProperties();}for(i=0;i<r.length;i++){if(r[i]instanceof sap.apf.core.utils.FilterTerm){p.push(r[i].getProperty());}else{P=r[i].getProperties();p=p.concat(P);}}return sap.apf.utils.eliminateDuplicatesInArray(m,p);};this.copy=function(){var F;var i;if(l===undefined){return new sap.apf.core.utils.Filter(m);}F=new sap.apf.core.utils.Filter(m,l);if(g===undefined){return F;}for(i=0;i<r.length;i++){if(g===sap.apf.core.constants.BooleFilterOperators.AND){F.addAnd(r[i].copy());}else{F.addOr(r[i].copy());}}return F;};this.isEmpty=function(){if(l===undefined){return true;}if(l instanceof sap.apf.core.utils.FilterTerm){return false;}if(!l.isEmpty()){return false;}if(r.length===0){return true;}var i;for(i=0;i<r.length;++i){if(!r[i].isEmpty()){return false;}}return true;};this.isOr=function(){if(g===sap.apf.core.constants.BooleFilterOperators.OR){return true;}else if(g===sap.apf.core.constants.BooleFilterOperators.AND){return false;}if(l){if(l instanceof sap.apf.core.utils.Filter){return l.isOr();}}return false;};this.isEqual=function(F){if(this===F){return true;}if(F===undefined){return false;}return this.getHash()===F.getHash();};this.getHash=function(L){var n=L||1;var j=0;if(r.length===0){j=n;}else{j=n+1;}if(l===undefined){return 0;}var H=l.getHash(j);var i;if(g===undefined){return H;}if(g===sap.apf.core.constants.BooleFilterOperators.AND){H=H+Math.pow(2,n);}else if(g===sap.apf.core.constants.BooleFilterOperators.OR){H=H+Math.pow(3,n);}for(i=0;i<r.length;i++){H=H+r[i].getHash(j);}return H;};this.filterArray=function(D){var F=[];var i;var j=0;var k=D.length;if(k===0){return F;}var p;var C=false;var n=this.getProperties();var o=[];for(p in D[0]){if(jQuery.inArray(p,n)>-1){o.push(p);}}if(o.length===0){return D;}for(i=0;i<k;i++){C=true;for(j=0;j<o.length;++j){p=o[j];if(this.isConsistentWithFilter(p,D[i][p])===false){C=false;break;}}if(C){F.push(D[i]);}}return F;};this.getFilterTermsForProperty=function(p){var t=[];var i;if(l===undefined){return t;}if(l instanceof sap.apf.core.utils.Filter){t=l.getFilterTermsForProperty(p);}else if(p===l.getProperty()){t.push(l);}for(i=0;i<r.length;i++){if(r[i]instanceof sap.apf.core.utils.FilterTerm){if(p===r[i].getProperty()){t.push(r[i]);}}else{t=t.concat(r[i].getFilterTermsForProperty(p));}}return t;};this.getFilterTerms=function(){var t=[];var i;if(l===undefined){return t;}if(l instanceof sap.apf.core.utils.Filter){t=l.getFilterTerms();}else{t.push(l);}for(i=0;i<r.length;i++){if(r[i]instanceof sap.apf.core.utils.FilterTerm){t.push(r[i]);}else{t=t.concat(r[i].getFilterTerms());}}return t;};function h(i,p){if(i instanceof sap.apf.core.utils.FilterTerm){return i.getProperty()===p;}return i.getProperties().indexOf(p)>=0;}this.isConsistentWithFilter=function(p,v){var i;var j=false;if(l===undefined){return true;}if(g===undefined){return l.isConsistentWithFilter(p,v);}if(g===sap.apf.core.constants.BooleFilterOperators.AND){if(!l.isConsistentWithFilter(p,v)){return false;}for(i=0;i<r.length;i++){if(!r[i].isConsistentWithFilter(p,v)){return false;}}return true;}if(g===sap.apf.core.constants.BooleFilterOperators.OR){if(h(l,p)){j=true;if(l.isConsistentWithFilter(p,v)){return true;}}for(i=0;i<r.length;i++){if(h(r[i],p)){j=true;if(r[i].isConsistentWithFilter(p,v)){return true;}}}return!j;}};this.removeTermsByProperty=function(p){var i,R,o;if(l===undefined){return this.copy();}R=l.removeTermsByProperty(p);if(R instanceof sap.apf.core.utils.FilterTerm){R=new sap.apf.core.utils.Filter(m,R.getProperty(),R.getOp(),R.getValue(),R.getHighValue());}if(g===undefined){return R;}for(i=0;i<r.length;i++){o=r[i].removeTermsByProperty(p);if(R===undefined){if(o instanceof sap.apf.core.utils.FilterTerm){R=new sap.apf.core.utils.Filter(m,o);}else{R=o;}}else if(o!==undefined){if(g===sap.apf.core.constants.BooleFilterOperators.AND){R.addAnd(o);}else{R.addOr(o);}}}if(R){return new sap.apf.core.utils.Filter(m,R);}};this.removeTerms=function(p,o,v){var i;if(l===undefined){return this.copy();}var F=l.removeTerms(p,o,v);var j;if(F instanceof sap.apf.core.utils.FilterTerm){F=new sap.apf.core.utils.Filter(m,F.getProperty(),F.getOp(),F.getValue(),F.getHighValue());}if(g===undefined){return F;}for(i=0;i<r.length;i++){j=r[i].removeTerms(p,o,v);if(F===undefined){if(j instanceof sap.apf.core.utils.FilterTerm){F=new sap.apf.core.utils.Filter(m,j);}else{F=j;}}else if(j!==undefined){if(g===sap.apf.core.constants.BooleFilterOperators.AND){F.addAnd(j);}else{F.addOr(j);}}}return F;};this.addOr=function(a,b,c,d){var F;if(a instanceof sap.apf.core.utils.Filter||a instanceof sap.apf.core.utils.FilterTerm){F=a;}else if(a!==undefined&&b!==undefined&&c!==undefined){F=new sap.apf.core.utils.FilterTerm(m,a,b,c,d);}else{m.check(false,"sap.apf.core.utils.Filter.addOr: wrong arguments in construction of  Filter");}if(l===undefined){l=F;return this;}if(g===undefined){g=sap.apf.core.constants.BooleFilterOperators.OR;}r.push(F);m.check(g===sap.apf.core.constants.BooleFilterOperators.OR,"sap.apf.core.utils.Filter - addOr wrong operation");return this;};this.addAnd=function(a,b,c,d){var F;if(a instanceof sap.apf.core.utils.Filter||a instanceof sap.apf.core.utils.FilterTerm){F=a;}else if(a!==undefined&&b!==undefined&&c!==undefined){F=new sap.apf.core.utils.FilterTerm(m,a,b,c,d);}else{m.check(false,"sap.apf.core.utils.Filter.addAnd: wrong arguments in construction of  Filter");}if(l===undefined){l=F;return this;}if(g===undefined){g=sap.apf.core.constants.BooleFilterOperators.AND;}m.check(g===sap.apf.core.constants.BooleFilterOperators.AND,"sap.apf.core.utils.Filter - addAnd wrong operation");r.push(F);return this;};this.toUrlParam=function(j){var A=false;var p=[];var E="";if(j!==undefined&&j.asFilterArray===true){A=true;}if(l===undefined){if(A===true){return[];}return"";}if(A===true){p=l.toUrlParam(j);}else{E=l.toUrlParam(j);}var i=0;var k=r.length;var C="";if(k===0){if(A===true){return p;}return E;}if(g===sap.apf.core.constants.BooleFilterOperators.AND){C=e;}else{C=f;}var R="";if(A===true){for(i=0;i<k;i++){p=p.concat(r[i].toUrlParam(j));}return p;}for(i=0;i<k;i++){R=r[i].toUrlParam(j);if(E===""){E=R;}else if(R!==""){E=E+C+R;}}return'('+E+')';};this.mapToSapUI5FilterExpression=function(){var i,j,F=[];if(l===undefined){return{};}if(r.length===0){return l.mapToSapUI5FilterExpression();}F.push(l.mapToSapUI5FilterExpression());for(i=0;i<r.length;i++){F.push(r[i].mapToSapUI5FilterExpression());}j={filters:F,and:g===sap.apf.core.constants.BooleFilterOperators.AND};return j;};this.overwriteWith=function(F){var p=F.getProperties();var R;if(p.length!==0){R=this.removeTermsByProperty(p);if(R===undefined){return F.copy();}R.addAnd(F);return R;}return this.copy();};this.reduceToProperty=function(){var p=[];var P;switch(arguments.length){case 1:P=arguments[0];if(P instanceof Array){p=P;}else{p.push(P);}break;default:p=Array.prototype.slice.call(arguments,0);}var F=s(this.getProperties(),p);return this.copy().removeTermsByProperty(F)||new sap.apf.core.utils.Filter(m);function s(S,j){var i;var k=[];var n={};var o=S?S.length:0;var q=j?j.length:0;for(i=0;i<q;i++){n[j[i]]=undefined;}for(i=0;i<o;i++){if(!(S[i]in n)){k.push(S[i]);}}return k;}};this.isFilterTerm=function(){if(r.length>0){return false;}if(!l){return false;}if(l instanceof sap.apf.core.utils.FilterTerm){return true;}return l.isFilterTerm();};this.traverse=function(v){if(!l){return v.processEmptyFilter();}if(l&&r.length===0){if(l instanceof sap.apf.core.utils.FilterTerm){return v.processTerm(l);}return l.traverse(v);}if(g===sap.apf.core.constants.BooleFilterOperators.AND){return v.processAnd(l,r,this);}if(g===sap.apf.core.constants.BooleFilterOperators.OR){return v.processOr(l,r,this);}m.check(false,'undefined case in traverse()');return false;};this.isDisjunctionOverEqualities=function(){var i=true;if(g===sap.apf.core.constants.BooleFilterOperators.AND){return false;}if(this.getProperties().length>1){return false;}if(l instanceof sap.apf.core.utils.Filter){if(l.getFilterTerms().length>1){return false;}}this.getFilterTerms().forEach(function(j){if(j.getOp()!==sap.apf.core.constants.FilterOperators.EQ){i=false;}});r.forEach(function(j){if(j instanceof sap.apf.core.utils.Filter){if(j.getFilterTerms().length>1){i=false;}}});return i;};};sap.apf.core.utils.Filter.createFromArray=function(m,p,d,I){var l=p.length;var i;var n;var j;var f;var F;var o;m.check(p instanceof Array&&p.length>0,"sap.apf.core.utils.Filter.createFromArray incorrect argument aProperties");m.check(d instanceof Array,"sap.apf.core.utils.Filter.createFromArray incorrect argument aData");if(I.length>0){for(i=0;i<I.length;++i){F=undefined;n=I[i];if(!d[n]){continue;}for(j=0;j<l;j++){o=new sap.apf.core.utils.Filter(m,p[j],sap.apf.core.constants.FilterOperators.EQ,d[n][p[j]]);if(F===undefined){F=new sap.apf.core.utils.Filter(m,o);}else{F.addAnd(o);}}if(f===undefined){f=new sap.apf.core.utils.Filter(m,F);}else{f.addOr(F);}}return f;}return new sap.apf.core.utils.Filter(m);};sap.apf.core.utils.Filter.createEmptyFilter=function(m,p){m.check(jQuery.isArray(p)&&p.length>0,"sap.apf.core.utils.Filter.createEmptyFilter - array with property names expected");return new sap.apf.core.utils.Filter(m,p[0],sap.apf.core.constants.FilterOperators.EQ,'').addAnd(p[0],sap.apf.core.constants.FilterOperators.NE,'');};sap.apf.core.utils.Filter.transformUI5FilterToInternal=function(m,u){return t(u,u.and);function t(u,a){var r=new sap.apf.core.utils.Filter(m);var s;if(u.filters){u.filters.forEach(function(f){if(f.filters){s=t(f,f.and);if(a){r.addAnd(s);}else{r.addOr(s);}}else if(f.path){if(a){r.addAnd(f.path,f.operator,f.value1,f.value2);}else{r.addOr(f.path,f.operator,f.value1,f.value2);}}});}else{r=new sap.apf.core.utils.Filter(m,u.path,u.operator,u.value1,u.value2);}return r;}};}());
